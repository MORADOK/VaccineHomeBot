var vo=Object.defineProperty;var jo=(t,s,a)=>s in t?vo(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var Me=(t,s,a)=>jo(t,typeof s!="symbol"?s+"":s,a);import{c as Ra,a as bo,u as ts,j as e,B as yo,P as Ve,b as La,d as $a,e as we,f as gs,V as Yn,R as No,g as wo,h as _o,i as So,k as Kn,D as Do,C as Co,S as ko,l as Eo,m as Ao,n as To,A as Io,o as Po,p as Ot,L as Jn,T as Qn,q as Xn,r as Mo,s as Zn,I as Ro,t as er,v as tr,w as Lo,x as sr,y as $o,z as ar,E as nr,F as Oo,G as Fo,H as rr,J as Vo,K as zo,O as ks,M as ir,N as Es,Q as or,U as As,W as Ts,X as lr,Y as Wo,Z as Bo}from"./ui-vendor-DiFimc_Y.js";import{a as cr,r as h,R as B,G as Uo,u as dr,d as Ft,N as fn,L as Gs,B as Ho,e as qo,f as ke}from"./react-vendor-DWcd0Lhh.js";import{c as mr}from"./chart-vendor-Cnqy24AO.js";import{X as Is,T as je,R as Se,B as vs,Z as Pt,C as G,F as Go,a as ye,D as js,A as Xe,b as Yo,S as Ee,I as Be,c as Ae,M as ft,d as jt,U as ot,e as Ce,f as $e,g as Oe,h as be,i as bs,j as ur,k as Ko,l as rt,m as Ze,n as Jo,P as Oa,o as Fa,L as hr,p as Ps,Q as gn,E as Ms,q as Va,r as Pe,G as Mt,s as pr,t as xr,u as fr,v as bt,w as De,x as Qo,y as yt,z as lt,H as Xo,J as Zo,K as ys,N as Zt,O as Ns,V as ws,W as gr,Y as el,_ as ua,$ as ls,a0 as tl,a1 as sl,a2 as al,a3 as nl,a4 as Ys,a5 as vn,a6 as jn,a7 as rl,a8 as vr,a9 as cs}from"./icons-vendor-iqovqxPN.js";import{u as Rt,a as Rs,b as ha,Q as il,c as ol}from"./query-vendor-DoV0zaUI.js";import{c as ll}from"./supabase-vendor-CQ6tMPmr.js";import{z as At,u as cl}from"./form-vendor-DgJNYV6L.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();var jr,bn=cr;jr=bn.createRoot,bn.hydrateRoot;const dl=1,ml=1e6;let Ks=0;function ul(){return Ks=(Ks+1)%Number.MAX_SAFE_INTEGER,Ks.toString()}const Js=new Map,yn=t=>{if(Js.has(t))return;const s=setTimeout(()=>{Js.delete(t),Jt({type:"REMOVE_TOAST",toastId:t})},ml);Js.set(t,s)},hl=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,dl)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(a=>a.id===s.toast.id?{...a,...s.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=s;return a?yn(a):t.toasts.forEach(n=>{yn(n.id)}),{...t,toasts:t.toasts.map(n=>n.id===a||a===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==s.toastId)}}},ps=[];let xs={toasts:[]};function Jt(t){xs=hl(xs,t),ps.forEach(s=>{s(xs)})}function pl({...t}){const s=ul(),a=r=>Jt({type:"UPDATE_TOAST",toast:{...r,id:s}}),n=()=>Jt({type:"DISMISS_TOAST",toastId:s});return Jt({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:r=>{r||n()}}}),{id:s,dismiss:n,update:a}}function ce(){const[t,s]=h.useState(xs);return h.useEffect(()=>(ps.push(s),()=>{const a=ps.indexOf(s);a>-1&&ps.splice(a,1)}),[t]),{...t,toast:pl,dismiss:a=>Jt({type:"DISMISS_TOAST",toastId:a})}}var za="ToastProvider",[Wa,xl,fl]=bo("Toast"),[br]=Ra("Toast",[fl]),[gl,Ls]=br(za),yr=t=>{const{__scopeToast:s,label:a="Notification",duration:n=5e3,swipeDirection:r="right",swipeThreshold:i=50,children:o}=t,[c,d]=h.useState(null),[p,u]=h.useState(0),j=h.useRef(!1),l=h.useRef(!1);return a.trim()||console.error(`Invalid prop \`label\` supplied to \`${za}\`. Expected non-empty \`string\`.`),e.jsx(Wa.Provider,{scope:s,children:e.jsx(gl,{scope:s,label:a,duration:n,swipeDirection:r,swipeThreshold:i,toastCount:p,viewport:c,onViewportChange:d,onToastAdd:h.useCallback(()=>u(m=>m+1),[]),onToastRemove:h.useCallback(()=>u(m=>m-1),[]),isFocusedToastEscapeKeyDownRef:j,isClosePausedRef:l,children:o})})};yr.displayName=za;var Nr="ToastViewport",vl=["F8"],pa="toast.viewportPause",xa="toast.viewportResume",wr=h.forwardRef((t,s)=>{const{__scopeToast:a,hotkey:n=vl,label:r="Notifications ({hotkey})",...i}=t,o=Ls(Nr,a),c=xl(a),d=h.useRef(null),p=h.useRef(null),u=h.useRef(null),j=h.useRef(null),l=ts(s,j,o.onViewportChange),m=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),x=o.toastCount>0;h.useEffect(()=>{const v=f=>{var _;n.length!==0&&n.every(A=>f[A]||f.code===A)&&((_=j.current)==null||_.focus())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[n]),h.useEffect(()=>{const v=d.current,f=j.current;if(x&&v&&f){const N=()=>{if(!o.isClosePausedRef.current){const V=new CustomEvent(pa);f.dispatchEvent(V),o.isClosePausedRef.current=!0}},_=()=>{if(o.isClosePausedRef.current){const V=new CustomEvent(xa);f.dispatchEvent(V),o.isClosePausedRef.current=!1}},A=V=>{!v.contains(V.relatedTarget)&&_()},E=()=>{v.contains(document.activeElement)||_()};return v.addEventListener("focusin",N),v.addEventListener("focusout",A),v.addEventListener("pointermove",N),v.addEventListener("pointerleave",E),window.addEventListener("blur",N),window.addEventListener("focus",_),()=>{v.removeEventListener("focusin",N),v.removeEventListener("focusout",A),v.removeEventListener("pointermove",N),v.removeEventListener("pointerleave",E),window.removeEventListener("blur",N),window.removeEventListener("focus",_)}}},[x,o.isClosePausedRef]);const g=h.useCallback(({tabbingDirection:v})=>{const N=c().map(_=>{const A=_.ref.current,E=[A,...Tl(A)];return v==="forwards"?E:E.reverse()});return(v==="forwards"?N.reverse():N).flat()},[c]);return h.useEffect(()=>{const v=j.current;if(v){const f=N=>{var E,V,Y;const _=N.altKey||N.ctrlKey||N.metaKey;if(N.key==="Tab"&&!_){const P=document.activeElement,T=N.shiftKey;if(N.target===v&&T){(E=p.current)==null||E.focus();return}const w=g({tabbingDirection:T?"backwards":"forwards"}),M=w.findIndex(I=>I===P);Qs(w.slice(M+1))?N.preventDefault():T?(V=p.current)==null||V.focus():(Y=u.current)==null||Y.focus()}};return v.addEventListener("keydown",f),()=>v.removeEventListener("keydown",f)}},[c,g]),e.jsxs(yo,{ref:d,role:"region","aria-label":r.replace("{hotkey}",m),tabIndex:-1,style:{pointerEvents:x?void 0:"none"},children:[x&&e.jsx(fa,{ref:p,onFocusFromOutsideViewport:()=>{const v=g({tabbingDirection:"forwards"});Qs(v)}}),e.jsx(Wa.Slot,{scope:a,children:e.jsx(Ve.ol,{tabIndex:-1,...i,ref:l})}),x&&e.jsx(fa,{ref:u,onFocusFromOutsideViewport:()=>{const v=g({tabbingDirection:"backwards"});Qs(v)}})]})});wr.displayName=Nr;var _r="ToastFocusProxy",fa=h.forwardRef((t,s)=>{const{__scopeToast:a,onFocusFromOutsideViewport:n,...r}=t,i=Ls(_r,a);return e.jsx(Yn,{"aria-hidden":!0,tabIndex:0,...r,ref:s,style:{position:"fixed"},onFocus:o=>{var p;const c=o.relatedTarget;!((p=i.viewport)!=null&&p.contains(c))&&n()}})});fa.displayName=_r;var $s="Toast",jl="toast.swipeStart",bl="toast.swipeMove",yl="toast.swipeCancel",Nl="toast.swipeEnd",Sr=h.forwardRef((t,s)=>{const{forceMount:a,open:n,defaultOpen:r,onOpenChange:i,...o}=t,[c=!0,d]=La({prop:n,defaultProp:r,onChange:i});return e.jsx($a,{present:a||c,children:e.jsx(Sl,{open:c,...o,ref:s,onClose:()=>d(!1),onPause:gs(t.onPause),onResume:gs(t.onResume),onSwipeStart:we(t.onSwipeStart,p=>{p.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:we(t.onSwipeMove,p=>{const{x:u,y:j}=p.detail.delta;p.currentTarget.setAttribute("data-swipe","move"),p.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),p.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${j}px`)}),onSwipeCancel:we(t.onSwipeCancel,p=>{p.currentTarget.setAttribute("data-swipe","cancel"),p.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),p.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),p.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),p.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:we(t.onSwipeEnd,p=>{const{x:u,y:j}=p.detail.delta;p.currentTarget.setAttribute("data-swipe","end"),p.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),p.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),p.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),p.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${j}px`),d(!1)})})})});Sr.displayName=$s;var[wl,_l]=br($s,{onClose(){}}),Sl=h.forwardRef((t,s)=>{const{__scopeToast:a,type:n="foreground",duration:r,open:i,onClose:o,onEscapeKeyDown:c,onPause:d,onResume:p,onSwipeStart:u,onSwipeMove:j,onSwipeCancel:l,onSwipeEnd:m,...x}=t,g=Ls($s,a),[v,f]=h.useState(null),N=ts(s,I=>f(I)),_=h.useRef(null),A=h.useRef(null),E=r||g.duration,V=h.useRef(0),Y=h.useRef(E),P=h.useRef(0),{onToastAdd:T,onToastRemove:W}=g,b=gs(()=>{var F;(v==null?void 0:v.contains(document.activeElement))&&((F=g.viewport)==null||F.focus()),o()}),w=h.useCallback(I=>{!I||I===1/0||(window.clearTimeout(P.current),V.current=new Date().getTime(),P.current=window.setTimeout(b,I))},[b]);h.useEffect(()=>{const I=g.viewport;if(I){const F=()=>{w(Y.current),p==null||p()},z=()=>{const C=new Date().getTime()-V.current;Y.current=Y.current-C,window.clearTimeout(P.current),d==null||d()};return I.addEventListener(pa,z),I.addEventListener(xa,F),()=>{I.removeEventListener(pa,z),I.removeEventListener(xa,F)}}},[g.viewport,E,d,p,w]),h.useEffect(()=>{i&&!g.isClosePausedRef.current&&w(E)},[i,E,g.isClosePausedRef,w]),h.useEffect(()=>(T(),()=>W()),[T,W]);const M=h.useMemo(()=>v?Ir(v):null,[v]);return g.viewport?e.jsxs(e.Fragment,{children:[M&&e.jsx(Dl,{__scopeToast:a,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:M}),e.jsx(wl,{scope:a,onClose:b,children:cr.createPortal(e.jsx(Wa.ItemSlot,{scope:a,children:e.jsx(No,{asChild:!0,onEscapeKeyDown:we(c,()=>{g.isFocusedToastEscapeKeyDownRef.current||b(),g.isFocusedToastEscapeKeyDownRef.current=!1}),children:e.jsx(Ve.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":g.swipeDirection,...x,ref:N,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:we(t.onKeyDown,I=>{I.key==="Escape"&&(c==null||c(I.nativeEvent),I.nativeEvent.defaultPrevented||(g.isFocusedToastEscapeKeyDownRef.current=!0,b()))}),onPointerDown:we(t.onPointerDown,I=>{I.button===0&&(_.current={x:I.clientX,y:I.clientY})}),onPointerMove:we(t.onPointerMove,I=>{if(!_.current)return;const F=I.clientX-_.current.x,z=I.clientY-_.current.y,C=!!A.current,y=["left","right"].includes(g.swipeDirection),R=["left","up"].includes(g.swipeDirection)?Math.min:Math.max,J=y?R(0,F):0,q=y?0:R(0,z),te=I.pointerType==="touch"?10:2,ne={x:J,y:q},ve={originalEvent:I,delta:ne};C?(A.current=ne,ds(bl,j,ve,{discrete:!1})):Nn(ne,g.swipeDirection,te)?(A.current=ne,ds(jl,u,ve,{discrete:!1}),I.target.setPointerCapture(I.pointerId)):(Math.abs(F)>te||Math.abs(z)>te)&&(_.current=null)}),onPointerUp:we(t.onPointerUp,I=>{const F=A.current,z=I.target;if(z.hasPointerCapture(I.pointerId)&&z.releasePointerCapture(I.pointerId),A.current=null,_.current=null,F){const C=I.currentTarget,y={originalEvent:I,delta:F};Nn(F,g.swipeDirection,g.swipeThreshold)?ds(Nl,m,y,{discrete:!0}):ds(yl,l,y,{discrete:!0}),C.addEventListener("click",R=>R.preventDefault(),{once:!0})}})})})}),g.viewport)})]}):null}),Dl=t=>{const{__scopeToast:s,children:a,...n}=t,r=Ls($s,s),[i,o]=h.useState(!1),[c,d]=h.useState(!1);return El(()=>o(!0)),h.useEffect(()=>{const p=window.setTimeout(()=>d(!0),1e3);return()=>window.clearTimeout(p)},[]),c?null:e.jsx(wo,{asChild:!0,children:e.jsx(Yn,{...n,children:i&&e.jsxs(e.Fragment,{children:[r.label," ",a]})})})},Cl="ToastTitle",Dr=h.forwardRef((t,s)=>{const{__scopeToast:a,...n}=t;return e.jsx(Ve.div,{...n,ref:s})});Dr.displayName=Cl;var kl="ToastDescription",Cr=h.forwardRef((t,s)=>{const{__scopeToast:a,...n}=t;return e.jsx(Ve.div,{...n,ref:s})});Cr.displayName=kl;var kr="ToastAction",Er=h.forwardRef((t,s)=>{const{altText:a,...n}=t;return a.trim()?e.jsx(Tr,{altText:a,asChild:!0,children:e.jsx(Ba,{...n,ref:s})}):(console.error(`Invalid prop \`altText\` supplied to \`${kr}\`. Expected non-empty \`string\`.`),null)});Er.displayName=kr;var Ar="ToastClose",Ba=h.forwardRef((t,s)=>{const{__scopeToast:a,...n}=t,r=_l(Ar,a);return e.jsx(Tr,{asChild:!0,children:e.jsx(Ve.button,{type:"button",...n,ref:s,onClick:we(t.onClick,r.onClose)})})});Ba.displayName=Ar;var Tr=h.forwardRef((t,s)=>{const{__scopeToast:a,altText:n,...r}=t;return e.jsx(Ve.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...r,ref:s})});function Ir(t){const s=[];return Array.from(t.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&s.push(n.textContent),Al(n)){const r=n.ariaHidden||n.hidden||n.style.display==="none",i=n.dataset.radixToastAnnounceExclude==="";if(!r)if(i){const o=n.dataset.radixToastAnnounceAlt;o&&s.push(o)}else s.push(...Ir(n))}}),s}function ds(t,s,a,{discrete:n}){const r=a.originalEvent.currentTarget,i=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:a});s&&r.addEventListener(t,s,{once:!0}),n?So(r,i):r.dispatchEvent(i)}var Nn=(t,s,a=0)=>{const n=Math.abs(t.x),r=Math.abs(t.y),i=n>r;return s==="left"||s==="right"?i&&n>a:!i&&r>a};function El(t=()=>{}){const s=gs(t);_o(()=>{let a=0,n=0;return a=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(s)),()=>{window.cancelAnimationFrame(a),window.cancelAnimationFrame(n)}},[s])}function Al(t){return t.nodeType===t.ELEMENT_NODE}function Tl(t){const s=[],a=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const r=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||r?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)s.push(a.currentNode);return s}function Qs(t){const s=document.activeElement;return t.some(a=>a===s?!0:(a.focus(),document.activeElement!==s))}var Il=yr,Pr=wr,Mr=Sr,Rr=Dr,Lr=Cr,$r=Er,Or=Ba;const wn=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,_n=mr,wt=(t,s)=>a=>{var n;if((s==null?void 0:s.variants)==null)return _n(t,a==null?void 0:a.class,a==null?void 0:a.className);const{variants:r,defaultVariants:i}=s,o=Object.keys(r).map(p=>{const u=a==null?void 0:a[p],j=i==null?void 0:i[p];if(u===null)return null;const l=wn(u)||wn(j);return r[p][l]}),c=a&&Object.entries(a).reduce((p,u)=>{let[j,l]=u;return l===void 0||(p[j]=l),p},{}),d=s==null||(n=s.compoundVariants)===null||n===void 0?void 0:n.reduce((p,u)=>{let{class:j,className:l,...m}=u;return Object.entries(m).every(x=>{let[g,v]=x;return Array.isArray(v)?v.includes({...i,...c}[g]):{...i,...c}[g]===v})?[...p,j,l]:p},[]);return _n(t,o,d,a==null?void 0:a.class,a==null?void 0:a.className)},Ua="-",Pl=t=>{const s=Rl(t),{conflictingClassGroups:a,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:o=>{const c=o.split(Ua);return c[0]===""&&c.length!==1&&c.shift(),Fr(c,s)||Ml(o)},getConflictingClassGroupIds:(o,c)=>{const d=a[o]||[];return c&&n[o]?[...d,...n[o]]:d}}},Fr=(t,s)=>{var o;if(t.length===0)return s.classGroupId;const a=t[0],n=s.nextPart.get(a),r=n?Fr(t.slice(1),n):void 0;if(r)return r;if(s.validators.length===0)return;const i=t.join(Ua);return(o=s.validators.find(({validator:c})=>c(i)))==null?void 0:o.classGroupId},Sn=/^\[(.+)\]$/,Ml=t=>{if(Sn.test(t)){const s=Sn.exec(t)[1],a=s==null?void 0:s.substring(0,s.indexOf(":"));if(a)return"arbitrary.."+a}},Rl=t=>{const{theme:s,prefix:a}=t,n={nextPart:new Map,validators:[]};return $l(Object.entries(t.classGroups),a).forEach(([i,o])=>{ga(o,n,i,s)}),n},ga=(t,s,a,n)=>{t.forEach(r=>{if(typeof r=="string"){const i=r===""?s:Dn(s,r);i.classGroupId=a;return}if(typeof r=="function"){if(Ll(r)){ga(r(n),s,a,n);return}s.validators.push({validator:r,classGroupId:a});return}Object.entries(r).forEach(([i,o])=>{ga(o,Dn(s,i),a,n)})})},Dn=(t,s)=>{let a=t;return s.split(Ua).forEach(n=>{a.nextPart.has(n)||a.nextPart.set(n,{nextPart:new Map,validators:[]}),a=a.nextPart.get(n)}),a},Ll=t=>t.isThemeGetter,$l=(t,s)=>s?t.map(([a,n])=>{const r=n.map(i=>typeof i=="string"?s+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,c])=>[s+o,c])):i);return[a,r]}):t,Ol=t=>{if(t<1)return{get:()=>{},set:()=>{}};let s=0,a=new Map,n=new Map;const r=(i,o)=>{a.set(i,o),s++,s>t&&(s=0,n=a,a=new Map)};return{get(i){let o=a.get(i);if(o!==void 0)return o;if((o=n.get(i))!==void 0)return r(i,o),o},set(i,o){a.has(i)?a.set(i,o):r(i,o)}}},Vr="!",Fl=t=>{const{separator:s,experimentalParseClassName:a}=t,n=s.length===1,r=s[0],i=s.length,o=c=>{const d=[];let p=0,u=0,j;for(let v=0;v<c.length;v++){let f=c[v];if(p===0){if(f===r&&(n||c.slice(v,v+i)===s)){d.push(c.slice(u,v)),u=v+i;continue}if(f==="/"){j=v;continue}}f==="["?p++:f==="]"&&p--}const l=d.length===0?c:c.substring(u),m=l.startsWith(Vr),x=m?l.substring(1):l,g=j&&j>u?j-u:void 0;return{modifiers:d,hasImportantModifier:m,baseClassName:x,maybePostfixModifierPosition:g}};return a?c=>a({className:c,parseClassName:o}):o},Vl=t=>{if(t.length<=1)return t;const s=[];let a=[];return t.forEach(n=>{n[0]==="["?(s.push(...a.sort(),n),a=[]):a.push(n)}),s.push(...a.sort()),s},zl=t=>({cache:Ol(t.cacheSize),parseClassName:Fl(t),...Pl(t)}),Wl=/\s+/,Bl=(t,s)=>{const{parseClassName:a,getClassGroupId:n,getConflictingClassGroupIds:r}=s,i=[],o=t.trim().split(Wl);let c="";for(let d=o.length-1;d>=0;d-=1){const p=o[d],{modifiers:u,hasImportantModifier:j,baseClassName:l,maybePostfixModifierPosition:m}=a(p);let x=!!m,g=n(x?l.substring(0,m):l);if(!g){if(!x){c=p+(c.length>0?" "+c:c);continue}if(g=n(l),!g){c=p+(c.length>0?" "+c:c);continue}x=!1}const v=Vl(u).join(":"),f=j?v+Vr:v,N=f+g;if(i.includes(N))continue;i.push(N);const _=r(g,x);for(let A=0;A<_.length;++A){const E=_[A];i.push(f+E)}c=p+(c.length>0?" "+c:c)}return c};function Ul(){let t=0,s,a,n="";for(;t<arguments.length;)(s=arguments[t++])&&(a=zr(s))&&(n&&(n+=" "),n+=a);return n}const zr=t=>{if(typeof t=="string")return t;let s,a="";for(let n=0;n<t.length;n++)t[n]&&(s=zr(t[n]))&&(a&&(a+=" "),a+=s);return a};function Hl(t,...s){let a,n,r,i=o;function o(d){const p=s.reduce((u,j)=>j(u),t());return a=zl(p),n=a.cache.get,r=a.cache.set,i=c,c(d)}function c(d){const p=n(d);if(p)return p;const u=Bl(d,a);return r(d,u),u}return function(){return i(Ul.apply(null,arguments))}}const fe=t=>{const s=a=>a[t]||[];return s.isThemeGetter=!0,s},Wr=/^\[(?:([a-z-]+):)?(.+)\]$/i,ql=/^\d+\/\d+$/,Gl=new Set(["px","full","screen"]),Yl=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Kl=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Jl=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Ql=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Xl=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,at=t=>Tt(t)||Gl.has(t)||ql.test(t),ht=t=>Vt(t,"length",ic),Tt=t=>!!t&&!Number.isNaN(Number(t)),Xs=t=>Vt(t,"number",Tt),Ut=t=>!!t&&Number.isInteger(Number(t)),Zl=t=>t.endsWith("%")&&Tt(t.slice(0,-1)),ie=t=>Wr.test(t),pt=t=>Yl.test(t),ec=new Set(["length","size","percentage"]),tc=t=>Vt(t,ec,Br),sc=t=>Vt(t,"position",Br),ac=new Set(["image","url"]),nc=t=>Vt(t,ac,lc),rc=t=>Vt(t,"",oc),Ht=()=>!0,Vt=(t,s,a)=>{const n=Wr.exec(t);return n?n[1]?typeof s=="string"?n[1]===s:s.has(n[1]):a(n[2]):!1},ic=t=>Kl.test(t)&&!Jl.test(t),Br=()=>!1,oc=t=>Ql.test(t),lc=t=>Xl.test(t),cc=()=>{const t=fe("colors"),s=fe("spacing"),a=fe("blur"),n=fe("brightness"),r=fe("borderColor"),i=fe("borderRadius"),o=fe("borderSpacing"),c=fe("borderWidth"),d=fe("contrast"),p=fe("grayscale"),u=fe("hueRotate"),j=fe("invert"),l=fe("gap"),m=fe("gradientColorStops"),x=fe("gradientColorStopPositions"),g=fe("inset"),v=fe("margin"),f=fe("opacity"),N=fe("padding"),_=fe("saturate"),A=fe("scale"),E=fe("sepia"),V=fe("skew"),Y=fe("space"),P=fe("translate"),T=()=>["auto","contain","none"],W=()=>["auto","hidden","clip","visible","scroll"],b=()=>["auto",ie,s],w=()=>[ie,s],M=()=>["",at,ht],I=()=>["auto",Tt,ie],F=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],z=()=>["solid","dashed","dotted","double","none"],C=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],y=()=>["start","end","center","between","around","evenly","stretch"],R=()=>["","0",ie],J=()=>["auto","avoid","all","avoid-page","page","left","right","column"],q=()=>[Tt,ie];return{cacheSize:500,separator:":",theme:{colors:[Ht],spacing:[at,ht],blur:["none","",pt,ie],brightness:q(),borderColor:[t],borderRadius:["none","","full",pt,ie],borderSpacing:w(),borderWidth:M(),contrast:q(),grayscale:R(),hueRotate:q(),invert:R(),gap:w(),gradientColorStops:[t],gradientColorStopPositions:[Zl,ht],inset:b(),margin:b(),opacity:q(),padding:w(),saturate:q(),scale:q(),sepia:R(),skew:q(),space:w(),translate:w()},classGroups:{aspect:[{aspect:["auto","square","video",ie]}],container:["container"],columns:[{columns:[pt]}],"break-after":[{"break-after":J()}],"break-before":[{"break-before":J()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...F(),ie]}],overflow:[{overflow:W()}],"overflow-x":[{"overflow-x":W()}],"overflow-y":[{"overflow-y":W()}],overscroll:[{overscroll:T()}],"overscroll-x":[{"overscroll-x":T()}],"overscroll-y":[{"overscroll-y":T()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ut,ie]}],basis:[{basis:b()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ie]}],grow:[{grow:R()}],shrink:[{shrink:R()}],order:[{order:["first","last","none",Ut,ie]}],"grid-cols":[{"grid-cols":[Ht]}],"col-start-end":[{col:["auto",{span:["full",Ut,ie]},ie]}],"col-start":[{"col-start":I()}],"col-end":[{"col-end":I()}],"grid-rows":[{"grid-rows":[Ht]}],"row-start-end":[{row:["auto",{span:[Ut,ie]},ie]}],"row-start":[{"row-start":I()}],"row-end":[{"row-end":I()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ie]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ie]}],gap:[{gap:[l]}],"gap-x":[{"gap-x":[l]}],"gap-y":[{"gap-y":[l]}],"justify-content":[{justify:["normal",...y()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...y(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...y(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[N]}],px:[{px:[N]}],py:[{py:[N]}],ps:[{ps:[N]}],pe:[{pe:[N]}],pt:[{pt:[N]}],pr:[{pr:[N]}],pb:[{pb:[N]}],pl:[{pl:[N]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[Y]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Y]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ie,s]}],"min-w":[{"min-w":[ie,s,"min","max","fit"]}],"max-w":[{"max-w":[ie,s,"none","full","min","max","fit","prose",{screen:[pt]},pt]}],h:[{h:[ie,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ie,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ie,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ie,s,"auto","min","max","fit"]}],"font-size":[{text:["base",pt,ht]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Xs]}],"font-family":[{font:[Ht]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ie]}],"line-clamp":[{"line-clamp":["none",Tt,Xs]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",at,ie]}],"list-image":[{"list-image":["none",ie]}],"list-style-type":[{list:["none","disc","decimal",ie]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[f]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[f]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...z(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",at,ht]}],"underline-offset":[{"underline-offset":["auto",at,ie]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:w()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ie]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ie]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[f]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...F(),sc]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",tc]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},nc]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[f]}],"border-style":[{border:[...z(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[f]}],"divide-style":[{divide:z()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["",...z()]}],"outline-offset":[{"outline-offset":[at,ie]}],"outline-w":[{outline:[at,ht]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:M()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[f]}],"ring-offset-w":[{"ring-offset":[at,ht]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",pt,rc]}],"shadow-color":[{shadow:[Ht]}],opacity:[{opacity:[f]}],"mix-blend":[{"mix-blend":[...C(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":C()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[n]}],contrast:[{contrast:[d]}],"drop-shadow":[{"drop-shadow":["","none",pt,ie]}],grayscale:[{grayscale:[p]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[j]}],saturate:[{saturate:[_]}],sepia:[{sepia:[E]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[d]}],"backdrop-grayscale":[{"backdrop-grayscale":[p]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[j]}],"backdrop-opacity":[{"backdrop-opacity":[f]}],"backdrop-saturate":[{"backdrop-saturate":[_]}],"backdrop-sepia":[{"backdrop-sepia":[E]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ie]}],duration:[{duration:q()}],ease:[{ease:["linear","in","out","in-out",ie]}],delay:[{delay:q()}],animate:[{animate:["none","spin","ping","pulse","bounce",ie]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[A]}],"scale-x":[{"scale-x":[A]}],"scale-y":[{"scale-y":[A]}],rotate:[{rotate:[Ut,ie]}],"translate-x":[{"translate-x":[P]}],"translate-y":[{"translate-y":[P]}],"skew-x":[{"skew-x":[V]}],"skew-y":[{"skew-y":[V]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ie]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ie]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":w()}],"scroll-mx":[{"scroll-mx":w()}],"scroll-my":[{"scroll-my":w()}],"scroll-ms":[{"scroll-ms":w()}],"scroll-me":[{"scroll-me":w()}],"scroll-mt":[{"scroll-mt":w()}],"scroll-mr":[{"scroll-mr":w()}],"scroll-mb":[{"scroll-mb":w()}],"scroll-ml":[{"scroll-ml":w()}],"scroll-p":[{"scroll-p":w()}],"scroll-px":[{"scroll-px":w()}],"scroll-py":[{"scroll-py":w()}],"scroll-ps":[{"scroll-ps":w()}],"scroll-pe":[{"scroll-pe":w()}],"scroll-pt":[{"scroll-pt":w()}],"scroll-pr":[{"scroll-pr":w()}],"scroll-pb":[{"scroll-pb":w()}],"scroll-pl":[{"scroll-pl":w()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ie]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[at,ht,Xs]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},dc=Hl(cc);function U(...t){return dc(mr(t))}const mc=Il,Ur=h.forwardRef(({className:t,...s},a)=>e.jsx(Pr,{ref:a,className:U("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...s}));Ur.displayName=Pr.displayName;const uc=wt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Hr=h.forwardRef(({className:t,variant:s,...a},n)=>e.jsx(Mr,{ref:n,className:U(uc({variant:s}),t),...a}));Hr.displayName=Mr.displayName;const hc=h.forwardRef(({className:t,...s},a)=>e.jsx($r,{ref:a,className:U("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...s}));hc.displayName=$r.displayName;const qr=h.forwardRef(({className:t,...s},a)=>e.jsx(Or,{ref:a,className:U("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:e.jsx(Is,{className:"h-4 w-4"})}));qr.displayName=Or.displayName;const Gr=h.forwardRef(({className:t,...s},a)=>e.jsx(Rr,{ref:a,className:U("text-sm font-semibold",t),...s}));Gr.displayName=Rr.displayName;const Yr=h.forwardRef(({className:t,...s},a)=>e.jsx(Lr,{ref:a,className:U("text-sm opacity-90",t),...s}));Yr.displayName=Lr.displayName;function pc(){const{toasts:t}=ce();return e.jsxs(mc,{children:[t.map(function({id:s,title:a,description:n,action:r,...i}){return e.jsxs(Hr,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(Gr,{children:a}),n&&e.jsx(Yr,{children:n})]}),r,e.jsx(qr,{})]},s)}),e.jsx(Ur,{})]})}var Cn=["light","dark"],xc="(prefers-color-scheme: dark)",fc=h.createContext(void 0),gc={setTheme:t=>{},themes:[]},vc=()=>{var t;return(t=h.useContext(fc))!=null?t:gc};h.memo(({forcedTheme:t,storageKey:s,attribute:a,enableSystem:n,enableColorScheme:r,defaultTheme:i,value:o,attrs:c,nonce:d})=>{let p=i==="system",u=a==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${c.map(x=>`'${x}'`).join(",")})`};`:`var d=document.documentElement,n='${a}',s='setAttribute';`,j=r?Cn.includes(i)&&i?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${i}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",l=(x,g=!1,v=!0)=>{let f=o?o[x]:x,N=g?x+"|| ''":`'${f}'`,_="";return r&&v&&!g&&Cn.includes(x)&&(_+=`d.style.colorScheme = '${x}';`),a==="class"?g||f?_+=`c.add(${N})`:_+="null":f&&(_+=`d[s](n,${N})`),_},m=t?`!function(){${u}${l(t)}}()`:n?`!function(){try{${u}var e=localStorage.getItem('${s}');if('system'===e||(!e&&${p})){var t='${xc}',m=window.matchMedia(t);if(m.media!==t||m.matches){${l("dark")}}else{${l("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${l(o?"x[e]":"e",!0)}}${p?"":"else{"+l(i,!1,!1)+"}"}${j}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${s}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${l(o?"x[e]":"e",!0)}}else{${l(i,!1,!1)};}${j}}catch(t){}}();`;return h.createElement("script",{nonce:d,dangerouslySetInnerHTML:{__html:m}})});var jc=t=>{switch(t){case"success":return Nc;case"info":return _c;case"warning":return wc;case"error":return Sc;default:return null}},bc=Array(12).fill(0),yc=({visible:t})=>B.createElement("div",{className:"sonner-loading-wrapper","data-visible":t},B.createElement("div",{className:"sonner-spinner"},bc.map((s,a)=>B.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),Nc=B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},B.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),wc=B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},B.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),_c=B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},B.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Sc=B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},B.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Dc=()=>{let[t,s]=B.useState(document.hidden);return B.useEffect(()=>{let a=()=>{s(document.hidden)};return document.addEventListener("visibilitychange",a),()=>window.removeEventListener("visibilitychange",a)},[]),t},va=1,Cc=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let s=this.subscribers.indexOf(t);this.subscribers.splice(s,1)}),this.publish=t=>{this.subscribers.forEach(s=>s(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var s;let{message:a,...n}=t,r=typeof(t==null?void 0:t.id)=="number"||((s=t.id)==null?void 0:s.length)>0?t.id:va++,i=this.toasts.find(c=>c.id===r),o=t.dismissible===void 0?!0:t.dismissible;return i?this.toasts=this.toasts.map(c=>c.id===r?(this.publish({...c,...t,id:r,title:a}),{...c,...t,id:r,dismissible:o,title:a}):c):this.addToast({title:a,...n,dismissible:o,id:r}),r},this.dismiss=t=>(t||this.toasts.forEach(s=>{this.subscribers.forEach(a=>a({id:s.id,dismiss:!0}))}),this.subscribers.forEach(s=>s({id:t,dismiss:!0})),t),this.message=(t,s)=>this.create({...s,message:t}),this.error=(t,s)=>this.create({...s,message:t,type:"error"}),this.success=(t,s)=>this.create({...s,type:"success",message:t}),this.info=(t,s)=>this.create({...s,type:"info",message:t}),this.warning=(t,s)=>this.create({...s,type:"warning",message:t}),this.loading=(t,s)=>this.create({...s,type:"loading",message:t}),this.promise=(t,s)=>{if(!s)return;let a;s.loading!==void 0&&(a=this.create({...s,promise:t,type:"loading",message:s.loading,description:typeof s.description!="function"?s.description:void 0}));let n=t instanceof Promise?t:t(),r=a!==void 0;return n.then(async i=>{if(Ec(i)&&!i.ok){r=!1;let o=typeof s.error=="function"?await s.error(`HTTP error! status: ${i.status}`):s.error,c=typeof s.description=="function"?await s.description(`HTTP error! status: ${i.status}`):s.description;this.create({id:a,type:"error",message:o,description:c})}else if(s.success!==void 0){r=!1;let o=typeof s.success=="function"?await s.success(i):s.success,c=typeof s.description=="function"?await s.description(i):s.description;this.create({id:a,type:"success",message:o,description:c})}}).catch(async i=>{if(s.error!==void 0){r=!1;let o=typeof s.error=="function"?await s.error(i):s.error,c=typeof s.description=="function"?await s.description(i):s.description;this.create({id:a,type:"error",message:o,description:c})}}).finally(()=>{var i;r&&(this.dismiss(a),a=void 0),(i=s.finally)==null||i.call(s)}),a},this.custom=(t,s)=>{let a=(s==null?void 0:s.id)||va++;return this.create({jsx:t(a),id:a,...s}),a},this.subscribers=[],this.toasts=[]}},Re=new Cc,kc=(t,s)=>{let a=(s==null?void 0:s.id)||va++;return Re.addToast({title:t,...s,id:a}),a},Ec=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",Ac=kc,Tc=()=>Re.toasts;Object.assign(Ac,{success:Re.success,info:Re.info,warning:Re.warning,error:Re.error,custom:Re.custom,message:Re.message,promise:Re.promise,dismiss:Re.dismiss,loading:Re.loading},{getHistory:Tc});function Ic(t,{insertAt:s}={}){if(typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",s==="top"&&a.firstChild?a.insertBefore(n,a.firstChild):a.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}Ic(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function ms(t){return t.label!==void 0}var Pc=3,Mc="32px",Rc=4e3,Lc=356,$c=14,Oc=20,Fc=200;function Vc(...t){return t.filter(Boolean).join(" ")}var zc=t=>{var s,a,n,r,i,o,c,d,p,u;let{invert:j,toast:l,unstyled:m,interacting:x,setHeights:g,visibleToasts:v,heights:f,index:N,toasts:_,expanded:A,removeToast:E,defaultRichColors:V,closeButton:Y,style:P,cancelButtonStyle:T,actionButtonStyle:W,className:b="",descriptionClassName:w="",duration:M,position:I,gap:F,loadingIcon:z,expandByDefault:C,classNames:y,icons:R,closeButtonAriaLabel:J="Close toast",pauseWhenPageIsHidden:q,cn:te}=t,[ne,ve]=B.useState(!1),[pe,de]=B.useState(!1),[mt,_t]=B.useState(!1),[Wt,Bt]=B.useState(!1),[io,Us]=B.useState(0),[oo,cn]=B.useState(0),dn=B.useRef(null),St=B.useRef(null),lo=N===0,co=N+1<=v,We=l.type,Dt=l.dismissible!==!1,mo=l.className||"",uo=l.descriptionClassName||"",is=B.useMemo(()=>f.findIndex(re=>re.toastId===l.id)||0,[f,l.id]),ho=B.useMemo(()=>{var re;return(re=l.closeButton)!=null?re:Y},[l.closeButton,Y]),mn=B.useMemo(()=>l.duration||M||Rc,[l.duration,M]),Hs=B.useRef(0),Ct=B.useRef(0),un=B.useRef(0),kt=B.useRef(null),[hn,po]=I.split("-"),pn=B.useMemo(()=>f.reduce((re,xe,ue)=>ue>=is?re:re+xe.height,0),[f,is]),xn=Dc(),xo=l.invert||j,qs=We==="loading";Ct.current=B.useMemo(()=>is*F+pn,[is,pn]),B.useEffect(()=>{ve(!0)},[]),B.useLayoutEffect(()=>{if(!ne)return;let re=St.current,xe=re.style.height;re.style.height="auto";let ue=re.getBoundingClientRect().height;re.style.height=xe,cn(ue),g(Ye=>Ye.find(Ke=>Ke.toastId===l.id)?Ye.map(Ke=>Ke.toastId===l.id?{...Ke,height:ue}:Ke):[{toastId:l.id,height:ue,position:l.position},...Ye])},[ne,l.title,l.description,g,l.id]);let ut=B.useCallback(()=>{de(!0),Us(Ct.current),g(re=>re.filter(xe=>xe.toastId!==l.id)),setTimeout(()=>{E(l)},Fc)},[l,E,g,Ct]);B.useEffect(()=>{if(l.promise&&We==="loading"||l.duration===1/0||l.type==="loading")return;let re,xe=mn;return A||x||q&&xn?(()=>{if(un.current<Hs.current){let ue=new Date().getTime()-Hs.current;xe=xe-ue}un.current=new Date().getTime()})():xe!==1/0&&(Hs.current=new Date().getTime(),re=setTimeout(()=>{var ue;(ue=l.onAutoClose)==null||ue.call(l,l),ut()},xe)),()=>clearTimeout(re)},[A,x,C,l,mn,ut,l.promise,We,q,xn]),B.useEffect(()=>{let re=St.current;if(re){let xe=re.getBoundingClientRect().height;return cn(xe),g(ue=>[{toastId:l.id,height:xe,position:l.position},...ue]),()=>g(ue=>ue.filter(Ye=>Ye.toastId!==l.id))}},[g,l.id]),B.useEffect(()=>{l.delete&&ut()},[ut,l.delete]);function fo(){return R!=null&&R.loading?B.createElement("div",{className:"sonner-loader","data-visible":We==="loading"},R.loading):z?B.createElement("div",{className:"sonner-loader","data-visible":We==="loading"},z):B.createElement(yc,{visible:We==="loading"})}return B.createElement("li",{"aria-live":l.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:St,className:te(b,mo,y==null?void 0:y.toast,(s=l==null?void 0:l.classNames)==null?void 0:s.toast,y==null?void 0:y.default,y==null?void 0:y[We],(a=l==null?void 0:l.classNames)==null?void 0:a[We]),"data-sonner-toast":"","data-rich-colors":(n=l.richColors)!=null?n:V,"data-styled":!(l.jsx||l.unstyled||m),"data-mounted":ne,"data-promise":!!l.promise,"data-removed":pe,"data-visible":co,"data-y-position":hn,"data-x-position":po,"data-index":N,"data-front":lo,"data-swiping":mt,"data-dismissible":Dt,"data-type":We,"data-invert":xo,"data-swipe-out":Wt,"data-expanded":!!(A||C&&ne),style:{"--index":N,"--toasts-before":N,"--z-index":_.length-N,"--offset":`${pe?io:Ct.current}px`,"--initial-height":C?"auto":`${oo}px`,...P,...l.style},onPointerDown:re=>{qs||!Dt||(dn.current=new Date,Us(Ct.current),re.target.setPointerCapture(re.pointerId),re.target.tagName!=="BUTTON"&&(_t(!0),kt.current={x:re.clientX,y:re.clientY}))},onPointerUp:()=>{var re,xe,ue,Ye;if(Wt||!Dt)return;kt.current=null;let Ke=Number(((re=St.current)==null?void 0:re.style.getPropertyValue("--swipe-amount").replace("px",""))||0),os=new Date().getTime()-((xe=dn.current)==null?void 0:xe.getTime()),go=Math.abs(Ke)/os;if(Math.abs(Ke)>=Oc||go>.11){Us(Ct.current),(ue=l.onDismiss)==null||ue.call(l,l),ut(),Bt(!0);return}(Ye=St.current)==null||Ye.style.setProperty("--swipe-amount","0px"),_t(!1)},onPointerMove:re=>{var xe;if(!kt.current||!Dt)return;let ue=re.clientY-kt.current.y,Ye=re.clientX-kt.current.x,Ke=(hn==="top"?Math.min:Math.max)(0,ue),os=re.pointerType==="touch"?10:2;Math.abs(Ke)>os?(xe=St.current)==null||xe.style.setProperty("--swipe-amount",`${ue}px`):Math.abs(Ye)>os&&(kt.current=null)}},ho&&!l.jsx?B.createElement("button",{"aria-label":J,"data-disabled":qs,"data-close-button":!0,onClick:qs||!Dt?()=>{}:()=>{var re;ut(),(re=l.onDismiss)==null||re.call(l,l)},className:te(y==null?void 0:y.closeButton,(r=l==null?void 0:l.classNames)==null?void 0:r.closeButton)},B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},B.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),B.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,l.jsx||B.isValidElement(l.title)?l.jsx||l.title:B.createElement(B.Fragment,null,We||l.icon||l.promise?B.createElement("div",{"data-icon":"",className:te(y==null?void 0:y.icon,(i=l==null?void 0:l.classNames)==null?void 0:i.icon)},l.promise||l.type==="loading"&&!l.icon?l.icon||fo():null,l.type!=="loading"?l.icon||(R==null?void 0:R[We])||jc(We):null):null,B.createElement("div",{"data-content":"",className:te(y==null?void 0:y.content,(o=l==null?void 0:l.classNames)==null?void 0:o.content)},B.createElement("div",{"data-title":"",className:te(y==null?void 0:y.title,(c=l==null?void 0:l.classNames)==null?void 0:c.title)},l.title),l.description?B.createElement("div",{"data-description":"",className:te(w,uo,y==null?void 0:y.description,(d=l==null?void 0:l.classNames)==null?void 0:d.description)},l.description):null),B.isValidElement(l.cancel)?l.cancel:l.cancel&&ms(l.cancel)?B.createElement("button",{"data-button":!0,"data-cancel":!0,style:l.cancelButtonStyle||T,onClick:re=>{var xe,ue;ms(l.cancel)&&Dt&&((ue=(xe=l.cancel).onClick)==null||ue.call(xe,re),ut())},className:te(y==null?void 0:y.cancelButton,(p=l==null?void 0:l.classNames)==null?void 0:p.cancelButton)},l.cancel.label):null,B.isValidElement(l.action)?l.action:l.action&&ms(l.action)?B.createElement("button",{"data-button":!0,"data-action":!0,style:l.actionButtonStyle||W,onClick:re=>{var xe,ue;ms(l.action)&&(re.defaultPrevented||((ue=(xe=l.action).onClick)==null||ue.call(xe,re),ut()))},className:te(y==null?void 0:y.actionButton,(u=l==null?void 0:l.classNames)==null?void 0:u.actionButton)},l.action.label):null))};function kn(){if(typeof window>"u"||typeof document>"u")return"ltr";let t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}var Wc=t=>{let{invert:s,position:a="bottom-right",hotkey:n=["altKey","KeyT"],expand:r,closeButton:i,className:o,offset:c,theme:d="light",richColors:p,duration:u,style:j,visibleToasts:l=Pc,toastOptions:m,dir:x=kn(),gap:g=$c,loadingIcon:v,icons:f,containerAriaLabel:N="Notifications",pauseWhenPageIsHidden:_,cn:A=Vc}=t,[E,V]=B.useState([]),Y=B.useMemo(()=>Array.from(new Set([a].concat(E.filter(q=>q.position).map(q=>q.position)))),[E,a]),[P,T]=B.useState([]),[W,b]=B.useState(!1),[w,M]=B.useState(!1),[I,F]=B.useState(d!=="system"?d:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),z=B.useRef(null),C=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),y=B.useRef(null),R=B.useRef(!1),J=B.useCallback(q=>{var te;(te=E.find(ne=>ne.id===q.id))!=null&&te.delete||Re.dismiss(q.id),V(ne=>ne.filter(({id:ve})=>ve!==q.id))},[E]);return B.useEffect(()=>Re.subscribe(q=>{if(q.dismiss){V(te=>te.map(ne=>ne.id===q.id?{...ne,delete:!0}:ne));return}setTimeout(()=>{Uo.flushSync(()=>{V(te=>{let ne=te.findIndex(ve=>ve.id===q.id);return ne!==-1?[...te.slice(0,ne),{...te[ne],...q},...te.slice(ne+1)]:[q,...te]})})})}),[]),B.useEffect(()=>{if(d!=="system"){F(d);return}d==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?F("dark"):F("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:q})=>{F(q?"dark":"light")})},[d]),B.useEffect(()=>{E.length<=1&&b(!1)},[E]),B.useEffect(()=>{let q=te=>{var ne,ve;n.every(pe=>te[pe]||te.code===pe)&&(b(!0),(ne=z.current)==null||ne.focus()),te.code==="Escape"&&(document.activeElement===z.current||(ve=z.current)!=null&&ve.contains(document.activeElement))&&b(!1)};return document.addEventListener("keydown",q),()=>document.removeEventListener("keydown",q)},[n]),B.useEffect(()=>{if(z.current)return()=>{y.current&&(y.current.focus({preventScroll:!0}),y.current=null,R.current=!1)}},[z.current]),E.length?B.createElement("section",{"aria-label":`${N} ${C}`,tabIndex:-1},Y.map((q,te)=>{var ne;let[ve,pe]=q.split("-");return B.createElement("ol",{key:q,dir:x==="auto"?kn():x,tabIndex:-1,ref:z,className:o,"data-sonner-toaster":!0,"data-theme":I,"data-y-position":ve,"data-x-position":pe,style:{"--front-toast-height":`${((ne=P[0])==null?void 0:ne.height)||0}px`,"--offset":typeof c=="number"?`${c}px`:c||Mc,"--width":`${Lc}px`,"--gap":`${g}px`,...j},onBlur:de=>{R.current&&!de.currentTarget.contains(de.relatedTarget)&&(R.current=!1,y.current&&(y.current.focus({preventScroll:!0}),y.current=null))},onFocus:de=>{de.target instanceof HTMLElement&&de.target.dataset.dismissible==="false"||R.current||(R.current=!0,y.current=de.relatedTarget)},onMouseEnter:()=>b(!0),onMouseMove:()=>b(!0),onMouseLeave:()=>{w||b(!1)},onPointerDown:de=>{de.target instanceof HTMLElement&&de.target.dataset.dismissible==="false"||M(!0)},onPointerUp:()=>M(!1)},E.filter(de=>!de.position&&te===0||de.position===q).map((de,mt)=>{var _t,Wt;return B.createElement(zc,{key:de.id,icons:f,index:mt,toast:de,defaultRichColors:p,duration:(_t=m==null?void 0:m.duration)!=null?_t:u,className:m==null?void 0:m.className,descriptionClassName:m==null?void 0:m.descriptionClassName,invert:s,visibleToasts:l,closeButton:(Wt=m==null?void 0:m.closeButton)!=null?Wt:i,interacting:w,position:q,style:m==null?void 0:m.style,unstyled:m==null?void 0:m.unstyled,classNames:m==null?void 0:m.classNames,cancelButtonStyle:m==null?void 0:m.cancelButtonStyle,actionButtonStyle:m==null?void 0:m.actionButtonStyle,removeToast:J,toasts:E.filter(Bt=>Bt.position==de.position),heights:P.filter(Bt=>Bt.position==de.position),setHeights:T,expandByDefault:r,gap:g,loadingIcon:v,expanded:W,pauseWhenPageIsHidden:_,cn:A})}))})):null};const Bc=({...t})=>{const{theme:s="system"}=vc();return e.jsx(Wc,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})};var[Os]=Ra("Tooltip",[Kn]),Fs=Kn(),Kr="TooltipProvider",Uc=700,ja="tooltip.open",[Hc,Ha]=Os(Kr),Jr=t=>{const{__scopeTooltip:s,delayDuration:a=Uc,skipDelayDuration:n=300,disableHoverableContent:r=!1,children:i}=t,[o,c]=h.useState(!0),d=h.useRef(!1),p=h.useRef(0);return h.useEffect(()=>{const u=p.current;return()=>window.clearTimeout(u)},[]),e.jsx(Hc,{scope:s,isOpenDelayed:o,delayDuration:a,onOpen:h.useCallback(()=>{window.clearTimeout(p.current),c(!1)},[]),onClose:h.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>c(!0),n)},[n]),isPointerInTransitRef:d,onPointerInTransitChange:h.useCallback(u=>{d.current=u},[]),disableHoverableContent:r,children:i})};Jr.displayName=Kr;var Vs="Tooltip",[qc,zs]=Os(Vs),Qr=t=>{const{__scopeTooltip:s,children:a,open:n,defaultOpen:r=!1,onOpenChange:i,disableHoverableContent:o,delayDuration:c}=t,d=Ha(Vs,t.__scopeTooltip),p=Fs(s),[u,j]=h.useState(null),l=Ao(),m=h.useRef(0),x=o??d.disableHoverableContent,g=c??d.delayDuration,v=h.useRef(!1),[f=!1,N]=La({prop:n,defaultProp:r,onChange:Y=>{Y?(d.onOpen(),document.dispatchEvent(new CustomEvent(ja))):d.onClose(),i==null||i(Y)}}),_=h.useMemo(()=>f?v.current?"delayed-open":"instant-open":"closed",[f]),A=h.useCallback(()=>{window.clearTimeout(m.current),m.current=0,v.current=!1,N(!0)},[N]),E=h.useCallback(()=>{window.clearTimeout(m.current),m.current=0,N(!1)},[N]),V=h.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>{v.current=!0,N(!0),m.current=0},g)},[g,N]);return h.useEffect(()=>()=>{m.current&&(window.clearTimeout(m.current),m.current=0)},[]),e.jsx(To,{...p,children:e.jsx(qc,{scope:s,contentId:l,open:f,stateAttribute:_,trigger:u,onTriggerChange:j,onTriggerEnter:h.useCallback(()=>{d.isOpenDelayed?V():A()},[d.isOpenDelayed,V,A]),onTriggerLeave:h.useCallback(()=>{x?E():(window.clearTimeout(m.current),m.current=0)},[E,x]),onOpen:A,onClose:E,disableHoverableContent:x,children:a})})};Qr.displayName=Vs;var ba="TooltipTrigger",Xr=h.forwardRef((t,s)=>{const{__scopeTooltip:a,...n}=t,r=zs(ba,a),i=Ha(ba,a),o=Fs(a),c=h.useRef(null),d=ts(s,c,r.onTriggerChange),p=h.useRef(!1),u=h.useRef(!1),j=h.useCallback(()=>p.current=!1,[]);return h.useEffect(()=>()=>document.removeEventListener("pointerup",j),[j]),e.jsx(Io,{asChild:!0,...o,children:e.jsx(Ve.button,{"aria-describedby":r.open?r.contentId:void 0,"data-state":r.stateAttribute,...n,ref:d,onPointerMove:we(t.onPointerMove,l=>{l.pointerType!=="touch"&&!u.current&&!i.isPointerInTransitRef.current&&(r.onTriggerEnter(),u.current=!0)}),onPointerLeave:we(t.onPointerLeave,()=>{r.onTriggerLeave(),u.current=!1}),onPointerDown:we(t.onPointerDown,()=>{p.current=!0,document.addEventListener("pointerup",j,{once:!0})}),onFocus:we(t.onFocus,()=>{p.current||r.onOpen()}),onBlur:we(t.onBlur,r.onClose),onClick:we(t.onClick,r.onClose)})})});Xr.displayName=ba;var Gc="TooltipPortal",[Xx,Yc]=Os(Gc,{forceMount:void 0}),Lt="TooltipContent",Zr=h.forwardRef((t,s)=>{const a=Yc(Lt,t.__scopeTooltip),{forceMount:n=a.forceMount,side:r="top",...i}=t,o=zs(Lt,t.__scopeTooltip);return e.jsx($a,{present:n||o.open,children:o.disableHoverableContent?e.jsx(ei,{side:r,...i,ref:s}):e.jsx(Kc,{side:r,...i,ref:s})})}),Kc=h.forwardRef((t,s)=>{const a=zs(Lt,t.__scopeTooltip),n=Ha(Lt,t.__scopeTooltip),r=h.useRef(null),i=ts(s,r),[o,c]=h.useState(null),{trigger:d,onClose:p}=a,u=r.current,{onPointerInTransitChange:j}=n,l=h.useCallback(()=>{c(null),j(!1)},[j]),m=h.useCallback((x,g)=>{const v=x.currentTarget,f={x:x.clientX,y:x.clientY},N=Zc(f,v.getBoundingClientRect()),_=ed(f,N),A=td(g.getBoundingClientRect()),E=ad([..._,...A]);c(E),j(!0)},[j]);return h.useEffect(()=>()=>l(),[l]),h.useEffect(()=>{if(d&&u){const x=v=>m(v,u),g=v=>m(v,d);return d.addEventListener("pointerleave",x),u.addEventListener("pointerleave",g),()=>{d.removeEventListener("pointerleave",x),u.removeEventListener("pointerleave",g)}}},[d,u,m,l]),h.useEffect(()=>{if(o){const x=g=>{const v=g.target,f={x:g.clientX,y:g.clientY},N=(d==null?void 0:d.contains(v))||(u==null?void 0:u.contains(v)),_=!sd(f,o);N?l():_&&(l(),p())};return document.addEventListener("pointermove",x),()=>document.removeEventListener("pointermove",x)}},[d,u,o,p,l]),e.jsx(ei,{...t,ref:i})}),[Jc,Qc]=Os(Vs,{isInside:!1}),ei=h.forwardRef((t,s)=>{const{__scopeTooltip:a,children:n,"aria-label":r,onEscapeKeyDown:i,onPointerDownOutside:o,...c}=t,d=zs(Lt,a),p=Fs(a),{onClose:u}=d;return h.useEffect(()=>(document.addEventListener(ja,u),()=>document.removeEventListener(ja,u)),[u]),h.useEffect(()=>{if(d.trigger){const j=l=>{const m=l.target;m!=null&&m.contains(d.trigger)&&u()};return window.addEventListener("scroll",j,{capture:!0}),()=>window.removeEventListener("scroll",j,{capture:!0})}},[d.trigger,u]),e.jsx(Do,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:j=>j.preventDefault(),onDismiss:u,children:e.jsxs(Co,{"data-state":d.stateAttribute,...p,...c,ref:s,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(ko,{children:n}),e.jsx(Jc,{scope:a,isInside:!0,children:e.jsx(Eo,{id:d.contentId,role:"tooltip",children:r||n})})]})})});Zr.displayName=Lt;var ti="TooltipArrow",Xc=h.forwardRef((t,s)=>{const{__scopeTooltip:a,...n}=t,r=Fs(a);return Qc(ti,a).isInside?null:e.jsx(Po,{...r,...n,ref:s})});Xc.displayName=ti;function Zc(t,s){const a=Math.abs(s.top-t.y),n=Math.abs(s.bottom-t.y),r=Math.abs(s.right-t.x),i=Math.abs(s.left-t.x);switch(Math.min(a,n,r,i)){case i:return"left";case r:return"right";case a:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function ed(t,s,a=5){const n=[];switch(s){case"top":n.push({x:t.x-a,y:t.y+a},{x:t.x+a,y:t.y+a});break;case"bottom":n.push({x:t.x-a,y:t.y-a},{x:t.x+a,y:t.y-a});break;case"left":n.push({x:t.x+a,y:t.y-a},{x:t.x+a,y:t.y+a});break;case"right":n.push({x:t.x-a,y:t.y-a},{x:t.x-a,y:t.y+a});break}return n}function td(t){const{top:s,right:a,bottom:n,left:r}=t;return[{x:r,y:s},{x:a,y:s},{x:a,y:n},{x:r,y:n}]}function sd(t,s){const{x:a,y:n}=t;let r=!1;for(let i=0,o=s.length-1;i<s.length;o=i++){const c=s[i].x,d=s[i].y,p=s[o].x,u=s[o].y;d>n!=u>n&&a<(p-c)*(n-d)/(u-d)+c&&(r=!r)}return r}function ad(t){const s=t.slice();return s.sort((a,n)=>a.x<n.x?-1:a.x>n.x?1:a.y<n.y?-1:a.y>n.y?1:0),nd(s)}function nd(t){if(t.length<=1)return t.slice();const s=[];for(let n=0;n<t.length;n++){const r=t[n];for(;s.length>=2;){const i=s[s.length-1],o=s[s.length-2];if((i.x-o.x)*(r.y-o.y)>=(i.y-o.y)*(r.x-o.x))s.pop();else break}s.push(r)}s.pop();const a=[];for(let n=t.length-1;n>=0;n--){const r=t[n];for(;a.length>=2;){const i=a[a.length-1],o=a[a.length-2];if((i.x-o.x)*(r.y-o.y)>=(i.y-o.y)*(r.x-o.x))a.pop();else break}a.push(r)}return a.pop(),s.length===1&&a.length===1&&s[0].x===a[0].x&&s[0].y===a[0].y?s:s.concat(a)}var rd=Jr,id=Qr,od=Xr,si=Zr;const ai=rd,ld=id,cd=od,ni=h.forwardRef(({className:t,sideOffset:s=4,...a},n)=>e.jsx(si,{ref:n,sideOffset:s,className:U("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a}));ni.displayName=si.displayName;const S=h.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:U("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s}));S.displayName="Card";const L=h.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:U("flex flex-col space-y-1.5 p-6",t),...s}));L.displayName="CardHeader";const $=h.forwardRef(({className:t,...s},a)=>e.jsx("h3",{ref:a,className:U("text-2xl font-semibold leading-none tracking-tight",t),...s}));$.displayName="CardTitle";const oe=h.forwardRef(({className:t,...s},a)=>e.jsx("p",{ref:a,className:U("text-sm text-muted-foreground",t),...s}));oe.displayName="CardDescription";const D=h.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:U("p-6 pt-0",t),...s}));D.displayName="CardContent";const dd=h.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:U("flex items-center p-6 pt-0",t),...s}));dd.displayName="CardFooter";const ya=wt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),k=h.forwardRef(({className:t,variant:s,size:a,asChild:n=!1,...r},i)=>{const o=n?Ot:"button";return e.jsx(o,{className:U(ya({variant:s,size:a,className:t})),ref:i,...r})});k.displayName="Button";const md=wt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Q=h.forwardRef(({className:t,variant:s,...a},n)=>e.jsx("div",{ref:n,role:"alert",className:U(md({variant:s}),t),...a}));Q.displayName="Alert";const ud=h.forwardRef(({className:t,...s},a)=>e.jsx("h5",{ref:a,className:U("mb-1 font-medium leading-none tracking-tight",t),...s}));ud.displayName="AlertTitle";const X=h.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:U("text-sm [&_p]:leading-relaxed",t),...s}));X.displayName="AlertDescription";class hd extends h.Component{constructor(a){super(a);Me(this,"handleReset",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0}}componentDidCatch(a,n){console.error("ErrorBoundary caught an error:",a,n),this.setState({error:a,errorInfo:n})}render(){var a;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-muted/30",children:e.jsxs(S,{className:"max-w-md w-full",children:[e.jsxs(L,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(je,{className:"h-12 w-12 text-destructive"})}),e.jsx($,{className:"text-destructive",children:"เกิดข้อผิดพลาด"}),e.jsx(oe,{children:"ขออภัย แอปพลิเคชันเกิดข้อผิดพลาดที่ไม่คาดคิด"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs(Q,{variant:"destructive",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(X,{children:((a=this.state.error)==null?void 0:a.message)||"Unknown error occurred"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{onClick:this.handleReset,className:"w-full",variant:"outline",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"ลองใหม่อีกครั้ง"]}),e.jsx(k,{onClick:()=>window.location.reload(),className:"w-full",variant:"secondary",children:"รีโหลดหน้าเว็บ"})]}),!1]})]})}):this.props.children}}const Ue=Mo,ze=h.forwardRef(({className:t,...s},a)=>e.jsx(Jn,{ref:a,className:U("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s}));ze.displayName=Jn.displayName;const Z=h.forwardRef(({className:t,...s},a)=>e.jsx(Qn,{ref:a,className:U("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s}));Z.displayName=Qn.displayName;const ee=h.forwardRef(({className:t,...s},a)=>e.jsx(Xn,{ref:a,className:U("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));ee.displayName=Xn.displayName;const pd=wt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function H({className:t,variant:s,...a}){return e.jsx("div",{className:U(pd({variant:s}),t),...a})}const zt=h.forwardRef(({className:t,...s},a)=>e.jsx("textarea",{className:U("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:a,...s}));zt.displayName="Textarea";var xd="Separator",En="horizontal",fd=["horizontal","vertical"],ri=h.forwardRef((t,s)=>{const{decorative:a,orientation:n=En,...r}=t,i=gd(n)?n:En,c=a?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return e.jsx(Ve.div,{"data-orientation":i,...c,...r,ref:s})});ri.displayName=xd;function gd(t){return fd.includes(t)}var ii=ri;const ge=h.forwardRef(({className:t,orientation:s="horizontal",decorative:a=!0,...n},r)=>e.jsx(ii,{ref:r,decorative:a,orientation:s,className:U("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...n}));ge.displayName=ii.displayName;const vd=({workflowNodes:t=[]})=>{const[s,a]=h.useState([]),[n,r]=h.useState(null),{toast:i}=ce(),o=()=>{const m=[{id:"ai-smart-router",name:"AI Smart Router (Rich Menu Compatible)",type:"ai-router",description:"รองรับ Rich Menu, Postback และ Quick Reply",replaces:t.filter(g=>g.type==="n8n-nodes-base.switch").map(g=>g.name),code:`// AI Smart Router - Rich Menu & Quick Reply Compatible
const input = $json.body?.events?.[0];
if (!input) {
  throw new Error('Invalid webhook payload: No events found');
}

// รองรับทั้ง text message, postback และ quick reply
const userMessage = input.message?.text || 
                   input.postbackData?.data || 
                   input.message?.quickReply?.postbackData?.data || 
                   input.postback?.data || '';

const userId = input.source?.userId;
const eventType = input.type; // message, postback, follow, etc.

if (!userId) {
  throw new Error('Invalid webhook payload: No userId found');
}

// ดึง LINE Profile เพื่อเอา Display Name
let displayName = "คุณ"; // default fallback
try {
  const profileResponse = await $http.request({
    method: "GET",
    url: "https://api.line.me/v2/bot/profile/" + userId,
    headers: {
      "Authorization": "Bearer " + $node.context().get("channelAccessToken")
    }
  });
  
  if (profileResponse.statusCode === 200) {
    displayName = profileResponse.body.displayName || "คุณ";
  }
} catch (error) {
  console.log("Error fetching profile:", error);
  // ใช้ fallback แทน
}

// จัดการ Rich Menu Actions และ Quick Replies
let processedMessage = userMessage;
let isRichMenuAction = false;
let dataCollected = {};

// ตรวจสอบ Postback Data จาก Rich Menu
if (input.postback?.data) {
  isRichMenuAction = true;
  console.log("Raw postback data:", input.postback.data);
  try {
    // รองรับ Postback data ในรูปแบบ JSON
    dataCollected = JSON.parse(input.postback.data);
    processedMessage = dataCollected.action || dataCollected.type || userMessage;
    console.log("Parsed postback data:", dataCollected);
    console.log("Processed message:", processedMessage);
  } catch (error) {
    // รองรับ Postback data แบบ string
    processedMessage = input.postback.data;
    console.log("String postback data:", processedMessage);
  }
}

// ตรวจสอบ datetime picker result
if (input.postback?.params?.date) {
  dataCollected.selectedDate = input.postback.params.date;
  processedMessage = 'confirm_appointment_date';
}

if (input.postback?.params?.time) {
  dataCollected.selectedTime = input.postback.params.time;
}

// AI Prompt ที่รองรับ Rich Menu และการบันทึกข้อมูล
const routingPrompt = \`คุณเป็น Smart Router สำหรับระบบจองวัคซีนที่รองรับ Rich Menu และการบันทึกข้อมูลอัตโนมัติ

Input: "\${processedMessage}"
Event Type: "\${eventType}"
Is Rich Menu Action: \${isRichMenuAction}
Collected Data: \${JSON.stringify(dataCollected)}

ส่งคืนในรูปแบบ JSON:
{
  "action": "checkin|record_appointment|hospital_info|vaccine_info|book_appointment|cancel_booking|check_status|general_info|show_rich_menu|show_vaccine_menu",
  "vaccine_type": "covid|flu|hepatitis|hpv|other",
  "intent_confidence": 0.8,
  "required_data": ["name", "phone", "vaccine_type", "date", "time", "symptoms"],
  "response_type": "rich_menu|quick_reply|datetime_picker|flex_message|confirm_template|form_input",
  "data_collection_step": "start|collecting|complete",
  "next_action": "show_menu|collect_missing_data|confirm|complete"
}

การทำงานของ Rich Menu:
- "checkin" → action: "checkin" (เช็คอิน)
- "record_appointment" → action: "record_appointment" (บันทึกนัดหมาย/ชื่อวัคซีน)
- "hospital_info" → action: "hospital_info" (ข้อมูลโรงพยาบาล)
- "show_vaccine_menu" → action: "show_vaccine_menu" (แสดงเมนูวัคซีน)
- "book_vaccine" → action: "book_appointment", vaccine_type: "covid"
- datetime selection → action: "collect_data", data_collection_step: "collecting"

การจับคู่ action:
- หาก input คือ "show_vaccine_menu" ต้องส่งคืน action: "show_vaccine_menu"
- หาก input คือ vaccine postback (pfizer, moderna, ฯลฯ) ส่งคืน action: "book_appointment"
\`;

// เตรียมข้อมูลสำหรับ HTTP Request
$json.openai_request = {
  model: 'gpt-4',
  messages: [{ role: 'user', content: routingPrompt }],
  temperature: 0.1
};

$json.userId = userId;
$json.displayName = displayName;
$json.originalInput = input;
$json.userMessage = processedMessage;
$json.eventType = eventType;
$json.isRichMenuAction = isRichMenuAction;
$json.collectedData = dataCollected;
$json.timestamp = new Date().toISOString();

return $input.all();`},{id:"dynamic-response-generator",name:"Dynamic Response Generator",type:"response-generator",description:"สร้าง response แบบ dynamic ตาม AI routing results",replaces:["Static Response Nodes"],code:`// Rich Menu Enhanced Dynamic Response Generator (Fixed)
const { routing, userId, displayName, collectedData, isRichMenuAction } = $json;

// ใช้ localStorage แทน getWorkflowStaticData เพื่อแก้ปัญหา ReferenceError
const nodeKey = 'vaccine_system_data';
let systemData = {};

try {
  // อ่านข้อมูลจาก localStorage (หรือจะใช้ database แทนได้)
  const existingData = $node.context().get(nodeKey);
  systemData = existingData || {};
} catch (e) {
  systemData = {};
}

// Database Node - สำหรับบันทึกข้อมูล  
if (!systemData.userBookings) systemData.userBookings = {};
if (!systemData.checkinRecords) systemData.checkinRecords = {};
if (!systemData.vaccineSlots) {
  systemData.vaccineSlots = {
    "2024-12-20": { available: 5, booked: 0 },
    "2024-12-21": { available: 8, booked: 0 },
    "2024-12-22": { available: 3, booked: 2 }
  };
}

// Configuration แบบ Rich Menu Compatible
const vaccineConfig = {
  "covid": {
    "info": "วัคซีนโควิด-19 ป้องกันการติดเชื้อ รุนแรง ลดการเสียชีวิต",
    "price": "ฟรี (ภาครัฐ)",
    "duration": "6 เดือน",
    "age_requirement": "6 เดือนขึ้นไป",
    "postback_data": { "action": "book_vaccine", "type": "covid" }
  },
  "flu": {
    "info": "วัคซีนไข้หวัดใหญ่ ป้องกันไข้หวัด โดยเฉพาะในกลุ่มเสี่ยง",
    "price": "800 บาท",
    "duration": "1 ปี", 
    "age_requirement": "6 เดือนขึ้นไป",
    "postback_data": { "action": "book_vaccine", "type": "flu" }
  },
  "hepatitis": {
    "info": "วัคซีนไวรัสตับอักเสบบี ป้องกันโรคตับอักเสบ",
    "price": "1,200 บาท",
    "duration": "ตลอดชีวิต",
    "age_requirement": "แรกเกิดขึ้นไป",
    "postback_data": { "action": "book_vaccine", "type": "hepatitis" }
  },
  "hpv": {
    "info": "วัคซีน HPV ป้องกันมะเร็งปากมดลูกและโรคอื่นๆ",
    "price": "3,500 บาท",
    "duration": "ตลอดชีวิต",
    "age_requirement": "9-45 ปี",
    "postback_data": { "action": "book_vaccine", "type": "hpv" }
  }
};

// สร้าง Response แบบ Rich Menu Compatible
let response = {};

switch(routing.action) {
  case 'show_rich_menu':
    // Main Rich Menu ตามที่คุณต้องการ
    response = {
      type: 'flex',
      altText: 'เมนูหลัก - บริการโรงพยาบาล',
      contents: {
        type: 'bubble',
        body: {
          type: 'box',
          layout: 'vertical',
          contents: [
            {
              type: 'text',
              text: '🏥 ระบบบริการโรงพยาบาล',
              weight: 'bold',
              size: 'xl',
              color: '#1DB446',
              align: 'center'
            },
            {
              type: 'text',
              text: 'เลือกบริการที่ต้องการ',
              wrap: true,
              margin: 'md',
              color: '#666666',
              align: 'center'
            },
            {
              type: 'separator',
              margin: 'xl'
            },
            {
              type: 'box',
              layout: 'vertical',
              margin: 'xl',
              spacing: 'md',
              contents: [
                {
                  type: 'box',
                  layout: 'horizontal',
                  spacing: 'md',
                  contents: [
                    {
                      type: 'button',
                      flex: 1,
                      height: 'md',
                      style: 'primary',
                      color: '#1DB446',
                      action: {
                        type: 'postback',
                        label: '✅ เช็คอิน',
                        data: JSON.stringify({ action: 'checkin' })
                      }
                    }
                  ]
                },
                {
                  type: 'box',
                  layout: 'horizontal',
                  spacing: 'md',
                  contents: [
                    {
                      type: 'button',
                      flex: 1,
                      height: 'md',
                      style: 'secondary',
                      action: {
                        type: 'postback',
                        label: '📝 บันทึกนัดหมาย',
                        data: JSON.stringify({ action: 'record_appointment' })
                      }
                    }
                  ]
                },
                {
                  type: 'box',
                  layout: 'horizontal',
                  spacing: 'md',
                  contents: [
                    {
                      type: 'button',
                      flex: 1,
                      height: 'md',
                      style: 'secondary',
                      action: {
                        type: 'postback',
                        label: '🏥 ข้อมูลโรงพยาบาล',
                        data: JSON.stringify({ action: 'hospital_info' })
                      }
                    }
                  ]
                }
              ]
            },
            {
              type: 'separator',
              margin: 'xl'
            },
            {
              type: 'text',
              text: 'บริการเพิ่มเติม',
              weight: 'bold',
              margin: 'xl',
              color: '#666666'
            },
            {
              type: 'box',
              layout: 'horizontal',
              margin: 'md',
              spacing: 'sm',
              contents: [
                {
                  type: 'button',
                  flex: 1,
                  height: 'sm',
                  style: 'link',
                  action: {
                    type: 'postback',
                    label: '💉 จองวัคซีน',
                    data: JSON.stringify({ action: 'show_vaccine_menu' })
                  }
                },
                {
                  type: 'button',
                  flex: 1,
                  height: 'sm',
                  style: 'link',
                  action: {
                    type: 'postback',
                    label: '📋 ตรวจสอบการจอง',
                    data: JSON.stringify({ action: 'check_status' })
                  }
                }
              ]
            }
          ]
        }
      }
    };
    break;

  case 'show_vaccine_menu':
    // Vaccine Menu แยกต่างหาก
    response = {
      type: 'flex',
      altText: 'เมนูวัคซีน - เลือกบริการ',
      contents: {
        type: 'carousel',
        contents: Object.keys(vaccineConfig).map(vaccineType => {
          const vaccine = vaccineConfig[vaccineType];
          return {
            type: 'bubble',
            hero: {
              type: 'image',
              url: 'https://via.placeholder.com/300x200/1DB446/FFFFFF?text=' + vaccineType.toUpperCase(),
              size: 'full',
              aspectRatio: '20:13',
              aspectMode: 'cover'
            },
            body: {
              type: 'box',
              layout: 'vertical',
              contents: [
                {
                  type: 'text',
                  text: \`วัคซีน \${vaccineType.toUpperCase()}\`,
                  weight: 'bold',
                  size: 'xl',
                  color: '#1DB446'
                },
                {
                  type: 'text',
                  text: vaccine.info,
                  wrap: true,
                  margin: 'md',
                  size: 'sm'
                },
                {
                  type: 'box',
                  layout: 'vertical',
                  margin: 'lg',
                  spacing: 'sm',
                  contents: [
                    {
                      type: 'box',
                      layout: 'baseline',
                      spacing: 'sm',
                      contents: [
                        { type: 'text', text: 'ราคา', color: '#aaaaaa', size: 'sm', flex: 1 },
                        { type: 'text', text: vaccine.price, wrap: true, color: '#666666', size: 'sm', flex: 3 }
                      ]
                    },
                    {
                      type: 'box',
                      layout: 'baseline',
                      spacing: 'sm',
                      contents: [
                        { type: 'text', text: 'ระยะเวลา', color: '#aaaaaa', size: 'sm', flex: 1 },
                        { type: 'text', text: vaccine.duration, wrap: true, color: '#666666', size: 'sm', flex: 3 }
                      ]
                    }
                  ]
                }
              ]
            },
            footer: {
              type: 'box',
              layout: 'vertical',
              spacing: 'sm',
              contents: [
                {
                  type: 'button',
                  style: 'primary',
                  height: 'sm',
                  action: {
                    type: 'postback',
                    label: 'จองเลย',
                    data: JSON.stringify(vaccine.postback_data)
                  }
                },
                {
                  type: 'button',
                  style: 'secondary',
                  height: 'sm',
                  action: {
                    type: 'postback',
                    label: 'ดูข้อมูล',
                    data: JSON.stringify({ "action": "view_info", "type": vaccineType })
                  }
                }
              ]
            }
          };
        })
      }
    };
    break;

  case 'vaccine_info':
    const vaccineData = vaccineConfig[routing.vaccine_type];
    if (vaccineData) {
      response = {
        type: 'flex',
        altText: \`ข้อมูลวัคซีน \${routing.vaccine_type}\`,
        contents: {
          type: 'bubble',
          body: {
            type: 'box',
            layout: 'vertical',
            contents: [
              {
                type: 'text',
                text: \`วัคซีน \${routing.vaccine_type.toUpperCase()}\`,
                weight: 'bold',
                size: 'xl',
                color: '#1DB446'
              },
              {
                type: 'text',
                text: vaccineData.info,
                wrap: true,
                margin: 'md'
              },
              {
                type: 'separator',
                margin: 'xl'
              },
              {
                type: 'box',
                layout: 'vertical',
                margin: 'xl',
                spacing: 'sm',
                contents: [
                  {
                    type: 'box',
                    layout: 'baseline',
                    spacing: 'sm',
                    contents: [
                      { type: 'text', text: 'ราคา', color: '#aaaaaa', size: 'sm', flex: 1 },
                      { type: 'text', text: vaccineData.price, wrap: true, color: '#666666', size: 'sm', flex: 3 }
                    ]
                  },
                  {
                    type: 'box',
                    layout: 'baseline',
                    spacing: 'sm',
                    contents: [
                      { type: 'text', text: 'อายุ', color: '#aaaaaa', size: 'sm', flex: 1 },
                      { type: 'text', text: vaccineData.age_requirement, wrap: true, color: '#666666', size: 'sm', flex: 3 }
                    ]
                  },
                  {
                    type: 'box',
                    layout: 'baseline',
                    spacing: 'sm',
                    contents: [
                      { type: 'text', text: 'ระยะเวลา', color: '#aaaaaa', size: 'sm', flex: 1 },
                      { type: 'text', text: vaccineData.duration, wrap: true, color: '#666666', size: 'sm', flex: 3 }
                    ]
                  }
                ]
              }
            ]
          },
          footer: {
            type: 'box',
            layout: 'vertical',
            spacing: 'sm',
            contents: [
              {
                type: 'button',
                style: 'primary',
                action: {
                  type: 'postback',
                  label: 'จองวัคซีนนี้',
                  data: JSON.stringify(vaccineData.postback_data)
                }
              },
              {
                type: 'button',
                style: 'secondary',
                action: {
                  type: 'postback',
                  label: 'ดูวัคซีนอื่น',
                  data: JSON.stringify({ "action": "show_menu" })
                }
              }
            ]
          }
        }
      };
    }
    break;

  case 'book_appointment':
    // ตรวจสอบข้อมูลที่เก็บได้แล้ว
    const currentBooking = systemData.userBookings[userId] || {};
    
    if (collectedData.selectedDate) {
      // มีการเลือกวันที่แล้ว -> แสดง Time Picker
      response = {
        type: 'template',
        altText: 'เลือกเวลา',
        template: {
          type: 'buttons',
          text: \`เลือกเวลาสำหรับวันที่ \${collectedData.selectedDate}\`,
          actions: [
            {
              type: 'datetimepicker',
              label: '9:00-12:00',
              data: JSON.stringify({
                action: 'confirm_booking',
                date: collectedData.selectedDate,
                time: '09:00-12:00',
                vaccine_type: routing.vaccine_type
              }),
              mode: 'time'
            },
            {
              type: 'datetimepicker', 
              label: '13:00-16:00',
              data: JSON.stringify({
                action: 'confirm_booking',
                date: collectedData.selectedDate,
                time: '13:00-16:00',
                vaccine_type: routing.vaccine_type
              }),
              mode: 'time'
            },
            {
              type: 'message',
              label: 'เลือกวันใหม่',
              text: 'เลือกวันใหม่'
            }
          ]
        }
      };
    } else {
      // ยังไม่มีวันที่ -> แสดง Date Picker
      response = {
        type: 'template',
        altText: 'เลือกวันที่จอง',
        template: {
          type: 'buttons',
          text: "จองวัคซีน " + routing.vaccine_type.toUpperCase() + "\\nกรุณาเลือกวันที่",
          actions: [
            { 
              type: 'datetimepicker', 
              label: 'เลือกวันที่', 
              data: JSON.stringify({
                action: 'collect_date',
                vaccine_type: routing.vaccine_type
              }),
              mode: 'date'
            },
            { 
              type: 'postback', 
              label: 'ดูข้อมูลเพิ่ม', 
              data: JSON.stringify({
                action: 'view_info',
                type: routing.vaccine_type
              })
            },
            { 
              type: 'message', 
              label: 'ยกเลิก', 
              text: 'ยกเลิก' 
            }
          ]
        }
      };
    }
    break;

  case 'confirm_booking':
    // บันทึกข้อมูลการจอง
    if (collectedData.selectedDate && collectedData.selectedTime) {
      const bookingId = 'BK' + Date.now();
      systemData.userBookings[userId] = {
        id: bookingId,
        vaccineType: routing.vaccine_type || collectedData.vaccine_type,
        date: collectedData.selectedDate,
        time: collectedData.selectedTime,
        status: 'confirmed',
        createdAt: new Date().toISOString()
      };
      
      // Update available slots
      if (systemData.vaccineSlots[collectedData.selectedDate]) {
        systemData.vaccineSlots[collectedData.selectedDate].booked += 1;
      }
      
      response = {
        type: 'flex',
        altText: 'การจองสำเร็จ',
        contents: {
          type: 'bubble',
          body: {
            type: 'box',
            layout: 'vertical',
            contents: [
              {
                type: 'text',
                text: '✅ จองสำเร็จ!',
                weight: 'bold',
                size: 'xl',
                color: '#1DB446'
              },
              {
                type: 'text',
                text: \`รหัสการจอง: \${bookingId}\`,
                margin: 'md',
                color: '#666666'
              },
              {
                type: 'separator',
                margin: 'xl'
              },
              {
                type: 'box',
                layout: 'vertical',
                margin: 'xl',
                spacing: 'sm',
                contents: [
                  {
                    type: 'box',
                    layout: 'baseline',
                    spacing: 'sm',
                    contents: [
                      { type: 'text', text: 'วัคซีน', color: '#aaaaaa', size: 'sm', flex: 1 },
                      { type: 'text', text: (routing.vaccine_type || collectedData.vaccine_type).toUpperCase(), wrap: true, color: '#666666', size: 'sm', flex: 3 }
                    ]
                  },
                  {
                    type: 'box',
                    layout: 'baseline',
                    spacing: 'sm',
                    contents: [
                      { type: 'text', text: 'วันที่', color: '#aaaaaa', size: 'sm', flex: 1 },
                      { type: 'text', text: collectedData.selectedDate, wrap: true, color: '#666666', size: 'sm', flex: 3 }
                    ]
                  },
                  {
                    type: 'box',
                    layout: 'baseline',
                    spacing: 'sm',
                    contents: [
                      { type: 'text', text: 'เวลา', color: '#aaaaaa', size: 'sm', flex: 1 },
                      { type: 'text', text: collectedData.selectedTime, wrap: true, color: '#666666', size: 'sm', flex: 3 }
                    ]
                  }
                ]
              }
            ]
          },
          footer: {
            type: 'box',
            layout: 'vertical',
            spacing: 'sm',
            contents: [
              {
                type: 'button',
                style: 'primary',
                action: {
                  type: 'postback',
                  label: 'ดูรายละเอียด',
                  data: JSON.stringify({ action: 'view_booking', booking_id: bookingId })
                }
              }
            ]
          }
        }
      };
    }
    break;

  case 'cancel_booking':
    const userBooking = systemData.userBookings[userId];
    if (userBooking) {
      response = {
        type: 'template',
        altText: 'ยืนยันการยกเลิก',
        template: {
          type: 'confirm',
          text: "ยกเลิกการจองรหัส " + userBooking.id + "?\\nวัคซีน: " + userBooking.vaccineType + "\\nวันที่: " + userBooking.date,
          actions: [
            {
              type: 'postback',
              label: 'ยืนยันยกเลิก',
              data: JSON.stringify({ action: 'confirm_cancel', booking_id: userBooking.id })
            },
            {
              type: 'message',
              label: 'ไม่ยกเลิก',
              text: 'ไม่ยกเลิก'
            }
          ]
        }
      };
    } else {
      response = {
        type: 'text',
        text: 'ไม่พบการจองของคุณ กรุณาตรวจสอบอีกครั้ง'
      };
    }
    break;

  case 'check_status':
    const booking = systemData.userBookings[userId];
    if (booking) {
      response = {
        type: 'flex',
        altText: 'สถานะการจอง',
        contents: {
          type: 'bubble',
          body: {
            type: 'box',
            layout: 'vertical',
            contents: [
              {
                type: 'text',
                text: 'สถานะการจอง',
                weight: 'bold',
                size: 'xl',
                color: '#1DB446'
              },
              {
                type: 'text',
                text: \`รหัส: \${booking.id}\`,
                margin: 'md',
                color: '#666666'
              },
              {
                type: 'separator',
                margin: 'xl'
              },
              {
                type: 'box',
                layout: 'vertical',
                margin: 'xl',
                spacing: 'sm',
                contents: [
                  {
                    type: 'box',
                    layout: 'baseline',
                    spacing: 'sm',
                    contents: [
                      { type: 'text', text: 'วัคซีน', color: '#aaaaaa', size: 'sm', flex: 1 },
                      { type: 'text', text: booking.vaccineType.toUpperCase(), wrap: true, color: '#666666', size: 'sm', flex: 3 }
                    ]
                  },
                  {
                    type: 'box',
                    layout: 'baseline',
                    spacing: 'sm',
                    contents: [
                      { type: 'text', text: 'วันที่', color: '#aaaaaa', size: 'sm', flex: 1 },
                      { type: 'text', text: booking.date, wrap: true, color: '#666666', size: 'sm', flex: 3 }
                    ]
                  },
                  {
                    type: 'box',
                    layout: 'baseline',
                    spacing: 'sm',
                    contents: [
                      { type: 'text', text: 'สถานะ', color: '#aaaaaa', size: 'sm', flex: 1 },
                      { type: 'text', text: booking.status === 'confirmed' ? '✅ ยืนยันแล้ว' : booking.status, wrap: true, color: '#666666', size: 'sm', flex: 3 }
                    ]
                  }
                ]
              }
            ]
          },
          footer: {
            type: 'box',
            layout: 'vertical',
            spacing: 'sm',
            contents: [
              {
                type: 'button',
                style: 'secondary',
                action: {
                  type: 'postback',
                  label: 'ยกเลิกการจอง',
                  data: JSON.stringify({ action: 'cancel_booking' })
                }
              }
            ]
          }
        }
      };
    } else {
      response = {
        type: 'text',
        text: 'คุณยังไม่มีการจองวัคซีน กรุณาเลือกวัคซีนที่ต้องการจองจากเมนูด้านล่าง',
        quickReply: {
          items: [
            {
              type: 'action',
              action: {
                type: 'postback',
                label: 'ดูเมนูวัคซีน',
                data: JSON.stringify({ action: 'show_menu' })
              }
            }
          ]
        }
      };
    }
    break;

  case 'checkin':
    // เช็คอิน - เก็บข้อมูลการมาถึง
    const checkinId = 'CI' + Date.now();
    systemData.checkinRecords[userId] = {
      id: checkinId,
      userId: userId,
      checkinTime: new Date().toISOString(),
      status: 'checked_in',
      appointment: systemData.userBookings[userId] || null
    };
    
    response = {
      type: 'flex',
      altText: 'เช็คอินสำเร็จ',
      contents: {
        type: 'bubble',
        body: {
          type: 'box',
          layout: 'vertical',
          contents: [
            {
              type: 'text',
              text: "✅ เช็คอินสำเร็จ " + (displayName || "คุณ") + "!",
              weight: 'bold',
              size: 'xl',
              color: '#1DB446'
            },
            {
              type: 'text',
              text: \`รหัสเช็คอิน: \${checkinId}\`,
              margin: 'md',
              color: '#666666'
            },
            {
              type: 'text',
              text: \`เวลา: \${new Date().toLocaleString('th-TH')}\`,
              margin: 'sm',
              color: '#666666',
              size: 'sm'
            },
            {
              type: 'separator',
              margin: 'xl'
            },
            {
              type: 'text',
              text: 'กรุณารอคิวและติดตามประกาศ',
              margin: 'xl',
              color: '#FF5555',
              weight: 'bold'
            }
          ]
        },
        footer: {
          type: 'box',
          layout: 'vertical',
          spacing: 'sm',
          contents: [
            {
              type: 'button',
              style: 'primary',
              action: {
                type: 'postback',
                label: 'ดูสถานะคิว',
                data: JSON.stringify({ action: 'check_queue' })
              }
            }
          ]
        }
      }
    };
    break;

  case 'record_appointment':
    // บันทึกนัดหมาย/ชื่อวัคซีน
    response = {
      type: 'flex',
      altText: 'บันทึกนัดหมาย',
      contents: {
        type: 'bubble',
        body: {
          type: 'box',
          layout: 'vertical',
          contents: [
            {
              type: 'text',
              text: '📝 บันทึกนัดหมาย',
              weight: 'bold',
              size: 'xl',
              color: '#1DB446'
            },
            {
              type: 'text',
              text: 'เลือกประเภทการบันทึก',
              wrap: true,
              margin: 'md'
            }
          ]
        },
        footer: {
          type: 'box',
          layout: 'vertical',
          spacing: 'sm',
          contents: [
            {
              type: 'button',
              style: 'primary',
              action: {
                type: 'postback',
                label: 'บันทึกนัดหมายใหม่',
                data: JSON.stringify({ action: 'new_appointment_record' })
              }
            },
            {
              type: 'button',
              style: 'secondary',
              action: {
                type: 'postback',
                label: 'บันทึกชื่อวัคซีน',
                data: JSON.stringify({ action: 'record_vaccine_name' })
              }
            },
            {
              type: 'button',
              style: 'secondary',
              action: {
                type: 'postback',
                label: 'ดูประวัติการบันทึก',
                data: JSON.stringify({ action: 'view_records' })
              }
            }
          ]
        }
      }
    };
    break;

  case 'hospital_info':
    // ข้อมูลโรงพยาบาล
    response = {
      type: 'flex',
      altText: 'ข้อมูลโรงพยาบาล',
      contents: {
        type: 'bubble',
        hero: {
          type: 'image',
          url: 'https://via.placeholder.com/300x200/1DB446/FFFFFF?text=HOSPITAL',
          size: 'full',
          aspectRatio: '20:13',
          aspectMode: 'cover'
        },
        body: {
          type: 'box',
          layout: 'vertical',
          contents: [
            {
              type: 'text',
              text: '🏥 โรงพยาบาลเครือข่าย',
              weight: 'bold',
              size: 'xl',
              color: '#1DB446'
            },
            {
              type: 'separator',
              margin: 'xl'
            },
            {
              type: 'box',
              layout: 'vertical',
              margin: 'xl',
              spacing: 'sm',
              contents: [
                {
                  type: 'box',
                  layout: 'baseline',
                  spacing: 'sm',
                  contents: [
                    { type: 'text', text: '📍', color: '#1DB446', size: 'sm', flex: 0 },
                    { type: 'text', text: 'ที่อยู่', color: '#aaaaaa', size: 'sm', flex: 1 },
                    { type: 'text', text: '123 ถนนสุขภาพ เขตดีเจ กรุงเทพฯ 10400', wrap: true, color: '#666666', size: 'sm', flex: 4 }
                  ]
                },
                {
                  type: 'box',
                  layout: 'baseline',
                  spacing: 'sm',
                  contents: [
                    { type: 'text', text: '⏰', color: '#1DB446', size: 'sm', flex: 0 },
                    { type: 'text', text: 'เวลา', color: '#aaaaaa', size: 'sm', flex: 1 },
                    { type: 'text', text: 'จันทร์-ศุกร์ 8:00-20:00\\nเสาร์-อาทิตย์ 9:00-17:00', wrap: true, color: '#666666', size: 'sm', flex: 4 }
                  ]
                },
                {
                  type: 'box',
                  layout: 'baseline',
                  spacing: 'sm',
                  contents: [
                    { type: 'text', text: '📞', color: '#1DB446', size: 'sm', flex: 0 },
                    { type: 'text', text: 'โทร', color: '#aaaaaa', size: 'sm', flex: 1 },
                    { type: 'text', text: '02-123-4567', wrap: true, color: '#666666', size: 'sm', flex: 4 }
                  ]
                },
                {
                  type: 'box',
                  layout: 'baseline',
                  spacing: 'sm',
                  contents: [
                    { type: 'text', text: '🚗', color: '#1DB446', size: 'sm', flex: 0 },
                    { type: 'text', text: 'จอดรถ', color: '#aaaaaa', size: 'sm', flex: 1 },
                    { type: 'text', text: 'มีที่จอดรถฟรี 200 คัน', wrap: true, color: '#666666', size: 'sm', flex: 4 }
                  ]
                }
              ]
            }
          ]
        },
        footer: {
          type: 'box',
          layout: 'vertical',
          spacing: 'sm',
          contents: [
            {
              type: 'button',
              style: 'primary',
              action: {
                type: 'uri',
                label: 'เปิดแผนที่',
                uri: 'https://maps.google.com/?q=โรงพยาบาล'
              }
            },
            {
              type: 'button',
              style: 'secondary',
              action: {
                type: 'uri',
                label: 'โทรติดต่อ',
                uri: 'tel:021234567'
              }
            }
          ]
        }
      }
    };
    break;

  case 'general_info':
    response = {
      type: 'flex',
      altText: 'เมนูหลัก - เลือกบริการ',
      contents: {
        type: 'bubble',
        body: {
          type: 'box',
          layout: 'vertical',
          contents: [
            {
              type: 'text',
              text: 'ระบบจองวัคซีน 💉',
              weight: 'bold',
              size: 'xl',
              color: '#1DB446'
            },
            {
              type: 'text',
              text: 'เลือกบริการที่ต้องการ',
              wrap: true,
              margin: 'md',
              color: '#666666'
            }
          ]
        },
        footer: {
          type: 'box',
          layout: 'vertical',
          spacing: 'sm',
          contents: [
            {
              type: 'button',
              style: 'primary',
              action: {
                type: 'postback',
                label: '✅ เช็คอิน',
                data: JSON.stringify({ action: 'checkin' })
              }
            },
            {
              type: 'button',
              style: 'secondary',
              action: {
                type: 'postback',
                label: '📝 บันทึกนัดหมาย/วัคซีน',
                data: JSON.stringify({ action: 'record_appointment' })
              }
            },
            {
              type: 'button',
              style: 'secondary',
              action: {
                type: 'postback',
                label: '🏥 ข้อมูลโรงพยาบาล',
                data: JSON.stringify({ action: 'hospital_info' })
              }
            },
            {
              type: 'button',
              style: 'link',
              action: {
                type: 'postback',
                label: 'ดูเมนูวัคซีน',
                data: JSON.stringify({ action: 'show_menu' })
              }
            }
          ]
        }
      }
    };
    break;

  default:
    response = {
      type: 'text',
      text: 'ขออภัย ไม่เข้าใจคำสั่ง กรุณาเลือกจากเมนูด้านล่าง',
      quickReply: {
        items: [
          {
            type: 'action',
            action: {
              type: 'postback',
              label: 'เมนูหลัก',
              data: JSON.stringify({ action: 'show_menu' })
            }
          }
        ]
      }
    };
}

// บันทึกข้อมูลกลับไปยัง node context
try {
  $node.context().set(nodeKey, systemData);
} catch (e) {
  console.error('Cannot save data to context:', e);
}

$json.lineResponse = response;
$json.processedBy = 'rich-menu-response-generator';
$json.savedData = systemData.userBookings[userId] || null;

return $input.all();`},{id:"context-manager",name:"Context Manager",type:"context-manager",description:"จัดการ user context และ session state",replaces:["Multiple Set Nodes"],code:`// Context Manager - จัดการ User Session (Fixed)
const { routing, userId } = $json;

// ใช้ node context แทน getWorkflowStaticData  
const nodeKey = 'user_sessions_data';
let sessionData = {};

try {
  const existingData = $node.context().get(nodeKey);
  sessionData = existingData || {};
} catch (e) {
  sessionData = {};
}

// จัดการ User Context
if (!sessionData.userSessions) sessionData.userSessions = {};
if (!sessionData.userSessions[userId]) {
  sessionData.userSessions[userId] = {
    currentFlow: null,
    data: {},
    history: [],
    preferences: {},
    lastActivity: new Date().toISOString()
  };
}

const userSession = sessionData.userSessions[userId];

// Update Context based on AI Routing
switch(routing.action) {
  case 'book_appointment':
    userSession.currentFlow = 'booking';
    userSession.data.vaccineType = routing.vaccine_type;
    userSession.data.step = 'select_date';
    userSession.data.confidence = routing.intent_confidence;
    break;
    
  case 'cancel_booking':
    userSession.currentFlow = 'cancellation';
    userSession.data.step = 'confirm_cancel';
    break;
    
  case 'vaccine_info':
    userSession.currentFlow = 'information';
    userSession.data.viewedVaccines = userSession.data.viewedVaccines || [];
    if (!userSession.data.viewedVaccines.includes(routing.vaccine_type)) {
      userSession.data.viewedVaccines.push(routing.vaccine_type);
    }
    break;
    
  case 'check_status':
    userSession.currentFlow = 'status_check';
    break;
}

// เก็บประวัติ (เก็บ 10 รายการล่าสุด)
userSession.history.push({
  input: $json.originalInput,
  routing: routing,
  timestamp: new Date().toISOString(),
  confidence: routing.intent_confidence
});

if (userSession.history.length > 10) {
  userSession.history = userSession.history.slice(-10);
}

// Update last activity
userSession.lastActivity = new Date().toISOString();

// ตรวจสอบและทำความสะอาด old sessions (เก็บ 24 ชั่วโมง)
const now = new Date();
Object.keys(sessionData.userSessions).forEach(sessionUserId => {
  const session = sessionData.userSessions[sessionUserId];
  const lastActivity = new Date(session.lastActivity);
  const hoursDiff = (now.getTime() - lastActivity.getTime()) / (1000 * 60 * 60);
  
  if (hoursDiff > 24) {
    delete sessionData.userSessions[sessionUserId];
  }
});

// Set user preferences based on behavior
if (userSession.history.length >= 3) {
  const recentActions = userSession.history.slice(-3).map(h => h.routing.action);
  const mostCommonAction = recentActions.reduce((a, b, _, arr) => 
    arr.filter(v => v === a).length >= arr.filter(v => v === b).length ? a : b
  );
  userSession.preferences.preferredAction = mostCommonAction;
}

// Determine next action
let nextAction = 'continue';
if (routing.action === 'book_appointment' && routing.intent_confidence < 0.6) {
  nextAction = 'clarify_vaccine_type';
} else if (routing.action === 'general_info' && routing.intent_confidence < 0.5) {
  nextAction = 'show_menu';
} else if (userSession.currentFlow === 'booking' && userSession.data.step === 'select_date') {
  nextAction = 'handle_date_selection';
}

// บันทึกข้อมูล session กลับไปยัง context
try {
  $node.context().set(nodeKey, sessionData);
} catch (e) {
  console.error('Cannot save session data:', e);
}

$json.userSession = userSession;
$json.nextAction = nextAction;
$json.sessionStats = {
  totalUsers: Object.keys(sessionData.userSessions).length,
  currentUserHistory: userSession.history.length,
  userPreferences: userSession.preferences
};

return $input.all();`}],x={name:"Smart Routing Vaccine Booking Workflow (HTTP Version)",nodes:[{parameters:{httpMethod:"POST",path:"vaccine-webhook",options:{}},id:"webhook-node",name:"Webhook",type:"n8n-nodes-base.webhook",typeVersion:1,position:[240,300],webhookId:"webhook-id"},{parameters:{jsCode:m[0].code},id:"input-processor-node",name:"Input Processor",type:"n8n-nodes-base.code",typeVersion:2,position:[460,300]},{parameters:{url:"https://api.openai.com/v1/chat/completions",method:"POST",authentication:"predefinedCredentialType",nodeCredentialType:"openAiApi",headers:{"Content-Type":"application/json"},body:"={{ JSON.stringify($json.openai_request) }}",options:{timeout:15e3,response:{response:{neverError:!0,responseFormat:"json"}},redirect:{redirect:{followRedirect:!1,maxRedirect:0}}}},id:"openai-http-node",name:"OpenAI HTTP Request (with Credentials)",type:"n8n-nodes-base.httpRequest",typeVersion:4,position:[680,300]},{parameters:{jsCode:`// AI Response Processor with Robust Error Handling
try {
  const httpResponse = $json;
  let routing = {};
  
  // ตรวจสอบ HTTP status และ response structure
  if (httpResponse.statusCode && httpResponse.statusCode !== 200) {
    console.warn('OpenAI API returned non-200 status:', httpResponse.statusCode);
    throw new Error(\`API returned status: \${httpResponse.statusCode}\`);
  }
  
  // ตรวจสอบ response structure
  if (!httpResponse.choices || !httpResponse.choices[0] || !httpResponse.choices[0].message) {
    throw new Error('Invalid OpenAI API response format');
  }
  
  // Parse AI response with validation
  try {
    routing = JSON.parse(httpResponse.choices[0].message.content);
  } catch (parseError) {
    // ถ้า JSON ไม่ถูกต้อง ใช้ fallback
    routing = {
      action: 'general_info',
      vaccine_type: 'covid',
      intent_confidence: 0.3,
      required_data: [],
      response_type: 'text'
    };
  }
  
  // Validate routing object
  if (!routing.action) {
    routing.action = 'general_info';
  }
  if (!routing.intent_confidence || routing.intent_confidence < 0 || routing.intent_confidence > 1) {
    routing.intent_confidence = 0.5;
  }
  
  // Combine with previous data
  $json.routing = routing;
  $json.userId = $('Input Processor').item.json.userId;
  $json.originalInput = $('Input Processor').item.json.originalInput;
  $json.userMessage = $('Input Processor').item.json.userMessage;
  $json.timestamp = $('Input Processor').item.json.timestamp;
  $json.apiSuccess = true;
  
} catch (error) {
  // Error handling - ใช้ fallback routing
  console.error('OpenAI API Error:', error);
  
  $json.routing = {
    action: 'general_info',
    vaccine_type: 'covid',
    intent_confidence: 0.2,
    required_data: [],
    response_type: 'text',
    error: true
  };
  $json.userId = $('Input Processor').item.json.userId;
  $json.originalInput = $('Input Processor').item.json.originalInput;
  $json.userMessage = $('Input Processor').item.json.userMessage;
  $json.timestamp = $('Input Processor').item.json.timestamp;
  $json.apiSuccess = false;
  $json.errorMessage = error.message;
}

return $input.all();`},id:"ai-response-processor-node",name:"AI Response Processor",type:"n8n-nodes-base.code",typeVersion:2,position:[900,300]},{parameters:{jsCode:m[2].code},id:"context-manager-node",name:"Context Manager",type:"n8n-nodes-base.code",typeVersion:2,position:[1120,300]},{parameters:{jsCode:m[1].code},id:"response-generator-node",name:"Dynamic Response Generator",type:"n8n-nodes-base.code",typeVersion:2,position:[1340,300]},{parameters:{authentication:"lineNotifyOAuth2Api",resource:"message",operation:"send",message:"={{ $json.lineResponse }}"},id:"line-response-node",name:"LINE Response",type:"n8n-nodes-base.line",typeVersion:1,position:[1560,300]}],connections:{Webhook:{main:[[{node:"Input Processor",type:"main",index:0}]]},"Input Processor":{main:[[{node:"OpenAI HTTP Request (with Credentials)",type:"main",index:0}]]},"OpenAI HTTP Request (with Credentials)":{main:[[{node:"AI Response Processor",type:"main",index:0}]]},"AI Response Processor":{main:[[{node:"Context Manager",type:"main",index:0}]]},"Context Manager":{main:[[{node:"Dynamic Response Generator",type:"main",index:0}]]},"Dynamic Response Generator":{main:[[{node:"LINE Response",type:"main",index:0}]]}},active:!1,settings:{executionOrder:"v1"},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),id:"smart-routing-workflow-http",tags:[]};m.forEach(g=>{g.workflowJSON=x}),a(m)},c=async(l,m)=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(l);else{const x=document.createElement("textarea");x.value=l,x.style.position="fixed",x.style.left="-999999px",x.style.top="-999999px",document.body.appendChild(x),x.focus(),x.select(),document.execCommand("copy"),x.remove()}r(m),setTimeout(()=>r(null),2e3),i({title:"คัดลอกสำเร็จ",description:"โค้ดถูกคัดลอกไปยัง clipboard แล้ว"})}catch(x){console.error("Failed to copy: ",x),i({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถคัดลอกได้ กรุณาลองใช้ปุ่มดาวน์โหลดแทน",variant:"destructive"})}},d=(l,m)=>{const x=new Blob([l],{type:"text/javascript"}),g=URL.createObjectURL(x),v=document.createElement("a");v.href=g,v.download=`${m}.js`,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(g)},p=l=>{const m=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),x=URL.createObjectURL(m),g=document.createElement("a");g.href=x,g.download="smart-routing-workflow.json",document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(x),i({title:"ดาวน์โหลดสำเร็จ",description:"ไฟล์ workflow JSON ถูกดาวน์โหลดแล้ว สามารถ import เข้า n8n ได้เลย"})},u=l=>{switch(l){case"ai-router":return e.jsx(vs,{className:"w-4 h-4"});case"response-generator":return e.jsx(Pt,{className:"w-4 h-4"});case"context-manager":return e.jsx(Ee,{className:"w-4 h-4"});default:return e.jsx(Yo,{className:"w-4 h-4"})}},j=l=>{switch(l){case"ai-router":return"bg-blue-500";case"response-generator":return"bg-green-500";case"context-manager":return"bg-purple-500";default:return"bg-gray-500"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"w-5 h-5"}),"Smart Routing Generator"]}),e.jsx(oe,{children:"สร้างโค้ด AI Smart Routing เพื่อแทนที่ Switch nodes และปรับปรุงประสิทธิภาพ workflow"})]}),e.jsx(D,{children:t.length===0?e.jsx(Q,{children:e.jsx(X,{children:"กรุณาวิเคราะห์ workflow ก่อนเพื่อดู nodes ที่สามารถแทนที่ด้วย Smart Routing ได้"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["พบ ",t.filter(l=>l.type==="n8n-nodes-base.switch").length," Switch nodes ที่สามารถแทนที่ได้"]})}),e.jsxs(k,{onClick:o,className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"w-4 h-4"}),"สร้าง Smart Routing"]})]}),s.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(Q,{className:"border-green-200 bg-green-50",children:[e.jsx(G,{className:"w-4 h-4 text-green-600"}),e.jsx(X,{className:"text-green-700",children:"สร้าง Smart Routing สำเร็จ! ดาวน์โหลด Workflow JSON เพื่อ import เข้า n8n โดยตรง"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:()=>p(s[0].workflowJSON),className:"flex items-center gap-2",variant:"default",children:[e.jsx(Go,{className:"w-4 h-4"}),"ดาวน์โหลด Complete Workflow (JSON)"]}),e.jsxs(k,{onClick:()=>c(JSON.stringify(s[0].workflowJSON,null,2),"workflow-json"),variant:"outline",className:"flex items-center gap-2",children:[n==="workflow-json"?e.jsx(G,{className:"w-4 h-4"}):e.jsx(ye,{className:"w-4 h-4"}),n==="workflow-json"?"คัดลอกแล้ว":"คัดลอก JSON"]})]})]})]})})]}),s.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:s.map(l=>e.jsxs(S,{className:"border-l-4",style:{borderLeftColor:j(l.type).replace("bg-","")},children:[e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-md text-white ${j(l.type)}`,children:u(l.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx($,{className:"text-lg",children:l.name}),e.jsx(oe,{className:"text-sm mt-1",children:l.description})]})]})}),e.jsxs(D,{className:"pt-0 space-y-3",children:[l.replaces.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"แทนที่:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:l.replaces.map((m,x)=>e.jsx(H,{variant:"outline",className:"text-xs",children:m},x))})]}),e.jsx(ge,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h5",{className:"font-medium text-sm",children:"Code สำหรับ n8n:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>c(l.code,l.id),className:"flex items-center gap-1",children:[n===l.id?e.jsx(G,{className:"w-3 h-3"}):e.jsx(ye,{className:"w-3 h-3"}),n===l.id?"คัดลอกแล้ว":"คัดลอก"]}),e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>d(l.code,l.id),className:"flex items-center gap-1",children:[e.jsx(js,{className:"w-3 h-3"}),"ดาวน์โหลด"]})]})]}),e.jsx(zt,{value:l.code,readOnly:!0,className:"font-mono text-xs h-32 bg-muted"})]})]})]},l.id))}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5"}),"วิธีใช้งาน Smart Routing"]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold",children:"1. เตรียม Environment Variables"}),e.jsx("div",{className:"bg-muted p-3 rounded-md",children:e.jsx("code",{className:"text-sm",children:"OPENAI_API_KEY=your_openai_api_key"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold",children:"2. สร้าง Code Nodes"}),e.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[e.jsx("li",{children:'• สร้าง Code node ชื่อ "AI Smart Router"'}),e.jsx("li",{children:'• สร้าง Code node ชื่อ "Dynamic Response Generator"'}),e.jsx("li",{children:'• สร้าง Code node ชื่อ "Context Manager"'})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold",children:"3. เชื่อมต่อกับ Nodes เดิม"}),e.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"• Smart Router → Database Nodes เดิม"}),e.jsx("li",{children:"• Response Generator → LINE Response เดิม"}),e.jsx("li",{children:"• Context Manager → HTTP Request เดิม"}),e.jsx("li",{children:"• ใช้ Merge Node เพื่อรวม flow เดิมและใหม่"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold",children:"4. ลบ Switch Nodes เก่า"}),e.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"• ลบ Switch nodes ที่ไม่ใช้แล้ว"}),e.jsx("li",{children:"• ลบ Static response nodes"}),e.jsx("li",{children:"• ทดสอบ workflow ใหม่"})]})]})]}),e.jsxs(Q,{children:[e.jsx(G,{className:"w-4 h-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"Integration กับ Flow เดิม:"})," สามารถเชื่อมต่อกับ Database, HTTP Request, และ LINE nodes เดิมได้ทั้งหมด โดยใช้ Merge Node หรือแทนที่ Switch nodes โดยตรง"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-md",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"🔄 วิธี Migration ที่แนะนำ:"}),e.jsxs("ol",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("li",{children:["1. ",e.jsx("strong",{children:"Backup"})," workflow เดิมก่อน"]}),e.jsxs("li",{children:["2. ",e.jsx("strong",{children:"Import"})," Smart Routing workflow ใหม่"]}),e.jsxs("li",{children:["3. ",e.jsx("strong",{children:"Test"})," ใน development environment"]}),e.jsxs("li",{children:["4. ",e.jsx("strong",{children:"Connect"})," กับ nodes เดิมทีละส่วน"]}),e.jsxs("li",{children:["5. ",e.jsx("strong",{children:"Remove"})," Switch nodes เดิมเมื่อแน่ใจแล้ว"]})]})]})]})]})]})]})},jd=()=>{const[t,s]=h.useState(null),[a,n]=h.useState([]),[r,i]=h.useState(""),[o,c]=h.useState(!1),d=m=>{const x=[],g=new Set(m.nodes.map(P=>P.id)),v=new Set;Object.entries(m.connections).forEach(([P,T])=>{T.main&&T.main.forEach((W,b)=>{Array.isArray(W)&&W.forEach(w=>{v.add(P),v.add(w.node),g.has(w.node)||x.push({type:"error",title:"Connection ชี้ไปยัง Node ที่ไม่มีอยู่",description:`Node "${P}" พยายามเชื่อมต่อไปยัง node "${w.node}" ที่ไม่มีอยู่ใน workflow`,nodeId:P,solution:"ตรวจสอบและแก้ไข connection ที่เสียหายหรือลบ node ที่ไม่ใช้แล้ว"})})})}),m.nodes.forEach(P=>{!v.has(P.id)&&P.type!=="n8n-nodes-base.webhook"&&x.push({type:"warning",title:"Node แยกตัวออกมา (Isolated)",description:`Node "${P.name}" (${P.id}) ไม่ได้เชื่อมต่อกับ node อื่นใด`,nodeId:P.id,solution:"เชื่อมต่อ node นี้เข้ากับ workflow หรือลบออกหากไม่ต้องการใช้"})});const f=m.nodes.filter(P=>P.type==="n8n-nodes-base.webhook"),N=m.nodes.filter(P=>P.type==="n8n-nodes-base.switch"),_=m.nodes.filter(P=>P.type==="n8n-nodes-base.httpRequest");N.forEach(P=>{var W,b,w,M,I,F,z;const T=m.connections[P.id];if(T&&T.main){T.main.filter(R=>R&&R.length>0).length;const C=((w=(b=(W=P.parameters)==null?void 0:W.conditions)==null?void 0:b.conditions)==null?void 0:w.length)||((F=(I=(M=P.parameters)==null?void 0:M.rules)==null?void 0:I.rules)==null?void 0:F.length)||0;!(T.main.length>C&&((z=T.main[T.main.length-1])==null?void 0:z.length)>0)&&C>0&&x.push({type:"warning",title:"Switch Node ไม่มี Fallback Path",description:`Switch node "${P.name}" มี ${C} เงื่อนไข แต่ไม่มี fallback path สำหรับกรณีที่ไม่ตรงเงื่อนไขใดๆ`,nodeId:P.id,solution:"เพิ่ม fallback path โดยเชื่อมต่อ output ท้ายสุดของ Switch node เพื่อจัดการกรณีที่ไม่ตรงเงื่อนไข"})}}),_.forEach(P=>{var w,M,I,F,z,C,y;const T=m.connections[P.id],W=(T==null?void 0:T.main)&&T.main.length>1&&((w=T.main[1])==null?void 0:w.length)>0,b=((I=(M=P.parameters)==null?void 0:M.url)==null?void 0:I.includes("api.line.me"))||((z=(F=P.parameters)==null?void 0:F.url)==null?void 0:z.includes("openai.com"))||((C=P.name)==null?void 0:C.toLowerCase().includes("line"))||((y=P.name)==null?void 0:y.toLowerCase().includes("ai"));W||x.push({type:b?"error":"warning",title:"HTTP Request ไม่มี Error Handling",description:`HTTP node "${P.name}" ${b?"(Critical API)":""} ไม่มีการจัดการ error กรณีที่ request ล้มเหลว`,nodeId:P.id,solution:"เพิ่ม error output และเชื่อมต่อไปยัง error handling nodes เช่น Set node สำหรับ log หรือ HTTP node สำหรับส่งการแจ้งเตือน"})});const A=f.length>0,E=m.nodes.filter(P=>{var T,W;return P.name.toLowerCase().includes("line")||P.type==="n8n-nodes-base.httpRequest"&&((W=(T=P.parameters)==null?void 0:T.url)==null?void 0:W.includes("api.line.me"))});return A&&E.length===0&&x.push({type:"error",title:"ไม่พบ LINE Response Node",description:"Chatbot workflow ควรมี node สำหรับตอบกลับข้อความผ่าน LINE API",solution:"เพิ่ม HTTP Request node ที่เรียก https://api.line.me/v2/bot/message/reply พร้อม reply token และข้อความที่ต้องการส่ง"}),E.forEach(P=>{var W,b,w,M;((b=(W=P.parameters)==null?void 0:W.bodyParametersJson)==null?void 0:b.includes("replyToken"))||((M=(w=P.parameters)==null?void 0:w.body)==null?void 0:M.includes("replyToken"))||JSON.stringify(P.parameters).includes("replyToken")||x.push({type:"error",title:"LINE Node ไม่มี Reply Token",description:`LINE response node "${P.name}" ไม่ได้ใช้ reply token ที่ได้จาก webhook`,nodeId:P.id,solution:'ใช้ reply token จาก webhook data ในรูปแบบ {{ $json["events"][0]["replyToken"] }}'})}),m.nodes.filter(P=>P.type.includes("langchain")||P.type.includes("openai")||P.name.toLowerCase().includes("ai")||P.name.toLowerCase().includes("gpt")).forEach(P=>{var b,w,M,I,F,z;((b=P.parameters)==null?void 0:b.prompt)||((w=P.parameters)==null?void 0:w.text)||((M=P.parameters)==null?void 0:M.message)||x.push({type:"warning",title:"AI Agent ไม่มี Prompt",description:`AI node "${P.name}" ไม่ได้กำหนด prompt หรือ instruction ที่ชัดเจน`,nodeId:P.id,solution:"กำหนด prompt ที่ชัดเจน รวมถึง role, context และ instruction สำหรับ AI Agent"}),!(((I=P.parameters)==null?void 0:I.apiKey)||P.credentials||((F=P.parameters)==null?void 0:F.authentication)||((z=P.parameters)==null?void 0:z.model))&&(P.type.includes("openai")||P.type.includes("langchain"))&&x.push({type:"error",title:"AI Agent ไม่มี API Key",description:`AI node "${P.name}" ไม่ได้กำหนด API key หรือ credentials สำหรับการเชื่อมต่อ AI service`,nodeId:P.id,solution:"กำหนด API key ผ่าน credentials หรือ parameters ของ node ให้ตรงกับ AI service ที่ใช้"})}),m.nodes.filter(P=>P.type==="n8n-nodes-base.googleSheets").forEach(P=>{var T;(T=P.parameters)!=null&&T.documentId||x.push({type:"error",title:"Google Sheets ไม่ได้กำหนด Document ID",description:`Google Sheets node "${P.name}" ไม่ได้ระบุ spreadsheet ที่ต้องการใช้`,nodeId:P.id,solution:"กำหนด Google Sheets document ID และ sheet name ที่ถูกต้อง"})}),x},p=()=>{c(!0);try{const m=JSON.parse(r);s(m);const x=d(m);n(x)}catch{n([{type:"error",title:"JSON Format ไม่ถูกต้อง",description:"ไม่สามารถ parse JSON ได้ กรุณาตรวจสอบรูปแบบ JSON",solution:"ตรวจสอบ syntax JSON ให้ถูกต้อง เช่น การใช้ comma, brackets และ quotes"}])}c(!1)},u=m=>m.includes("webhook")?e.jsx(ft,{className:"w-4 h-4"}):m.includes("switch")?e.jsx(Ee,{className:"w-4 h-4"}):m.includes("langchain")?e.jsx(Pt,{className:"w-4 h-4"}):m.includes("httpRequest")?e.jsx(ft,{className:"w-4 h-4"}):m.includes("googleSheets")?e.jsx(jt,{className:"w-4 h-4"}):e.jsx(Ee,{className:"w-4 h-4"}),j=m=>m.includes("webhook")?"bg-node-webhook":m.includes("switch")?"bg-node-switch":m.includes("langchain")?"bg-node-ai":m.includes("httpRequest")?"bg-node-http":m.includes("googleSheets")?"bg-node-function":"bg-muted",l=m=>{switch(m){case"error":return e.jsx(Ae,{className:"w-4 h-4 text-workflow-error"});case"warning":return e.jsx(je,{className:"w-4 h-4 text-workflow-warning"});case"info":return e.jsx(Be,{className:"w-4 h-4 text-workflow-info"});default:return e.jsx(G,{className:"w-4 h-4 text-workflow-success"})}};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-workflow-primary to-workflow-info bg-clip-text text-transparent",children:"n8n Workflow Analyzer"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"วิเคราะห์และตรวจสอบข้อผิดพลาดใน n8n workflow ของคุณ พร้อมคำแนะนำการแก้ไขแบบละเอียด"})]}),e.jsxs(S,{className:"shadow-workflow",children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),"อัพโหลด Workflow JSON"]}),e.jsx(oe,{children:"วางโค้ด JSON ของ n8n workflow ที่ต้องการวิเคราะห์"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsx(zt,{placeholder:"วาง n8n workflow JSON ที่นี่...",value:r,onChange:m=>i(m.target.value),className:"min-h-[200px] font-mono text-sm"}),e.jsx(k,{onClick:p,disabled:!r.trim()||o,className:"w-full",children:o?"กำลังวิเคราะห์...":"วิเคราะห์ Workflow"})]})]}),t&&e.jsxs(Ue,{defaultValue:"issues",className:"space-y-4",children:[e.jsxs(ze,{className:"grid w-full grid-cols-4",children:[e.jsxs(Z,{value:"issues",children:["ปัญหาที่พบ (",a.length,")"]}),e.jsx(Z,{value:"overview",children:"ภาพรวม เวิร์คโฟลว์"}),e.jsx(Z,{value:"smart-routing",children:"Smart Routing"}),e.jsx(Z,{value:"troubleshooting",children:"คู่มือแก้ไข"})]}),e.jsx(ee,{value:"issues",className:"space-y-4",children:a.length===0?e.jsxs(Q,{className:"border-workflow-success",children:[e.jsx(G,{className:"w-4 h-4 text-workflow-success"}),e.jsx(X,{className:"text-workflow-success",children:"ไม่พบปัญหาสำคัญใน workflow นี้ แต่ควรตรวจสอบการทำงานจริงด้วยการทดสอบ"})]}):e.jsx("div",{className:"space-y-4",children:a.map((m,x)=>e.jsxs(S,{className:`border-l-4 ${m.type==="error"?"border-l-workflow-error":m.type==="warning"?"border-l-workflow-warning":"border-l-workflow-info"}`,children:[e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[l(m.type),e.jsxs("div",{className:"flex-1",children:[e.jsx($,{className:"text-lg",children:m.title}),m.nodeId&&e.jsxs(H,{variant:"outline",className:"mt-1",children:["Node: ",m.nodeId.slice(0,8),"..."]})]}),e.jsx(H,{variant:m.type==="error"?"destructive":m.type==="warning"?"secondary":"default",children:m.type==="error"?"ข้อผิดพลาด":m.type==="warning"?"คำเตือน":"ข้อมูล"})]})}),e.jsxs(D,{className:"pt-0 space-y-3",children:[e.jsx("p",{className:"text-muted-foreground",children:m.description}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-workflow-primary",children:"💡 วิธีแก้ไข:"}),e.jsx("p",{className:"text-sm bg-muted p-3 rounded-md",children:m.solution})]})]})]},x))})}),e.jsxs(ee,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(S,{children:[e.jsx(L,{className:"pb-2",children:e.jsx($,{className:"text-sm",children:"จำนวน Nodes"})}),e.jsx(D,{children:e.jsx("div",{className:"text-2xl font-bold text-workflow-primary",children:t.nodes.length})})]}),e.jsxs(S,{children:[e.jsx(L,{className:"pb-2",children:e.jsx($,{className:"text-sm",children:"การเชื่อมต่อ"})}),e.jsx(D,{children:e.jsx("div",{className:"text-2xl font-bold text-workflow-info",children:Object.keys(t.connections).length})})]}),e.jsxs(S,{children:[e.jsx(L,{className:"pb-2",children:e.jsx($,{className:"text-sm",children:"ข้อผิดพลาด"})}),e.jsx(D,{children:e.jsx("div",{className:"text-2xl font-bold text-workflow-error",children:a.filter(m=>m.type==="error").length})})]}),e.jsxs(S,{children:[e.jsx(L,{className:"pb-2",children:e.jsx($,{className:"text-sm",children:"คำเตือน"})}),e.jsx(D,{children:e.jsx("div",{className:"text-2xl font-bold text-workflow-warning",children:a.filter(m=>m.type==="warning").length})})]})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsx($,{children:"รายการ Nodes"})}),e.jsx(D,{children:e.jsx("div",{className:"space-y-2",children:t.nodes.map(m=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:`p-2 rounded-md ${j(m.type)}`,children:u(m.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:m.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:m.type})]}),e.jsxs(H,{variant:"outline",className:"font-mono text-xs",children:[m.id.slice(0,8),"..."]})]},m.id))})})]})]}),e.jsx(ee,{value:"smart-routing",className:"space-y-4",children:e.jsx(vd,{workflowNodes:(t==null?void 0:t.nodes)||[]})}),e.jsx(ee,{value:"troubleshooting",className:"space-y-4",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),"คู่มือแก้ไขปัญหาแบบละเอียด"]}),e.jsx(oe,{children:"แนวทางแก้ไขปัญหาทีละขั้นตอนสำหรับปัญหาที่พบใน workflow นี้"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[a.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"ปัญหาที่พบใน workflow ของคุณ และวิธีแก้ไขที่แนะนำ:"}),a.map((m,x)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l(m.type),e.jsx("h4",{className:"font-semibold",children:m.title})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.description}),e.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"💡 วิธีแก้ไข:"}),e.jsx("p",{className:"text-sm",children:m.solution})]}),m.nodeId&&e.jsxs(H,{variant:"outline",className:"text-xs",children:["Node: ",m.nodeId.slice(0,8),"..."]})]},x))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold text-green-700",children:"Workflow ไม่มีปัญหา!"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"ไม่พบปัญหาสำคัญใน workflow นี้ แต่ควรทดสอบการทำงานจริงอีกครั้ง"})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"📋 Checklist การตรวจสอบเพิ่มเติม:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox"}),e.jsx("span",{children:"ทดสอบ workflow ด้วยข้อมูลจริง"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox"}),e.jsx("span",{children:"ตรวจสอบ API keys และ credentials"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox"}),e.jsx("span",{children:"ทดสอบ error scenarios"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox"}),e.jsx("span",{children:"ตรวจสอบ performance และ rate limits"})]})]})]})]})})]})})]})]})},bd=()=>{const[t,s]=h.useState("overview"),{toast:a}=ce(),n=[{id:"webhook",name:"LINE Webhook",type:"trigger",description:"รับข้อความจาก LINE Bot พร้อม Rich Menu",implementation:`// Webhook Configuration
HTTP POST: https://your-n8n.domain/webhook/line-bot
Method: POST
Content-Type: application/json

// Rich Menu Configuration
{
  "areas": [
    {
      "bounds": {"x": 0, "y": 0, "width": 833, "height": 843},
      "action": {
        "type": "postback",
        "data": "{\\"action\\":\\"register\\"}",
        "displayText": "ลงทะเบียนคนไข้"
      }
    },
    {
      "bounds": {"x": 834, "y": 0, "width": 833, "height": 843},
      "action": {
        "type": "postback", 
        "data": "{\\"action\\":\\"show_vaccine_menu\\"}",
        "displayText": "จองวัคซีน"
      }
    },
    {
      "bounds": {"x": 1667, "y": 0, "width": 833, "height": 843},
      "action": {
        "type": "postback",
        "data": "{\\"action\\":\\"check_booking\\"}",
        "displayText": "ตรวจสอบการจอง"
      }
    }
  ]
}`,connections:["user-validator"],icon:ft,color:"bg-blue-500"},{id:"user-validator",name:"User Data Validator",type:"logic",description:"ตรวจสอบข้อมูลผู้ใช้และดึง LINE Profile",implementation:`// User Validation และ Profile Fetching
const input = $json.body?.events?.[0];
const userId = input?.source?.userId;
const eventType = input?.type;

if (!userId) {
  throw new Error('Invalid webhook: No userId found');
}

// ✅ ใช้ Environment Variables แทน context
const CHANNEL_ACCESS_TOKEN = process.env.LINE_CHANNEL_ACCESS_TOKEN;
const SPREADSHEET_ID = process.env.GOOGLE_SPREADSHEET_ID;
const GOOGLE_ACCESS_TOKEN = process.env.GOOGLE_ACCESS_TOKEN;

// ดึง LINE Profile
let userProfile = null;
try {
  const profileResponse = await $http.request({
    method: "GET",
    url: "https://api.line.me/v2/bot/profile/" + userId,
    headers: {
      "Authorization": "Bearer " + CHANNEL_ACCESS_TOKEN
    }
  });
  
  userProfile = profileResponse.body;
} catch (error) {
  console.log("Profile fetch error:", error);
  userProfile = { displayName: "ผู้ใช้", userId: userId };
}

// Helper function ตรวจสอบผู้ใช้ใน Google Sheets
async function checkUserInSheets(userId, spreadsheetId, accessToken) {
  const response = await $http.request({
    method: 'GET',
    url: \`https://sheets.googleapis.com/v4/spreadsheets/\${spreadsheetId}/values/Users:A:G\`,
    headers: {
      'Authorization': 'Bearer ' + accessToken
    }
  });
  
  const rows = response.body.values || [];
  
  for (let i = 1; i < rows.length; i++) {
    if (rows[i][0] === userId) {
      return {
        exists: true,
        row: i + 1,
        data: {
          userId: rows[i][0],
          name: rows[i][1],
          phone: rows[i][2],
          email: rows[i][3],
          dateOfBirth: rows[i][4],
          address: rows[i][5],
          emergencyContact: rows[i][6]
        }
      };
    }
  }
  
  return { exists: false };
}

const existingUser = await checkUserInSheets(userId, SPREADSHEET_ID, GOOGLE_ACCESS_TOKEN);

$json.userId = userId;
$json.userProfile = userProfile;
$json.existingUser = existingUser;
$json.input = input;
$json.timestamp = new Date().toISOString();

return $input.all();`,connections:["smart-router"],icon:Oe,color:"bg-green-500"},{id:"smart-router",name:"AI Smart Router",type:"logic",description:"วิเคราะห์ intent และเส้นทางการทำงาน",implementation:`// AI Smart Router with Rich Menu Support
const { input, userProfile, existingUser } = $json;

let action = 'unknown';
let collectedData = {};

// ตรวจสอบ Postback Data
if (input.postback?.data) {
  try {
    const postbackData = JSON.parse(input.postback.data);
    action = postbackData.action;
    collectedData = postbackData;
  } catch {
    action = input.postback.data;
  }
}

// ตรวจสอบ text message
const userMessage = input.message?.text || '';

// AI Routing Logic
const routingPrompt = \`
คุณเป็น Smart Router สำหรับระบบจองวัคซีน
Input: "\${userMessage}"
Action: "\${action}"
User Profile: \${JSON.stringify(userProfile)}
Existing User: \${!!existingUser}

ส่งคืน JSON:
{
  "route": "register|vaccine_menu|booking|status_check|appointment_reminder",
  "vaccine_type": "covid|flu|hepatitis|hpv|other",
  "required_fields": ["name", "phone", "id_card", "vaccine_type", "date", "time"],
  "next_step": "collect_data|show_calendar|confirm|complete",
  "is_returning_user": \${!!existingUser}
}
\`;

// OpenAI Request
$json.openai_request = {
  model: 'gpt-4',
  messages: [{ role: 'user', content: routingPrompt }],
  temperature: 0.1
};

$json.action = action;
$json.userMessage = userMessage;
$json.collectedData = collectedData;

return $input.all();`,connections:["user-registration","vaccine-booking"],icon:Ee,color:"bg-purple-500"},{id:"user-registration",name:"User Registration",type:"action",description:"ลงทะเบียนผู้ใช้ใหม่และเก็บข้อมูล",implementation:`// User Registration Process
const { userProfile, routing } = $json;

if (routing.route === 'register') {
  // สร้างข้อมูลผู้ใช้ใหม่
  const userData = {
    userId: userProfile.userId,
    displayName: userProfile.displayName,
    pictureUrl: userProfile.pictureUrl || '',
    registeredAt: new Date().toISOString(),
    status: 'active',
    vaccineHistory: [],
    appointments: []
  };

  // บันทึกใน Google Sheets
  const sheetData = [
    userData.userId,
    userData.displayName,
    userData.pictureUrl,
    userData.registeredAt,
    userData.status,
    '[]', // vaccineHistory
    '[]'  // appointments
  ];

  await saveToGoogleSheets('Users', sheetData);

  // Response ข้อความ
  $json.response = {
    type: 'text',
    text: \`สวัสดีคุณ \${userData.displayName}! 🎉
    
ยินดีต้อนรับสู่ระบบจองวัคซีนออนไลน์

✅ ลงทะเบียนเรียบร้อยแล้ว
📱 สามารถใช้เมนูด้านล่างเพื่อเลือกบริการ
💉 พร้อมจองวัคซีนได้ทันที

กดที่เมนู "จองวัคซีน" เพื่อเริ่มต้น\`
  };

  $json.userData = userData;
}

return $input.all();`,connections:["response-sender"],icon:ot,color:"bg-teal-500"},{id:"vaccine-booking",name:"Vaccine Booking System",type:"action",description:"ระบบจองวัคซีนพร้อมการนัดหมาย",implementation:`// Vaccine Booking with Multi-dose Support
const { routing, userProfile, collectedData } = $json;

const vaccineTypes = {
  covid: { doses: 2, interval: 21, name: 'โควิด-19' },
  flu: { doses: 1, interval: 0, name: 'ไข้หวัดใหญ่' },
  hepatitis: { doses: 3, interval: 30, name: 'ไวรัสตับอักเสบบี' },
  hpv: { doses: 2, interval: 60, name: 'HPV' }
};

if (routing.route === 'vaccine_menu') {
  // แสดงเมนูวัคซีน
  $json.response = {
    type: 'flex',
    altText: 'เมนูวัคซีน',
    contents: {
      type: 'carousel',
      contents: Object.keys(vaccineTypes).map(type => ({
        type: 'bubble',
        hero: {
          type: 'image',
          url: \`https://via.placeholder.com/300x200/42A5F5/FFFFFF?text=\${vaccineTypes[type].name}\`,
          size: 'full'
        },
        body: {
          type: 'box',
          layout: 'vertical',
          contents: [
            {
              type: 'text',
              text: vaccineTypes[type].name,
              weight: 'bold',
              size: 'xl'
            },
            {
              type: 'text',
              text: \`จำนวนโดส: \${vaccineTypes[type].doses}\`,
              margin: 'md'
            }
          ]
        },
        footer: {
          type: 'box',
          layout: 'vertical',
          contents: [{
            type: 'button',
            action: {
              type: 'postback',
              label: 'จองเลย',
              data: JSON.stringify({ 
                action: 'book_vaccine', 
                vaccine_type: type 
              })
            }
          }]
        }
      }))
    }
  };
}

if (routing.route === 'booking' && collectedData.vaccine_type) {
  const vaccine = vaccineTypes[collectedData.vaccine_type];
  
  // สร้างนัดหมาย
  const appointment = {
    appointmentId: generateId(),
    userId: userProfile.userId,
    vaccineType: collectedData.vaccine_type,
    vaccineName: vaccine.name,
    doseNumber: 1,
    totalDoses: vaccine.doses,
    appointmentDate: collectedData.date,
    appointmentTime: collectedData.time,
    status: 'confirmed',
    createdAt: new Date().toISOString()
  };

  // คำนวณนัดครั้งถัดไป (ถ้ามี)
  if (vaccine.doses > 1) {
    const nextDate = new Date(collectedData.date);
    nextDate.setDate(nextDate.getDate() + vaccine.interval);
    appointment.nextAppointment = nextDate.toISOString().split('T')[0];
  }

  // บันทึกใน Google Sheets
  await saveAppointmentToSheets(appointment);

  $json.appointment = appointment;
  $json.response = {
    type: 'text',
    text: \`✅ จองวัคซีนเรียบร้อย!

📋 รายละเอียดการจอง:
🏥 วัคซีน: \${vaccine.name}
💉 โดสที่: 1/\${vaccine.doses}
📅 วันที่: \${collectedData.date}
⏰ เวลา: \${collectedData.time}

\${vaccine.doses > 1 ? \`📌 นัดครั้งถัดไป: \${appointment.nextAppointment}\` : ''}

💾 ข้อมูลถูกบันทึกแล้ว
🔔 จะแจ้งเตือนก่อนวันนัด 1 วัน\`
  };
}

return $input.all();`,connections:["calendar-scheduler","response-sender"],icon:Ce,color:"bg-red-500"},{id:"calendar-scheduler",name:"Google Calendar Scheduler",type:"calendar",description:"สร้างนัดหมายใน Google Calendar พร้อมระบบแจ้งเตือนอัตโนมัติ",implementation:`// Google Calendar Integration with Auto Reminders
const { appointment } = $json;

if (appointment) {
  // กำหนดค่า Google Calendar
  const CALENDAR_ID = 'primary'; // หรือ calendar ID ที่ต้องการ
  
  // สร้าง Event ใน Google Calendar
  const eventData = {
    summary: \`วัคซีน \${appointment.vaccineName} - โดสที่ \${appointment.doseNumber}/\${appointment.totalDoses}\`,
    description: \`📋 รายละเอียดการนัดฉีดวัคซีน
    
👤 ผู้ป่วย: \${appointment.userProfile?.displayName || 'ไม่ระบุ'}
💉 วัคซีน: \${appointment.vaccineName}
📊 โดสที่: \${appointment.doseNumber} จาก \${appointment.totalDoses} โดส
📱 LINE User ID: \${appointment.userId}
🆔 Appointment ID: \${appointment.appointmentId}

⚠️ หมายเหตุ: กรุณาให้ผู้ป่วยมาตรงเวลา
\${appointment.nextAppointment ? \`📅 นัดครั้งถัดไป: \${appointment.nextAppointment}\` : ''}\`,
    
    start: {
      dateTime: \`\${appointment.appointmentDate}T\${appointment.appointmentTime}:00+07:00\`,
      timeZone: 'Asia/Bangkok'
    },
    end: {
      dateTime: \`\${appointment.appointmentDate}T\${String(parseInt(appointment.appointmentTime.split(':')[0]) + 1).padStart(2, '0')}:\${appointment.appointmentTime.split(':')[1]}:00+07:00\`,
      timeZone: 'Asia/Bangkok'
    },
    
    // ตั้งค่าการแจ้งเตือน
    reminders: {
      useDefault: false,
      overrides: [
        { method: 'email', minutes: 24 * 60 }, // 1 วันก่อน
        { method: 'popup', minutes: 60 },      // 1 ชั่วโมงก่อน
        { method: 'email', minutes: 30 }       // 30 นาทีก่อน
      ]
    },
    
    // เพิ่ม Attendee
    attendees: [
      {
        email: 'vaccine.admin@hospital.com',
        displayName: 'Vaccine Administrator',
        responseStatus: 'accepted'
      }
    ],
    
    // กำหนดสถานะ
    status: 'confirmed',
    transparency: 'opaque',
    visibility: 'private',
    
    // Extended Properties สำหรับการติดตาม
    extendedProperties: {
      private: {
        lineUserId: appointment.userId,
        appointmentId: appointment.appointmentId,
        vaccineType: appointment.vaccineType,
        doseNumber: appointment.doseNumber.toString(),
        totalDoses: appointment.totalDoses.toString(),
        isVaccineAppointment: 'true'
      }
    }
  };

  // สร้าง Event ใน Google Calendar
  const calendarResponse = await $http.request({
    method: 'POST',
    url: \`https://www.googleapis.com/calendar/v3/calendars/\${CALENDAR_ID}/events\`,
    headers: {
      'Authorization': 'Bearer ' + GOOGLE_ACCESS_TOKEN,
      'Content-Type': 'application/json'
    },
    body: eventData
  });

  // บันทึก Event ID สำหรับการจัดการในอนาคต
  const calendarEvent = calendarResponse.body;
  appointment.calendarEventId = calendarEvent.id;
  appointment.calendarEventUrl = calendarEvent.htmlLink;

  // สร้าง Scheduled Reminder ใน n8n (ใช้ Cron Trigger)
  const reminderDate = new Date(appointment.appointmentDate);
  reminderDate.setDate(reminderDate.getDate() - 1); // 1 วันก่อน
  reminderDate.setHours(9, 0, 0, 0); // เวลา 9:00 น.

  const reminderData = {
    reminderId: generateId(),
    scheduledFor: reminderDate.toISOString(),
    userId: appointment.userId,
    appointmentId: appointment.appointmentId,
    calendarEventId: calendarEvent.id,
    message: \`🔔 แจ้งเตือนการนัดฉีดวัคซีน

พรุ่งนี้ (\${appointment.appointmentDate}) คุณมีนัดฉีดวัคซีน:

💉 วัคซีน: \${appointment.vaccineName}
📊 โดสที่: \${appointment.doseNumber}/\${appointment.totalDoses}
⏰ เวลา: \${appointment.appointmentTime} น.
📍 สถานที่: โรงพยาบาล/คลินิก

✅ สิ่งที่ต้องเตรียม:
• บัตรประชาชน
• บัตรประกันสุขภาพ (ถ้ามี)
• หน้ากากอนามัย

⚠️ หากไม่สามารถมาได้ กรุณาแจ้งล่วงหน้า 24 ชั่วโมง
📱 กดเมนู "ตรวจสอบการจอง" เพื่อดูรายละเอียด\`,
    type: 'appointment_reminder',
    status: 'pending'
  };

  // บันทึก Reminder Schedule
  await saveReminderToSheets(reminderData);

  // ถ้ามีโดสถัดไป ให้สร้าง Event สำหรับโดสถัดไป (แบบ Tentative)
  if (appointment.nextAppointment) {
    const nextEventData = {
      ...eventData,
      summary: \`วัคซีน \${appointment.vaccineName} - โดสที่ \${appointment.doseNumber + 1}/\${appointment.totalDoses} (ขั้นต้น)\`,
      description: \`📋 นัดฉีดโดสถัดไป (รอยืนยัน)
      
👤 ผู้ป่วย: \${appointment.userProfile?.displayName || 'ไม่ระบุ'}
💉 วัคซีน: \${appointment.vaccineName}
📊 โดสที่: \${appointment.doseNumber + 1} จาก \${appointment.totalDoses} โดส
⏰ สถานะ: รอยืนยันการจอง

📱 ระบบจะแจ้งเตือนให้จองเวลาที่แน่นอน\`,
      start: {
        dateTime: \`\${appointment.nextAppointment}T09:00:00+07:00\`,
        timeZone: 'Asia/Bangkok'
      },
      end: {
        dateTime: \`\${appointment.nextAppointment}T10:00:00+07:00\`,
        timeZone: 'Asia/Bangkok'
      },
      status: 'tentative', // สถานะไม่แน่นอน
      transparency: 'transparent'
    };

    const nextCalendarResponse = await $http.request({
      method: 'POST',
      url: \`https://www.googleapis.com/calendar/v3/calendars/\${CALENDAR_ID}/events\`,
      headers: {
        'Authorization': 'Bearer ' + GOOGLE_ACCESS_TOKEN,
        'Content-Type': 'application/json'
      },
      body: nextEventData
    });

    // สร้าง Reminder สำหรับโดสถัดไป
    const nextReminderDate = new Date(appointment.nextAppointment);
    nextReminderDate.setDate(nextReminderDate.getDate() - 7); // 1 สัปดาห์ก่อน
    nextReminderDate.setHours(10, 0, 0, 0);

    const nextReminderData = {
      reminderId: generateId(),
      scheduledFor: nextReminderDate.toISOString(),
      userId: appointment.userId,
      appointmentId: appointment.appointmentId,
      relatedAppointmentId: appointment.appointmentId,
      calendarEventId: nextCalendarResponse.body.id,
      message: \`🔔 แจ้งเตือนโดสวัคซีนถัดไป

อีก 1 สัปดาห์ถึงเวลานัดโดสถัดไป!

💉 วัคซีน: \${appointment.vaccineName}
📊 โดสที่: \${appointment.doseNumber + 1}/\${appointment.totalDoses}
📅 วันที่แนะนำ: \${appointment.nextAppointment}

📱 กรุณาจองเวลาที่แน่นอนผ่านเมนู "จองวัคซีน"
⚠️ ไม่ควรล่าช้าเกินวันที่แนะนำ\`,
      type: 'next_dose_reminder',
      status: 'pending'
    };

    await saveReminderToSheets(nextReminderData);
    
    appointment.nextCalendarEventId = nextCalendarResponse.body.id;
  }

  // อัปเดตข้อมูล appointment ด้วย Calendar Event IDs
  await updateAppointmentInSheets(appointment);

  $json.calendarEvent = calendarEvent;
  $json.reminderScheduled = true;
  $json.calendarCreated = true;
}

// Helper Functions
function generateId() {
  return Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
}

async function saveReminderToSheets(reminderData) {
  const sheetData = [
    reminderData.reminderId,
    reminderData.scheduledFor,
    reminderData.userId,
    reminderData.appointmentId,
    reminderData.calendarEventId || '',
    reminderData.message,
    reminderData.type,
    reminderData.status,
    new Date().toISOString()
  ];

  return await $http.request({
    method: 'POST',
    url: \`https://sheets.googleapis.com/v4/spreadsheets/\${SPREADSHEET_ID}/values/Reminders:append\`,
    headers: {
      'Authorization': 'Bearer ' + GOOGLE_ACCESS_TOKEN,
      'Content-Type': 'application/json'
    },
    body: {
      values: [sheetData],
      valueInputOption: 'RAW'
    }
  });
}

async function updateAppointmentInSheets(appointment) {
  // อัปเดตข้อมูล appointment ด้วย calendar event IDs
  // ใช้ Google Sheets API เพื่ออัปเดตแถวที่ตรงกับ appointmentId
}

return $input.all();`,connections:["google-sheets"],icon:be,color:"bg-orange-500"},{id:"google-sheets",name:"Google Sheets Database",type:"data",description:"จัดเก็บข้อมูลทั้งหมดใน Google Sheets",implementation:`// Google Sheets Database Management
const SPREADSHEET_ID = 'your-spreadsheet-id';

// Sheets Structure:
// 1. Users: userId, displayName, pictureUrl, registeredAt, status, vaccineHistory, appointments
// 2. Appointments: appointmentId, userId, vaccineType, doseNumber, totalDoses, date, time, status, createdAt
// 3. Reminders: reminderId, userId, appointmentId, scheduledFor, message, type, sent
// 4. VaccineHistory: historyId, userId, vaccineType, vaccineName, doseNumber, date, location, batch

async function saveToGoogleSheets(sheetName, data) {
  const response = await $http.request({
    method: 'POST',
    url: \`https://sheets.googleapis.com/v4/spreadsheets/\${SPREADSHEET_ID}/values/\${sheetName}:append\`,
    headers: {
      'Authorization': 'Bearer ' + GOOGLE_ACCESS_TOKEN,
      'Content-Type': 'application/json'
    },
    body: {
      values: [data],
      valueInputOption: 'RAW'
    }
  });
  
  return response.body;
}


// Auto-backup and data integrity
const backupData = {
  timestamp: new Date().toISOString(),
  totalUsers: await countRows('Users'),
  totalAppointments: await countRows('Appointments'),
  pendingReminders: await countPendingReminders()
};

$json.backupInfo = backupData;
$json.dataOperation = 'success';

return $input.all();`,connections:["response-sender"],icon:jt,color:"bg-indigo-500"},{id:"response-sender",name:"LINE Response Handler",type:"action",description:"ส่งข้อความตอบกลับผ่าน LINE API",implementation:`// LINE Response Handler
const { response, input } = $json;
const replyToken = input.replyToken;

if (!replyToken) {
  throw new Error('No reply token found');
}

// ส่งข้อความผ่าน LINE API
const lineResponse = await $http.request({
  method: 'POST',
  url: 'https://api.line.me/v2/bot/message/reply',
  headers: {
    'Authorization': 'Bearer ' + CHANNEL_ACCESS_TOKEN,
    'Content-Type': 'application/json'
  },
  body: {
    replyToken: replyToken,
    messages: [response]
  }
});

// Log การส่งข้อความ
await logActivity({
  userId: $json.userId,
  action: 'message_sent',
  response: response,
  timestamp: new Date().toISOString()
});

$json.messageSent = true;
$json.lineResponse = lineResponse.body;

return $input.all();`,connections:[],icon:ft,color:"bg-green-600"}],r=()=>{const u={name:"ระบบจองวัคซีนครบวงจร",nodes:n.map((j,l)=>({id:j.id,name:j.name,type:i(j.type),typeVersion:1,position:[100+l%3*300,100+Math.floor(l/3)*200],parameters:o(j)})),connections:c(),active:!0,settings:{timezone:"Asia/Bangkok"}};return JSON.stringify(u,null,2)},i=u=>{switch(u){case"trigger":return"n8n-nodes-base.webhook";case"logic":return"n8n-nodes-base.code";case"action":return"n8n-nodes-base.httpRequest";case"data":return"n8n-nodes-base.googleSheets";case"calendar":return"n8n-nodes-base.googleCalendar";default:return"n8n-nodes-base.code"}},o=u=>u.type==="trigger"?{httpMethod:"POST",path:"line-vaccine-bot",responseMode:"respondImmediately"}:u.type==="logic"||u.type==="action"?{mode:"runOnceForAllItems",jsCode:u.implementation}:{},c=()=>{const u={},j=n.reduce((l,m)=>(l[m.id]=m.name,l),{});return n.forEach(l=>{l.connections.length>0&&(u[l.name]={main:[l.connections.map(m=>({node:j[m]||m,type:"main",index:0}))]})}),u},d=u=>{navigator.clipboard.writeText(u),a({title:"คัดลอกแล้ว",description:"โค้ดถูกคัดลอกไปยัง clipboard แล้ว"})},p=()=>{const u=r(),j=new Blob([u],{type:"application/json"}),l=URL.createObjectURL(j),m=document.createElement("a");m.href=l,m.download="vaccine-booking-workflow.json",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(l)};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent",children:"🏥 ระบบจองวัคซีนครบวงจร"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-3xl mx-auto",children:"Workflow สมบูรณ์สำหรับระบบจองวัคซีน พร้อมการลงทะเบียน, นัดหมาย, และการแจ้งเตือนอัตโนมัติ"})]}),e.jsxs(Ue,{value:t,onValueChange:s,className:"space-y-4",children:[e.jsxs(ze,{className:"grid w-full grid-cols-5",children:[e.jsx(Z,{value:"overview",children:"ภาพรวม"}),e.jsx(Z,{value:"workflow",children:"โครงสร้าง"}),e.jsx(Z,{value:"features",children:"คุณสมบัติ"}),e.jsx(Z,{value:"implementation",children:"การติดตั้ง"}),e.jsx(Z,{value:"export",children:"Export"})]}),e.jsxs(ee,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(S,{className:"text-center",children:e.jsxs(D,{className:"p-6",children:[e.jsx(ot,{className:"w-12 h-12 mx-auto mb-4 text-teal-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"ลงทะเบียนผู้ใช้"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"ระบบลงทะเบียนอัตโนมัติด้วย LINE Profile"})]})}),e.jsx(S,{className:"text-center",children:e.jsxs(D,{className:"p-6",children:[e.jsx(Ce,{className:"w-12 h-12 mx-auto mb-4 text-red-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"จองวัคซีน"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"จองวัคซีนแบบ Multi-dose พร้อมนัดครั้งถัดไป"})]})}),e.jsx(S,{className:"text-center",children:e.jsxs(D,{className:"p-6",children:[e.jsx($e,{className:"w-12 h-12 mx-auto mb-4 text-orange-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"แจ้งเตือน"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"แจ้งเตือนอัตโนมัติก่อนวันนัด 1 วัน"})]})}),e.jsx(S,{className:"text-center",children:e.jsxs(D,{className:"p-6",children:[e.jsx(jt,{className:"w-12 h-12 mx-auto mb-4 text-indigo-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"จัดเก็บข้อมูล"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"บันทึกใน Google Sheets แบบ Real-time"})]})})]}),e.jsxs(Q,{children:[e.jsx(G,{className:"w-4 h-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"ความสมบูรณ์ 100%:"})," ระบบนี้ครอบคลุมทุกความต้องการที่คุณระบุ พร้อมใช้งานได้ทันที"]})]})]}),e.jsx(ee,{value:"workflow",className:"space-y-4",children:e.jsx("div",{className:"space-y-4",children:n.map((u,j)=>{const l=u.icon;return e.jsxs(S,{className:"relative",children:[e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${u.color} text-white`,children:e.jsx(l,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx($,{className:"text-lg",children:u.name}),e.jsx(oe,{children:u.description})]}),e.jsx(H,{variant:u.type==="trigger"?"default":u.type==="logic"?"secondary":u.type==="action"?"destructive":"outline",children:u.type.toUpperCase()})]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"การทำงาน:"}),e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>d(u.implementation),children:e.jsx(ye,{className:"w-4 h-4"})})]}),e.jsxs("pre",{className:"text-xs overflow-x-auto whitespace-pre-wrap",children:[u.implementation.substring(0,200),"..."]})]}),u.connections.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsxs("span",{children:["เชื่อมต่อไปยัง: ",u.connections.join(", ")]})]})]})]},u.id)})})}),e.jsx(ee,{value:"features",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"w-5 h-5"}),"Rich Menu & UX"]})}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Rich Menu 3 ปุ่มหลัก"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Carousel วัคซีนแยกประเภท"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Quick Reply สะดวกรวดเร็ว"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Datetime Picker เลือกวันเวลา"})]})]})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(jt,{className:"w-5 h-5"}),"การจัดเก็บข้อมูล"]})}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Users Sheet - ข้อมูลผู้ใช้"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Appointments - การนัดหมาย"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Reminders - การแจ้งเตือน"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"VaccineHistory - ประวัติการฉีด"})]})]})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5"}),"ระบบวัคซีน"]})}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"โควิด-19 (2 โดส, ห่าง 21 วัน)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"ไข้หวัดใหญ่ (1 โดส)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"ไวรัสตับอักเสบบี (3 โดส)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"HPV (2 โดส, ห่าง 60 วัน)"})]})]})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5"}),"การแจ้งเตือน"]})}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"แจ้งเตือนก่อนนัด 1 วัน"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"แจ้งเตือนโดสถัดไป"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Cron Schedule อัตโนมัติ"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"การยกเลิก/เลื่อนนัด"})]})]})]})]})}),e.jsx(ee,{value:"implementation",className:"space-y-6",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsx($,{children:"ขั้นตอนการติดตั้ง"}),e.jsx(oe,{children:"คำแนะนำการติดตั้งและกำหนดค่าระบบ"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"สร้าง LINE Bot"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"สร้าง LINE Bot ใน LINE Developers Console และได้ Channel Access Token"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"ตั้งค่า Google Sheets"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"สร้าง Google Sheets พร้อม 4 Sheets: Users, Appointments, Reminders, VaccineHistory"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold",children:"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Import Workflow"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Import ไฟล์ JSON ลงใน n8n และกำหนดค่า credentials"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold",children:"4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"ติดตั้ง Rich Menu"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"อัปโหลด Rich Menu ไปยัง LINE Bot ด้วย API หรือ Console"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold",children:"5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"ทดสอบระบบ"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ทดสอบการทำงานทุกฟีเจอร์ และปรับแต่งตามความต้องการ"})]})]})]}),e.jsx(ge,{}),e.jsxs(Q,{children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"สำคัญ:"})," ต้องกำหนดค่า credentials สำหรับ LINE API, Google Sheets API และ OpenAI API ให้ครบถ้วน"]})]})]})]})}),e.jsxs(ee,{value:"export",className:"space-y-6",children:[e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsx($,{children:"ดาวน์โหลด Workflow"}),e.jsx(oe,{children:"ดาวน์โหลดไฟล์ JSON ของ workflow เพื่อ import ใน n8n"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(k,{onClick:p,className:"flex-1",children:[e.jsx(js,{className:"w-4 h-4 mr-2"}),"ดาวน์โหลด JSON"]}),e.jsxs(k,{variant:"outline",onClick:()=>d(r()),className:"flex-1",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"คัดลอก JSON"]})]}),e.jsxs(Q,{children:[e.jsx(bs,{className:"w-4 h-4"}),e.jsx(X,{children:"ไฟล์ JSON นี้พร้อมใช้งาน ครอบคลุมทุกฟีเจอร์ตามที่คุณต้องการ รวมถึงการจัดการข้อผิดพลาดและ error handling"})]})]})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsx($,{children:"คุณสมบัติพิเศษ"})}),e.jsx(D,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"🚀 Performance"}),e.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"• Async/Await pattern"}),e.jsx("li",{children:"• Error handling ครอบคลุม"}),e.jsx("li",{children:"• Connection pooling"}),e.jsx("li",{children:"• Rate limiting support"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"🔒 Security"}),e.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"• Token validation"}),e.jsx("li",{children:"• Data sanitization"}),e.jsx("li",{children:"• API rate limiting"}),e.jsx("li",{children:"• Access logging"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"📊 Analytics"}),e.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"• User behavior tracking"}),e.jsx("li",{children:"• Appointment statistics"}),e.jsx("li",{children:"• Conversion metrics"}),e.jsx("li",{children:"• Performance monitoring"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"🔧 Maintenance"}),e.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"• Auto backup"}),e.jsx("li",{children:"• Health checks"}),e.jsx("li",{children:"• Log management"}),e.jsx("li",{children:"• Update mechanisms"})]})]})]})})]})]})]})]})},ae=h.forwardRef(({className:t,type:s,...a},n)=>e.jsx("input",{type:s,className:U("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...a}));ae.displayName="Input";var yd="Label",oi=h.forwardRef((t,s)=>e.jsx(Ve.label,{...t,ref:s,onMouseDown:a=>{var r;a.target.closest("button, input, select, textarea")||((r=t.onMouseDown)==null||r.call(t,a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));oi.displayName=yd;var li=oi;const Nd=wt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),K=h.forwardRef(({className:t,...s},a)=>e.jsx(li,{ref:a,className:U(Nd(),t),...s}));K.displayName=li.displayName;const ct=Vo,dt=zo,et=h.forwardRef(({className:t,children:s,...a},n)=>e.jsxs(Zn,{ref:n,className:U("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...a,children:[s,e.jsx(Ro,{asChild:!0,children:e.jsx(ur,{className:"h-4 w-4 opacity-50"})})]}));et.displayName=Zn.displayName;const ci=h.forwardRef(({className:t,...s},a)=>e.jsx(er,{ref:a,className:U("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Ko,{className:"h-4 w-4"})}));ci.displayName=er.displayName;const di=h.forwardRef(({className:t,...s},a)=>e.jsx(tr,{ref:a,className:U("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(ur,{className:"h-4 w-4"})}));di.displayName=tr.displayName;const tt=h.forwardRef(({className:t,children:s,position:a="popper",...n},r)=>e.jsx(Lo,{children:e.jsxs(sr,{ref:r,className:U("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...n,children:[e.jsx(ci,{}),e.jsx($o,{className:U("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(di,{})]})}));tt.displayName=sr.displayName;const wd=h.forwardRef(({className:t,...s},a)=>e.jsx(ar,{ref:a,className:U("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}));wd.displayName=ar.displayName;const _e=h.forwardRef(({className:t,children:s,...a},n)=>e.jsxs(nr,{ref:n,className:U("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Oo,{children:e.jsx(rt,{className:"h-4 w-4"})})}),e.jsx(Fo,{children:s})]}));_e.displayName=nr.displayName;const _d=h.forwardRef(({className:t,...s},a)=>e.jsx(rr,{ref:a,className:U("-mx-1 my-1 h-px bg-muted",t),...s}));_d.displayName=rr.displayName;const Sd=()=>{const[t,s]=h.useState("patients"),[a,n]=h.useState([]),[r,i]=h.useState([]),[o,c]=h.useState(""),[d,p]=h.useState(null),[u,j]=h.useState(!1),{toast:l}=ce(),m=[{id:"flu",name:"วัคซีนไข้หวัดใหญ่",doses:2,interval:365,description:"วัคซีนป้องกันไข้หวัดใหญ่ประจำปี และฉีดกระตุ้นปีหน้า",available:!0},{id:"hep_b",name:"วัคซีนไวรัสตับอักเสบบี",doses:3,interval:30,description:"ฉีด 3 โดส: โดส 1, โดส 2 (1 เดือน), โดส 3 (6 เดือน)",available:!0},{id:"tetanus",name:"วัคซีนป้องกันบาดทะยัก",doses:3,interval:30,description:"ฉีด 3 โดส: โดส 1, โดส 2 (1 เดือน), โดส 3 (หลังจากโดส 2 อีก 6 เดือน)",available:!0},{id:"shingles",name:"วัคซีนงูสวัด",doses:2,interval:90,description:"ฉีด 2 โดส ห่างกัน 3 เดือน",available:!0},{id:"hpv",name:"วัคซีนป้องกันมะเร็งปากมดลูก",doses:3,interval:30,description:"ฉีด 3 โดส: โดส 1, โดส 2 (1 เดือน), โดส 3 (6 เดือน)",available:!0},{id:"pneumonia",name:"วัคซีนปอดอักเสบ",doses:2,interval:60,description:"ฉีด 2 โดส ห่างกัน 2 เดือน",available:!0},{id:"chickenpox",name:"วัคซีนอีสุกอีใส",doses:2,interval:30,description:"ฉีด 2 โดส ห่างกัน 1 เดือน",available:!0},{id:"rabies",name:"วัคซีนพิษสุนัขบ้า",doses:5,interval:3,description:"ฉีด 5 เข็ม: วันแรก, วันที่ 3, วันที่ 7, วันที่ 14, วันที่ 28",available:!0}];h.useEffect(()=>{const f=[{id:"1",lineUserId:"U1234567890",displayName:"สมชาย ใจดี",firstName:"สมชาย",lastName:"ใจดี",phone:"081-234-5678",registeredAt:"2024-01-15T10:30:00",status:"pending"},{id:"2",lineUserId:"U2345678901",displayName:"สมหญิง รักดี",firstName:"สมหญิง",lastName:"รักดี",phone:"082-345-6789",registeredAt:"2024-01-16T14:20:00",status:"pending"},{id:"3",lineUserId:"U3456789012",displayName:"วิชัย เก่งมาก",firstName:"วิชัย",lastName:"เก่งมาก",registeredAt:"2024-01-17T09:15:00",status:"completed"}],N=[{id:"apt-1",patientId:"3",patientName:"วิชัย เก่งมาก",vaccineId:"covid-19",vaccineName:"วัคซีนโควิด-19",doseNumber:1,totalDoses:2,appointmentDate:"2024-01-20",appointmentTime:"10:00",status:"completed",notes:"ฉีดเรียบร้อย ไม่มีผลข้างเคียง",createdAt:"2024-01-17T09:30:00",staffId:"staff-001"}];n(f),i(N)},[]);const x=a.filter(f=>{var N;return f.displayName.toLowerCase().includes(o.toLowerCase())||((N=f.phone)==null?void 0:N.includes(o))}),g=f=>{var _,A;if(!d)return;const N={id:`apt-${Date.now()}`,patientId:d.id,patientName:d.displayName,vaccineId:f.vaccineId,vaccineName:((_=m.find(E=>E.id===f.vaccineId))==null?void 0:_.name)||"",doseNumber:1,totalDoses:((A=m.find(E=>E.id===f.vaccineId))==null?void 0:A.doses)||1,appointmentDate:f.date,appointmentTime:f.time,status:"scheduled",notes:f.notes,createdAt:new Date().toISOString(),staffId:"staff-001"};i(E=>[...E,N]),j(!1),p(null),v(d,N),l({title:"สร้างนัดหมายสำเร็จ",description:`นัดหมายสำหรับ ${d.displayName} ถูกสร้างเรียบร้อยแล้ว`})},v=(f,N)=>{console.log("Sending LINE notification:",{to:f.lineUserId,message:`🎉 การนัดหมายของคุณถูกยืนยันแล้ว!

📋 รายละเอียดการนัด:
💉 วัคซีน: ${N.vaccineName}
📅 วันที่: ${N.appointmentDate}
⏰ เวลา: ${N.appointmentTime}
🏥 โดสที่: ${N.doseNumber}/${N.totalDoses}

⚠️ กรุณามาตรงเวลา
📞 หากมีปัญหาโทร: 02-xxx-xxxx`}),l({title:"ส่งการแจ้งเตือนแล้ว",description:`ส่งข้อความยืนยันการนัดไปยัง LINE ของ ${f.displayName} เรียบร้อยแล้ว`})};return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"ระบบจัดการวัคซีน - เจ้าหน้าที่"}),e.jsx("p",{className:"text-muted-foreground",children:"จัดการคนไข้ วัคซีน และการนัดหมาย"})]}),e.jsxs(Ue,{value:t,onValueChange:s,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-4 max-w-2xl",children:[e.jsxs(Z,{value:"patients",className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"คนไข้"]}),e.jsxs(Z,{value:"appointments",className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"นัดหมาย"]}),e.jsxs(Z,{value:"vaccines",className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"วัคซีน"]}),e.jsxs(Z,{value:"notifications",className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),"แจ้งเตือน"]})]}),e.jsx(ee,{value:"patients",className:"mt-6",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),"รายชื่อคนไข้ที่ลงทะเบียนผ่าน LINE"]}),e.jsx(oe,{children:"คนไข้ที่ลงทะเบียนชื่อ-นามสกุลผ่าน LINE Bot รอการจัดการ"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ae,{placeholder:"ค้นหาชื่อหรือเบอร์โทร...",value:o,onChange:f=>c(f.target.value),className:"pl-10"})]})})]}),e.jsx(D,{children:e.jsx("div",{className:"grid gap-4",children:x.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Jo,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:f.displayName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:f.phone||"ไม่มีเบอร์โทร"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ลงทะเบียนเมื่อ: ",new Date(f.registeredAt).toLocaleString("th-TH")]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{variant:f.status==="completed"?"default":"secondary",children:f.status==="pending"?"รอดำเนินการ":f.status==="completed"?"เสร็จสิ้น":"ยกเลิก"}),e.jsxs(k,{onClick:()=>{p(f),j(!0)},size:"sm",className:"flex items-center gap-2",children:[e.jsx(Oa,{className:"h-4 w-4"}),"จองวัคซีน"]})]})]},f.id))})})]})}),e.jsx(ee,{value:"appointments",className:"mt-6",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"รายการนัดหมาย"]}),e.jsx(oe,{children:"นัดหมายการฉีดวัคซีนทั้งหมด"})]}),e.jsx(D,{children:e.jsx("div",{className:"grid gap-4",children:r.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Ce,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:f.patientName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[f.vaccineName," - โดสที่ ",f.doseNumber,"/",f.totalDoses]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["📅 ",f.appointmentDate," เวลา ",f.appointmentTime]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{variant:f.status==="completed"?"default":f.status==="scheduled"?"secondary":f.status==="cancelled"?"destructive":"outline",children:f.status==="scheduled"?"นัดแล้ว":f.status==="completed"?"เสร็จสิ้น":f.status==="cancelled"?"ยกเลิก":"ไม่มา"}),f.status==="scheduled"&&e.jsx(k,{size:"sm",variant:"outline",children:e.jsx(Fa,{className:"h-4 w-4"})})]})]},f.id))})})]})}),e.jsx(ee,{value:"vaccines",className:"mt-6",children:e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:m.map(f=>e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),f.name]}),e.jsx(oe,{children:f.description})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"จำนวนโดส:"}),e.jsxs("span",{className:"font-semibold",children:[f.doses," โดส"]})]}),f.interval>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ห่างระหว่างโดส:"}),e.jsxs("span",{className:"font-semibold",children:[f.interval," วัน"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"สถานะ:"}),e.jsx(H,{variant:f.available?"default":"secondary",children:f.available?"พร้อมให้บริการ":"ไม่พร้อม"})]})]})})]},f.id))})}),e.jsx(ee,{value:"notifications",className:"mt-6",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5"}),"ส่งการแจ้งเตือน"]}),e.jsx(oe,{children:"ส่งข้อความแจ้งเตือนไปยัง LINE ของคนไข้"})]}),e.jsx(D,{children:e.jsxs(Q,{children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx(X,{children:"ระบบจะส่งการแจ้งเตือนอัตโนมัติเมื่อสร้างนัดหมายใหม่ และก่อนวันนัด 1 วัน"})]})})]})})]}),u&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs(S,{className:"w-full max-w-md",children:[e.jsxs(L,{children:[e.jsxs($,{children:["จองวัคซีนสำหรับ ",d.displayName]}),e.jsx(oe,{children:"เลือกวัคซีนและกำหนดวันเวลานัดหมาย"})]}),e.jsx(D,{children:e.jsxs("form",{onSubmit:f=>{f.preventDefault();const N=new FormData(f.target);g({vaccineId:N.get("vaccine"),date:N.get("date"),time:N.get("time"),notes:N.get("notes")})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"vaccine",children:"เลือกวัคซีน"}),e.jsxs(ct,{name:"vaccine",required:!0,children:[e.jsx(et,{children:e.jsx(dt,{placeholder:"เลือกประเภทวัคซีน"})}),e.jsx(tt,{children:m.filter(f=>f.available).map(f=>e.jsxs(_e,{value:f.id,children:[f.name," (",f.doses," โดส)"]},f.id))})]})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"date",children:"วันที่นัด"}),e.jsx(ae,{type:"date",name:"date",required:!0,min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"time",children:"เวลานัด"}),e.jsx(ae,{type:"time",name:"time",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"notes",children:"หมายเหตุ (ไม่จำเป็น)"}),e.jsx(zt,{name:"notes",placeholder:"หมายเหตุเพิ่มเติม...",rows:3})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(k,{type:"submit",className:"flex-1",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"สร้างนัดหมาย"]}),e.jsx(k,{type:"button",variant:"outline",onClick:()=>{j(!1),p(null)},children:"ยกเลิก"})]})]})})]})})]})})},Dd=()=>{const[t,s]=h.useState(!1),[a,n]=h.useState(""),[r,i]=h.useState(!1),{toast:o}=ce(),c={name:"VaccineBot",id:"@vaccine-bot",webhook:"https://your-n8n.domain/webhook/line-bot"},d=()=>{const l=`// LINE Bot Webhook สำหรับลงทะเบียนคนไข้
// URL: ${c.webhook}

// ข้อความต้อนรับ
const welcomeMessage = {
  "type": "text",
  "text": "🏥 ยินดีต้อนรับสู่ระบบลงทะเบียนวัคซีน\\n\\n📝 กรุณากรอกข้อมูลของคุณ:\\n\\n1️⃣ ชื่อ-นามสกุล (เต็ม)\\n2️⃣ เบอร์โทรศัพท์\\n\\nตอบกลับข้อความนี้เพื่อเริ่มลงทะเบียน"
};

// การประมวลผลข้อความ
if (input.type === "message" && input.message.type === "text") {
  const userText = input.message.text.trim();
  const userId = input.source.userId;
  
  // ดึงข้อมูล Profile จาก LINE
  const profileResponse = await this.helpers.request({
    method: "GET",
    url: "https://api.line.me/v2/bot/profile/" + userId,
    headers: {
      "Authorization": "Bearer " + process.env.LINE_CHANNEL_ACCESS_TOKEN
    }
  });
  
  const profile = profileResponse.body;
  
  // วิเคราะห์ข้อความที่ส่งมา
  const patterns = {
    fullName: /^[ก-๙a-zA-Z\\s]{4,50}$/,
    phone: /^(08|09|06|02)\\d{8}$/
  };
  
  let responseMessage = "";
  
  // ตรวจสอบรูปแบบข้อมูล
  if (patterns.fullName.test(userText)) {
    // เป็นชื่อ-นามสกุล
    responseMessage = \`✅ บันทึกชื่อ: \${userText}\\n\\n📱 กรุณาส่งเบอร์โทรศัพท์ของคุณ\\n(ตัวอย่าง: 081-234-5678)\`;
    
    // บันทึกลง Google Sheets
    await saveToGoogleSheets('Patients', [
      userId,
      profile.displayName,
      userText, // ชื่อเต็มที่ผู้ใช้กรอก
      '', // เบอร์โทร - รอกรอก
      new Date().toISOString(),
      'pending-phone'
    ]);
    
  } else if (patterns.phone.test(userText.replace(/-/g, ''))) {
    // เป็นเบอร์โทรศัพท์
    responseMessage = \`✅ บันทึกเบอร์โทร: \${userText}\\n\\n🎉 ลงทะเบียนสำเร็จ!\\n\\n👩‍⚕️ เจ้าหน้าที่จะติดต่อกลับเพื่อนัดหมายการฉีดวัคซีน\\n\\n⏰ โดยปกติจะได้รับการติดต่อภายใน 24 ชั่วโมง\`;
    
    // อัปเดตข้อมูลใน Google Sheets
    await updatePatientPhone(userId, userText);
    
    // แจ้งเตือนเจ้าหน้าที่
    await notifyStaff(userId, profile.displayName, userText);
    
  } else {
    // รูปแบบไม่ถูกต้อง
    responseMessage = \`❌ รูปแบบข้อมูลไม่ถูกต้อง\\n\\n📝 กรุณาส่ง:\\n\\n1️⃣ ชื่อ-นามสกุล (ภาษาไทยหรืออังกฤษ)\\nตัวอย่าง: สมชาย ใจดี\\n\\n2️⃣ เบอร์โทรศัพท์ (10 หลัก)\\nตัวอย่าง: 081-234-5678\`;
  }
  
  // ส่งข้อความตอบกลับ
  return [{
    json: {
      to: userId,
      messages: [{
        type: "text",
        text: responseMessage
      }]
    }
  }];
}

// Helper Functions
async function saveToGoogleSheets(sheetName, data) {
  const response = await this.helpers.request({
    method: 'POST',
    url: \`https://sheets.googleapis.com/v4/spreadsheets/\${process.env.GOOGLE_SPREADSHEET_ID}/values/\${sheetName}:append\`,
    headers: {
      'Authorization': 'Bearer ' + process.env.GOOGLE_ACCESS_TOKEN,
      'Content-Type': 'application/json'
    },
    body: {
      values: [data],
      valueInputOption: 'RAW'
    }
  });
  return response.body;
}

async function updatePatientPhone(userId, phone) {
  // ค้นหาแถวที่ต้องอัปเดต
  const getResponse = await this.helpers.request({
    method: 'GET',
    url: \`https://sheets.googleapis.com/v4/spreadsheets/\${process.env.GOOGLE_SPREADSHEET_ID}/values/Patients:A:F\`,
    headers: {
      'Authorization': 'Bearer ' + process.env.GOOGLE_ACCESS_TOKEN
    }
  });
  
  const rows = getResponse.body.values || [];
  let updateRow = -1;
  
  for (let i = 0; i < rows.length; i++) {
    if (rows[i][0] === userId) {
      updateRow = i + 1;
      break;
    }
  }
  
  if (updateRow > 0) {
    // อัปเดตเบอร์โทรและสถานะ
    await this.helpers.request({
      method: 'PUT',
      url: \`https://sheets.googleapis.com/v4/spreadsheets/\${process.env.GOOGLE_SPREADSHEET_ID}/values/Patients:D\${updateRow}:F\${updateRow}\`,
      headers: {
        'Authorization': 'Bearer ' + process.env.GOOGLE_ACCESS_TOKEN,
        'Content-Type': 'application/json'
      },
      body: {
        values: [[
          phone,
          new Date().toISOString(),
          'completed'
        ]],
        valueInputOption: 'RAW'
      }
    });
  }
}

async function notifyStaff(userId, displayName, phone) {
  // ส่งการแจ้งเตือนไปยังระบบเจ้าหน้าที่
  // (สามารถใช้ Webhook, Email, หรือ Slack)
  console.log('New patient registered:', {
    userId,
    displayName,
    phone,
    timestamp: new Date().toISOString()
  });
}`;n(l)},p=l=>{navigator.clipboard.writeText(l),o({title:"คัดลอกแล้ว",description:"คัดลอกโค้ดไปยังคลิปบอร์ดเรียบร้อยแล้ว"})},u=async l=>{i(!0);try{await fetch("https://fljyjbrgfzervxofrilo.supabase.co/functions/v1/secure-patient-webhook",{method:"POST",headers:{"Content-Type":"application/json","x-webhook-secret":"secure-patient-registration"},body:JSON.stringify({type:"patient_registration",patientName:l.fullName||l.displayName,registrationType:l.registrationType||"manual",timestamp:new Date().toISOString(),source:"frontend_registration"})}),o({title:"ส่งข้อมูลสำเร็จ",description:"ข้อมูลได้ถูกส่งผ่านระบบรักษาความปลอดภัยแล้ว"})}catch(m){console.error("Error sending to secure webhook:",m),o({title:"ข้อผิดพลาด",description:"ไม่สามารถส่งข้อมูลได้",variant:"destructive"})}finally{i(!1)}},j=()=>{u({LineUserID:"test-user-123",displayName:"ทดสอบ ระบบ",fullName:"นาย ทดสอบ ระบบ",registrationType:"manual"})};return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"ระบบลงทะเบียนคนไข้ผ่าน LINE Bot"}),e.jsx("p",{className:"text-muted-foreground",children:"คนไข้สามารถลงทะเบียนชื่อ-นามสกุลและเบอร์โทรศัพท์ผ่าน LINE Bot"})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(hr,{className:"h-5 w-5"}),"เชื่อมต่อกับ n8n Workflow"]}),e.jsx(oe,{children:"ระบบจะเชื่อมต่อกับ n8n Webhook อัตโนมัติจากการตั้งค่าของผู้ดูแลระบบ"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs(Q,{children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"ระบบรักษาความปลอดภัย:"}),e.jsx("br",{}),"• ข้อมูลจะถูกส่งผ่านระบบรักษาความปลอดภัยของ Supabase",e.jsx("br",{}),"• ข้อมูลส่วนตัวจะถูกกรองก่อนส่งต่อ",e.jsx("br",{}),'• กดปุ่ม "ทดสอบ" เพื่อทดสอบการเชื่อมต่อ']})]}),e.jsxs(k,{onClick:j,disabled:r,className:"w-full",children:[e.jsx(Ps,{className:"h-4 w-4 mr-2"}),r?"กำลังส่ง...":"ทดสอบระบบ"]})]})]}),e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5"}),"ข้อมูล LINE Bot"]}),e.jsx(oe,{children:"ข้อมูลสำหรับตั้งค่า LINE Bot สำหรับรับลงทะเบียนคนไข้"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{children:"ชื่อบอท"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ae,{value:c.name,readOnly:!0}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>p(c.name),children:e.jsx(ye,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx(K,{children:"LINE Bot ID"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ae,{value:c.id,readOnly:!0}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>p(c.id),children:e.jsx(ye,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{children:[e.jsx(K,{children:"Webhook URL"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ae,{value:c.webhook,readOnly:!0}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>p(c.webhook),children:e.jsx(ye,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(k,{onClick:()=>s(!t),children:[e.jsx(gn,{className:"h-4 w-4 mr-2"}),t?"ซ่อน QR Code":"แสดง QR Code"]}),e.jsxs(k,{variant:"outline",onClick:d,children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"สร้างโค้ด n8n"]})]}),t&&e.jsx("div",{className:"flex justify-center p-6 bg-muted rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-48 h-48 bg-white p-4 rounded-lg shadow-md mx-auto mb-4",children:e.jsx("div",{className:"w-full h-full bg-gray-200 rounded flex items-center justify-center",children:e.jsx(gn,{className:"h-20 w-20 text-gray-400"})})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"QR Code สำหรับเพิ่มเพื่อน LINE Bot"}),e.jsxs(k,{size:"sm",variant:"outline",className:"mt-2",children:[e.jsx(Ms,{className:"h-4 w-4 mr-2"}),"เปิดใน LINE"]})]})})]})]}),e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"h-5 w-5"}),"ขั้นตอนการลงทะเบียนสำหรับคนไข้"]}),e.jsx(oe,{children:"ลำดับขั้นตอนที่คนไข้ต้องทำผ่าน LINE"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-bold",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"เพิ่มเพื่อน LINE Bot"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["สแกน QR Code หรือค้นหา ID: ",c.id]})]})]}),e.jsx(Xe,{className:"h-5 w-5 text-muted-foreground ml-4"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-bold",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"ส่งชื่อ-นามสกุล"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"พิมพ์ชื่อ-นามสกุลเต็ม (ภาษาไทยหรืออังกฤษ)"}),e.jsx(H,{variant:"outline",className:"mt-1",children:"ตัวอย่าง: สมชาย ใจดี"})]})]}),e.jsx(Xe,{className:"h-5 w-5 text-muted-foreground ml-4"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-bold",children:"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"ส่งเบอร์โทรศัพท์"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"พิมพ์เบอร์โทรศัพท์ 10 หลัก"}),e.jsx(H,{variant:"outline",className:"mt-1",children:"ตัวอย่าง: 081-234-5678"})]})]}),e.jsx(Xe,{className:"h-5 w-5 text-muted-foreground ml-4"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center",children:e.jsx(G,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-600",children:"ลงทะเบียนสำเร็จ"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"เจ้าหน้าที่จะติดต่อกลับเพื่อนัดหมายภายใน 24 ชั่วโมง"})]})]})]})})]}),a&&e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"โค้ด n8n Webhook"}),e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>p(a),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"คัดลอก"]})]}),e.jsx(oe,{children:"โค้ดสำหรับใส่ใน Code Node ของ n8n เพื่อจัดการการลงทะเบียน"})]}),e.jsx(D,{children:e.jsx("pre",{className:"bg-muted p-4 rounded-lg text-sm overflow-x-auto",children:e.jsx("code",{children:a})})})]}),!1,e.jsxs(Q,{children:[e.jsx(ot,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"หมายเหตุ:"})," ระบบนี้เป็นส่วนสำหรับคนไข้ลงทะเบียนเบื้องต้นเท่านั้น เจ้าหน้าที่จะใช้ระบบ Staff Dashboard เพื่อจัดการการจองวัคซีนและการนัดหมาย"]})]})]})]})})},Cd=()=>{const[t,s]=h.useState("overview"),[a,n]=h.useState(!1),r=(i,o)=>{navigator.clipboard.writeText(i),alert(`คัดลอก ${o} แล้ว!`)};return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-4",children:"🏥 คู่มือการติดตั้งระบบลงทะเบียนวัคซีน"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"ระบบจัดการการลงทะเบียนวัคซีนผ่าน LINE Bot พร้อมระบบนัดหมายอัตโนมัติ สำหรับโรงพยาบาล คลินิก และสถานพยาบาล"})]}),e.jsxs(Ue,{value:t,onValueChange:s,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-6",children:[e.jsx(Z,{value:"overview",children:"ภาพรวม"}),e.jsx(Z,{value:"requirements",children:"ความต้องการ"}),e.jsx(Z,{value:"line-setup",children:"ตั้งค่า LINE"}),e.jsx(Z,{value:"n8n-setup",children:"ตั้งค่า n8n"}),e.jsx(Z,{value:"calendar",children:"Google Calendar"}),e.jsx(Z,{value:"usage",children:"การใช้งาน"})]}),e.jsx(ee,{value:"overview",className:"mt-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"ภาพรวมระบบ"]}),e.jsx(oe,{children:"ระบบลงทะเบียนวัคซีนแบบครบวงจร ประกอบด้วย 3 ส่วนหลัก"})]}),e.jsx(D,{children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Va,{className:"h-8 w-8 text-primary"}),e.jsx("h3",{className:"font-semibold",children:"LINE Bot"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"คนไข้ลงทะเบียนชื่อ-นามสกุลผ่าน LINE Bot พร้อม Rich Menu"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Oe,{className:"h-8 w-8 text-primary"}),e.jsx("h3",{className:"font-semibold",children:"Staff Dashboard"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"เจ้าหน้าที่เลือกวัคซีน สร้างนัดหมาย และส่งการแจ้งเตือน"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(be,{className:"h-8 w-8 text-primary"}),e.jsx("h3",{className:"font-semibold",children:"Auto Scheduling"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ระบบนัดหมายอัตโนมัติใน Google Calendar พร้อมแจ้งเตือน"})]})]})})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsx($,{children:"🔄 ขั้นตอนการทำงาน"})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(H,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center",children:"1"}),e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:"คนไข้ลงทะเบียนผ่าน LINE Bot"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(H,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center",children:"2"}),e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:"เจ้าหน้าที่เลือกวัคซีนและสร้างนัดหมาย"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(H,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center",children:"3"}),e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:"ระบบส่งการแจ้งเตือนไป LINE และสร้างนัดใน Google Calendar"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(H,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center",children:"4"}),e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:"แจ้งเตือนอัตโนมัติก่อนวันนัด"})]})]})})]})]})}),e.jsx(ee,{value:"requirements",className:"mt-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"ความต้องการของระบบ"]})}),e.jsx(D,{children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"บัญชีและเครื่องมือที่จำเป็น"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"LINE Developers Account"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"n8n Self-hosted หรือ Cloud"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Google Account"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Google Sheets"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Google Calendar"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Mt,{className:"h-4 w-4"}),"ข้อกำหนดทางเทคนิค"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Public URL สำหรับ Webhook"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"SSL Certificate (HTTPS)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Internet Connection"})]})]})]})]})})]}),e.jsxs(Q,{children:[e.jsx(js,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"หมายเหตุ:"})," หากใช้ n8n แบบ Self-hosted จำเป็นต้องมี Server ที่สามารถรัน Docker หรือ Node.js และมี Public URL สำหรับรับ Webhook จาก LINE"]})]})]})}),e.jsx(ee,{value:"line-setup",className:"mt-6",children:e.jsx("div",{className:"grid gap-6",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5"}),"การตั้งค่า LINE Bot"]}),e.jsx(oe,{children:"ขั้นตอนการสร้างและตั้งค่า LINE Bot สำหรับการลงทะเบียนวัคซีน"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"1. สร้าง LINE Bot"}),e.jsxs("div",{className:"pl-4 space-y-2",children:[e.jsxs("p",{className:"text-sm",children:["• ไปที่ ",e.jsx("a",{href:"https://developers.line.biz",target:"_blank",className:"text-primary underline",children:"LINE Developers Console"})]}),e.jsx("p",{className:"text-sm",children:"• สร้าง Provider ใหม่ (ถ้ายังไม่มี)"}),e.jsx("p",{className:"text-sm",children:'• สร้าง Channel ประเภท "Messaging API"'}),e.jsx("p",{className:"text-sm",children:'• ตั้งชื่อ Bot เช่น "ระบบลงทะเบียนวัคซีน"'})]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"2. ตั้งค่า Webhook"}),e.jsxs("div",{className:"pl-4 space-y-3",children:[e.jsx("p",{className:"text-sm",children:"• ในหน้า Channel Settings"}),e.jsx("p",{className:"text-sm",children:'• เปิดใช้งาน "Use webhook"'}),e.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Webhook URL:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-sm bg-background px-2 py-1 rounded border",children:"https://your-n8n-domain.com/webhook/line-vaccine"}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>r("https://your-n8n-domain.com/webhook/line-vaccine","Webhook URL"),children:e.jsx(ye,{className:"h-4 w-4"})})]})]})]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"3. ข้อมูลสำคัญที่ต้องเก็บ"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Channel Access Token:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-sm bg-background px-2 py-1 rounded border flex-1",children:a?"YOUR_CHANNEL_ACCESS_TOKEN_HERE":"••••••••••••••••••••"}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>n(!a),children:a?e.jsx(pr,{className:"h-4 w-4"}):e.jsx(xr,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Channel Secret:"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("code",{className:"text-sm bg-background px-2 py-1 rounded border flex-1",children:a?"YOUR_CHANNEL_SECRET_HERE":"••••••••••••••••••••"})})]})]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"4. สร้าง Rich Menu"}),e.jsxs("div",{className:"pl-4 space-y-2",children:[e.jsx("p",{className:"text-sm",children:"• ใช้ LINE Official Account Manager"}),e.jsx("p",{className:"text-sm",children:"• สร้างเมนูขนาด 2500x843 pixels"}),e.jsx("p",{className:"text-sm",children:"• แบ่งเป็น 3 พื้นที่:"}),e.jsxs("div",{className:"ml-4 space-y-1",children:[e.jsx("p",{className:"text-xs",children:"- ลงทะเบียนคนไข้"}),e.jsx("p",{className:"text-xs",children:"- จองวัคซีน"}),e.jsx("p",{className:"text-xs",children:"- ตรวจสอบการจอง"})]})]})]})]})]})})}),e.jsx(ee,{value:"n8n-setup",className:"mt-6",children:e.jsx("div",{className:"grid gap-6",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(jt,{className:"h-5 w-5"}),"การตั้งค่า n8n Workflow"]}),e.jsx(oe,{children:"ขั้นตอนการสร้างและกำหนดค่า n8n workflow สำหรับระบบ"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"1. ติดตั้ง n8n"}),e.jsxs("div",{className:"bg-muted p-4 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Docker (แนะนำ):"}),e.jsx("code",{className:"text-sm block bg-background p-2 rounded border",children:"docker run -it --rm --name n8n -p 5678:5678 -v ~/.n8n:/home/node/.n8n n8nio/n8n"})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-md mt-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"NPM:"}),e.jsxs("code",{className:"text-sm block bg-background p-2 rounded border",children:["npm install n8n -g",e.jsx("br",{}),"n8n start"]})]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"2. กำหนด Environment Variables"}),e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"bg-muted p-3 rounded-md",children:e.jsxs("code",{className:"text-sm block",children:["LINE_CHANNEL_ACCESS_TOKEN=your_line_access_token",e.jsx("br",{}),"LINE_CHANNEL_SECRET=your_line_channel_secret",e.jsx("br",{}),"GOOGLE_ACCESS_TOKEN=your_google_access_token",e.jsx("br",{}),"GOOGLE_SPREADSHEET_ID=your_spreadsheet_id",e.jsx("br",{}),"GOOGLE_CALENDAR_ID=your_calendar_id"]})})})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"3. สร้าง Workflow Nodes"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Webhook Trigger"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"รับข้อมูลจาก LINE Bot"}),e.jsxs("div",{className:"text-xs bg-background p-2 rounded border",children:["Method: POST",e.jsx("br",{}),"Path: /webhook/line-vaccine"]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Code Node - Vaccine Mapping"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"ใช้โค้ดที่คุณให้มา"}),e.jsxs(k,{size:"sm",variant:"outline",className:"w-full",children:[e.jsx(js,{className:"h-4 w-4 mr-2"}),"ดาวน์โหลดโค้ด Vaccine Mapping"]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Google Sheets"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"บันทึกข้อมูลคนไข้และนัดหมาย"}),e.jsxs("div",{className:"text-xs bg-background p-2 rounded border",children:["Operation: Append",e.jsx("br",{}),"Sheet: Patients, Appointments"]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"LINE Message Reply"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"ส่งข้อความตอบกลับ"}),e.jsxs("div",{className:"text-xs bg-background p-2 rounded border",children:["Type: Reply Message",e.jsx("br",{}),"Format: Text, Flex Message"]})]})]})]})]})]})})}),e.jsx(ee,{value:"calendar",className:"mt-6",children:e.jsx("div",{className:"grid gap-6",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"การตั้งค่า Google Calendar"]}),e.jsx(oe,{children:"เชื่อมต่อระบบกับ Google Calendar สำหรับการนัดหมายอัตโนมัติ"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"1. สร้าง Google Cloud Project"}),e.jsxs("div",{className:"pl-4 space-y-2",children:[e.jsxs("p",{className:"text-sm",children:["• ไปที่ ",e.jsx("a",{href:"https://console.cloud.google.com",target:"_blank",className:"text-primary underline",children:"Google Cloud Console"})]}),e.jsx("p",{className:"text-sm",children:"• สร้าง Project ใหม่"}),e.jsx("p",{className:"text-sm",children:"• เปิดใช้งาน Google Calendar API"}),e.jsx("p",{className:"text-sm",children:"• สร้าง Service Account"})]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"2. สร้าง Calendar สำหรับวัคซีน"}),e.jsxs("div",{className:"pl-4 space-y-2",children:[e.jsx("p",{className:"text-sm",children:"• เข้า Google Calendar"}),e.jsx("p",{className:"text-sm",children:'• สร้าง Calendar ใหม่ชื่อ "วัคซีนคลินิก"'}),e.jsx("p",{className:"text-sm",children:"• แชร์ Calendar ให้ Service Account"}),e.jsx("p",{className:"text-sm",children:"• คัดลอก Calendar ID"})]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"3. ตั้งค่าการแจ้งเตือน"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"การแจ้งเตือนอัตโนมัติ:"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("p",{children:"• 1 วันก่อนนัด - ส่งข้อความไป LINE"}),e.jsx("p",{children:"• 1 ชั่วโมงก่อนนัด - แจ้งเตือนใน Calendar"}),e.jsx("p",{children:"• 30 นาทีก่อนนัด - Email reminder"})]})]})})]})]})]})})}),e.jsx(ee,{value:"usage",className:"mt-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),"วิธีการใช้งานระบบ"]}),e.jsx(oe,{children:"คู่มือการใช้งานสำหรับเจ้าหน้าที่และคนไข้"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"สำหรับคนไข้ (ผ่าน LINE Bot)"}),e.jsxs("div",{className:"pl-4 space-y-2",children:[e.jsx("p",{className:"text-sm",children:"1. เพิ่มเพื่อน LINE Bot ของคลินิก"}),e.jsx("p",{className:"text-sm",children:'2. กดเมนู "ลงทะเบียนคนไข้"'}),e.jsx("p",{className:"text-sm",children:"3. กรอกข้อมูล ชื่อ-นามสกุล และเบอร์โทร"}),e.jsx("p",{className:"text-sm",children:"4. รอเจ้าหน้าที่ติดต่อกลับเพื่อนัดหมาย"}),e.jsx("p",{className:"text-sm",children:"5. ได้รับการแจ้งเตือนการนัดผ่าน LINE"})]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"สำหรับเจ้าหน้าที่"}),e.jsxs("div",{className:"pl-4 space-y-2",children:[e.jsx("p",{className:"text-sm",children:"1. เข้าใช้งาน Staff Dashboard"}),e.jsx("p",{className:"text-sm",children:"2. ดูรายชื่อคนไข้ที่ลงทะเบียน"}),e.jsx("p",{className:"text-sm",children:'3. เลือกคนไข้และกดปุ่ม "จองวัคซีน"'}),e.jsx("p",{className:"text-sm",children:"4. เลือกประเภทวัคซีนและวันเวลานัด"}),e.jsx("p",{className:"text-sm",children:"5. ระบบจะส่งการแจ้งเตือนอัตโนมัติ"})]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"การจัดการวัคซีนหลายโดส"}),e.jsxs("div",{className:"bg-muted p-4 rounded-md",children:[e.jsx("p",{className:"text-sm mb-2",children:"ระบบรองรับวัคซีนที่ต้องฉีดหลายโดส:"}),e.jsxs("div",{className:"text-sm space-y-1 ml-4",children:[e.jsx("p",{children:"• วัคซีนไวรัสตับอักเสบบี: 3 โดส"}),e.jsx("p",{children:"• วัคซีนป้องกันมะเร็งปากมดลูก: 3 โดส"}),e.jsx("p",{children:"• วัคซีนพิษสุนัขบ้า: 5 เข็ม"}),e.jsx("p",{children:"• ระบบจะคำนวณวันนัดครั้งถัดไปอัตโนมัติ"})]})]})]})]})]}),e.jsxs(Q,{children:[e.jsx($e,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"เคล็ดลับ:"})," ใช้ฟีเจอร์ค้นหาใน Staff Dashboard เพื่อหาคนไข้ได้เร็วขึ้น สามารถค้นหาด้วยชื่อหรือเบอร์โทรศัพท์"]})]})]})})]})]})})},kd=()=>{const t=[{issue:"Package.json ไม่สามารถเปิดใน n8n Render ได้",category:"deployment",severity:"high",symptoms:["Build failed บน Render","n8n ไม่ start","Error: Cannot find module 'n8n'","Version compatibility issues"],solutions:[{step:"ตรวจสอบ Node.js Version",details:"ใช้ Node.js 18.10.0 ขึ้นไป (แนะนำ 20.x)",code:`"engines": {
  "node": ">=18.10.0",
  "npm": ">=9.0.0"
}`},{step:"แก้ไข n8n Version",details:"ใช้ version เฉพาะที่ stable (แนะนำ 1.100.1)",code:`"dependencies": {
  "n8n": "1.100.1"
}`},{step:"เพิ่ม Build Script ที่ถูกต้อง",details:"Render ต้องการ build script ที่ทำงานได้",code:`"scripts": {
  "start": "n8n start",
  "build": "echo 'Build completed'",
  "postinstall": "echo 'Dependencies installed'"
}`}]},{issue:"n8n ไม่สามารถเชื่อมต่อ Database ได้",category:"database",severity:"high",symptoms:["Database connection error","PostgreSQL connection failed","Authentication failed for user"],solutions:[{step:"ตรวจสอบ Environment Variables",details:"ให้แน่ใจว่าตั้งค่า DB variables ถูกต้อง",code:`DB_TYPE=postgresdb
DB_POSTGRESDB_HOST=your-postgres-host
DB_POSTGRESDB_PORT=5432
DB_POSTGRESDB_DATABASE=n8n_db
DB_POSTGRESDB_USER=n8n_user
DB_POSTGRESDB_PASSWORD=your-password`},{step:"ใช้ Connection String Format",details:"บางครั้งใช้ connection string ง่ายกว่า",code:"DATABASE_URL=postgresql://user:password@host:5432/database"}]},{issue:"Webhook ไม่ทำงาน",category:"network",severity:"medium",symptoms:["LINE Bot ไม่ตอบกลับ","Webhook timeout","404 Not Found"],solutions:[{step:"ตรวจสอบ WEBHOOK_URL",details:"ใช้ URL ที่ Render สร้างให้",code:"WEBHOOK_URL=https://your-app-name.onrender.com"},{step:"เปิด n8n Webhook",details:"ตั้งค่า webhook endpoint ใน n8n",code:"https://your-app-name.onrender.com/webhook/line-bot"}]},{issue:"Environment Variables ไม่ถูกอ่าน",category:"config",severity:"medium",symptoms:["API keys ไม่ทำงาน","undefined environment variables","Authentication errors"],solutions:[{step:"ตั้งค่าใน Render Dashboard",details:"ไม่ใส่ใน code แต่ตั้งใน Environment section",code:"Settings → Environment → Add Environment Variable"},{step:"Redeploy หลังเปลี่ยน ENV",details:"Render ต้อง redeploy เมื่อเปลี่ยน environment variables",code:"Manual Deploy → Deploy Latest Commit"}]}],s=n=>{switch(n){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},a=n=>{switch(n){case"deployment":return e.jsx(fr,{className:"h-5 w-5"});case"database":return e.jsx(jt,{className:"h-5 w-5"});case"network":return e.jsx(Ee,{className:"h-5 w-5"});case"config":return e.jsx(Pe,{className:"h-5 w-5"});default:return e.jsx(Be,{className:"h-5 w-5"})}};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"🔧 คู่มือแก้ไขปัญหา N8N บน Render"}),e.jsx("p",{className:"text-muted-foreground",children:"แนวทางแก้ไขปัญหาที่พบบ่อยในการ deploy N8N Vaccine Workflow"})]}),e.jsxs(Q,{children:[e.jsx(je,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"วิธีการดีบัก:"})," ตรวจสอบ Render Logs ได้ที่ Dashboard → Service → Logs เพื่อดูข้อผิดพลาดแบบละเอียด"]})]}),e.jsx("div",{className:"space-y-6",children:t.map((n,r)=>e.jsxs(S,{className:"border-l-4 border-l-blue-500",children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a(n.category),e.jsx($,{className:"text-lg",children:n.issue})]}),e.jsx(H,{className:s(n.severity),children:n.severity.toUpperCase()})]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-red-600 mb-2 flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"อาการที่พบ:"]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground ml-6",children:n.symptoms.map((i,o)=>e.jsx("li",{children:i},o))})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-green-600 mb-3 flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"วิธีแก้ไข:"]}),e.jsx("div",{className:"space-y-4",children:n.solutions.map((i,o)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-muted/50",children:[e.jsxs("h5",{className:"font-medium mb-2",children:[o+1,". ",i.step]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:i.details}),i.code&&e.jsx("pre",{className:"bg-background p-3 rounded border text-xs overflow-x-auto",children:e.jsx("code",{children:i.code})})]},o))})]})]})]},r))}),e.jsxs(S,{className:"bg-blue-50 border-blue-200",children:[e.jsx(L,{children:e.jsxs($,{className:"text-blue-700 flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5"}),"เทคนิคการดีบัก"]})}),e.jsx(D,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"1. ตรวจสอบ Render Logs"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dashboard → Service → Logs → ดู error messages แบบ real-time"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"2. ทดสอบ Environment Variables"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"เพิ่ม console.log ใน n8n workflow เพื่อดูค่าของ env variables"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"3. ใช้ n8n Editor"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"เข้า https://your-app.onrender.com เพื่อเปิด n8n editor"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"4. ทดสอบ Webhook"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ใช้ Postman หรือ curl ทดสอบ webhook endpoint"})]})]})})]}),e.jsxs(S,{className:"bg-green-50 border-green-200",children:[e.jsx(L,{children:e.jsx($,{className:"text-green-700",children:"✅ Checklist การ Deploy"})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Files ที่จำเป็น:"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),"Dockerfile"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),"package.json (ที่แก้ไขแล้ว)"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),"render.yaml (optional)"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Environment Variables:"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),"Database connection"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),"LINE Bot credentials"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),"Google API keys"]})]})]})]})})]})]})},mi=()=>{const[t,s]=h.useState(""),[a,n]=h.useState(""),[r,i]=h.useState(""),[o,c]=h.useState(""),[d,p]=h.useState(!1),[u,j]=h.useState("disconnected"),{toast:l}=ce(),m=async()=>{if(!t){l({title:"ข้อผิดพลาด",description:"กรุณากรอก Webhook URL",variant:"destructive"});return}p(!0);try{const v=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"test",message:"Connection test from web app",timestamp:new Date().toISOString()})});j("connected"),l({title:"เชื่อมต่อสำเร็จ",description:"เชื่อมต่อกับ n8n workflow สำเร็จ"})}catch{j("error"),l({title:"เชื่อมต่อไม่สำเร็จ",description:"ไม่สามารถเชื่อมต่อกับ n8n workflow ได้",variant:"destructive"})}finally{p(!1)}},x=async()=>{if(!(!t||!o)){p(!0);try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"message",data:{message:o,source:"web_app_test"}})}),l({title:"ส่งข้อความสำเร็จ",description:"ส่งข้อความทดสอบไปยัง n8n แล้ว"}),c("")}catch{l({title:"ส่งข้อความไม่สำเร็จ",description:"เกิดข้อผิดพลาดในการส่งข้อความ",variant:"destructive"})}finally{p(!1)}}},g=()=>{const v=`${t}/line-webhook`;navigator.clipboard.writeText(v),l({title:"คัดลอกสำเร็จ",description:"คัดลอก LINE Webhook URL แล้ว"})};return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"LINE Bot Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"จัดการและเชื่อมต่อ LINE Bot กับ n8n workflow"})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(hr,{className:"h-5 w-5"}),"เชื่อมต่อ n8n Workflow"]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"webhook-url",children:"n8n Webhook URL"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(ae,{id:"webhook-url",placeholder:"https://your-n8n.render.com/webhook/...",value:t,onChange:v=>s(v.target.value)}),e.jsx(k,{onClick:m,disabled:d,variant:u==="connected"?"secondary":"default",children:u==="connected"?"เชื่อมต่อแล้ว":"ทดสอบ"})]})]}),u==="connected"&&e.jsxs(Q,{children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsxs(X,{children:["เชื่อมต่อกับ n8n workflow สำเร็จ! สำหรับ LINE Bot ให้ใช้ URL:",e.jsxs("code",{className:"mx-1 p-1 bg-muted rounded",children:[t,"/line-webhook"]}),e.jsx(k,{variant:"ghost",size:"sm",className:"ml-2",onClick:g,children:e.jsx(ye,{className:"h-3 w-3"})})]})]})]})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"การตั้งค่า LINE Bot"]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"channel-access-token",children:"Channel Access Token"}),e.jsx(ae,{id:"channel-access-token",type:"password",placeholder:"Channel Access Token จาก LINE Developers",value:a,onChange:v=>n(v.target.value)})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"channel-secret",children:"Channel Secret"}),e.jsx(ae,{id:"channel-secret",type:"password",placeholder:"Channel Secret จาก LINE Developers",value:r,onChange:v=>i(v.target.value)})]}),e.jsx(Q,{children:e.jsxs(X,{children:[e.jsx("strong",{children:"วิธีการตั้งค่า LINE Bot:"}),e.jsx("br",{}),"1. ไปที่ LINE Developers Console",e.jsx("br",{}),"2. คัดลอก Webhook URL ไปใส่ใน Messaging API",e.jsx("br",{}),"3. กรอก Channel Access Token และ Channel Secret ที่นี่",e.jsx("br",{}),"4. เปิดใช้งาน Webhook ใน LINE Developers"]})})]})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5"}),"ทดสอบส่งข้อความ"]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"test-message",children:"ข้อความทดสอบ"}),e.jsx(zt,{id:"test-message",placeholder:"พิมพ์ข้อความที่ต้องการทดสอบ...",value:o,onChange:v=>c(v.target.value)})]}),e.jsxs(k,{onClick:x,disabled:!t||!o||d,className:"w-full",children:[e.jsx(Ps,{className:"h-4 w-4 mr-2"}),d?"กำลังส่ง...":"ส่งข้อความทดสอบ"]})]})]})]})})},Ed="https://fljyjbrgfzervxofrilo.supabase.co",Ad="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZsanlqYnJnZnplcnZ4b2ZyaWxvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMDE1MDUsImV4cCI6MjA2OTY3NzUwNX0.2_rGfy-3UA4cPnRsg8Lm8uvj9KBCOoz5IhwCbSWYIq4",O=ll(Ed,Ad,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),Td=()=>{const[t,s]=h.useState([]),[a,n]=h.useState([]),[r,i]=h.useState(!1),[o,c]=h.useState(""),{toast:d}=ce();h.useEffect(()=>{(async()=>{try{if(window.liff&&window.liff.isLoggedIn()){const v=await window.liff.getProfile();c(v.userId),p(v.userId),u(v.userId)}else console.log("LINE LIFF not available or not logged in")}catch(v){console.log("Error getting LINE profile:",v)}})()},[]);const p=async g=>{if(g){i(!0);try{console.log("🔍 เริ่มโหลดข้อมูลการติดตามผู้ป่วย...");const{data:v,error:f}=await O.from("appointments").select("*").eq("line_user_id",g).order("appointment_date",{ascending:!1});if(f)throw f;console.log("📊 ข้อมูลนัดทั้งหมด:",(v==null?void 0:v.length)||0,"รายการ");const N=(v==null?void 0:v.filter(b=>b.status==="completed"))||[],_=(v==null?void 0:v.filter(b=>["scheduled","pending"].includes(b.status)))||[];console.log("✅ การฉีดที่เสร็จสิ้น:",N.length,"รายการ"),console.log("📅 นัดที่มีอยู่แล้ว:",_.length,"รายการ");const{data:A}=await O.from("vaccine_schedules").select("*").eq("active",!0);console.log("💉 โหลดข้อมูลวัคซีน:",(A==null?void 0:A.length)||0,"ประเภท");const E=[];for(const b of _)if(new Date(b.appointment_date)>new Date){const w=N.filter(I=>I.vaccine_type.toLowerCase()===b.vaccine_type.toLowerCase()),M=A==null?void 0:A.find(I=>I.vaccine_type.toLowerCase()===b.vaccine_type.toLowerCase());M&&(E.push({id:`scheduled-${b.id}`,patient_id:g,patient_name:b.patient_name||"ผู้ใช้",vaccine_name:b.vaccine_name||M.vaccine_name,vaccine_type:b.vaccine_type,current_dose:w.length,total_doses:M.total_doses,next_dose_due:b.appointment_date,last_dose_date:w.length>0?w.reduce((I,F)=>new Date(F.appointment_date)>new Date(I.appointment_date)?F:I).appointment_date:"",completion_status:"scheduled"}),console.log(`📅 นัดที่มีอยู่: ${b.vaccine_type} วันที่ ${b.appointment_date}`))}const V=new Map;for(const b of N||[]){const w=b.vaccine_type;if(!V.has(w)){const M=N.filter(F=>F.vaccine_type.toLowerCase()===b.vaccine_type.toLowerCase());console.log(`💉 วัคซีน: ${b.vaccine_type}, โดสที่ฉีดแล้ว: ${M.length}`);const I=M.reduce((F,z)=>new Date(z.appointment_date)>new Date(F.appointment_date)?z:F);console.log(`📅 เข็มล่าสุด: ${I.appointment_date}`),V.set(w,{vaccine_type:b.vaccine_type,doses_received:M.length,latest_date:I.appointment_date,patient_name:b.patient_name})}}const Y=Array.from(V.values()).map(async b=>{var w;try{const M=A==null?void 0:A.find(J=>J.vaccine_type.toLowerCase()===b.vaccine_type.toLowerCase());if(!M)return console.log(`❌ ไม่พบข้อมูลวัคซีน: ${b.vaccine_type}`),null;if(b.doses_received>=M.total_doses)return console.log(`✅ ได้รับวัคซีน ${b.vaccine_type} ครบแล้ว`),null;const I=_.find(J=>J.vaccine_type.toLowerCase()===b.vaccine_type.toLowerCase()&&new Date(J.appointment_date)>new Date);if(I)return console.log(`📅 มีนัด ${b.vaccine_type} แล้วในวันที่ ${I.appointment_date} - ข้าม`),null;const F=Array.isArray(M.dose_intervals)?M.dose_intervals:JSON.parse(((w=M.dose_intervals)==null?void 0:w.toString())||"[]");let z=new Date(b.latest_date);const C=b.doses_received,y=typeof F[C]=="number"?F[C]:typeof F[b.doses_received-1]=="number"?F[b.doses_received-1]:30;z.setDate(z.getDate()+y);const R=b.doses_received+1;return console.log(`🎯 วัคซีน ${b.vaccine_type}: ต้องการโดสใหม่ ${R}/${M.total_doses}, คำนวณนัด: ${z.toISOString().split("T")[0]}, ช่วงห่าง: ${y} วัน`),{id:`new-${g}-${b.vaccine_type}`,patient_id:g,patient_name:b.patient_name||"ผู้ใช้",vaccine_name:M.vaccine_name,vaccine_type:b.vaccine_type,current_dose:b.doses_received,total_doses:M.total_doses,next_dose_due:z.toISOString().split("T")[0],last_dose_date:b.latest_date,completion_status:"needs_appointment"}}catch(M){return console.error("Error processing vaccine:",b.vaccine_type,M),null}}),T=(await Promise.all(Y)).filter(b=>b!==null),W=[...E,...T].sort((b,w)=>new Date(b.next_dose_due).getTime()-new Date(w.next_dose_due).getTime());console.log("✅ ข้อมูลการติดตามที่คำนวณได้:",W.length,"รายการ"),console.log("📅 นัดที่มีอยู่แล้ว:",E.length,"รายการ"),console.log("🆕 นัดใหม่ที่ต้องสร้าง:",T.length,"รายการ"),W.forEach(b=>{const w=b.completion_status==="scheduled"?"(มีนัดแล้ว)":"(ต้องสร้างนัด)";console.log(`- วัคซีน: ${b.vaccine_name}, โดส ${b.current_dose+1}/${b.total_doses}, นัด: ${b.next_dose_due}, เข็มล่าสุด: ${b.last_dose_date||"ยังไม่มี"} ${w}`)}),s(W)}catch(v){console.error("Error loading next appointments:",v),d({title:"ไม่สามารถโหลดข้อมูลได้",description:"กรุณาลองใหม่อีกครั้ง",variant:"destructive"})}finally{i(!1)}}},u=async g=>{if(g)try{const{data:v,error:f}=await O.rpc("api_next_appointments",{_line_user_id:g,_limit:5});if(f)throw f;v&&n(v)}catch(v){console.error("Error loading upcoming appointments:",v)}},j=()=>{o&&(p(o),u(o))},l=g=>new Date(g).toLocaleDateString("th-TH",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),m=g=>{switch(g){case"scheduled":return"bg-blue-500";case"completed":return"bg-green-500";case"cancelled":return"bg-red-500";default:return"bg-gray-500"}},x=g=>{const v=new Date,N=new Date(g).getTime()-v.getTime();return Math.ceil(N/(1e3*60*60*24))};return o?e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"นัดหมายของฉัน"}),e.jsx("p",{className:"text-muted-foreground",children:"ตรวจสอบนัดหมายและวัคซีนครั้งถัดไป"})]}),e.jsxs(k,{onClick:j,disabled:r,variant:"outline",children:[e.jsx(Se,{className:`h-4 w-4 mr-2 ${r?"animate-spin":""}`}),"รีเฟรช"]})]}),a.length>0&&e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"นัดหมายที่จะมาถึง"]})}),e.jsx(D,{className:"space-y-4",children:a.map((g,v)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold",children:g.vaccine_name}),e.jsx(H,{className:m(g.status),children:g.status==="scheduled"?"นัดแล้ว":g.status})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"h-4 w-4"}),l(g.appointment_date)]}),g.appointment_time&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"h-4 w-4"}),g.appointment_time]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qo,{className:"h-4 w-4"}),g.location]})]})]},v))})]}),t.length>0?e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"วัคซีนครั้งถัดไปที่ต้องฉีด"]})}),e.jsx(D,{className:"space-y-4",children:t.map(g=>{const v=x(g.next_dose_due),f=v<0,N=v<=7&&v>=0;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:g.vaccine_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["เข็มที่ ",g.current_dose+1," จาก ",g.total_doses," เข็ม"]})]}),e.jsx(H,{variant:f?"destructive":N?"secondary":"outline",className:f?"bg-red-100 text-red-800":N?"bg-yellow-100 text-yellow-800":"",children:f?`เลยกำหนด ${Math.abs(v)} วัน`:N?`อีก ${v} วัน`:`อีก ${v} วัน`})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"วันที่ควรฉีด:"}),e.jsx("p",{className:"font-medium",children:l(g.next_dose_due)})]}),g.last_dose_date&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"เข็มล่าสุด:"}),e.jsx("p",{className:"font-medium",children:l(g.last_dose_date)})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-muted rounded-lg",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:g.completion_status==="scheduled"?"✅ มีนัดหมายแล้ว - กรุณามาตามเวลาที่นัด":"💡 กรุณาติดต่อโรงพยาบาลโฮม เพื่อนัดหมายฉีดวัคซีนเข็มถัดไป"})})]},g.id)})})]}):e.jsx(S,{children:e.jsxs(D,{className:"text-center py-8",children:[e.jsx(G,{className:"h-12 w-12 mx-auto text-green-500 mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"ไม่มีวัคซีนที่ต้องฉีดครั้งถัดไป"}),e.jsx("p",{className:"text-muted-foreground",children:"วัคซีนทั้งหมดของคุณครบตามกำหนดแล้ว หรือยังไม่มีการลงทะเบียนฉีดวัคซีน"})]})}),e.jsx(S,{children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"โรงพยาบาลโฮม"}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsx("p",{children:"📞 โทร: 02-xxx-xxxx"}),e.jsx("p",{children:"📍 ที่อยู่: [ใส่ที่อยู่โรงพยาบาล]"}),e.jsx("p",{children:"🕐 เวลาทำการ: จันทร์-ศุกร์ 08:00-17:00"})]})]})})})]}):e.jsx("div",{className:"max-w-2xl mx-auto p-6",children:e.jsx(Q,{children:e.jsx(X,{children:"กรุณาเข้าสู่ระบบผ่าน LINE เพื่อดูข้อมูลนัดหมายของคุณ"})})})},ui=()=>{const[t,s]=h.useState({fullName:"",phone:""}),[a,n]=h.useState(!1),[r,i]=h.useState(!1),[o,c]=h.useState(0),{toast:d}=ce(),p=(l,m)=>{s(x=>({...x,[l]:m}))},u=async()=>{if(!t.fullName||!t.phone){d({title:"ข้อผิดพลาด",description:"กรุณากรอกข้อมูลให้ครบถ้วน",variant:"destructive"});return}if(!/^[0-9]{9,10}$/.test(t.phone.replace(/[-\s]/g,""))){d({title:"ข้อผิดพลาด",description:"กรุณากรอกหมายเลขโทรศัพท์ให้ถูกต้อง",variant:"destructive"});return}n(!0);try{const m=`HOM-${Date.now()}`;let x=null;try{window.liff&&window.liff.isLoggedIn()&&(x=(await window.liff.getProfile()).userId,s(N=>({...N,lineUserId:x})))}catch(f){console.log("LINE profile not available:",f)}const{error:g}=await O.from("patient_registrations").insert({full_name:t.fullName,phone:t.phone,line_user_id:x||`temp_${Date.now()}`,hospital:"โรงพยาบาลโฮม",registration_id:m,source:x?"line_liff":"web_portal",status:"pending"});if(g)throw g;if(i(!0),d({title:"ลงทะเบียนสำเร็จ",description:"ลงทะเบียนรับบริการสำเร็จแล้ว"}),x)try{await O.functions.invoke("send-line-message",{body:{userId:x,message:`✅ ลงทะเบียนรับบริการสำเร็จ

📋 รายละเอียด:
• ชื่อ: ${t.fullName}
• เบอร์โทร: ${t.phone}
• รหัสลงทะเบียน: ${m}

🏥 โรงพยาบาลโฮม
เจ้าหน้าที่จะติดต่อกลับเพื่อยืนยันนัดหมาย`}})}catch(f){console.error("Error sending LINE message:",f)}const v=window.setTimeout(()=>{window.liff&&window.liff.isInClient()&&window.liff.closeWindow()},1e4);c(v)}catch(m){console.error("Registration error:",m),d({title:"ลงทะเบียนไม่สำเร็จ",description:"เกิดข้อผิดพลาดในการลงทะเบียน กรุณาลองใหม่อีกครั้ง",variant:"destructive"})}finally{n(!1)}},j=()=>{o&&(window.clearTimeout(o),c(0)),s({fullName:"",phone:""}),i(!1)};return r?e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx(S,{className:"border-green-200 bg-green-50",children:e.jsxs(D,{className:"p-8 text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:"./images/hospital-logo.png",alt:"โรงพยาบาลโฮม",className:"mx-auto h-16 w-auto object-contain mb-4"})}),e.jsx(G,{className:"h-16 w-16 text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-2",children:"ลงทะเบียนสำเร็จ!"}),e.jsxs("p",{className:"text-green-700 mb-6",children:["ขอบคุณที่ลงทะเบียน เจ้าหน้าที่จะติดต่อกลับเพื่อยืนยันนัดหมายและแจ้งข้อมูลบริการ",t.lineUserId&&e.jsx("span",{className:"block mt-2 text-sm",children:"📱 ข้อความยืนยันได้ส่งไปที่ LINE แล้ว"}),window.liff&&window.liff.isInClient()&&e.jsx("span",{className:"block mt-2 text-sm",children:"⏰ หน้าต่างจะปิดอัตโนมัติใน 10 วินาที"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border mb-6 text-left",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"ข้อมูลที่ลงทะเบียน:"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ชื่อ:"})," ",t.fullName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"เบอร์โทร:"})," ",t.phone]}),e.jsxs("p",{children:[e.jsx("strong",{children:"สถานที่:"})," โรงพยาบาลโฮม"]}),t.lineUserId&&e.jsxs("p",{children:[e.jsx("strong",{children:"LINE ID:"})," ",t.lineUserId]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{onClick:j,variant:"outline",className:"w-full",children:"ลงทะเบียนใหม่"}),window.liff&&window.liff.isInClient()&&e.jsx(k,{onClick:()=>window.liff.closeWindow(),className:"w-full",children:"ปิดหน้าต่าง"})]})]})})})}):e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:"./images/hospital-logo.png",alt:"โรงพยาบาลโฮม",className:"mx-auto h-24 w-auto object-contain"})}),e.jsx("h1",{className:"text-3xl font-bold",children:"โรงพยาบาลโฮม"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"บริการวัคซีนและการนัดหมาย"})]}),e.jsxs(Ue,{defaultValue:"appointments",className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-2",children:[e.jsxs(Z,{value:"appointments",className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"นัดหมายของฉัน"]}),e.jsxs(Z,{value:"register",className:"flex items-center gap-2",children:[e.jsx(yt,{className:"h-4 w-4"}),"ลงทะเบียน"]})]}),e.jsx(ee,{value:"appointments",className:"mt-6",children:e.jsx(Td,{})}),e.jsx(ee,{value:"register",className:"mt-6",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ลงทะเบียนรับบริการ"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-sm",children:"กรุณากรอกข้อมูลเพื่อลงทะเบียนรับบริการ"})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"h-5 w-5"}),"ข้อมูลผู้ลงทะเบียน"]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"fullName",children:"ชื่อ-นามสกุล"}),e.jsx(ae,{id:"fullName",placeholder:"นาย/นาง/นางสาว ชื่อ นามสกุล",value:t.fullName,onChange:l=>{console.log("Name input changed:",l.target.value),p("fullName",l.target.value)},onFocus:()=>console.log("Name input focused"),onBlur:()=>console.log("Name input blurred"),className:"mt-1",autoComplete:"name"})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"phone",children:"หมายเลขโทรศัพท์"}),e.jsx(ae,{id:"phone",placeholder:"08x-xxx-xxxx",value:t.phone,onChange:l=>p("phone",l.target.value),className:"mt-1"})]})]})]}),e.jsx(k,{onClick:u,disabled:a,className:"w-full",size:"lg",children:a?"กำลังลงทะเบียน...":"ลงทะเบียนรับบริการ"}),e.jsx(Q,{children:e.jsx(X,{children:"หลังจากลงทะเบียน เจ้าหน้าที่จะติดต่อกลับเพื่อยืนยันนัดหมาย และแจ้งข้อมูลบริการที่ต้องการ"})})]})})]})]})})};function _s(t){const s=[],a=[];if(!t||typeof t!="string")return s.push("Domain is required and must be a string"),{isValid:!1,errors:s,warnings:a};const n=t.replace(/^https?:\/\//,"").toLowerCase().trim();/^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?$/i.test(n)||s.push("Invalid domain format. Domain must contain only letters, numbers, hyphens, and dots"),n.length>253&&s.push("Domain name is too long (maximum 253 characters)");const i=n.split(".");for(const c of i)c.length===0?s.push("Domain cannot contain empty labels (consecutive dots)"):c.length>63?s.push(`Domain label "${c}" is too long (maximum 63 characters)`):(c.startsWith("-")||c.endsWith("-"))&&s.push(`Domain label "${c}" cannot start or end with a hyphen`);return i.length<2?s.push("Domain must have at least one dot (e.g., example.com)"):i[i.length-1].length<2&&s.push("Top-level domain must be at least 2 characters long"),["localhost","example.com","test.com","invalid"].some(c=>n.includes(c))&&a.push("This appears to be a reserved or example domain"),n.startsWith("www.")&&a.push("Consider configuring both www and non-www variants for better accessibility"),{isValid:s.length===0,errors:s,warnings:a.length>0?a:void 0}}function Id(t,s=!0){const a=t.replace(/^https?:\/\//,"").toLowerCase().trim(),n=a.split(".").length>2||a.startsWith("www.");return n&&!s?{recommendedType:"CNAME",supportsANAME:!1,reason:"Subdomains should use CNAME records pointing to the target service"}:s||!n&&!a.startsWith("www.")?{recommendedType:"ANAME",supportsANAME:!0,reason:"Apex domains should use ANAME/ALIAS records when supported, or A records as fallback"}:{recommendedType:"CNAME",supportsANAME:!1,reason:"Subdomains typically use CNAME records for flexibility"}}const Pd=At.object({type:At.enum(["A","AAAA","CNAME","ANAME","ALIAS","TXT","MX"]),name:At.string().min(1),value:At.string().min(1),ttl:At.number().optional()}),Md=At.string().regex(new RegExp("^(?!-)(?!.*--)[a-zA-Z0-9-]{1,63}(?<!-)(?:\\.[a-zA-Z0-9-]{1,63}(?<!-))*$"),"Invalid domain format");class Rd{constructor(){Me(this,"maxRetries",3);Me(this,"baseDelay",1e3);Me(this,"maxDelay",3e4)}parseDNSRecord(s){return Pd.parse(s)}validateDomain(s){try{return Md.parse(s),!0}catch{return!1}}async checkDNSPropagation(s,a,n){if(!this.validateDomain(s))throw new Error(`Invalid domain format: ${s}`);const i=(await this.performDNSLookupWithRetry(s,a)).records.map(c=>c.value),o=i.includes(n);return{domain:s,recordType:a,expectedValue:n,actualValues:i,propagated:o,checkedAt:new Date}}async performDNSLookupWithRetry(s,a,n=1){try{return await this.performDNSLookup(s,a)}catch(r){if(n>=this.maxRetries)return{success:!1,records:[],error:r instanceof Error?r.message:"DNS lookup failed",propagated:!1};const i=Math.min(this.baseDelay*Math.pow(2,n-1),this.maxDelay);return await this.sleep(i),this.performDNSLookupWithRetry(s,a,n+1)}}async performDNSLookup(s,a){try{const n=`https://cloudflare-dns.com/dns-query?name=${s}&type=${a}`,r=await fetch(n,{headers:{Accept:"application/dns-json"}});if(!r.ok)throw new Error(`DNS query failed: ${r.statusText}`);const o=((await r.json()).Answer||[]).map(c=>({type:a,name:s,value:c.data,ttl:c.TTL}));return{success:!0,records:o,propagated:o.length>0}}catch(n){throw new Error(`DNS lookup failed: ${n instanceof Error?n.message:"Unknown error"}`)}}async verifySSLCertificate(s){if(!this.validateDomain(s))return{valid:!1,error:`Invalid domain format: ${s}`};try{const a=`https://${s}`,n=await fetch(a,{method:"HEAD",mode:"no-cors"});return{valid:!0}}catch(a){return{valid:!1,error:a instanceof Error?a.message:"SSL verification failed"}}}async validateRenderDNSConfiguration(s){const a=["line-intent-router-bot.onrender.com","216.24.57.1"],n=[];let r=null;try{r=await Promise.race([this.checkDNSPropagation(s,"ANAME",a[0]),new Promise((c,d)=>setTimeout(()=>d(new Error("Timeout")),1e3))])}catch{}let i=null;try{i=await Promise.race([this.checkDNSPropagation(s,"CNAME",a[0]),new Promise((c,d)=>setTimeout(()=>d(new Error("Timeout")),1e3))])}catch{}let o=null;try{o=await Promise.race([this.checkDNSPropagation(s,"A",a[1]),new Promise((c,d)=>setTimeout(()=>d(new Error("Timeout")),1e3))])}catch{}if(r!=null&&r.propagated)return{isValid:!0,recordType:"ANAME",currentValue:a[0],expectedValues:a,recommendations:["ANAME record is properly configured"]};if(i!=null&&i.propagated)return{isValid:!0,recordType:"CNAME",currentValue:a[0],expectedValues:a,recommendations:["CNAME record is properly configured"]};if(o!=null&&o.propagated)return{isValid:!0,recordType:"A",currentValue:a[1],expectedValues:a,recommendations:["A record is configured correctly","Consider using ANAME/ALIAS record if your DNS provider supports it for better reliability"]};if(r!=null&&r.actualValues.length||i!=null&&i.actualValues.length||o!=null&&o.actualValues.length){n.push("DNS records exist but point to incorrect values"),n.push(`Expected: ${a.join(" or ")}`);const c=(r==null?void 0:r.actualValues[0])||(i==null?void 0:i.actualValues[0])||(o==null?void 0:o.actualValues[0])||null;return{isValid:!1,recordType:r!=null&&r.actualValues.length?"ANAME":i!=null&&i.actualValues.length?"CNAME":"A",currentValue:c,expectedValues:a,recommendations:n}}return n.push("No DNS records found for this domain"),n.push("Add an ANAME record pointing to line-intent-router-bot.onrender.com"),n.push("Or add an A record pointing to 216.24.57.1 if ANAME is not supported"),{isValid:!1,recordType:null,currentValue:null,expectedValues:a,recommendations:n}}sleep(s){return new Promise(a=>setTimeout(a,s))}getDNSInstructions(s,a){const n=s.startsWith("www."),r=n?s.substring(4):s,i=[];let o,c;if(a==="ANAME"||a==="ALIAS")o=n?"www":"@",c="line-intent-router-bot.onrender.com",i.push("Log in to your DNS provider's control panel"),i.push(`Create an ${a} record`),i.push(`Set Name/Host to: ${o}`),i.push(`Set Value/Target to: ${c}`),i.push("Save the record and wait for DNS propagation (up to 48 hours)");else if(a==="CNAME")o="www",c=n?"line-intent-router-bot.onrender.com":r,i.push("Log in to your DNS provider's control panel"),i.push("Create a CNAME record"),i.push(`Set Name/Host to: ${o}`),i.push(`Set Value/Target to: ${c}`),i.push("Save the record and wait for DNS propagation (up to 48 hours)");else if(a==="A")o=n?"www":"@",c="216.24.57.1",i.push("Log in to your DNS provider's control panel"),i.push("Create an A record"),i.push(`Set Name/Host to: ${o}`),i.push(`Set Value/Target to: ${c}`),i.push("Save the record and wait for DNS propagation (up to 48 hours)");else throw new Error(`Unsupported record type for domain configuration: ${a}`);return{recordType:a,name:o,value:c,instructions:i}}async detectDNSProviderCapabilities(s){if(!this.validateDomain(s))throw new Error(`Invalid domain format: ${s}`);try{const a=await this.performDNSLookup(s,"NS");if(!a.success||a.records.length===0)return{provider:null,supportsANAME:!1,supportsALIAS:!1,supportsCNAME:!0,supportsA:!0,confidence:0};const n=a.records.map(i=>i.value.toLowerCase()),r=[{name:"cloudflare",patterns:["cloudflare.com","ns.cloudflare.com"],capabilities:{supportsANAME:!1,supportsALIAS:!0,supportsCNAME:!0,supportsA:!0}},{name:"godaddy",patterns:["domaincontrol.com","godaddy.com"],capabilities:{supportsANAME:!1,supportsALIAS:!1,supportsCNAME:!0,supportsA:!0}},{name:"namecheap",patterns:["registrar-servers.com","namecheap.com"],capabilities:{supportsANAME:!1,supportsALIAS:!0,supportsCNAME:!0,supportsA:!0}},{name:"route53",patterns:["awsdns","amazonaws.com"],capabilities:{supportsANAME:!1,supportsALIAS:!0,supportsCNAME:!0,supportsA:!0}},{name:"digitalocean",patterns:["digitalocean.com","ns1.digitalocean.com"],capabilities:{supportsANAME:!1,supportsALIAS:!1,supportsCNAME:!0,supportsA:!0}},{name:"google-domains",patterns:["googledomains.com","google.com"],capabilities:{supportsANAME:!1,supportsALIAS:!1,supportsCNAME:!0,supportsA:!0}}];for(const i of r)if(n.some(c=>i.patterns.some(d=>c.includes(d))))return{provider:i.name,...i.capabilities,confidence:.9};return{provider:"unknown",supportsANAME:!0,supportsALIAS:!0,supportsCNAME:!0,supportsA:!0,confidence:.3}}catch{return{provider:null,supportsANAME:!1,supportsALIAS:!1,supportsCNAME:!0,supportsA:!0,confidence:0}}}getRecommendedRecordType(s,a){const n=!s.includes(".")||s.split(".").length===2;return s.startsWith("www."),n?a.supportsANAME?"ANAME":a.supportsALIAS?"ALIAS":"A":a.supportsCNAME?"CNAME":"A"}}const Qt=new Rd;class Ld{async getDomainConfigurations(){try{const{data:s,error:a}=await O.from("domain_configurations").select("*").order("created_at",{ascending:!1});if(a)throw new Error(`Failed to fetch domain configurations: ${a.message}`);return s||[]}catch(s){throw s instanceof Error?s:new Error("Unknown error occurred while fetching domain configurations")}}async getDomainConfiguration(s){try{if(!s||typeof s!="string")throw new Error("Invalid domain configuration ID");const{data:a,error:n}=await O.from("domain_configurations").select("*").eq("id",s).single();if(n){if(n.code==="PGRST116")return null;throw new Error(`Failed to fetch domain configuration: ${n.message}`)}return a}catch(a){throw a instanceof Error?a:new Error("Unknown error occurred while fetching domain configuration")}}async getDomainConfigurationByDomain(s){try{if(!s||typeof s!="string")throw new Error("Invalid domain name");const{data:a,error:n}=await O.from("domain_configurations").select("*").eq("domain",s.toLowerCase().trim()).single();if(n){if(n.code==="PGRST116")return null;throw new Error(`Failed to fetch domain configuration: ${n.message}`)}return a}catch(a){throw a instanceof Error?a:new Error("Unknown error occurred while fetching domain configuration")}}async addDomainConfiguration(s){var a;try{if(!s||!s.domain)throw new Error("Domain is required");if(!s.dns_record_type)throw new Error("DNS record type is required");const n=_s(s.domain);if(!n.isValid)throw new Error(`Invalid domain format: ${n.errors.join(", ")}`);if(await this.getDomainConfigurationByDomain(s.domain))throw new Error("Domain already exists in configuration");const i=this.getTargetValue(s.dns_record_type),o=this.generateVerificationToken(),c={domain:s.domain.toLowerCase().trim(),subdomain:((a=s.subdomain)==null?void 0:a.toLowerCase().trim())||null,dns_record_type:s.dns_record_type,target_value:i,status:"pending",ssl_enabled:!1,verification_token:o},{data:d,error:p}=await O.from("domain_configurations").insert(c).select().single();if(p)throw p.code==="23505"?new Error("Domain already exists in configuration"):new Error(`Failed to add domain configuration: ${p.message}`);return d}catch(n){throw n instanceof Error?n:new Error("Unknown error occurred while adding domain configuration")}}async updateDomainConfiguration(s,a){try{if(!s||typeof s!="string")throw new Error("Invalid domain configuration ID");if(!await this.getDomainConfiguration(s))throw new Error("Domain configuration not found");if(a.domain){const c=_s(a.domain);if(!c.isValid)throw new Error(`Invalid domain format: ${c.errors.join(", ")}`);const d=await this.getDomainConfigurationByDomain(a.domain);if(d&&d.id!==s)throw new Error("Domain already exists in configuration")}const r={...a,updated_at:new Date().toISOString()};r.domain&&(r.domain=r.domain.toLowerCase().trim()),r.subdomain&&(r.subdomain=r.subdomain.toLowerCase().trim());const{data:i,error:o}=await O.from("domain_configurations").update(r).eq("id",s).select().single();if(o)throw new Error(`Failed to update domain configuration: ${o.message}`);return i}catch(n){throw n instanceof Error?n:new Error("Unknown error occurred while updating domain configuration")}}async updateDomainStatus(s,a,n){try{const r={status:a};return a==="verified"||a==="enabled"?(r.last_verified_at=new Date().toISOString(),r.error_message=null):a==="failed"&&n&&(r.error_message=n),await this.updateDomainConfiguration(s,r)}catch(r){throw r instanceof Error?r:new Error("Unknown error occurred while updating domain status")}}async deleteDomainConfiguration(s,a){try{if(!s||typeof s!="string")throw new Error("Invalid domain configuration ID");const n=await this.getDomainConfiguration(s);if(!n)throw new Error("Domain configuration not found");a!=null&&a.force||await this.validateDomainRemoval(n),await this.cleanupDomainConfiguration(n);const{error:r}=await O.from("domain_configurations").delete().eq("id",s);if(r)throw new Error(`Failed to delete domain configuration: ${r.message}`)}catch(n){throw n instanceof Error?n:new Error("Unknown error occurred while deleting domain configuration")}}async validateDomainRemoval(s){if(s.status==="enabled")throw new Error("Cannot delete enabled domain configuration. Please disable it first or use force delete.");if((await this.getDomainConfigurations()).filter(r=>r.status==="enabled"&&r.id!==s.id).length===0&&s.status==="enabled")throw new Error("Cannot delete the last enabled domain. At least one domain must remain accessible.");if(s.last_health_check){const r=new Date(s.last_health_check);(Date.now()-r.getTime())/(1e3*60*60)<24&&s.is_accessible&&console.warn(`Domain ${s.domain} was recently accessible. Consider disabling before deletion.`)}}async cleanupDomainConfiguration(s){try{console.log(`Cleaning up domain configuration for ${s.domain}`),s.status==="enabled"&&await this.updateDomainStatus(s.id,"failed","Domain disabled before removal"),s.verification_token&&console.log(`Clearing verification token for ${s.domain}`)}catch(a){console.warn(`Cleanup warning for domain ${s.domain}:`,a)}}async forceDeleteDomainConfiguration(s){return this.deleteDomainConfiguration(s,{force:!0})}async safeDomainRemoval(s,a){try{const n=await this.getDomainConfiguration(s);if(!n)throw new Error("Domain configuration not found");const r=`delete-${n.domain}-${n.id.slice(-8)}`;if(a!==r)throw new Error("Invalid confirmation token. Please verify the domain name.");await this.deleteDomainConfiguration(s)}catch(n){throw n instanceof Error?n:new Error("Unknown error occurred during safe domain removal")}}generateDeletionConfirmationToken(s){return`delete-${s.domain}-${s.id.slice(-8)}`}async verifyDomainConfiguration(s){const{data:a,error:n}=await O.from("domain_configurations").select("*").eq("id",s).single();if(n||!a)throw new Error("Domain configuration not found");try{const r=await Qt.validateRenderDNSConfiguration(a.domain);let i,o;return r.isValid?(i="verified",(await Qt.verifySSLCertificate(a.domain)).valid&&(i="enabled")):(i="failed",o=r.recommendations.join("; ")),await this.updateDomainStatus(s,i,o)}catch(r){const i=r instanceof Error?r.message:"Verification failed";return await this.updateDomainStatus(s,"failed",i)}}getDNSInstructions(s){return Qt.getDNSInstructions(s.domain,s.dns_record_type)}getTargetValue(s){switch(s){case"ANAME":case"CNAME":return"line-intent-router-bot.onrender.com";case"A":return"216.24.57.1";default:throw new Error(`Unsupported DNS record type: ${s}`)}}generateVerificationToken(){return`kiro-verify-${Math.random().toString(36).substring(2,15)}${Math.random().toString(36).substring(2,15)}`}getRecommendedDNSRecordType(s){return Id(s).recommendedType}async bulkUpdateDomainStatus(s){try{if(!s||s.length===0)throw new Error("No updates provided");const a=[],n=[];for(const r of s)try{const i=await this.updateDomainStatus(r.id,r.status,r.errorMessage);a.push(i)}catch(i){const o=i instanceof Error?i.message:"Unknown error";n.push(`Failed to update domain ${r.id}: ${o}`)}if(n.length>0)throw new Error(`Bulk update completed with errors: ${n.join("; ")}`);return a}catch(a){throw a instanceof Error?a:new Error("Unknown error occurred during bulk update")}}async getDomainsByStatus(s){try{const{data:a,error:n}=await O.from("domain_configurations").select("*").eq("status",s).order("created_at",{ascending:!1});if(n)throw new Error(`Failed to fetch domains by status: ${n.message}`);return a||[]}catch(a){throw a instanceof Error?a:new Error("Unknown error occurred while fetching domains by status")}}async getDomainCountByStatus(){try{const s=await this.getDomainConfigurations(),a={pending:0,verified:0,failed:0,enabled:0};return s.forEach(n=>{a[n.status]++}),a}catch(s){throw s instanceof Error?s:new Error("Unknown error occurred while counting domains by status")}}}const it=new Ld;function $d({onSuccess:t,onCancel:s}){const{toast:a}=ce(),{register:n,handleSubmit:r,watch:i,setValue:o,formState:{errors:c},setError:d,clearErrors:p}=cl(),u=i("domain"),j=i("dns_record_type"),l=Rt({mutationFn:g=>it.addDomainConfiguration(g),onSuccess:g=>{a({title:"Domain Added",description:`${g.domain} has been added successfully`}),t()},onError:g=>{const v=g instanceof Error?g.message:"Failed to add domain";d("root",{message:v}),a({title:"Failed to Add Domain",description:v,variant:"destructive"})}});B.useEffect(()=>{if(u&&!j)try{if(_s(u).isValid){const v=it.getRecommendedDNSRecordType(u);o("dns_record_type",v),p("domain")}}catch{}},[u,j,o,p]);const m=g=>{const v=_s(g.domain);if(!v.isValid){d("domain",{message:v.errors[0]});return}p(),l.mutate(g)},x=g=>{switch(g){case"ANAME":return"Recommended: Points directly to the service hostname (best performance)";case"CNAME":return"For subdomains: Points to another domain name";case"A":return"Fallback: Points to a specific IP address";default:return""}};return e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsx($,{children:"Add Custom Domain"}),e.jsx(oe,{children:"Configure a new custom domain for your vaccine hospital service"})]}),e.jsx(D,{children:e.jsxs("form",{onSubmit:r(m),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"domain",children:"Domain Name"}),e.jsx(ae,{id:"domain",placeholder:"example.com",...n("domain",{required:"Domain name is required",pattern:{value:/^[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9](?:\.[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9])*$/,message:"Please enter a valid domain name"}}),className:c.domain?"border-red-500":""}),c.domain&&e.jsx("p",{className:"text-sm text-red-500",children:c.domain.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"subdomain",children:"Subdomain (Optional)"}),e.jsx(ae,{id:"subdomain",placeholder:"www",...n("subdomain",{pattern:{value:/^[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9]$/,message:"Please enter a valid subdomain"}}),className:c.subdomain?"border-red-500":""}),c.subdomain&&e.jsx("p",{className:"text-sm text-red-500",children:c.subdomain.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave empty for apex domain (e.g., example.com) or enter 'www' for www subdomain"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"dns_record_type",children:"DNS Record Type"}),e.jsxs(ct,{value:j,onValueChange:g=>o("dns_record_type",g),children:[e.jsx(et,{children:e.jsx(dt,{placeholder:"Select DNS record type"})}),e.jsxs(tt,{children:[e.jsx(_e,{value:"ANAME",children:"ANAME/ALIAS (Recommended)"}),e.jsx(_e,{value:"CNAME",children:"CNAME (For subdomains)"}),e.jsx(_e,{value:"A",children:"A Record (Fallback)"})]})]}),j&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 rounded-md",children:[e.jsx(Be,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-blue-700",children:x(j)})]})]}),u&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{children:"Domain Preview"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-md",children:e.jsx("p",{className:"font-mono text-sm",children:i("subdomain")?`${i("subdomain")}.${u}`:u})})]}),c.root&&e.jsxs(Q,{variant:"destructive",children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsx(X,{children:c.root.message})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(k,{type:"submit",disabled:l.isPending,className:"flex-1",children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"h-4 w-4 animate-spin mr-2"}),"Adding Domain..."]}):"Add Domain"}),e.jsx(k,{type:"button",variant:"outline",onClick:s,disabled:l.isPending,children:"Cancel"})]})]})})]})}const Zs=[{id:"cloudflare",name:"Cloudflare",supportsANAME:!1,supportsALIAS:!0,supportsCNAME:!0,supportsA:!0,guideUrl:"https://developers.cloudflare.com/dns/manage-dns-records/how-to/create-dns-records/",notes:["Uses CNAME flattening for root domains","Automatic SSL certificate provisioning"]},{id:"godaddy",name:"GoDaddy",supportsANAME:!1,supportsALIAS:!1,supportsCNAME:!0,supportsA:!0,guideUrl:"https://www.godaddy.com/help/add-an-a-record-19238",notes:["Use A records for root domains","CNAME only for subdomains"]},{id:"namecheap",name:"Namecheap",supportsANAME:!1,supportsALIAS:!0,supportsCNAME:!0,supportsA:!0,guideUrl:"https://www.namecheap.com/support/knowledgebase/article.aspx/319/2237/how-can-i-set-up-an-a-address-record-for-my-domain/",notes:["ALIAS records available for root domains","Advanced DNS required for ALIAS"]},{id:"route53",name:"AWS Route 53",supportsANAME:!1,supportsALIAS:!0,supportsCNAME:!0,supportsA:!0,guideUrl:"https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-creating.html",notes:["ALIAS records recommended for root domains","Health checks available"]},{id:"digitalocean",name:"DigitalOcean",supportsANAME:!1,supportsALIAS:!1,supportsCNAME:!0,supportsA:!0,guideUrl:"https://docs.digitalocean.com/products/networking/dns/how-to/manage-records/",notes:["A records only for root domains"]},{id:"google-domains",name:"Google Domains",supportsANAME:!1,supportsALIAS:!1,supportsCNAME:!0,supportsA:!0,guideUrl:"https://support.google.com/domains/answer/3290350",notes:["Synthetic records available for some configurations"]},{id:"generic",name:"Other DNS Provider",supportsANAME:!0,supportsALIAS:!0,supportsCNAME:!0,supportsA:!0,notes:["Check your provider documentation for ANAME/ALIAS support"]}];function Od({domain:t,className:s}){const[a,n]=h.useState(""),[r,i]=h.useState(null),{toast:o}=ce(),c=t.subdomain?`${t.subdomain}.${t.domain}`:t.domain,d=!t.subdomain;t.subdomain;const p=(x,g,v)=>{const f=v.split("."),N=f.length===2,_=v.startsWith("www.");let A,E,V;const Y=[],P=[];switch(N?A="@":_?A="www":A=f[0],g){case"ANAME":case"ALIAS":E="line-intent-router-bot.onrender.com",V=[`Log in to your ${x.name} DNS management panel`,`Navigate to DNS records for ${N?v:f.slice(-2).join(".")}`,`Create a new ${g} record`,`Set Name/Host field to: ${A}`,`Set Value/Target field to: ${E}`,"Set TTL to 300 (5 minutes) for initial setup","Save the record","Wait for DNS propagation (typically 5-30 minutes)"],P.push(`${g} records automatically resolve to the correct IP address`),P.push("This is the recommended configuration for reliability");break;case"CNAME":E="line-intent-router-bot.onrender.com",V=[`Log in to your ${x.name} DNS management panel`,`Navigate to DNS records for ${N?v:f.slice(-2).join(".")}`,"Create a new CNAME record",`Set Name/Host field to: ${A}`,`Set Value/Target field to: ${E}`,"Set TTL to 300 (5 minutes) for initial setup","Save the record","Wait for DNS propagation (typically 5-30 minutes)"],N&&Y.push("CNAME records cannot be used for root domains on most DNS providers");break;case"A":E="216.24.57.1",V=[`Log in to your ${x.name} DNS management panel`,`Navigate to DNS records for ${N?v:f.slice(-2).join(".")}`,"Create a new A record",`Set Name/Host field to: ${A}`,`Set Value/Target field to: ${E}`,"Set TTL to 300 (5 minutes) for initial setup","Save the record","Wait for DNS propagation (typically 5-30 minutes)"],Y.push("A records point to a fixed IP address which may change"),P.push("Use ANAME/ALIAS records if available for better reliability");break;default:throw new Error(`Unsupported record type: ${g}`)}return{provider:x,recordType:g,name:A,value:E,ttl:300,instructions:V,warnings:Y,tips:P}},u=h.useMemo(()=>{if(!a)return[];const x=Zs.find(v=>v.id===a);if(!x)return[];const g=[];return d?(x.supportsANAME?g.push(p(x,"ANAME",c)):x.supportsALIAS&&g.push(p(x,"ALIAS",c)),g.push(p(x,"A",c))):(x.supportsCNAME&&g.push(p(x,"CNAME",c)),g.push(p(x,"A",c))),g},[a,c,d,p]),j=async(x,g)=>{try{await navigator.clipboard.writeText(x),i(g),o({title:"Copied to clipboard",description:`${g} has been copied`}),setTimeout(()=>i(null),2e3)}catch{o({title:"Copy failed",description:"Failed to copy to clipboard",variant:"destructive"})}},l=x=>{switch(x){case"ANAME":case"ALIAS":return e.jsx(Mt,{className:"h-4 w-4"});case"CNAME":return e.jsx(fr,{className:"h-4 w-4"});case"A":return e.jsx(Pe,{className:"h-4 w-4"});default:return e.jsx(Be,{className:"h-4 w-4"})}},m=x=>{switch(x){case"ANAME":return"Points to a hostname and resolves to its IP address (recommended)";case"ALIAS":return"Similar to ANAME, resolves to the target hostname's IP (recommended)";case"CNAME":return"Points to another domain name (good for subdomains)";case"A":return"Points directly to an IP address (fallback option)";default:return""}};return e.jsx("div",{className:s,children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"h-5 w-5"}),"DNS Configuration Generator"]}),e.jsxs(oe,{children:["Get provider-specific DNS instructions for ",c]})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Select your DNS provider:"}),e.jsxs(ct,{value:a,onValueChange:n,children:[e.jsx(et,{children:e.jsx(dt,{placeholder:"Choose your DNS provider..."})}),e.jsx(tt,{children:Zs.map(x=>e.jsx(_e,{value:x.id,children:x.name},x.id))})]})]}),a&&u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{}),(()=>{const x=Zs.find(g=>g.id===a);return x&&e.jsxs(Q,{children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx(X,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:x.name})," capabilities:"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[x.supportsANAME&&e.jsx(H,{variant:"secondary",children:"ANAME"}),x.supportsALIAS&&e.jsx(H,{variant:"secondary",children:"ALIAS"}),x.supportsCNAME&&e.jsx(H,{variant:"secondary",children:"CNAME"}),x.supportsA&&e.jsx(H,{variant:"secondary",children:"A Record"})]}),x.notes&&x.notes.length>0&&e.jsx("ul",{className:"text-sm text-muted-foreground mt-2 space-y-1",children:x.notes.map((g,v)=>e.jsxs("li",{children:["• ",g]},v))})]})})]})})(),e.jsxs(Ue,{defaultValue:"0",className:"w-full",children:[e.jsx(ze,{className:"grid w-full grid-cols-2",children:u.map((x,g)=>e.jsxs(Z,{value:g.toString(),className:"flex items-center gap-2",children:[l(x.recordType),x.recordType," Record",g===0&&e.jsx(H,{variant:"default",className:"ml-1 text-xs",children:"Recommended"})]},g))}),u.map((x,g)=>e.jsxs(ee,{value:g.toString(),className:"space-y-4",children:[e.jsxs(Q,{children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx(X,{children:m(x.recordType)})]}),x.warnings&&x.warnings.length>0&&e.jsxs(Q,{variant:"destructive",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(X,{children:e.jsx("ul",{className:"space-y-1",children:x.warnings.map((v,f)=>e.jsxs("li",{children:["• ",v]},f))})})]}),e.jsxs(S,{children:[e.jsx(L,{className:"pb-3",children:e.jsx($,{className:"text-base",children:"DNS Record Values"})}),e.jsxs(D,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Record Type"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(H,{variant:"outline",className:"flex items-center gap-1",children:[l(x.recordType),x.recordType]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>j(x.recordType,"Record Type"),children:r==="Record Type"?e.jsx(rt,{className:"h-3 w-3"}):e.jsx(ye,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Name/Host"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm font-mono",children:x.name}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>j(x.name,"Name/Host"),children:r==="Name/Host"?e.jsx(rt,{className:"h-3 w-3"}):e.jsx(ye,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Value/Target"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm font-mono",children:x.value}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>j(x.value,"Value/Target"),children:r==="Value/Target"?e.jsx(rt,{className:"h-3 w-3"}):e.jsx(ye,{className:"h-3 w-3"})})]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["TTL (Time To Live): ",x.ttl," seconds"]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>j(x.ttl.toString(),"TTL"),children:r==="TTL"?e.jsx(rt,{className:"h-3 w-3"}):e.jsx(ye,{className:"h-3 w-3"})})]})})]})]}),e.jsxs(S,{children:[e.jsx(L,{className:"pb-3",children:e.jsx($,{className:"text-base",children:"Step-by-step Instructions"})}),e.jsx(D,{children:e.jsx("ol",{className:"space-y-3 text-sm",children:x.instructions.map((v,f)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-semibold",children:f+1}),e.jsx("span",{children:v})]},f))})})]}),x.tips&&x.tips.length>0&&e.jsxs(Q,{children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("p",{className:"font-medium mb-2",children:"Tips:"}),e.jsx("ul",{className:"space-y-1",children:x.tips.map((v,f)=>e.jsxs("li",{children:["• ",v]},f))})]})]}),x.provider.guideUrl&&e.jsx("div",{className:"flex justify-center",children:e.jsxs(k,{variant:"outline",onClick:()=>window.open(x.provider.guideUrl,"_blank"),children:[e.jsx(Ms,{className:"h-4 w-4 mr-2"}),"View ",x.provider.name," DNS Guide"]})})]},g))]})]}),a&&u.length===0&&e.jsxs(Q,{variant:"destructive",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(X,{children:"No compatible DNS record types found for the selected provider and domain configuration."})]})]})]})})}function Fd({domain:t}){const[s,a]=h.useState(null),{toast:n}=ce(),r=it.getDNSInstructions(t),i=t.subdomain?`${t.subdomain}.${t.domain}`:t.domain,o=async(d,p)=>{try{await navigator.clipboard.writeText(d),a(p),n({title:"Copied to clipboard",description:`${p} has been copied`}),setTimeout(()=>a(null),2e3)}catch{n({title:"Copy failed",description:"Failed to copy to clipboard",variant:"destructive"})}},c=d=>({cloudflare:"https://developers.cloudflare.com/dns/manage-dns-records/how-to/create-dns-records/",godaddy:"https://www.godaddy.com/help/add-an-a-record-19238",namecheap:"https://www.namecheap.com/support/knowledgebase/article.aspx/319/2237/how-can-i-set-up-an-a-address-record-for-my-domain/",route53:"https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-creating.html"})[d];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"DNS Configuration Instructions"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Configure these DNS records with your domain provider to enable ",i]})]}),e.jsxs(Ue,{defaultValue:"quick",className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-2",children:[e.jsxs(Z,{value:"quick",className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"Quick Setup"]}),e.jsxs(Z,{value:"advanced",className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Provider-Specific"]})]}),e.jsxs(ee,{value:"quick",className:"space-y-4",children:[e.jsxs(S,{children:[e.jsx(L,{className:"pb-3",children:e.jsx($,{className:"text-base",children:"DNS Record Details"})}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ea,{children:"Record Type"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"outline",children:r.recordType}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>o(r.recordType,"Record Type"),children:s==="Record Type"?e.jsx(rt,{className:"h-3 w-3"}):e.jsx(ye,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ea,{children:"Name/Host"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm font-mono",children:r.name}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>o(r.name,"Name/Host"),children:s==="Name/Host"?e.jsx(rt,{className:"h-3 w-3"}):e.jsx(ye,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ea,{children:"Value/Target"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm font-mono",children:r.value}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>o(r.value,"Value/Target"),children:s==="Value/Target"?e.jsx(rt,{className:"h-3 w-3"}):e.jsx(ye,{className:"h-3 w-3"})})]})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(Q,{children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"TTL (Time To Live):"})," Set to 300 seconds (5 minutes) for faster propagation during setup. You can increase it to 3600 (1 hour) or higher once the domain is working properly."]})]})})]})]}),e.jsxs(S,{children:[e.jsx(L,{className:"pb-3",children:e.jsx($,{className:"text-base",children:"Setup Instructions"})}),e.jsx(D,{children:e.jsx("ol",{className:"space-y-3 text-sm",children:r.instructions.map((d,p)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-semibold",children:p+1}),e.jsx("span",{children:d})]},p))})})]}),e.jsxs(S,{children:[e.jsxs(L,{className:"pb-3",children:[e.jsx($,{className:"text-base",children:"Provider-specific Guides"}),e.jsx(oe,{children:"Click on your DNS provider for detailed setup instructions"})]}),e.jsx(D,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:["cloudflare","godaddy","namecheap","route53"].map(d=>e.jsxs(k,{variant:"outline",size:"sm",className:"justify-start",onClick:()=>{const p=c(d);p&&window.open(p,"_blank")},children:[e.jsx(Ms,{className:"h-3 w-3 mr-2"}),d.charAt(0).toUpperCase()+d.slice(1)]},d))})})]}),e.jsxs(S,{children:[e.jsx(L,{className:"pb-3",children:e.jsxs($,{className:"text-base flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4 text-yellow-500"}),"Troubleshooting"]})}),e.jsxs(D,{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-1",children:"DNS Propagation"}),e.jsxs("p",{className:"text-muted-foreground",children:["DNS changes can take up to 48 hours to propagate globally. Use tools like"," ",e.jsx("a",{href:"https://www.whatsmydns.net",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"whatsmydns.net"})," ","to check propagation status."]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-1",children:"ANAME/ALIAS Not Supported"}),e.jsxs("p",{className:"text-muted-foreground",children:["If your DNS provider doesn't support ANAME or ALIAS records, use an A record pointing to"," ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"216.24.57.1"})," instead."]})]}),e.jsx(ge,{}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-1",children:"SSL Certificate Issues"}),e.jsx("p",{className:"text-muted-foreground",children:"SSL certificates are automatically provisioned once DNS is properly configured. This process may take a few minutes after DNS propagation completes."})]})]})]})]}),e.jsx(ee,{value:"advanced",children:e.jsx(Od,{domain:t})})]})]})}function ea({children:t}){return e.jsx("label",{className:"text-sm font-medium text-gray-700",children:t})}function Vd(t,s=[]){let a=[];function n(i,o){const c=h.createContext(o),d=a.length;a=[...a,o];function p(j){const{scope:l,children:m,...x}=j,g=(l==null?void 0:l[t][d])||c,v=h.useMemo(()=>x,Object.values(x));return e.jsx(g.Provider,{value:v,children:m})}function u(j,l){const m=(l==null?void 0:l[t][d])||c,x=h.useContext(m);if(x)return x;if(o!==void 0)return o;throw new Error(`\`${j}\` must be used within \`${i}\``)}return p.displayName=i+"Provider",[p,u]}const r=()=>{const i=a.map(o=>h.createContext(o));return function(c){const d=(c==null?void 0:c[t])||i;return h.useMemo(()=>({[`__scope${t}`]:{...c,[t]:d}}),[c,d])}};return r.scopeName=t,[n,zd(r,...s)]}function zd(...t){const s=t[0];if(t.length===1)return s;const a=()=>{const n=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(i){const o=n.reduce((c,{useScope:d,scopeName:p})=>{const j=d(i)[`__scope${p}`];return{...c,...j}},{});return h.useMemo(()=>({[`__scope${s.scopeName}`]:o}),[o])}};return a.scopeName=s.scopeName,a}var qa="Progress",Ga=100,[Wd]=Vd(qa),[Bd,Ud]=Wd(qa),hi=h.forwardRef((t,s)=>{const{__scopeProgress:a,value:n=null,max:r,getValueLabel:i=Hd,...o}=t;(r||r===0)&&!An(r)&&console.error(qd(`${r}`,"Progress"));const c=An(r)?r:Ga;n!==null&&!Tn(n,c)&&console.error(Gd(`${n}`,"Progress"));const d=Tn(n,c)?n:null,p=Ss(d)?i(d,c):void 0;return e.jsx(Bd,{scope:a,value:d,max:c,children:e.jsx(Ve.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":Ss(d)?d:void 0,"aria-valuetext":p,role:"progressbar","data-state":fi(d,c),"data-value":d??void 0,"data-max":c,...o,ref:s})})});hi.displayName=qa;var pi="ProgressIndicator",xi=h.forwardRef((t,s)=>{const{__scopeProgress:a,...n}=t,r=Ud(pi,a);return e.jsx(Ve.div,{"data-state":fi(r.value,r.max),"data-value":r.value??void 0,"data-max":r.max,...n,ref:s})});xi.displayName=pi;function Hd(t,s){return`${Math.round(t/s*100)}%`}function fi(t,s){return t==null?"indeterminate":t===s?"complete":"loading"}function Ss(t){return typeof t=="number"}function An(t){return Ss(t)&&!isNaN(t)&&t>0}function Tn(t,s){return Ss(t)&&!isNaN(t)&&t<=s&&t>=0}function qd(t,s){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${Ga}\`.`}function Gd(t,s){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${Ga} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var gi=hi,Yd=xi;const vi=h.forwardRef(({className:t,value:s,...a},n)=>e.jsx(gi,{ref:n,className:U("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...a,children:e.jsx(Yd,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));vi.displayName=gi.displayName;class Kd{constructor(){Me(this,"verificationStatuses",new Map);Me(this,"maxRetries",5);Me(this,"retryDelays",[5e3,1e4,3e4,6e4,3e5]);Me(this,"verificationTimers",new Map)}async startVerification(s){if(!await this.getDomainConfiguration(s))throw new Error("Domain configuration not found");this.verificationStatuses.set(s,{domainId:s,isVerifying:!0,currentStep:null,lastCheck:null,nextCheck:new Date,retryCount:0,maxRetries:this.maxRetries}),await this.updateDomainStatus(s,"pending"),this.performVerification(s).catch(n=>{console.error("Verification failed:",n)})}stopVerification(s){const a=this.verificationTimers.get(s);a&&(clearTimeout(a),this.verificationTimers.delete(s));const n=this.verificationStatuses.get(s);n&&(n.isVerifying=!1,n.currentStep=null)}getVerificationStatus(s){return this.verificationStatuses.get(s)||null}async performVerification(s){var r,i,o;const a=this.verificationStatuses.get(s);if(!a||!a.isVerifying)return;const n=await this.getDomainConfiguration(s);if(!n){await this.handleVerificationError(s,"Domain configuration not found");return}try{a.lastCheck=new Date,await this.updateVerificationStep(s,{step:"dns_check",message:"Checking DNS configuration...",progress:25});const c=await this.verifyDNSConfiguration(n);if(!c.success){await this.handleVerificationFailure(s,c.message,c.details);return}if(!((r=this.verificationStatuses.get(s))!=null&&r.isVerifying))return;await this.updateVerificationStep(s,{step:"ssl_check",message:"Verifying SSL certificate...",progress:50});const d=await this.verifySSLCertificate(n);if(!d.success){await this.updateDomainStatus(s,"verified",d.message),await this.scheduleRetryVerification(s);return}if(!((i=this.verificationStatuses.get(s))!=null&&i.isVerifying))return;await this.updateVerificationStep(s,{step:"accessibility_check",message:"Testing domain accessibility...",progress:75});const p=await this.verifyDomainAccessibility(n);if(!p.success){await this.handleVerificationFailure(s,p.message,p.details);return}if(!((o=this.verificationStatuses.get(s))!=null&&o.isVerifying))return;await this.updateVerificationStep(s,{step:"complete",message:"Domain verification complete!",progress:100}),await this.updateDomainStatus(s,"enabled"),this.stopVerification(s)}catch(c){const d=c instanceof Error?c.message:"Verification failed";await this.handleVerificationError(s,d)}}async verifyDNSConfiguration(s){try{const a=await Qt.validateRenderDNSConfiguration(s.domain);return a.isValid?{success:!0,message:"DNS configuration is correct",details:a.recommendations}:{success:!1,message:"DNS configuration is incorrect",details:a.recommendations}}catch(a){return{success:!1,message:"Failed to check DNS configuration",details:[a instanceof Error?a.message:"Unknown error"]}}}async verifySSLCertificate(s){try{const a=await Qt.verifySSLCertificate(s.domain);return a.valid?{success:!0,message:"SSL certificate is valid"}:{success:!1,message:a.error||"SSL certificate is not valid",details:["SSL certificate may still be provisioning. This can take up to 24 hours."]}}catch(a){return{success:!1,message:"Failed to verify SSL certificate",details:[a instanceof Error?a.message:"Unknown error"]}}}async verifyDomainAccessibility(s){try{const a=await fetch(`https://${s.domain}`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(1e4)});return{success:!0,message:"Domain is accessible"}}catch(a){return a instanceof Error&&a.name==="AbortError"?{success:!1,message:"Domain accessibility check timed out",details:["The domain may be slow to respond or not properly configured"]}:{success:!1,message:"Domain is not accessible",details:[a instanceof Error?a.message:"Unknown error"]}}}async handleVerificationError(s,a){await this.updateDomainStatus(s,"failed",a);const n=this.verificationStatuses.get(s);n&&(n.currentStep={step:"dns_check",message:a,progress:0,isError:!0},n.isVerifying=!1)}async handleVerificationFailure(s,a,n){const r=this.verificationStatuses.get(s);r&&(r.retryCount++,r.retryCount>=r.maxRetries?(await this.updateDomainStatus(s,"failed",a),r.isVerifying=!1,r.currentStep={step:"dns_check",message:`Verification failed after ${r.maxRetries} attempts: ${a}`,progress:0,isError:!0}):await this.scheduleRetryVerification(s))}async scheduleRetryVerification(s){const a=this.verificationStatuses.get(s);if(!a)return;const n=Math.min(a.retryCount,this.retryDelays.length-1),r=this.retryDelays[n];a.nextCheck=new Date(Date.now()+r),a.currentStep={step:"dns_check",message:`Retrying verification in ${Math.round(r/1e3)} seconds... (Attempt ${a.retryCount+1}/${a.maxRetries})`,progress:10};const i=this.verificationTimers.get(s);i&&clearTimeout(i);const o=setTimeout(()=>{this.performVerification(s)},r);this.verificationTimers.set(s,o)}async updateVerificationStep(s,a){const n=this.verificationStatuses.get(s);n&&(n.currentStep=a)}async getDomainConfiguration(s){const{data:a,error:n}=await O.from("domain_configurations").select("*").eq("id",s).single();return n||!a?null:a}async updateDomainStatus(s,a,n){const r={status:a,updated_at:new Date().toISOString()};a==="verified"||a==="enabled"?(r.last_verified_at=new Date().toISOString(),r.error_message=null):a==="failed"&&n&&(r.error_message=n),await O.from("domain_configurations").update(r).eq("id",s)}async verifyAllPendingDomains(){const{data:s}=await O.from("domain_configurations").select("*").in("status",["pending","failed"]);if(s)for(const a of s)this.verificationStatuses.has(a.id)||await this.startVerification(a.id)}cleanup(){for(const s of this.verificationTimers.values())clearTimeout(s);this.verificationTimers.clear(),this.verificationStatuses.clear()}}const qt=new Kd;function Jd(t){var d;const[s,a]=h.useState(null),[n,r]=h.useState(!1);h.useEffect(()=>{if(!(t!=null&&t.id)||!n)return;const p=setInterval(()=>{const u=qt.getVerificationStatus(t.id);a(u),u!=null&&u.isVerifying||r(!1)},1e3);return()=>clearInterval(p)},[t==null?void 0:t.id,n]),h.useEffect(()=>{if(t!=null&&t.id){const p=qt.getVerificationStatus(t.id);a(p),r((p==null?void 0:p.isVerifying)||!1)}},[t==null?void 0:t.id]);const i=h.useCallback(async()=>{if(t!=null&&t.id)try{await qt.startVerification(t.id),r(!0)}catch(p){throw console.error("Failed to start verification:",p),p}},[t==null?void 0:t.id]),o=h.useCallback(()=>{t!=null&&t.id&&(qt.stopVerification(t.id),r(!1),a(p=>p?{...p,isVerifying:!1}:null))},[t==null?void 0:t.id]),c=h.useCallback(async()=>{t!=null&&t.id&&(qt.stopVerification(t.id),await i())},[t==null?void 0:t.id,i]);return{verificationStatus:s,isVerifying:(s==null?void 0:s.isVerifying)||!1,currentStep:(s==null?void 0:s.currentStep)||null,progress:((d=s==null?void 0:s.currentStep)==null?void 0:d.progress)||0,startVerification:i,stopVerification:o,retryVerification:c}}function Qd({domain:t,onVerificationComplete:s}){const{verificationStatus:a,isVerifying:n,currentStep:r,progress:i,startVerification:o,stopVerification:c,retryVerification:d}=Jd(t);B.useEffect(()=>{(r==null?void 0:r.step)==="complete"&&s&&s()},[r==null?void 0:r.step,s]);const p=()=>{if(n)return e.jsx(lt,{className:"h-4 w-4 animate-spin text-blue-500"});switch(t.status){case"enabled":return e.jsx(G,{className:"h-4 w-4 text-green-500"});case"verified":return e.jsx(G,{className:"h-4 w-4 text-yellow-500"});case"failed":return e.jsx(Ae,{className:"h-4 w-4 text-red-500"});case"pending":default:return e.jsx(De,{className:"h-4 w-4 text-gray-500"})}},u=()=>{if(n)return e.jsx(H,{variant:"secondary",children:"Verifying..."});switch(t.status){case"enabled":return e.jsx(H,{variant:"default",className:"bg-green-500",children:"Enabled"});case"verified":return e.jsx(H,{variant:"secondary",className:"bg-yellow-500",children:"Verified"});case"failed":return e.jsx(H,{variant:"destructive",children:"Failed"});case"pending":default:return e.jsx(H,{variant:"outline",children:"Pending"})}},j=g=>{if(!r)return e.jsx(De,{className:"h-4 w-4 text-gray-400"});const v=r.step===g,f=l(r.step)>l(g);return r.isError&&v?e.jsx(Ae,{className:"h-4 w-4 text-red-500"}):f?e.jsx(G,{className:"h-4 w-4 text-green-500"}):v?e.jsx(lt,{className:"h-4 w-4 animate-spin text-blue-500"}):e.jsx(De,{className:"h-4 w-4 text-gray-400"})},l=g=>{switch(g){case"dns_check":return 1;case"ssl_check":return 2;case"accessibility_check":return 3;case"complete":return 4;default:return 0}},m=!n&&t.status!=="enabled",x=!n&&(t.status==="failed"||(r==null?void 0:r.isError));return e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p(),e.jsx("span",{children:"Domain Verification"})]}),u()]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Domain:"})," ",t.domain,t.subdomain&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("strong",{children:"Subdomain:"})," ",t.subdomain]})]}),n&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[i,"%"]})]}),e.jsx(vi,{value:i,className:"w-full"})]}),r&&e.jsxs(Q,{className:r.isError?"border-red-200 bg-red-50":void 0,children:[e.jsx(je,{className:`h-4 w-4 ${r.isError?"text-red-500":"text-blue-500"}`}),e.jsx(X,{children:r.message})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Verification Steps"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[j("dns_check"),e.jsx("span",{children:"DNS Configuration Check"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[j("ssl_check"),e.jsx("span",{children:"SSL Certificate Verification"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[j("accessibility_check"),e.jsx("span",{children:"Domain Accessibility Test"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[j("complete"),e.jsx("span",{children:"Verification Complete"})]})]})]}),t.error_message&&e.jsxs(Q,{variant:"destructive",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx(X,{children:t.error_message})]}),a&&a.retryCount>0&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Retry attempt: ",a.retryCount," / ",a.maxRetries,a.nextCheck&&e.jsxs("div",{children:["Next check: ",a.nextCheck.toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[m&&e.jsxs(k,{onClick:o,size:"sm",className:"flex items-center gap-2",children:[e.jsx(Xo,{className:"h-4 w-4"}),"Start Verification"]}),n&&e.jsxs(k,{onClick:c,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Zo,{className:"h-4 w-4"}),"Stop"]}),x&&e.jsxs(k,{onClick:d,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Retry"]})]}),t.last_verified_at&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Last verified: ",new Date(t.last_verified_at).toLocaleString()]})]})]})}const Xd=lr,Zd=ir,ji=h.forwardRef(({className:t,...s},a)=>e.jsx(ks,{ref:a,className:U("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));ji.displayName=ks.displayName;const bi=h.forwardRef(({className:t,children:s,...a},n)=>e.jsxs(Zd,{children:[e.jsx(ji,{}),e.jsxs(Es,{ref:n,className:U("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a,children:[s,e.jsxs(or,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Is,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));bi.displayName=Es.displayName;const Na=({className:t,...s})=>e.jsx("div",{className:U("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});Na.displayName="DialogHeader";const wa=({className:t,...s})=>e.jsx("div",{className:U("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});wa.displayName="DialogFooter";const _a=h.forwardRef(({className:t,...s},a)=>e.jsx(As,{ref:a,className:U("text-lg font-semibold leading-none tracking-tight",t),...s}));_a.displayName=As.displayName;const Sa=h.forwardRef(({className:t,...s},a)=>e.jsx(Ts,{ref:a,className:U("text-sm text-muted-foreground",t),...s}));Sa.displayName=Ts.displayName;var Ya="Checkbox",[em]=Ra(Ya),[tm,sm]=em(Ya),yi=h.forwardRef((t,s)=>{const{__scopeCheckbox:a,name:n,checked:r,defaultChecked:i,required:o,disabled:c,value:d="on",onCheckedChange:p,form:u,...j}=t,[l,m]=h.useState(null),x=ts(s,A=>m(A)),g=h.useRef(!1),v=l?u||!!l.closest("form"):!0,[f=!1,N]=La({prop:r,defaultProp:i,onChange:p}),_=h.useRef(f);return h.useEffect(()=>{const A=l==null?void 0:l.form;if(A){const E=()=>N(_.current);return A.addEventListener("reset",E),()=>A.removeEventListener("reset",E)}},[l,N]),e.jsxs(tm,{scope:a,state:f,disabled:c,children:[e.jsx(Ve.button,{type:"button",role:"checkbox","aria-checked":gt(f)?"mixed":f,"aria-required":o,"data-state":_i(f),"data-disabled":c?"":void 0,disabled:c,value:d,...j,ref:x,onKeyDown:we(t.onKeyDown,A=>{A.key==="Enter"&&A.preventDefault()}),onClick:we(t.onClick,A=>{N(E=>gt(E)?!0:!E),v&&(g.current=A.isPropagationStopped(),g.current||A.stopPropagation())})}),v&&e.jsx(am,{control:l,bubbles:!g.current,name:n,value:d,checked:f,required:o,disabled:c,form:u,style:{transform:"translateX(-100%)"},defaultChecked:gt(i)?!1:i})]})});yi.displayName=Ya;var Ni="CheckboxIndicator",wi=h.forwardRef((t,s)=>{const{__scopeCheckbox:a,forceMount:n,...r}=t,i=sm(Ni,a);return e.jsx($a,{present:n||gt(i.state)||i.state===!0,children:e.jsx(Ve.span,{"data-state":_i(i.state),"data-disabled":i.disabled?"":void 0,...r,ref:s,style:{pointerEvents:"none",...t.style}})})});wi.displayName=Ni;var am=t=>{const{control:s,checked:a,bubbles:n=!0,defaultChecked:r,...i}=t,o=h.useRef(null),c=Wo(a),d=Bo(s);h.useEffect(()=>{const u=o.current,j=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(j,"checked").set;if(c!==a&&m){const x=new Event("click",{bubbles:n});u.indeterminate=gt(a),m.call(u,gt(a)?!1:a),u.dispatchEvent(x)}},[c,a,n]);const p=h.useRef(gt(a)?!1:a);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r??p.current,...i,tabIndex:-1,ref:o,style:{...t.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function gt(t){return t==="indeterminate"}function _i(t){return gt(t)?"indeterminate":t?"checked":"unchecked"}var Si=yi,nm=wi;const Ka=h.forwardRef(({className:t,...s},a)=>e.jsx(Si,{ref:a,className:U("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(nm,{className:U("flex items-center justify-center text-current"),children:e.jsx(rt,{className:"h-4 w-4"})})}));Ka.displayName=Si.displayName;function rm({domain:t,isOpen:s,onClose:a,onSuccess:n}){const[r,i]=h.useState(""),[o,c]=h.useState(!1),[d,p]=h.useState("warning"),{toast:u}=ce(),j=Rs(),l=Rt({mutationFn:async()=>{if(!t)throw new Error("No domain selected");if(o)return it.forceDeleteDomainConfiguration(t.id);{const _=it.generateDeletionConfirmationToken(t);return it.safeDomainRemoval(t.id,_)}},onSuccess:()=>{j.invalidateQueries({queryKey:["domain-configurations"]}),u({title:"Domain Removed",description:`${t==null?void 0:t.domain} has been successfully removed`}),m(),n==null||n()},onError:_=>{u({title:"Removal Failed",description:_ instanceof Error?_.message:"Failed to remove domain",variant:"destructive"})}}),m=()=>{i(""),c(!1),p("warning"),a()},x=()=>{p("confirmation")},g=()=>{if(!t)return;const _=t.domain;if(!o&&r!==_){u({title:"Confirmation Failed",description:`Please type "${_}" exactly to confirm deletion`,variant:"destructive"});return}l.mutate()};if(!t)return null;const v=t.subdomain?`${t.subdomain}.${t.domain}`:t.domain,f=t.status==="enabled",N=!f||o;return e.jsx(Xd,{open:s,onOpenChange:m,children:e.jsxs(bi,{className:"sm:max-w-md",children:[d==="warning"&&e.jsxs(e.Fragment,{children:[e.jsxs(Na,{children:[e.jsxs(_a,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-destructive"}),"Remove Domain Configuration"]}),e.jsxs(Sa,{children:["You are about to remove the domain configuration for ",e.jsx("strong",{children:v}),"."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Q,{variant:f?"destructive":"default",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(X,{children:f?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Warning:"})," This domain is currently enabled and may be actively serving traffic. Removing it will make the service inaccessible through this domain."]}):e.jsx(e.Fragment,{children:"This will permanently remove the domain configuration. DNS records will need to be manually cleaned up from your DNS provider."})})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Domain:"})," ",v]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",t.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"DNS Record:"})," ",t.dns_record_type," → ",t.target_value]}),t.ssl_enabled&&e.jsxs("div",{children:[e.jsx("strong",{children:"SSL:"})," Active"]})]}),f&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ka,{id:"force-delete",checked:o,onCheckedChange:_=>c(_)}),e.jsx(K,{htmlFor:"force-delete",className:"text-sm",children:"Force delete (bypass safety checks)"})]})]}),e.jsxs(wa,{children:[e.jsx(k,{variant:"outline",onClick:m,children:"Cancel"}),e.jsx(k,{variant:"destructive",onClick:x,disabled:!N,children:"Continue"})]})]}),d==="confirmation"&&e.jsxs(e.Fragment,{children:[e.jsxs(Na,{children:[e.jsxs(_a,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5 text-destructive"}),"Confirm Domain Removal"]}),e.jsx(Sa,{children:"This action cannot be undone. Please confirm by typing the domain name below."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Q,{variant:"destructive",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"Final Warning:"})," This will permanently delete the domain configuration. You will need to manually remove DNS records from your DNS provider."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(K,{htmlFor:"confirmation",children:["Type ",e.jsx("strong",{children:t.domain})," to confirm:"]}),e.jsx(ae,{id:"confirmation",value:r,onChange:_=>i(_.target.value),placeholder:t.domain,className:"font-mono"})]}),o&&e.jsxs(Q,{variant:"destructive",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"Force Delete Mode:"})," All safety checks will be bypassed."]})]})]}),e.jsxs(wa,{children:[e.jsx(k,{variant:"outline",onClick:()=>p("warning"),children:"Back"}),e.jsx(k,{variant:"destructive",onClick:g,disabled:l.isPending||!o&&r!==t.domain,children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"h-4 w-4 animate-spin mr-2"}),"Removing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ys,{className:"h-4 w-4 mr-2"}),"Delete Domain"]})})]})]})]})})}const In=[{id:"vchomehospital-www",name:"VCHome Hospital - WWW",description:"Main website for VCHome Hospital",domain:"vchomehospital.co.th",subdomain:"www",dns_record_type:"CNAME",instructions:["Go to your DNS management panel for vchomehospital.co.th","Add a CNAME record:","  - Type: CNAME","  - Name: www","  - Value: your-render-service.onrender.com","  - TTL: 300","Save the changes and wait for DNS propagation","SSL certificate will be automatically generated"],notes:"Recommended for main website. CNAME provides better flexibility."},{id:"vchomehospital-root",name:"VCHome Hospital - Root Domain",description:"Root domain for VCHome Hospital",domain:"vchomehospital.co.th",dns_record_type:"A",instructions:["Go to your DNS management panel for vchomehospital.co.th","Add an A record:","  - Type: A","  - Name: @ (or leave blank)","  - Value: 216.24.57.1","  - TTL: 300","Save the changes and wait for DNS propagation","SSL certificate will be automatically generated"],notes:"Use this for root domain access (without www)"},{id:"vchomehospital-api",name:"VCHome Hospital - API",description:"API subdomain for VCHome Hospital",domain:"vchomehospital.co.th",subdomain:"api",dns_record_type:"CNAME",instructions:["Go to your DNS management panel for vchomehospital.co.th","Add a CNAME record:","  - Type: CNAME","  - Name: api","  - Value: your-api-service.onrender.com","  - TTL: 300","Save the changes and wait for DNS propagation"],notes:"For API endpoints. Point to your API service on Render."}],Gt={defaultTarget:"your-service-name.onrender.com",ipAddress:"216.24.57.1",propagationTime:"15 minutes - 48 hours"};function im({currentDomain:t="your-app.onrender.com",onMigrate:s}){const[a,n]=h.useState("www.vchomehospital.co.th"),[r,i]=h.useState("planning"),{toast:o}=ce(),c=u=>{navigator.clipboard.writeText(u),o({title:"Copied!",description:"DNS record copied to clipboard"})},d=()=>{i("instructions")},p=()=>{i("verification"),s==null||s(a)};return e.jsx("div",{className:"space-y-6",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"h-5 w-5 text-blue-500"}),"Domain Migration Assistant"]}),e.jsx(oe,{children:"Migrate from your current domain to a custom domain"})]}),e.jsxs(D,{children:[r==="planning"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(H,{variant:"outline",className:"mb-2",children:"Current"}),e.jsx("div",{className:"font-mono text-sm bg-gray-100 px-3 py-2 rounded",children:t})]}),e.jsx(Xe,{className:"h-6 w-6 text-blue-500"}),e.jsxs("div",{className:"text-center",children:[e.jsx(H,{variant:"default",className:"mb-2",children:"New Custom Domain"}),e.jsx("div",{className:"font-mono text-sm bg-blue-50 px-3 py-2 rounded border border-blue-200",children:a})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"new-domain",children:"Custom Domain"}),e.jsx(ae,{id:"new-domain",value:a,onChange:u=>n(u.target.value),placeholder:"www.yourdomain.com"})]}),e.jsxs(Q,{children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"Migration Benefits:"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-sm",children:[e.jsx("li",{children:"• Professional branded domain"}),e.jsx("li",{children:"• Better SEO and user trust"}),e.jsx("li",{children:"• Free SSL certificate"}),e.jsx("li",{children:"• No additional costs"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Migration Steps:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 font-medium text-xs",children:"1"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"DNS Setup"}),e.jsx("div",{className:"text-muted-foreground",children:"Configure DNS records"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 font-medium text-xs",children:"2"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Verification"}),e.jsx("div",{className:"text-muted-foreground",children:"Test new domain"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 font-medium text-xs",children:"3"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Go Live"}),e.jsx("div",{className:"text-muted-foreground",children:"Switch to new domain"})]})]})]})]})]}),e.jsx(k,{onClick:d,className:"w-full",children:"Start Migration"})]}),r==="instructions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs(X,{children:["Ready to migrate to ",e.jsx("strong",{children:a})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Step 1: Add Custom Domain in Render"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsx("div",{className:"text-sm",children:"1. Go to your Render service dashboard"}),e.jsxs("div",{className:"text-sm",children:["2. Click ",e.jsx("strong",{children:"Settings"})," → ",e.jsx("strong",{children:"Custom Domains"})]}),e.jsxs("div",{className:"text-sm",children:["3. Click ",e.jsx("strong",{children:'"Add Custom Domain"'})]}),e.jsxs("div",{className:"text-sm flex items-center gap-2",children:["4. Enter:",e.jsx("code",{className:"bg-white px-2 py-1 rounded text-xs",children:a}),e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>c(a),children:e.jsx(ye,{className:"h-3 w-3"})})]})]})]}),e.jsx(ge,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Step 2: Configure DNS Records"}),e.jsx(S,{className:"bg-gray-50",children:e.jsx(D,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Type:"}),e.jsx(H,{children:"CNAME"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsx("code",{className:"bg-white px-2 py-1 rounded text-sm",children:"www"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Value:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-white px-2 py-1 rounded text-sm",children:t}),e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>c(t),children:e.jsx(ye,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"TTL:"}),e.jsx("code",{className:"bg-white px-2 py-1 rounded text-sm",children:"300"})]})]})})})]}),e.jsxs(Q,{variant:"default",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"Important:"})," DNS propagation can take 15 minutes to 48 hours. Your current domain will continue working during this time."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{onClick:p,className:"flex-1",children:"DNS Configured - Test Domain"}),e.jsx(k,{variant:"outline",onClick:()=>i("planning"),children:"Back"})]})]}),r==="verification"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx(X,{children:"Migration in progress! Your new domain is being set up."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Verification Steps:"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"DNS records configured"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Waiting for DNS propagation..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 border border-gray-300 rounded-full"}),e.jsx("span",{children:"SSL certificate generation"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 border border-gray-300 rounded-full"}),e.jsx("span",{children:"Domain verification"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Test Your New Domain:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-blue-800",children:["Try accessing: ",e.jsxs("a",{href:`https://${a}`,target:"_blank",rel:"noopener noreferrer",className:"underline font-mono",children:["https://",a]})]}),e.jsx("div",{className:"text-xs text-blue-600",children:"If it doesn't work yet, wait a bit longer for DNS propagation."})]})]}),e.jsxs(Q,{children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"Next Steps:"})," Once your new domain is working, you can update bookmarks, links, and inform users about the new address. Your old domain will continue to work as a backup."]})]})]})]})]})})}function om({onSuccess:t,onCancel:s}){const[a,n]=h.useState("setup"),[r,i]=h.useState("vchomehospital-www"),[o,c]=h.useState("migrate"),{toast:d}=ce(),p=Rs(),u=In.find(g=>g.id===r),j=Rt({mutationFn:async()=>{if(!u)throw new Error("No preset selected");const g={domain:u.domain,subdomain:u.subdomain,dns_record_type:u.dns_record_type};return it.addDomainConfiguration(g)},onSuccess:g=>{d({title:"Domain Added Successfully",description:`${u!=null&&u.subdomain?`${u.subdomain}.`:""}${u==null?void 0:u.domain} has been added to your configuration`}),n("instructions")},onError:g=>{d({title:"Failed to Add Domain",description:g instanceof Error?g.message:"An error occurred",variant:"destructive"})}}),l=g=>{navigator.clipboard.writeText(g),d({title:"Copied to Clipboard",description:"DNS record information copied"})},m=()=>{j.mutate()},x=()=>{n("monitoring"),p.invalidateQueries({queryKey:["domain-configurations"]}),t==null||t()};return u?e.jsx("div",{className:"space-y-6",children:e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"h-5 w-5 text-blue-500"}),"VCHome Hospital Domain Setup"]}),e.jsx(oe,{children:"Quick setup for www.vchomehospital.co.th on Render"})]}),e.jsxs(H,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Mt,{className:"h-3 w-3"}),u.subdomain?`${u.subdomain}.`:"",u.domain]})]})}),e.jsxs(D,{children:[a==="setup"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Choose Setup Type:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(S,{className:`cursor-pointer transition-colors ${o==="migrate"?"border-blue-500 bg-blue-50":"hover:border-gray-300"}`,onClick:()=>c("migrate"),children:e.jsx(D,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium text-sm",children:"🔄 Migrate Existing Domain"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Switch from your current domain to www.vchomehospital.co.th"}),e.jsx(H,{variant:"default",className:"text-xs",children:"Recommended"})]})})}),e.jsx(S,{className:`cursor-pointer transition-colors ${o==="new"?"border-blue-500 bg-blue-50":"hover:border-gray-300"}`,onClick:()=>c("new"),children:e.jsx(D,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium text-sm",children:"✨ New Domain Setup"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Add www.vchomehospital.co.th as additional domain"}),e.jsx(H,{variant:"secondary",className:"text-xs",children:"Advanced"})]})})})]})]}),o==="new"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:In.filter(g=>g.domain==="vchomehospital.co.th").map(g=>e.jsx(S,{className:`cursor-pointer transition-colors ${r===g.id?"border-blue-500 bg-blue-50":"hover:border-gray-300"}`,onClick:()=>i(g.id),children:e.jsx(D,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"font-medium text-sm",children:[g.subdomain?`${g.subdomain}.`:"",g.domain]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:g.description}),e.jsxs(H,{variant:"secondary",className:"text-xs",children:[g.dns_record_type," Record"]})]})})},g.id))}),e.jsx(ge,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"What happens next:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 font-medium text-xs",children:"1"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Add to Render"}),e.jsx("div",{className:"text-muted-foreground",children:"Domain will be added to your Render service"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 font-medium text-xs",children:"2"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"DNS Setup"}),e.jsx("div",{className:"text-muted-foreground",children:"You'll get step-by-step DNS instructions"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 font-medium text-xs",children:"3"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Auto SSL"}),e.jsx("div",{className:"text-muted-foreground",children:"Free SSL certificate from Let's Encrypt"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{onClick:()=>{o==="migrate"?n("migration"):m()},disabled:j.isPending,className:"flex-1",children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"h-4 w-4 animate-spin mr-2"}),"Setting up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),o==="migrate"?"Start Migration":"Setup Domain"]})}),s&&e.jsx(k,{variant:"outline",onClick:s,children:"Cancel"})]})]}),a==="migration"&&e.jsx(im,{currentDomain:"your-render-app.onrender.com",onMigrate:g=>{d({title:"Migration Started",description:`Migrating to ${g}`}),n("monitoring"),t==null||t()}}),a==="instructions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx(X,{children:"Domain added successfully! Now you need to configure DNS records."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"DNS Configuration Required"}),e.jsx(S,{className:"bg-gray-50",children:e.jsx(D,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"DNS Record Type:"}),e.jsx(H,{children:u.dns_record_type})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsx("code",{className:"bg-white px-2 py-1 rounded text-sm",children:u.subdomain||"@"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Value:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-white px-2 py-1 rounded text-sm",children:u.dns_record_type==="CNAME"?Gt.defaultTarget:Gt.ipAddress}),e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>l(u.dns_record_type==="CNAME"?Gt.defaultTarget:Gt.ipAddress),children:e.jsx(ye,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"TTL:"}),e.jsx("code",{className:"bg-white px-2 py-1 rounded text-sm",children:"300"})]})]})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Step-by-step instructions:"}),e.jsx("ol",{className:"space-y-2 text-sm",children:u.instructions.map((g,v)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 text-xs font-medium text-blue-600",children:v+1}),e.jsx("span",{children:g})]},v))})]}),e.jsxs(Q,{children:[e.jsx(De,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"DNS Propagation Time:"})," ",Gt.propagationTime,e.jsx("br",{}),"You can check propagation status at"," ",e.jsxs("a",{href:"https://dnschecker.org",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline inline-flex items-center gap-1",children:["dnschecker.org ",e.jsx(Ms,{className:"h-3 w-3"})]})]})]}),u.notes&&e.jsx(Q,{children:e.jsxs(X,{children:[e.jsx("strong",{children:"Note:"})," ",u.notes]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:x,className:"flex-1",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Start Monitoring"]}),e.jsx(k,{variant:"outline",onClick:()=>n("setup"),children:"Back"})]})]}),a==="monitoring"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Q,{children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx(X,{children:"Setup complete! Your domain is now being monitored automatically."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium",children:"What's being monitored:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),"DNS Resolution"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),"SSL Certificate"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),"Domain Accessibility"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-500"}),"Response Time"]})]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"You can view the domain status in the Domain Management section. The system will automatically detect when your DNS changes take effect."})]})]})]})}):e.jsx(Q,{variant:"destructive",children:e.jsx(X,{children:"Invalid preset configuration"})})}function lm(){const[t,s]=h.useState(!1),[a,n]=h.useState(!1),[r,i]=h.useState(null),{toast:o}=ce(),c=Rs(),{data:d=[],isLoading:p,error:u,refetch:j}=ha({queryKey:["domain-configurations"],queryFn:()=>it.getDomainConfigurations()}),l=Rt({mutationFn:g=>it.verifyDomainConfiguration(g),onSuccess:g=>{c.invalidateQueries({queryKey:["domain-configurations"]}),o({title:"Domain Verified",description:`${g.domain} verification completed`})},onError:g=>{o({title:"Verification Failed",description:g instanceof Error?g.message:"Failed to verify domain",variant:"destructive"})}}),m=g=>{l.mutate(g)},x=g=>{i(g)};return p?e.jsx(S,{children:e.jsxs(D,{className:"flex items-center justify-center py-8",children:[e.jsx(lt,{className:"h-6 w-6 animate-spin mr-2"}),"Loading domain configurations..."]})}):u?e.jsx(S,{children:e.jsx(D,{className:"py-8",children:e.jsxs(Q,{variant:"destructive",children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsxs(X,{children:["Failed to load domain configurations: ",u instanceof Error?u.message:"Unknown error"]})]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{children:"Domain Management"}),e.jsx(oe,{children:"Configure custom domains for your vaccine hospital service"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>j(),disabled:p,children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(k,{onClick:()=>n(!0),size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Quick Setup"]}),e.jsxs(k,{onClick:()=>s(!0),size:"sm",variant:"outline",children:[e.jsx(Oa,{className:"h-4 w-4 mr-2"}),"Add Domain"]})]})]})}),e.jsxs(D,{children:[a&&e.jsxs(e.Fragment,{children:[e.jsx(om,{onSuccess:()=>{n(!1),c.invalidateQueries({queryKey:["domain-configurations"]})},onCancel:()=>n(!1)}),e.jsx(ge,{className:"my-6"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx($d,{onSuccess:()=>{s(!1),c.invalidateQueries({queryKey:["domain-configurations"]})},onCancel:()=>s(!1)}),e.jsx(ge,{className:"my-6"})]}),d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No domain configurations found."}),e.jsx("p",{className:"text-sm mt-2",children:"Add your first custom domain to get started."})]}):e.jsx("div",{className:"space-y-4",children:d.map(g=>e.jsx(cm,{domain:g,onVerify:()=>m(g.id),onDelete:()=>x(g),isVerifying:l.isPending},g.id))})]})]}),e.jsx(rm,{domain:r,isOpen:!!r,onClose:()=>i(null),onSuccess:()=>{c.invalidateQueries({queryKey:["domain-configurations"]})}})]})}function cm({domain:t,onVerify:s,onDelete:a,isVerifying:n}){const[r,i]=h.useState(!1),[o,c]=h.useState(!1),d=t.subdomain?`${t.subdomain}.${t.domain}`:t.domain,p=j=>{switch(j){case"enabled":return e.jsx(G,{className:"h-4 w-4 text-green-500"});case"verified":return e.jsx(G,{className:"h-4 w-4 text-blue-500"});case"pending":return e.jsx(De,{className:"h-4 w-4 text-yellow-500"});case"failed":return e.jsx(Ae,{className:"h-4 w-4 text-red-500"});default:return e.jsx(bt,{className:"h-4 w-4 text-gray-500"})}},u=j=>{switch(j){case"enabled":return"default";case"verified":return"secondary";case"pending":return"outline";case"failed":return"destructive";default:return"outline"}};return e.jsx(S,{children:e.jsxs(D,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:d}),e.jsxs(H,{variant:u(t.status),className:"flex items-center gap-1",children:[p(t.status),t.status.charAt(0).toUpperCase()+t.status.slice(1)]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["DNS Record: ",t.dns_record_type," → ",t.target_value]}),t.last_verified_at&&e.jsxs("p",{children:["Last verified: ",new Date(t.last_verified_at).toLocaleString()]}),t.ssl_enabled&&e.jsx("p",{className:"text-green-600",children:"SSL Certificate: Active"})]}),t.error_message&&e.jsxs(Q,{variant:"destructive",className:"mt-2",children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsx(X,{children:t.error_message})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:()=>i(!r),children:"DNS Setup"}),e.jsx(k,{variant:"outline",size:"sm",onClick:()=>c(!o),children:"Verification"}),e.jsxs(k,{variant:"outline",size:"sm",onClick:s,disabled:n||t.status==="enabled",children:[n?e.jsx(lt,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Quick Verify"]}),e.jsx(k,{variant:"outline",size:"sm",onClick:a,children:e.jsx(ys,{className:"h-4 w-4"})})]})]}),r&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx(Fd,{domain:t})}),o&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx(Qd,{domain:t,onVerificationComplete:()=>{window.location.reload()}})})]})})}class dm{constructor(){Me(this,"monitoringInterval",null);Me(this,"CHECK_INTERVAL",5*60*1e3);Me(this,"SSL_WARNING_DAYS",30)}startMonitoring(){this.monitoringInterval&&this.stopMonitoring(),this.monitoringInterval=setInterval(()=>{this.performHealthChecks()},this.CHECK_INTERVAL),this.performHealthChecks()}stopMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null)}async performHealthChecks(){try{const s=await this.getConfiguredDomains();for(const a of s){const n=await this.checkDomainHealth(a.domain);await this.updateDomainHealth(a.id,n),await this.processAlerts(a,n)}}catch(s){console.error("Error performing domain health checks:",s)}}async checkDomainHealth(s){const a=Date.now();try{const n=await this.checkDomainAccessibility(s),r=Date.now()-a,i=await this.checkSSLCertificate(s);return{domain:s,isAccessible:n.ok,responseTime:r,statusCode:n.status,sslValid:i.valid,sslExpiresAt:i.expiresAt,lastChecked:new Date}}catch(n){return{domain:s,isAccessible:!1,lastChecked:new Date,sslValid:!1,error:n instanceof Error?n.message:"Unknown error"}}}async checkDomainAccessibility(s){const a=new AbortController,n=setTimeout(()=>a.abort(),1e4);try{const r=await fetch(`https://${s}`,{method:"HEAD",signal:a.signal,mode:"no-cors"});return clearTimeout(n),r}catch(r){throw clearTimeout(n),r}}async checkSSLCertificate(s){try{const a=await fetch(`https://${s}`,{method:"HEAD",mode:"no-cors"});return{valid:a.ok||a.type==="opaque",expiresAt:new Date(Date.now()+90*24*60*60*1e3)}}catch{return{valid:!1}}}async getConfiguredDomains(){const{data:s,error:a}=await O.from("domain_configurations").select("*").eq("status","enabled");if(a)throw new Error(`Failed to fetch domains: ${a.message}`);return s||[]}async updateDomainHealth(s,a){var r;const{error:n}=await O.from("domain_configurations").update({last_health_check:a.lastChecked.toISOString(),is_accessible:a.isAccessible,ssl_valid:a.sslValid,ssl_expires_at:(r=a.sslExpiresAt)==null?void 0:r.toISOString(),response_time_ms:a.responseTime,last_error:a.error}).eq("id",s);n&&console.error("Failed to update domain health:",n)}async processAlerts(s,a){const n=[];if(a.isAccessible||n.push({domain:s.domain,alertType:"accessibility",severity:"critical",message:`Domain ${s.domain} is not accessible. ${a.error||"Unknown error"}`,resolved:!1}),a.sslExpiresAt){const r=Math.floor((a.sslExpiresAt.getTime()-Date.now())/864e5);r<=0?n.push({domain:s.domain,alertType:"ssl_expired",severity:"critical",message:`SSL certificate for ${s.domain} has expired`,resolved:!1}):r<=this.SSL_WARNING_DAYS&&n.push({domain:s.domain,alertType:"ssl_expiring",severity:r<=7?"high":"medium",message:`SSL certificate for ${s.domain} expires in ${r} days`,resolved:!1})}for(const r of n)await this.createAlert(r)}async createAlert(s){const{data:a}=await O.from("domain_alerts").select("id").eq("domain",s.domain).eq("alert_type",s.alertType).eq("resolved",!1).limit(1);if(a&&a.length>0)return;const{error:n}=await O.from("domain_alerts").insert({domain:s.domain,alert_type:s.alertType,severity:s.severity,message:s.message,resolved:s.resolved,created_at:new Date().toISOString()});n&&console.error("Failed to create alert:",n)}async getActiveAlerts(s){let a=O.from("domain_alerts").select("*").eq("resolved",!1).order("created_at",{ascending:!1});s&&(a=a.eq("domain",s));const{data:n,error:r}=await a;if(r)throw new Error(`Failed to fetch alerts: ${r.message}`);return n||[]}async resolveAlert(s){const{error:a}=await O.from("domain_alerts").update({resolved:!0,resolved_at:new Date().toISOString()}).eq("id",s);if(a)throw new Error(`Failed to resolve alert: ${a.message}`)}async detectConfigurationDrift(s){try{const{data:a}=await O.from("domain_configurations").select("*").eq("domain",s).single();return!1}catch(a){return console.error("Error detecting configuration drift:",a),!1}}}const Yt=new dm;function mm(){const[t,s]=h.useState(!1),a=Rs(),{data:n=[],isLoading:r,error:i}=ha({queryKey:["domain-alerts"],queryFn:()=>Yt.getActiveAlerts(),refetchInterval:3e4}),{data:o=[],isLoading:c}=ha({queryKey:["domain-configurations"],queryFn:async()=>{const{data:v,error:f}=await O.from("domain_configurations").select("*").eq("status","enabled");if(f)throw f;return v},refetchInterval:6e4}),d=Rt({mutationFn:v=>Yt.resolveAlert(v),onSuccess:()=>{a.invalidateQueries({queryKey:["domain-alerts"]})}}),p=Rt({mutationFn:v=>Yt.checkDomainHealth(v),onSuccess:()=>{a.invalidateQueries({queryKey:["domain-configurations"]}),a.invalidateQueries({queryKey:["domain-alerts"]})}}),u=h.useCallback(()=>{Yt.startMonitoring(),s(!0)},[]),j=h.useCallback(()=>{Yt.stopMonitoring(),s(!1)},[]),l=h.useCallback(v=>{d.mutate(v)},[d]),m=h.useCallback(v=>{p.mutate(v)},[p]),x=h.useCallback(v=>n.filter(f=>f.severity===v),[n]),g=n.filter(v=>v.severity==="critical").length;return h.useEffect(()=>(u(),()=>{j()}),[u,j]),h.useEffect(()=>{const v=O.channel("domain_alerts_changes").on("postgres_changes",{event:"*",schema:"public",table:"domain_alerts"},()=>{a.invalidateQueries({queryKey:["domain-alerts"]})}).subscribe(),f=O.channel("domain_configurations_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"domain_configurations"},()=>{a.invalidateQueries({queryKey:["domain-configurations"]})}).subscribe();return()=>{O.removeChannel(v),O.removeChannel(f)}},[a]),{isMonitoring:t,alerts:n,domains:o,criticalAlertsCount:g,alertsLoading:r,domainsLoading:c,isResolvingAlert:d.isPending,isPerformingHealthCheck:p.isPending,alertsError:i,resolveAlertError:d.error,healthCheckError:p.error,startMonitoring:u,stopMonitoring:j,resolveAlert:l,performHealthCheck:m,getAlertsBySeverity:x}}function um({className:t}){const{isMonitoring:s,alerts:a,domains:n,criticalAlertsCount:r,alertsLoading:i,domainsLoading:o,isResolvingAlert:c,isPerformingHealthCheck:d,resolveAlert:p,performHealthCheck:u}=mm(),j=x=>{switch(x){case"critical":return e.jsx(Ae,{className:"h-4 w-4 text-red-500"});case"high":return e.jsx(je,{className:"h-4 w-4 text-orange-500"});case"medium":return e.jsx(je,{className:"h-4 w-4 text-yellow-500"});case"low":return e.jsx(je,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(je,{className:"h-4 w-4 text-gray-500"})}},l=x=>{switch(x){case"critical":return"destructive";case"high":return"destructive";case"medium":return"secondary";case"low":return"outline";default:return"outline"}},m=x=>{if(!x)return"Never";const g=new Date(x),f=new Date().getTime()-g.getTime(),N=Math.floor(f/(1e3*60));if(N<1)return"Just now";if(N<60)return`${N}m ago`;const _=Math.floor(N/60);return _<24?`${_}h ago`:`${Math.floor(_/24)}d ago`};return i||o?e.jsxs(S,{className:t,children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Zt,{className:"h-5 w-5"}),"Domain Monitoring"]})}),e.jsx(D,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Se,{className:"h-6 w-6 animate-spin text-muted-foreground"})})})]}):e.jsxs("div",{className:t,children:[e.jsxs(S,{className:"mb-6",children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Zt,{className:"h-5 w-5"}),"Domain Monitoring",s?e.jsxs(H,{variant:"outline",className:"ml-auto",children:[e.jsx(G,{className:"h-3 w-3 mr-1 text-green-500"}),"Active"]}):e.jsxs(H,{variant:"secondary",className:"ml-auto",children:[e.jsx(Ae,{className:"h-3 w-3 mr-1 text-red-500"}),"Inactive"]})]}),e.jsx(oe,{children:"Continuous monitoring of domain accessibility and SSL certificates"})]}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Monitored Domains"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Critical Alerts"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Alerts"})]})]})})]}),a.length>0&&e.jsxs(S,{className:"mb-6",children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5"}),"Active Alerts"]}),e.jsx(oe,{children:"Domain issues requiring attention"})]}),e.jsx(D,{className:"space-y-4",children:a.map(x=>e.jsx(Q,{className:"relative",children:e.jsxs("div",{className:"flex items-start gap-3",children:[j(x.severity),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(H,{variant:l(x.severity),children:x.severity.toUpperCase()}),e.jsx("span",{className:"text-sm font-medium",children:x.domain}),e.jsx("span",{className:"text-xs text-muted-foreground",children:m(x.createdAt.toString())})]}),e.jsx(X,{className:"text-sm",children:x.message})]}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>p(x.id),disabled:c,children:"Resolve"})]})},x.id))})]}),e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5"}),"Domain Health Status"]}),e.jsx(oe,{children:"Current status of all monitored domains"})]}),e.jsx(D,{children:n.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No domains configured for monitoring"}):e.jsx("div",{className:"space-y-4",children:n.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-medium",children:x.domain}),x.is_accessible?e.jsx(G,{className:"h-4 w-4 text-green-500"}):e.jsx(Ae,{className:"h-4 w-4 text-red-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx("div",{className:"font-medium",children:x.is_accessible?"Accessible":"Inaccessible"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"SSL:"}),e.jsx("div",{className:"font-medium",children:x.ssl_valid?"Valid":"Invalid"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Response:"}),e.jsx("div",{className:"font-medium",children:x.response_time_ms?`${x.response_time_ms}ms`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Check:"}),e.jsx("div",{className:"font-medium",children:m(x.last_health_check)})]})]}),x.ssl_expires_at&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"SSL Expires:"}),e.jsx("span",{className:"ml-1 font-medium",children:new Date(x.ssl_expires_at).toLocaleDateString()})]}),x.last_error&&e.jsxs("div",{className:"mt-2 text-sm text-red-600",children:[e.jsx("span",{className:"font-medium",children:"Error:"})," ",x.last_error]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>u(x.domain),disabled:d,children:[e.jsx(Se,{className:`h-4 w-4 ${d?"animate-spin":""}`}),"Check Now"]})})]},x.id))})})]})]})}const Xt=["domain:read","domain:write","domain:delete","vaccine:read","vaccine:write","appointments:read","appointments:write","system:settings"],hm=[...Xt,"users:manage","system:admin","domain:force_delete"],pm=[{email:"admin@vchomehospital.co.th",password:"admin123",role:"admin",permissions:Xt},{email:"superadmin@vchomehospital.co.th",password:"superadmin123",role:"superadmin",permissions:hm}],us=t=>t.endsWith("@vchomehospital.co.th")?!0:["admin@gmail.com","admin@example.com","test@admin.com"].includes(t.toLowerCase());function Di(){const[t,s]=h.useState(null),[a,n]=h.useState(!0),[r,i]=h.useState(null);h.useEffect(()=>{(async()=>{var m;const{data:{session:j}}=await O.auth.getSession();if((m=j==null?void 0:j.user)!=null&&m.email&&us(j.user.email)){const x={id:j.user.id,email:j.user.email,role:(j.user.email.endsWith("@vchomehospital.co.th"),"admin"),permissions:Xt,isAdmin:!0,isSuperAdmin:j.user.email==="superadmin@vchomehospital.co.th"};s(x),localStorage.setItem("admin_user",JSON.stringify(x)),n(!1);return}const l=localStorage.getItem("admin_user");if(l)try{const x=JSON.parse(l);s(x)}catch{localStorage.removeItem("admin_user")}n(!1)})();const{data:{subscription:u}}=O.auth.onAuthStateChange(async(j,l)=>{var m;if((m=l==null?void 0:l.user)!=null&&m.email&&us(l.user.email)){const x={id:l.user.id,email:l.user.email,role:(l.user.email.endsWith("@vchomehospital.co.th"),"admin"),permissions:Xt,isAdmin:!0,isSuperAdmin:l.user.email==="superadmin@vchomehospital.co.th"};s(x),localStorage.setItem("admin_user",JSON.stringify(x))}else j==="SIGNED_OUT"&&(s(null),localStorage.removeItem("admin_user"))});return()=>u.unsubscribe()},[]);const o=async(p,u)=>{n(!0),i(null);try{const{data:j,error:l}=await O.auth.signInWithPassword({email:p,password:u});if(j.user&&us(p)){const m={id:j.user.id,email:j.user.email,role:(p.endsWith("@vchomehospital.co.th"),"admin"),permissions:Xt,isAdmin:!0,isSuperAdmin:p==="superadmin@vchomehospital.co.th"};s(m),localStorage.setItem("admin_user",JSON.stringify(m));return}if(l){const m=pm.find(g=>g.email===p&&g.password===u);if(!m)throw new Error("Invalid credentials. Please check your email and password.");const x={id:`demo_admin_${Date.now()}`,email:m.email,role:m.role,permissions:m.permissions,isAdmin:!0,isSuperAdmin:m.role==="superadmin"};s(x),localStorage.setItem("admin_user",JSON.stringify(x));return}if(j.user&&!us(p))throw await O.auth.signOut(),new Error("Access denied. Admin privileges required.")}catch(j){throw i(j instanceof Error?j.message:"Login failed"),j}finally{n(!1)}},c=async()=>{await O.auth.signOut(),s(null),localStorage.removeItem("admin_user")},d=p=>(t==null?void 0:t.permissions.includes(p))||!1;return{user:t,isLoading:a,isAdmin:(t==null?void 0:t.isAdmin)||!1,isSuperAdmin:(t==null?void 0:t.isSuperAdmin)||!1,hasPermission:d,login:o,logout:c,error:r}}function xm({onSuccess:t}){const[s,a]=h.useState(""),[n,r]=h.useState(""),[i,o]=h.useState(!1),{login:c,isLoading:d,error:p}=Di(),u=async j=>{j.preventDefault();try{await c(s,n),t==null||t()}catch{}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs(S,{className:"w-full max-w-md",children:[e.jsxs(L,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(Pe,{className:"h-6 w-6 text-blue-600"})}),e.jsx($,{className:"text-2xl font-bold",children:"Admin Access"}),e.jsx(oe,{children:"เข้าสู่ระบบสำหรับผู้ดูแลระบบ"})]}),e.jsxs(D,{children:[e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[p&&e.jsx(Q,{variant:"destructive",children:e.jsx(X,{children:p})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"email",children:"Email"}),e.jsx(ae,{id:"email",type:"email",value:s,onChange:j=>a(j.target.value),placeholder:"admin@vchomehospital.co.th",required:!0,disabled:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{id:"password",type:i?"text":"password",value:n,onChange:j=>r(j.target.value),placeholder:"รหัสผ่าน",required:!0,disabled:d}),e.jsx(k,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>o(!i),disabled:d,children:i?e.jsx(pr,{className:"h-4 w-4"}):e.jsx(xr,{className:"h-4 w-4"})})]})]}),e.jsx(k,{type:"submit",className:"w-full",disabled:d||!s||!n,children:d?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"h-4 w-4 animate-spin mr-2"}),"กำลังเข้าสู่ระบบ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"เข้าสู่ระบบ"]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Admin Access:"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Existing Users:"})," Use your regular login credentials"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Demo Admin:"})," admin@vchomehospital.co.th / admin123"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Super Admin:"})," superadmin@vchomehospital.co.th / superadmin123"]})]}),e.jsx("div",{className:"mt-2 text-xs text-blue-600",children:"💡 Admin access is granted to @vchomehospital.co.th emails"})]})]})]})})}function Da({children:t,requiredPermission:s,fallback:a,showLoginForm:n=!0}){const{user:r,isLoading:i,isAdmin:o,hasPermission:c,logout:d}=Di();return i?e.jsx(S,{children:e.jsx(D,{className:"py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Pe,{className:"h-8 w-8 animate-pulse text-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"กำลังตรวจสอบสิทธิ์..."})]})})}):o?s&&!c(s)?e.jsx(S,{children:e.jsx(D,{className:"py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Ns,{className:"h-12 w-12 text-orange-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-700",children:"Insufficient Permissions"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"คุณไม่มีสิทธิ์เข้าถึงฟีเจอร์นี้"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Required: ",s]})]})]})})}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:["Admin Mode: ",r==null?void 0:r.email]}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:r==null?void 0:r.role})]}),e.jsxs(k,{size:"sm",variant:"ghost",onClick:d,className:"text-blue-600 hover:text-blue-800",children:[e.jsx(ws,{className:"h-3 w-3 mr-1"}),"Logout"]})]})}),t]}):n?e.jsx(xm,{}):a||e.jsx(S,{children:e.jsx(D,{className:"py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Ns,{className:"h-12 w-12 text-red-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-700",children:"Access Restricted"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"คุณต้องเป็น Admin เพื่อเข้าถึงส่วนนี้"})]})]})})})}function fm(){const[t,s]=h.useState([]),[a,n]=h.useState(!0),[r,i]=h.useState(null),[o,c]=h.useState(!1),[d,p]=h.useState({vaccine_type:"",vaccine_name:"",total_doses:1}),{toast:u}=ce(),j=async()=>{try{const{data:f,error:N}=await O.from("vaccine_schedules").select("*").order("vaccine_name");if(N)throw N;s(f||[])}catch(f){console.error("Error loading vaccines:",f),u({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลวัคซีนได้",variant:"destructive"})}finally{n(!1)}},l=async()=>{if(!d.vaccine_type||!d.vaccine_name||d.total_doses<1){u({title:"ข้อมูลไม่ครบถ้วน",description:"กรุณากรอกข้อมูลให้ครบถ้วน",variant:"destructive"});return}try{if(r){const{error:f}=await O.from("vaccine_schedules").update({vaccine_type:d.vaccine_type,vaccine_name:d.vaccine_name,total_doses:d.total_doses,updated_at:new Date().toISOString()}).eq("id",r);if(f)throw f;u({title:"อัพเดตสำเร็จ",description:"อัพเดตข้อมูลวัคซีนแล้ว"})}else{const{error:f}=await O.from("vaccine_schedules").insert([{vaccine_type:d.vaccine_type,vaccine_name:d.vaccine_name,total_doses:d.total_doses,active:!0}]);if(f)throw f;u({title:"เพิ่มสำเร็จ",description:"เพิ่มวัคซีนใหม่แล้ว"})}p({vaccine_type:"",vaccine_name:"",total_doses:1}),i(null),c(!1),j()}catch(f){console.error("Error saving vaccine:",f),u({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถบันทึกข้อมูลได้",variant:"destructive"})}},m=f=>{p({vaccine_type:f.vaccine_type,vaccine_name:f.vaccine_name,total_doses:f.total_doses}),i(f.id),c(!0)},x=async(f,N)=>{try{const{error:_}=await O.from("vaccine_schedules").update({active:!N,updated_at:new Date().toISOString()}).eq("id",f);if(_)throw _;u({title:"อัพเดตสำเร็จ",description:`${N?"ปิดใช้งาน":"เปิดใช้งาน"}วัคซีนแล้ว`}),j()}catch(_){console.error("Error toggling vaccine status:",_),u({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถอัพเดตสถานะได้",variant:"destructive"})}},g=async(f,N)=>{if(confirm(`คุณต้องการลบวัคซีน "${N}" หรือไม่?`))try{const{error:_}=await O.from("vaccine_schedules").delete().eq("id",f);if(_)throw _;u({title:"ลบสำเร็จ",description:"ลบวัคซีนแล้ว"}),j()}catch(_){console.error("Error deleting vaccine:",_),u({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถลบวัคซีนได้",variant:"destructive"})}},v=()=>{p({vaccine_type:"",vaccine_name:"",total_doses:1}),i(null),c(!1)};return h.useEffect(()=>{j()},[]),e.jsx(Da,{requiredPermission:"vaccine:write",children:e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"การตั้งค่าวัคซีน"]}),e.jsx(oe,{children:"จัดการประเภทวัคซีนและจำนวนเข็มที่ต้องฉีด"})]}),e.jsxs(k,{onClick:()=>c(!0),disabled:o,children:[e.jsx(Oa,{className:"h-4 w-4 mr-2"}),"เพิ่มวัคซีน"]})]})}),e.jsxs(D,{children:[o&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{className:"mb-6",children:[e.jsx(L,{children:e.jsx($,{className:"text-lg",children:r?"แก้ไขวัคซีน":"เพิ่มวัคซีนใหม่"})}),e.jsxs(D,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"vaccine_type",children:"รหัสวัคซีน"}),e.jsx(ae,{id:"vaccine_type",value:d.vaccine_type,onChange:f=>p({...d,vaccine_type:f.target.value}),placeholder:"เช่น COVID19, INFLUENZA"})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"vaccine_name",children:"ชื่อวัคซีน"}),e.jsx(ae,{id:"vaccine_name",value:d.vaccine_name,onChange:f=>p({...d,vaccine_name:f.target.value}),placeholder:"เช่น วัคซีนโควิด-19"})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"total_doses",children:"จำนวนเข็ม"}),e.jsx(ae,{id:"total_doses",type:"number",min:"1",max:"10",value:d.total_doses,onChange:f=>p({...d,total_doses:parseInt(f.target.value)||1})})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(k,{onClick:l,children:[e.jsx(gr,{className:"h-4 w-4 mr-2"}),r?"อัพเดต":"บันทึก"]}),e.jsxs(k,{variant:"outline",onClick:v,children:[e.jsx(Is,{className:"h-4 w-4 mr-2"}),"ยกเลิก"]})]})]})]}),e.jsx(ge,{className:"mb-6"})]}),a?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(lt,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"กำลังโหลดข้อมูลวัคซีน..."})]}):e.jsxs("div",{className:"space-y-4",children:[t.map(f=>e.jsx(S,{children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Ce,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:f.vaccine_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["รหัส: ",f.vaccine_type," • ",f.total_doses," เข็ม"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:f.active?"default":"secondary",children:f.active?"ใช้งาน":"ปิดใช้งาน"}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>m(f),children:e.jsx(Fa,{className:"h-3 w-3"})}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>x(f.id,f.active),children:f.active?"ปิด":"เปิด"}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>g(f.id,f.vaccine_name),children:e.jsx(ys,{className:"h-3 w-3"})})]})]})})},f.id)),t.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ce,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"ยังไม่มีวัคซีนในระบบ"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:'คลิก "เพิ่มวัคซีน" เพื่อเริ่มต้น'})]})]})]})]})})}class gm extends B.Component{constructor(a){super(a);Me(this,"retry",()=>{this.setState({hasError:!1,error:null})});this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,n){console.error("Domain Management Error:",a,n)}render(){if(this.state.hasError&&this.state.error){const a=this.props.fallback;return e.jsx(a,{error:this.state.error,retry:this.retry})}return this.props.children}}function vm({error:t,retry:s}){return e.jsx(S,{children:e.jsx(D,{className:"py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Ae,{className:"h-12 w-12 text-red-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-700",children:"Domain Management Error"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Failed to load domain management: ",t.message]})]}),e.jsxs(k,{onClick:s,variant:"outline",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})})})}const Ci=()=>{const[t,s]=h.useState([]),[a,n]=h.useState(!1),[r,i]=h.useState(new Date().toISOString().split("T")[0]),[o,c]=h.useState([]),[d,p]=h.useState([]),[u,j]=h.useState(""),[l,m]=h.useState(null),[x,g]=h.useState("appointments"),[v,f]=h.useState({vaccineType:"",doseNumber:"1",notes:""}),{toast:N}=ce(),_=async y=>{n(!0);try{const{data:R,error:J}=await O.from("appointments").select("*").eq("appointment_date",y).order("appointment_time",{ascending:!0});if(J)throw J;s(R||[])}catch(R){console.error("Error loading appointments:",R),N({title:"เกิดข้อผิดพลาด",description:`ไม่สามารถโหลดข้อมูลนัดหมายวันที่ ${new Date(y).toLocaleDateString("th-TH")} ได้`,variant:"destructive"})}finally{n(!1)}},A=()=>_(r),E=async()=>{try{const{data:y,error:R}=await O.from("vaccine_schedules").select("id, vaccine_type, vaccine_name, total_doses").eq("active",!0).order("vaccine_name");if(R)throw R;c(y||[])}catch(y){console.error("Error loading vaccine options:",y),N({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลวัคซีนได้",variant:"destructive"})}},V=async()=>{try{const{data:y,error:R}=await O.from("patient_registrations").select("*").order("created_at",{ascending:!1});if(R)throw R;console.log("Patient registrations loaded:",(y==null?void 0:y.length)||0,"records"),console.log("Sample data:",y==null?void 0:y.slice(0,3)),p(y||[])}catch(y){console.error("Error loading patient registrations:",y),N({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลผู้ป่วยได้",variant:"destructive"})}},Y=async(y,R)=>{try{const{error:J}=await O.from("appointments").update({status:R,updated_at:new Date().toISOString()}).eq("appointment_id",y);if(J)throw J;N({title:"อัปเดตสำเร็จ",description:`อัปเดตสถานะนัดหมายเป็น ${W(R)} แล้ว`}),A()}catch(J){console.error("Error updating appointment:",J),N({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถอัปเดตสถานะได้",variant:"destructive"})}},P=async()=>{if(!l||!v.vaccineType||!v.doseNumber){N({title:"ข้อมูลไม่ครบถ้วน",description:"กรุณาเลือกผู้ป่วย ประเภทวัคซีน และโดสที่ฉีด",variant:"destructive"});return}const y=o.find(J=>J.vaccine_type===v.vaccineType),R=parseInt(v.doseNumber);if(y&&R>y.total_doses){N({title:"โดสไม่ถูกต้อง",description:`วัคซีน ${y.vaccine_name} มีเพียง ${y.total_doses} เข็ม`,variant:"destructive"});return}try{const J=new Date().toISOString().split("T")[0],te=new Date().toTimeString().slice(0,5),ne=v.doseNumber==="1"?"เข็มที่ 1":v.doseNumber==="2"?"เข็มที่ 2":v.doseNumber==="3"?"เข็มที่ 3":`เข็มที่ ${v.doseNumber}`,ve={patient_name:l.full_name,patient_phone:l.phone,patient_id_number:l.registration_id,line_user_id:l.line_user_id,vaccine_type:v.vaccineType,appointment_date:J,appointment_time:te,status:"completed",scheduled_by:"walk_in",notes:`ฉีดวัคซีน Walk-in ${ne} (${y==null?void 0:y.vaccine_name}) วันนี้${v.notes?" - "+v.notes:""}`},{error:pe}=await O.from("appointments").insert([ve]);if(pe)throw pe;N({title:"บันทึกสำเร็จ",description:`บันทึกการฉีดวัคซีน ${y==null?void 0:y.vaccine_name} ${ne} ของ ${l.full_name} แล้ว`}),m(null),j(""),f({vaccineType:"",doseNumber:"1",notes:""}),A()}catch(J){console.error("Error creating walk-in vaccination:",J),N({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถบันทึกการฉีดวัคซีนได้",variant:"destructive"})}};h.useEffect(()=>{_(r),E(),V()},[r]);const T=y=>{i(y)},W=y=>{switch(y){case"scheduled":return"นัดหมาย";case"completed":return"เสร็จสิ้น";case"cancelled":return"ยกเลิก";case"no_show":return"ไม่มา";default:return y}},b=y=>{switch(y){case"scheduled":return"bg-blue-100 text-blue-800 border-blue-200";case"completed":return"bg-green-100 text-green-800 border-green-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"no_show":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},w=y=>{switch(y){case"scheduled":return e.jsx(De,{className:"h-4 w-4"});case"completed":return e.jsx(G,{className:"h-4 w-4"});case"cancelled":return e.jsx(Ae,{className:"h-4 w-4"});case"no_show":return e.jsx(Ae,{className:"h-4 w-4"});default:return e.jsx(De,{className:"h-4 w-4"})}},M=t.filter(y=>y.status==="completed").length,I=t.filter(y=>y.status==="scheduled").length,F=t.length,z=r===new Date().toISOString().split("T")[0],C=z?"วันนี้":new Date(r).toLocaleDateString("th-TH");return e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(el,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Staff Portal"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"จัดการระบบโรงพยาบาลวัคซีน"})]})]})}),e.jsxs(Ue,{value:x,onValueChange:g,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-3 lg:w-auto lg:grid-cols-3",children:[e.jsxs(Z,{value:"appointments",className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"นัดหมายและการฉีด"}),e.jsx("span",{className:"sm:hidden",children:"นัดหมาย"})]}),e.jsxs(Z,{value:"domains",className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"จัดการโดเมน"}),e.jsx("span",{className:"sm:hidden",children:"โดเมน"})]}),e.jsxs(Z,{value:"settings",className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"ตั้งค่าระบบ"}),e.jsx("span",{className:"sm:hidden",children:"ตั้งค่า"})]})]}),e.jsxs(ee,{value:"appointments",className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{htmlFor:"date-picker",className:"text-sm font-medium",children:"เลือกวันที่:"}),e.jsx(ae,{id:"date-picker",type:"date",value:r,onChange:y=>T(y.target.value),className:"w-40"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{onClick:()=>T(new Date().toISOString().split("T")[0]),variant:"outline",size:"sm",disabled:z,children:"วันนี้"}),e.jsx(k,{onClick:()=>{const y=new Date;y.setDate(y.getDate()+1),T(y.toISOString().split("T")[0])},variant:"outline",size:"sm",children:"พรุ่งนี้"}),e.jsxs(k,{onClick:A,disabled:a,variant:"outline",size:"sm",children:[e.jsx(Se,{className:`h-4 w-4 mr-2 ${a?"animate-spin":""}`}),"รีเฟรช"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(S,{children:e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(be,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["นัดหมาย",C]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:F})]})]})})}),e.jsx(S,{children:e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(G,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"ฉีดแล้ว"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:M})]})]})})}),e.jsx(S,{children:e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(De,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"รอฉีด"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:I})]})]})})}),e.jsx(S,{children:e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ua,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"อัตราสำเร็จ"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[F>0?Math.round(M/F*100):0,"%"]})]})]})})})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"h-5 w-5"}),"บันทึกการฉีดวัคซีน Walk-in"]})}),e.jsxs(D,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"patientSearch",children:"ค้นหาผู้ป่วยที่ลงทะเบียนแล้ว *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{id:"patientSearch",value:u,onChange:y=>j(y.target.value),placeholder:"กรอกชื่อ หรือเบอร์โทรศัพท์เพื่อค้นหา",className:"pr-10"}),u&&e.jsxs("div",{className:"absolute top-full left-0 right-0 z-50 bg-background border rounded-b-md shadow-lg max-h-60 overflow-y-auto",children:[d.filter(y=>y.full_name.toLowerCase().includes(u.toLowerCase())||y.phone.includes(u)||y.registration_id.includes(u)).slice(0,10).map(y=>e.jsxs("div",{className:"p-3 hover:bg-muted cursor-pointer border-b last:border-b-0 transition-colors",onClick:()=>{m(y),j("")},children:[e.jsx("div",{className:"font-medium text-foreground",children:y.full_name}),e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center justify-between",children:[e.jsxs("span",{children:["โทร: ",y.phone]}),e.jsxs("span",{className:"text-xs",children:["ID: ",y.registration_id]})]})]},y.id)),d.filter(y=>y.full_name.toLowerCase().includes(u.toLowerCase())||y.phone.includes(u)||y.registration_id.includes(u)).length===0&&e.jsx("div",{className:"p-3 text-center text-muted-foreground",children:"ไม่พบผู้ป่วยที่ตรงกับการค้นหา"})]})]})]}),l&&e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:l.full_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:l.phone}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",l.registration_id]})]}),e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>m(null),children:e.jsx(Ae,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"vaccineType",children:"ประเภทวัคซีน *"}),e.jsxs(ct,{value:v.vaccineType,onValueChange:y=>f({...v,vaccineType:y,doseNumber:"1"}),children:[e.jsx(et,{children:e.jsx(dt,{placeholder:"เลือกประเภทวัคซีน"})}),e.jsx(tt,{children:o.filter(y=>y.vaccine_type&&y.vaccine_type.trim()!=="").map(y=>e.jsx(_e,{value:y.vaccine_type,children:y.vaccine_name},y.id))})]})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"doseNumber",children:"โดสที่มาฉีด *"}),e.jsxs(ct,{value:v.doseNumber,onValueChange:y=>f({...v,doseNumber:y}),disabled:!v.vaccineType,children:[e.jsx(et,{children:e.jsx(dt,{placeholder:v.vaccineType?"เลือกโดสที่ฉีด":"เลือกวัคซีนก่อน"})}),e.jsx(tt,{children:v.vaccineType&&(()=>{const y=o.find(q=>q.vaccine_type===v.vaccineType),R=(y==null?void 0:y.total_doses)||1,J=[];for(let q=1;q<=R;q++){let te=`เข็มที่ ${q}`;q===1?te+=" (เข็มแรก)":q===R&&R>2?te+=" (เข็มสุดท้าย)":q>2&&(te+=" (เข็มเสริม)"),J.push(e.jsx(_e,{value:q.toString(),children:te},q))}return J})()})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:v.vaccineType?(()=>{const y=o.find(R=>R.vaccine_type===v.vaccineType);return`วัคซีนนี้มี ${(y==null?void 0:y.total_doses)||1} เข็ม - เลือกโดสที่คนไข้มาฉีดครั้งนี้`})():"กรุณาเลือกประเภทวัคซีนก่อน"})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"notes",children:"หมายเหตุ"}),e.jsx(ae,{id:"notes",value:v.notes,onChange:y=>f({...v,notes:y.target.value}),placeholder:"หมายเหตุเพิ่มเติม"})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(k,{onClick:P,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"บันทึกการฉีดวัคซีน"]})})]})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"นัดหมาย",C]}),e.jsxs(H,{variant:"secondary",children:[t.length," รายการ"]})]})}),e.jsxs(D,{children:[e.jsx("div",{className:"space-y-4",children:t.map(y=>e.jsx("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:y.patient_name}),e.jsxs(H,{className:b(y.status),children:[w(y.status),e.jsx("span",{className:"ml-1",children:W(y.status)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),y.vaccine_type]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),y.appointment_time||"ไม่ระบุเวลา"]}),y.patient_phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"📞"}),y.patient_phone]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"🆔"}),y.appointment_id]})]}),y.notes&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground bg-muted/50 p-2 rounded",children:y.notes})]}),e.jsx("div",{className:"flex gap-2 w-full sm:w-auto",children:y.status==="scheduled"&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{size:"sm",onClick:()=>Y(y.appointment_id,"completed"),className:"bg-green-600 hover:bg-green-700 flex-1 sm:flex-none",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"ฉีดแล้ว"]}),e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>Y(y.appointment_id,"no_show"),className:"flex-1 sm:flex-none",children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"ไม่มา"]})]})})]})},y.id))}),t.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(be,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsxs("p",{className:"text-muted-foreground",children:["ไม่มีนัดหมายใน",C]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:z?"ใช้ฟอร์มด้านบนสำหรับบันทึกการฉีดวัคซีน Walk-in":"เลือกวันที่อื่นเพื่อดูนัดหมาย"})]})]})]})]}),e.jsx(ee,{value:"domains",className:"space-y-6 mt-6",children:e.jsx(Da,{requiredPermission:"domain:read",showLoginForm:!1,fallback:e.jsx(S,{children:e.jsx(D,{className:"py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Ns,{className:"h-12 w-12 text-orange-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-700",children:"Admin Access Required"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"การจัดการโดเมนต้องใช้สิทธิ์ Admin เท่านั้น"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"กรุณาติดต่อผู้ดูแลระบบเพื่อขอสิทธิ์เข้าถึง"})]})]})})}),children:e.jsxs(gm,{fallback:vm,children:[e.jsx(um,{className:"mb-6"}),e.jsx(lm,{})]})})}),e.jsx(ee,{value:"settings",className:"space-y-6 mt-6",children:e.jsx(Da,{requiredPermission:"system:settings",showLoginForm:!1,fallback:e.jsx(S,{children:e.jsx(D,{className:"py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Ns,{className:"h-12 w-12 text-orange-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-700",children:"Admin Access Required"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"การตั้งค่าระบบต้องใช้สิทธิ์ Admin เท่านั้น"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"กรุณาติดต่อผู้ดูแลระบบเพื่อขอสิทธิ์เข้าถึง"})]})]})})}),children:e.jsx(fm,{})})})]})]})},ki=()=>{const[t,s]=h.useState([]),[a,n]=h.useState(!1),[r,i]=h.useState({patientId:"",patientName:"",date:"",time:"",vaccine:"",hospital:"โรงพยาบาลโฮม",notes:"",notificationDate:""}),{toast:o}=ce(),c=async()=>{n(!0);try{const{data:m,error:x}=await O.from("patient_registrations").select("id, full_name, phone, line_user_id, registration_id, created_at").order("created_at",{ascending:!1});if(x)throw x;const g=(m==null?void 0:m.map(v=>({id:v.registration_id||v.id,name:v.full_name,phone:v.phone,lineId:v.line_user_id,createdAt:v.created_at})))||[];s(g),o({title:"โหลดข้อมูลสำเร็จ",description:`โหลดข้อมูลผู้ป่วย ${g.length} คน จาก Supabase`})}catch(m){o({title:"ข้อผิดพลาด",description:m.message||"ไม่สามารถโหลดข้อมูลได้",variant:"destructive"})}finally{n(!1)}},d=async()=>{if(t.length===0){o({title:"ไม่มีข้อมูล",description:"กรุณาโหลดข้อมูลผู้ป่วยก่อน",variant:"destructive"});return}n(!0);try{const{data:m,error:x}=await O.functions.invoke("google-sheets-integration",{body:{action:"syncPatients",data:t}});if(x)throw x;o({title:"Sync สำเร็จ",description:`Sync ข้อมูลผู้ป่วย ${t.length} คน ไป Google Sheets แล้ว`})}catch(m){o({title:"Sync ไม่สำเร็จ",description:m.message||"ไม่สามารถ sync ข้อมูลได้",variant:"destructive"})}finally{n(!1)}},p=async()=>{if(!r.patientId||!r.date||!r.time||!r.vaccine){o({title:"ข้อผิดพลาด",description:"กรุณากรอกข้อมูลให้ครบถ้วน",variant:"destructive"});return}n(!0);try{const m=t.find(v=>v.id===r.patientId);if(!m)throw new Error("ไม่พบข้อมูลผู้ป่วย");const x={patient_name:m.name,patient_phone:m.phone,patient_id_number:r.patientId,line_user_id:m.lineId,vaccine_type:r.vaccine,appointment_date:r.date,appointment_time:r.time,status:"scheduled",notes:r.notes||`นัดหมายจาก ${r.hospital}`,scheduled_by:"staff_manual"},{error:g}=await O.from("appointments").insert([x]);if(g)throw g;try{await O.functions.invoke("google-sheets-integration",{body:{action:"saveAppointment",data:{...r,patientName:m.name,patientPhone:m.phone,lineId:m.lineId,timestamp:new Date().toISOString()}}}),console.log("✅ Synced to Google Sheets successfully")}catch(v){console.warn("⚠️ Failed to sync to Google Sheets:",v)}o({title:"บันทึกสำเร็จ",description:`บันทึกการนัดหมายของ ${m.name} เรียบร้อยแล้ว (พร้อม sync ข้อมูลสำรอง)`}),i({patientId:"",patientName:"",date:"",time:"",vaccine:"",hospital:"โรงพยาบาลโฮม",notes:"",notificationDate:""})}catch(m){o({title:"ข้อผิดพลาด",description:m.message||"ไม่สามารถบันทึกได้",variant:"destructive"})}finally{n(!1)}},u=async()=>{if(!r.patientId||!r.date){o({title:"ข้อผิดพลาด",description:"กรุณากรอกข้อมูลผู้ป่วยและวันที่นัดก่อน",variant:"destructive"});return}n(!0);try{const m=t.find(v=>v.id===r.patientId);if(!m||!m.lineId)throw new Error("ไม่พบ LINE ID ของผู้ป่วย");const x=`🔔 แจ้งเตือนการนัดหมายฉีดวัคซีน

สวัสดีคุณ ${m.name}

📅 วันที่: ${r.date}
⏰ เวลา: ${r.time}
💉 วัคซีน: ${r.vaccine}
🏥 สถานที่: ${r.hospital}

${r.notes?`📝 หมายเหตุ: ${r.notes}`:""}

กรุณามาตามเวลานัดหมาย`,{error:g}=await O.functions.invoke("send-line-message",{body:{userId:m.lineId,message:x}});if(g)throw g;o({title:"ส่งการแจ้งเตือนสำเร็จ",description:`ส่งข้อความแจ้งเตือนไปยัง ${m.name} แล้ว`})}catch(m){o({title:"ข้อผิดพลาด",description:m.message||"ไม่สามารถตั้งค่าการแจ้งเตือนได้",variant:"destructive"})}finally{n(!1)}},j=m=>{const x=t.find(g=>g.id===m);x&&i(g=>({...g,patientId:m,patientName:x.name}))},l=async()=>{n(!0);try{const{data:m,error:x}=await O.from("appointments").select("*").order("created_at",{ascending:!1}).limit(100);if(x)throw x;if(!m||m.length===0){o({title:"ไม่มีข้อมูล",description:"ไม่พบข้อมูลนัดหมายที่จะ sync",variant:"destructive"});return}const{error:g}=await O.functions.invoke("google-sheets-integration",{body:{action:"syncAppointments",data:m}});if(g)throw g;o({title:"Sync สำเร็จ",description:`Sync ข้อมูลนัดหมาย ${m.length} รายการ ไป Google Sheets แล้ว`})}catch(m){o({title:"Sync ไม่สำเร็จ",description:m.message||"ไม่สามารถ sync ข้อมูลนัดหมายได้",variant:"destructive"})}finally{n(!1)}};return h.useEffect(()=>{c()},[]),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs(S,{children:[e.jsx(L,{className:"pb-3 md:pb-4",children:e.jsxs($,{className:"flex items-center gap-2 text-lg md:text-xl",children:[e.jsx(Oe,{className:"h-5 w-5 text-primary"}),"ข้อมูลผู้ป่วยจาก Supabase"]})}),e.jsxs(D,{className:"space-y-4 p-4 md:p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs(k,{onClick:c,disabled:a,className:"h-10 md:h-11",children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),a?"กำลังโหลด...":"โหลดข้อมูลผู้ป่วย"]}),e.jsxs(k,{onClick:d,disabled:a||t.length===0,variant:"outline",className:"h-10 md:h-11",children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),a?"กำลัง Sync...":"Sync ไป Google Sheets"]})]}),e.jsxs(Q,{children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"ระบบ Dual Backup:"})," ข้อมูลจะถูกบันทึกใน Supabase (หลัก) และ sync ไป Google Sheets (สำรอง) เพื่อความปลอดภัยและการเข้าถึงที่สะดวก"]})]}),t.length>0&&e.jsxs("div",{className:"bg-muted/50 p-3 md:p-4 rounded-lg border",children:[e.jsxs("p",{className:"text-sm md:text-base font-medium mb-3",children:["ผู้ป่วยทั้งหมด: ",t.length," คน"]}),e.jsx("div",{className:"max-h-32 md:max-h-40 overflow-y-auto space-y-2",children:t.map(m=>e.jsxs("div",{className:"text-xs md:text-sm bg-background p-2 md:p-3 rounded border border-border/30",children:[e.jsx("div",{className:"font-medium",children:m.name}),e.jsx("div",{className:"text-muted-foreground",children:m.phone})]},m.id))})]})]})]}),e.jsxs(S,{children:[e.jsx(L,{className:"pb-3 md:pb-4",children:e.jsxs($,{className:"flex items-center gap-2 text-lg md:text-xl",children:[e.jsx(be,{className:"h-5 w-5 text-primary"}),"บันทึกการนัดหมาย"]})}),e.jsxs(D,{className:"space-y-4 p-4 md:p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"patient",className:"text-sm md:text-base font-medium",children:"เลือกผู้ป่วย"}),e.jsxs(ct,{value:r.patientId,onValueChange:j,children:[e.jsx(et,{className:"mt-1",children:e.jsx(dt,{placeholder:"เลือกผู้ป่วย"})}),e.jsx(tt,{children:t.filter(m=>m.id&&m.id.trim()!=="").map(m=>e.jsxs(_e,{value:m.id,children:[m.name," - ",m.phone]},m.id))})]})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"vaccine",className:"text-sm md:text-base font-medium",children:"ประเภทวัคซีน"}),e.jsxs(ct,{value:r.vaccine,onValueChange:m=>i(x=>({...x,vaccine:m})),children:[e.jsx(et,{className:"mt-1",children:e.jsx(dt,{placeholder:"เลือกประเภทวัคซีน"})}),e.jsxs(tt,{children:[e.jsx(_e,{value:"COVID-19",children:"COVID-19"}),e.jsx(_e,{value:"ไข้หวัดใหญ่",children:"ไข้หวัดใหญ่"}),e.jsx(_e,{value:"โควิด + ไข้หวัดใหญ่",children:"โควิด + ไข้หวัดใหญ่"}),e.jsx(_e,{value:"HPV",children:"HPV"}),e.jsx(_e,{value:"MMR",children:"MMR"})]})]})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"date",className:"text-sm md:text-base font-medium",children:"วันที่นัด"}),e.jsx(ae,{id:"date",type:"date",value:r.date,onChange:m=>i(x=>({...x,date:m.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"time",className:"text-sm md:text-base font-medium",children:"เวลา"}),e.jsx(ae,{id:"time",type:"time",value:r.time,onChange:m=>i(x=>({...x,time:m.target.value})),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"notes",className:"text-sm md:text-base font-medium",children:"หมายเหตุ"}),e.jsx(zt,{id:"notes",placeholder:"หมายเหตุเพิ่มเติม",value:r.notes,onChange:m=>i(x=>({...x,notes:m.target.value})),className:"mt-1 min-h-[80px] md:min-h-[100px]"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs(k,{onClick:p,disabled:a,className:"h-10 md:h-11",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),a?"กำลังบันทึก...":"บันทึกการนัดหมาย"]}),e.jsxs(k,{onClick:l,disabled:a,variant:"outline",className:"h-10 md:h-11",children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),a?"กำลัง Sync...":"Sync นัดหมายทั้งหมด"]})]})]})]}),e.jsxs(S,{children:[e.jsx(L,{className:"pb-3 md:pb-4",children:e.jsxs($,{className:"flex items-center gap-2 text-lg md:text-xl",children:[e.jsx($e,{className:"h-5 w-5 text-primary"}),"ส่งการแจ้งเตือน"]})}),e.jsxs(D,{className:"space-y-4 p-4 md:p-6",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"notificationDate",className:"text-sm md:text-base font-medium",children:"วันที่ต้องการแจ้งเตือน"}),e.jsx(ae,{id:"notificationDate",type:"date",value:r.notificationDate,onChange:m=>i(x=>({...x,notificationDate:m.target.value})),className:"mt-1"})]}),e.jsxs(Q,{children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx(X,{className:"text-sm md:text-base",children:"ระบบจะแจ้งเตือนผู้ป่วยผ่าน LINE ในวันที่กำหนด เพื่อเตือนเรื่องการนัดหมายฉีดวัคซีน"})]}),e.jsxs(k,{onClick:u,disabled:a,className:"w-full h-10 md:h-11",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),a?"กำลังส่ง...":"ส่งการแจ้งเตือนทันที"]})]})]})]})},jm=()=>e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs(Ue,{defaultValue:"designer",className:"w-full",children:[e.jsx("div",{className:"container mx-auto pt-6",children:e.jsxs(ze,{className:"grid w-full grid-cols-10 max-w-7xl mx-auto",children:[e.jsx(Z,{value:"setup",children:"คู่มือติดตั้ง"}),e.jsx(Z,{value:"designer",children:"Workflow Designer"}),e.jsx(Z,{value:"analyzer",children:"Analyzer"}),e.jsx(Z,{value:"LineBot",children:"LINE Bot"}),e.jsx(Z,{value:"PatientPortal",children:"ลงทะเบียนผู้ป่วย"}),e.jsx(Z,{value:"StaffPortal",children:"เจ้าหน้าที่"}),e.jsx(Z,{value:"googlesheets",children:"Google Sheets"}),e.jsx(Z,{value:"staff",children:"Dashboard เดิม"}),e.jsx(Z,{value:"patient",children:"LINE เดิม"}),e.jsx(Z,{value:"troubleshooting",children:"แก้ไขปัญหา"})]})}),e.jsx(ee,{value:"designer",className:"mt-0",children:e.jsx(bd,{})}),e.jsx(ee,{value:"analyzer",className:"mt-0",children:e.jsx(jd,{})}),e.jsx(ee,{value:"staff",className:"mt-0",children:e.jsx(Sd,{})}),e.jsx(ee,{value:"patient",className:"mt-0",children:e.jsx(Dd,{})}),e.jsx(ee,{value:"setup",className:"mt-0",children:e.jsx(Cd,{})}),e.jsx(ee,{value:"LineBot",className:"mt-0",children:e.jsx(mi,{})}),e.jsx(ee,{value:"PatientPortal",className:"mt-0",children:e.jsx(ui,{})}),e.jsx(ee,{value:"StaffPortal",className:"mt-0",children:e.jsx(Ci,{})}),e.jsx(ee,{value:"googlesheets",className:"mt-0",children:e.jsx(ki,{})}),e.jsx(ee,{value:"troubleshooting",className:"mt-0",children:e.jsx(kd,{})})]})}),bm=()=>{const t=dr();return h.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},Pn=()=>e.jsx(mi,{}),Mn=()=>e.jsx(ui,{});function le(t){const s=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&s==="[object Date]"?new t.constructor(+t):typeof t=="number"||s==="[object Number]"||typeof t=="string"||s==="[object String]"?new Date(t):new Date(NaN)}function Fe(t,s){return t instanceof Date?new t.constructor(s):new Date(s)}function Ne(t,s){const a=le(t);return isNaN(s)?Fe(t,NaN):(s&&a.setDate(a.getDate()+s),a)}function qe(t,s){const a=le(t);if(isNaN(s))return Fe(t,NaN);if(!s)return a;const n=a.getDate(),r=Fe(t,a.getTime());r.setMonth(a.getMonth()+s+1,0);const i=r.getDate();return n>=i?r:(a.setFullYear(r.getFullYear(),r.getMonth(),n),a)}const Ja=6048e5,ym=864e5,Ei=6e4,Ai=36e5;let Nm={};function ss(){return Nm}function st(t,s){var c,d,p,u;const a=ss(),n=(s==null?void 0:s.weekStartsOn)??((d=(c=s==null?void 0:s.locale)==null?void 0:c.options)==null?void 0:d.weekStartsOn)??a.weekStartsOn??((u=(p=a.locale)==null?void 0:p.options)==null?void 0:u.weekStartsOn)??0,r=le(t),i=r.getDay(),o=(i<n?7:0)+i-n;return r.setDate(r.getDate()-o),r.setHours(0,0,0,0),r}function Nt(t){return st(t,{weekStartsOn:1})}function Ti(t){const s=le(t),a=s.getFullYear(),n=Fe(t,0);n.setFullYear(a+1,0,4),n.setHours(0,0,0,0);const r=Nt(n),i=Fe(t,0);i.setFullYear(a,0,4),i.setHours(0,0,0,0);const o=Nt(i);return s.getTime()>=r.getTime()?a+1:s.getTime()>=o.getTime()?a:a-1}function $t(t){const s=le(t);return s.setHours(0,0,0,0),s}function Ds(t){const s=le(t),a=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return a.setUTCFullYear(s.getFullYear()),+t-+a}function He(t,s){const a=$t(t),n=$t(s),r=+a-Ds(a),i=+n-Ds(n);return Math.round((r-i)/ym)}function wm(t){const s=Ti(t),a=Fe(t,0);return a.setFullYear(s,0,4),a.setHours(0,0,0,0),Nt(a)}function Ca(t,s){const a=s*7;return Ne(t,a)}function _m(t,s){return qe(t,s*12)}function Sm(t){let s;return t.forEach(function(a){const n=le(a);(s===void 0||s<n||isNaN(Number(n)))&&(s=n)}),s||new Date(NaN)}function Dm(t){let s;return t.forEach(a=>{const n=le(a);(!s||s>n||isNaN(+n))&&(s=n)}),s||new Date(NaN)}function Te(t,s){const a=$t(t),n=$t(s);return+a==+n}function Qa(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Cm(t){if(!Qa(t)&&typeof t!="number")return!1;const s=le(t);return!isNaN(Number(s))}function es(t,s){const a=le(t),n=le(s),r=a.getFullYear()-n.getFullYear(),i=a.getMonth()-n.getMonth();return r*12+i}function km(t,s,a){const n=st(t,a),r=st(s,a),i=+n-Ds(n),o=+r-Ds(r);return Math.round((i-o)/Ja)}function ta(t,s){const a=le(t),n=le(s),r=Rn(a,n),i=Math.abs(He(a,n));a.setDate(a.getDate()-r*i);const o=+(Rn(a,n)===-r),c=r*(i-o);return c===0?0:c}function Rn(t,s){const a=t.getFullYear()-s.getFullYear()||t.getMonth()-s.getMonth()||t.getDate()-s.getDate()||t.getHours()-s.getHours()||t.getMinutes()-s.getMinutes()||t.getSeconds()-s.getSeconds()||t.getMilliseconds()-s.getMilliseconds();return a<0?-1:a>0?1:a}function Xa(t){const s=le(t),a=s.getMonth();return s.setFullYear(s.getFullYear(),a+1,0),s.setHours(23,59,59,999),s}function Ie(t){const s=le(t);return s.setDate(1),s.setHours(0,0,0,0),s}function Ii(t){const s=le(t),a=Fe(t,0);return a.setFullYear(s.getFullYear(),0,1),a.setHours(0,0,0,0),a}function Za(t,s){var c,d,p,u;const a=ss(),n=(s==null?void 0:s.weekStartsOn)??((d=(c=s==null?void 0:s.locale)==null?void 0:c.options)==null?void 0:d.weekStartsOn)??a.weekStartsOn??((u=(p=a.locale)==null?void 0:p.options)==null?void 0:u.weekStartsOn)??0,r=le(t),i=r.getDay(),o=(i<n?-7:0)+6-(i-n);return r.setDate(r.getDate()+o),r.setHours(23,59,59,999),r}function Pi(t){return Za(t,{weekStartsOn:1})}const Em={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Am=(t,s,a)=>{let n;const r=Em[t];return typeof r=="string"?n=r:s===1?n=r.one:n=r.other.replace("{{count}}",s.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+n:n+" ago":n};function It(t){return(s={})=>{const a=s.width?String(s.width):t.defaultWidth;return t.formats[a]||t.formats[t.defaultWidth]}}const Tm={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Im={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Pm={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Mm={date:It({formats:Tm,defaultWidth:"full"}),time:It({formats:Im,defaultWidth:"full"}),dateTime:It({formats:Pm,defaultWidth:"full"})},Rm={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Lm=(t,s,a,n)=>Rm[t];function Je(t){return(s,a)=>{const n=a!=null&&a.context?String(a.context):"standalone";let r;if(n==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,c=a!=null&&a.width?String(a.width):o;r=t.formattingValues[c]||t.formattingValues[o]}else{const o=t.defaultWidth,c=a!=null&&a.width?String(a.width):t.defaultWidth;r=t.values[c]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(s):s;return r[i]}}const $m={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Om={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Fm={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Vm={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},zm={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Wm={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Bm=(t,s)=>{const a=Number(t),n=a%100;if(n>20||n<10)switch(n%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},Um={ordinalNumber:Bm,era:Je({values:$m,defaultWidth:"wide"}),quarter:Je({values:Om,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Je({values:Fm,defaultWidth:"wide"}),day:Je({values:Vm,defaultWidth:"wide"}),dayPeriod:Je({values:zm,defaultWidth:"wide",formattingValues:Wm,defaultFormattingWidth:"wide"})};function Qe(t){return(s,a={})=>{const n=a.width,r=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth],i=s.match(r);if(!i)return null;const o=i[0],c=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth],d=Array.isArray(c)?qm(c,j=>j.test(o)):Hm(c,j=>j.test(o));let p;p=t.valueCallback?t.valueCallback(d):d,p=a.valueCallback?a.valueCallback(p):p;const u=s.slice(o.length);return{value:p,rest:u}}}function Hm(t,s){for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a)&&s(t[a]))return a}function qm(t,s){for(let a=0;a<t.length;a++)if(s(t[a]))return a}function Mi(t){return(s,a={})=>{const n=s.match(t.matchPattern);if(!n)return null;const r=n[0],i=s.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=a.valueCallback?a.valueCallback(o):o;const c=s.slice(r.length);return{value:o,rest:c}}}const Gm=/^(\d+)(th|st|nd|rd)?/i,Ym=/\d+/i,Km={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Jm={any:[/^b/i,/^(a|c)/i]},Qm={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Xm={any:[/1/i,/2/i,/3/i,/4/i]},Zm={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},eu={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},tu={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},su={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},au={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},nu={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ru={ordinalNumber:Mi({matchPattern:Gm,parsePattern:Ym,valueCallback:t=>parseInt(t,10)}),era:Qe({matchPatterns:Km,defaultMatchWidth:"wide",parsePatterns:Jm,defaultParseWidth:"any"}),quarter:Qe({matchPatterns:Qm,defaultMatchWidth:"wide",parsePatterns:Xm,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Qe({matchPatterns:Zm,defaultMatchWidth:"wide",parsePatterns:eu,defaultParseWidth:"any"}),day:Qe({matchPatterns:tu,defaultMatchWidth:"wide",parsePatterns:su,defaultParseWidth:"any"}),dayPeriod:Qe({matchPatterns:au,defaultMatchWidth:"any",parsePatterns:nu,defaultParseWidth:"any"})},Ri={code:"en-US",formatDistance:Am,formatLong:Mm,formatRelative:Lm,localize:Um,match:ru,options:{weekStartsOn:0,firstWeekContainsDate:1}};function iu(t){const s=le(t);return He(s,Ii(s))+1}function Li(t){const s=le(t),a=+Nt(s)-+wm(s);return Math.round(a/Ja)+1}function $i(t,s){var u,j,l,m;const a=le(t),n=a.getFullYear(),r=ss(),i=(s==null?void 0:s.firstWeekContainsDate)??((j=(u=s==null?void 0:s.locale)==null?void 0:u.options)==null?void 0:j.firstWeekContainsDate)??r.firstWeekContainsDate??((m=(l=r.locale)==null?void 0:l.options)==null?void 0:m.firstWeekContainsDate)??1,o=Fe(t,0);o.setFullYear(n+1,0,i),o.setHours(0,0,0,0);const c=st(o,s),d=Fe(t,0);d.setFullYear(n,0,i),d.setHours(0,0,0,0);const p=st(d,s);return a.getTime()>=c.getTime()?n+1:a.getTime()>=p.getTime()?n:n-1}function ou(t,s){var c,d,p,u;const a=ss(),n=(s==null?void 0:s.firstWeekContainsDate)??((d=(c=s==null?void 0:s.locale)==null?void 0:c.options)==null?void 0:d.firstWeekContainsDate)??a.firstWeekContainsDate??((u=(p=a.locale)==null?void 0:p.options)==null?void 0:u.firstWeekContainsDate)??1,r=$i(t,s),i=Fe(t,0);return i.setFullYear(r,0,n),i.setHours(0,0,0,0),st(i,s)}function Oi(t,s){const a=le(t),n=+st(a,s)-+ou(a,s);return Math.round(n/Ja)+1}function me(t,s){const a=t<0?"-":"",n=Math.abs(t).toString().padStart(s,"0");return a+n}const xt={y(t,s){const a=t.getFullYear(),n=a>0?a:1-a;return me(s==="yy"?n%100:n,s.length)},M(t,s){const a=t.getMonth();return s==="M"?String(a+1):me(a+1,2)},d(t,s){return me(t.getDate(),s.length)},a(t,s){const a=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(t,s){return me(t.getHours()%12||12,s.length)},H(t,s){return me(t.getHours(),s.length)},m(t,s){return me(t.getMinutes(),s.length)},s(t,s){return me(t.getSeconds(),s.length)},S(t,s){const a=s.length,n=t.getMilliseconds(),r=Math.trunc(n*Math.pow(10,a-3));return me(r,s.length)}},Et={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ln={G:function(t,s,a){const n=t.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return a.era(n,{width:"abbreviated"});case"GGGGG":return a.era(n,{width:"narrow"});case"GGGG":default:return a.era(n,{width:"wide"})}},y:function(t,s,a){if(s==="yo"){const n=t.getFullYear(),r=n>0?n:1-n;return a.ordinalNumber(r,{unit:"year"})}return xt.y(t,s)},Y:function(t,s,a,n){const r=$i(t,n),i=r>0?r:1-r;if(s==="YY"){const o=i%100;return me(o,2)}return s==="Yo"?a.ordinalNumber(i,{unit:"year"}):me(i,s.length)},R:function(t,s){const a=Ti(t);return me(a,s.length)},u:function(t,s){const a=t.getFullYear();return me(a,s.length)},Q:function(t,s,a){const n=Math.ceil((t.getMonth()+1)/3);switch(s){case"Q":return String(n);case"QQ":return me(n,2);case"Qo":return a.ordinalNumber(n,{unit:"quarter"});case"QQQ":return a.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,s,a){const n=Math.ceil((t.getMonth()+1)/3);switch(s){case"q":return String(n);case"qq":return me(n,2);case"qo":return a.ordinalNumber(n,{unit:"quarter"});case"qqq":return a.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,s,a){const n=t.getMonth();switch(s){case"M":case"MM":return xt.M(t,s);case"Mo":return a.ordinalNumber(n+1,{unit:"month"});case"MMM":return a.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(n,{width:"wide",context:"formatting"})}},L:function(t,s,a){const n=t.getMonth();switch(s){case"L":return String(n+1);case"LL":return me(n+1,2);case"Lo":return a.ordinalNumber(n+1,{unit:"month"});case"LLL":return a.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(n,{width:"wide",context:"standalone"})}},w:function(t,s,a,n){const r=Oi(t,n);return s==="wo"?a.ordinalNumber(r,{unit:"week"}):me(r,s.length)},I:function(t,s,a){const n=Li(t);return s==="Io"?a.ordinalNumber(n,{unit:"week"}):me(n,s.length)},d:function(t,s,a){return s==="do"?a.ordinalNumber(t.getDate(),{unit:"date"}):xt.d(t,s)},D:function(t,s,a){const n=iu(t);return s==="Do"?a.ordinalNumber(n,{unit:"dayOfYear"}):me(n,s.length)},E:function(t,s,a){const n=t.getDay();switch(s){case"E":case"EE":case"EEE":return a.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(n,{width:"short",context:"formatting"});case"EEEE":default:return a.day(n,{width:"wide",context:"formatting"})}},e:function(t,s,a,n){const r=t.getDay(),i=(r-n.weekStartsOn+8)%7||7;switch(s){case"e":return String(i);case"ee":return me(i,2);case"eo":return a.ordinalNumber(i,{unit:"day"});case"eee":return a.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(r,{width:"short",context:"formatting"});case"eeee":default:return a.day(r,{width:"wide",context:"formatting"})}},c:function(t,s,a,n){const r=t.getDay(),i=(r-n.weekStartsOn+8)%7||7;switch(s){case"c":return String(i);case"cc":return me(i,s.length);case"co":return a.ordinalNumber(i,{unit:"day"});case"ccc":return a.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(r,{width:"narrow",context:"standalone"});case"cccccc":return a.day(r,{width:"short",context:"standalone"});case"cccc":default:return a.day(r,{width:"wide",context:"standalone"})}},i:function(t,s,a){const n=t.getDay(),r=n===0?7:n;switch(s){case"i":return String(r);case"ii":return me(r,s.length);case"io":return a.ordinalNumber(r,{unit:"day"});case"iii":return a.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(n,{width:"short",context:"formatting"});case"iiii":default:return a.day(n,{width:"wide",context:"formatting"})}},a:function(t,s,a){const r=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(t,s,a){const n=t.getHours();let r;switch(n===12?r=Et.noon:n===0?r=Et.midnight:r=n/12>=1?"pm":"am",s){case"b":case"bb":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(t,s,a){const n=t.getHours();let r;switch(n>=17?r=Et.evening:n>=12?r=Et.afternoon:n>=4?r=Et.morning:r=Et.night,s){case"B":case"BB":case"BBB":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(t,s,a){if(s==="ho"){let n=t.getHours()%12;return n===0&&(n=12),a.ordinalNumber(n,{unit:"hour"})}return xt.h(t,s)},H:function(t,s,a){return s==="Ho"?a.ordinalNumber(t.getHours(),{unit:"hour"}):xt.H(t,s)},K:function(t,s,a){const n=t.getHours()%12;return s==="Ko"?a.ordinalNumber(n,{unit:"hour"}):me(n,s.length)},k:function(t,s,a){let n=t.getHours();return n===0&&(n=24),s==="ko"?a.ordinalNumber(n,{unit:"hour"}):me(n,s.length)},m:function(t,s,a){return s==="mo"?a.ordinalNumber(t.getMinutes(),{unit:"minute"}):xt.m(t,s)},s:function(t,s,a){return s==="so"?a.ordinalNumber(t.getSeconds(),{unit:"second"}):xt.s(t,s)},S:function(t,s){return xt.S(t,s)},X:function(t,s,a){const n=t.getTimezoneOffset();if(n===0)return"Z";switch(s){case"X":return On(n);case"XXXX":case"XX":return vt(n);case"XXXXX":case"XXX":default:return vt(n,":")}},x:function(t,s,a){const n=t.getTimezoneOffset();switch(s){case"x":return On(n);case"xxxx":case"xx":return vt(n);case"xxxxx":case"xxx":default:return vt(n,":")}},O:function(t,s,a){const n=t.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+$n(n,":");case"OOOO":default:return"GMT"+vt(n,":")}},z:function(t,s,a){const n=t.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+$n(n,":");case"zzzz":default:return"GMT"+vt(n,":")}},t:function(t,s,a){const n=Math.trunc(t.getTime()/1e3);return me(n,s.length)},T:function(t,s,a){const n=t.getTime();return me(n,s.length)}};function $n(t,s=""){const a=t>0?"-":"+",n=Math.abs(t),r=Math.trunc(n/60),i=n%60;return i===0?a+String(r):a+String(r)+s+me(i,2)}function On(t,s){return t%60===0?(t>0?"-":"+")+me(Math.abs(t)/60,2):vt(t,s)}function vt(t,s=""){const a=t>0?"-":"+",n=Math.abs(t),r=me(Math.trunc(n/60),2),i=me(n%60,2);return a+r+s+i}const Fn=(t,s)=>{switch(t){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},Fi=(t,s)=>{switch(t){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},lu=(t,s)=>{const a=t.match(/(P+)(p+)?/)||[],n=a[1],r=a[2];if(!r)return Fn(t,s);let i;switch(n){case"P":i=s.dateTime({width:"short"});break;case"PP":i=s.dateTime({width:"medium"});break;case"PPP":i=s.dateTime({width:"long"});break;case"PPPP":default:i=s.dateTime({width:"full"});break}return i.replace("{{date}}",Fn(n,s)).replace("{{time}}",Fi(r,s))},cu={p:Fi,P:lu},du=/^D+$/,mu=/^Y+$/,uu=["D","DD","YY","YYYY"];function hu(t){return du.test(t)}function pu(t){return mu.test(t)}function xu(t,s,a){const n=fu(t,s,a);if(console.warn(n),uu.includes(t))throw new RangeError(n)}function fu(t,s,a){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${s}\`) for formatting ${n} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const gu=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,vu=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ju=/^'([^]*?)'?$/,bu=/''/g,yu=/[a-zA-Z]/;function Le(t,s,a){var u,j,l,m,x,g,v,f;const n=ss(),r=(a==null?void 0:a.locale)??n.locale??Ri,i=(a==null?void 0:a.firstWeekContainsDate)??((j=(u=a==null?void 0:a.locale)==null?void 0:u.options)==null?void 0:j.firstWeekContainsDate)??n.firstWeekContainsDate??((m=(l=n.locale)==null?void 0:l.options)==null?void 0:m.firstWeekContainsDate)??1,o=(a==null?void 0:a.weekStartsOn)??((g=(x=a==null?void 0:a.locale)==null?void 0:x.options)==null?void 0:g.weekStartsOn)??n.weekStartsOn??((f=(v=n.locale)==null?void 0:v.options)==null?void 0:f.weekStartsOn)??0,c=le(t);if(!Cm(c))throw new RangeError("Invalid time value");let d=s.match(vu).map(N=>{const _=N[0];if(_==="p"||_==="P"){const A=cu[_];return A(N,r.formatLong)}return N}).join("").match(gu).map(N=>{if(N==="''")return{isToken:!1,value:"'"};const _=N[0];if(_==="'")return{isToken:!1,value:Nu(N)};if(Ln[_])return{isToken:!0,value:N};if(_.match(yu))throw new RangeError("Format string contains an unescaped latin alphabet character `"+_+"`");return{isToken:!1,value:N}});r.localize.preprocessor&&(d=r.localize.preprocessor(c,d));const p={firstWeekContainsDate:i,weekStartsOn:o,locale:r};return d.map(N=>{if(!N.isToken)return N.value;const _=N.value;(!(a!=null&&a.useAdditionalWeekYearTokens)&&pu(_)||!(a!=null&&a.useAdditionalDayOfYearTokens)&&hu(_))&&xu(_,s,String(t));const A=Ln[_[0]];return A(c,_,r.localize,p)}).join("")}function Nu(t){const s=t.match(ju);return s?s[1].replace(bu,"'"):t}function wu(t){const s=le(t),a=s.getFullYear(),n=s.getMonth(),r=Fe(t,0);return r.setFullYear(a,n+1,0),r.setHours(0,0,0,0),r.getDate()}function _u(t){return Math.trunc(+le(t)/1e3)}function Su(t){const s=le(t),a=s.getMonth();return s.setFullYear(s.getFullYear(),a+1,0),s.setHours(0,0,0,0),s}function Du(t,s){return km(Su(t),Ie(t),s)+1}function ka(t,s){const a=le(t),n=le(s);return a.getTime()>n.getTime()}function Vi(t,s){const a=le(t),n=le(s);return+a<+n}function en(t,s){const a=le(t),n=le(s);return a.getFullYear()===n.getFullYear()&&a.getMonth()===n.getMonth()}function Cu(t,s){const a=le(t),n=le(s);return a.getFullYear()===n.getFullYear()}function sa(t,s){return Ne(t,-s)}function aa(t,s){const n=Tu(t);let r;if(n.date){const d=Iu(n.date,2);r=Pu(d.restDateString,d.year)}if(!r||isNaN(r.getTime()))return new Date(NaN);const i=r.getTime();let o=0,c;if(n.time&&(o=Mu(n.time),isNaN(o)))return new Date(NaN);if(n.timezone){if(c=Ru(n.timezone),isNaN(c))return new Date(NaN)}else{const d=new Date(i+o),p=new Date(0);return p.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),p.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),p}return new Date(i+o+c)}const hs={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ku=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Eu=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Au=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Tu(t){const s={},a=t.split(hs.dateTimeDelimiter);let n;if(a.length>2)return s;if(/:/.test(a[0])?n=a[0]:(s.date=a[0],n=a[1],hs.timeZoneDelimiter.test(s.date)&&(s.date=t.split(hs.timeZoneDelimiter)[0],n=t.substr(s.date.length,t.length))),n){const r=hs.timezone.exec(n);r?(s.time=n.replace(r[1],""),s.timezone=r[1]):s.time=n}return s}function Iu(t,s){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),n=t.match(a);if(!n)return{year:NaN,restDateString:""};const r=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?r:i*100,restDateString:t.slice((n[1]||n[2]).length)}}function Pu(t,s){if(s===null)return new Date(NaN);const a=t.match(ku);if(!a)return new Date(NaN);const n=!!a[4],r=Kt(a[1]),i=Kt(a[2])-1,o=Kt(a[3]),c=Kt(a[4]),d=Kt(a[5])-1;if(n)return Vu(s,c,d)?Lu(s,c,d):new Date(NaN);{const p=new Date(0);return!Ou(s,i,o)||!Fu(s,r)?new Date(NaN):(p.setUTCFullYear(s,i,Math.max(r,o)),p)}}function Kt(t){return t?parseInt(t):1}function Mu(t){const s=t.match(Eu);if(!s)return NaN;const a=na(s[1]),n=na(s[2]),r=na(s[3]);return zu(a,n,r)?a*Ai+n*Ei+r*1e3:NaN}function na(t){return t&&parseFloat(t.replace(",","."))||0}function Ru(t){if(t==="Z")return 0;const s=t.match(Au);if(!s)return 0;const a=s[1]==="+"?-1:1,n=parseInt(s[2]),r=s[3]&&parseInt(s[3])||0;return Wu(n,r)?a*(n*Ai+r*Ei):NaN}function Lu(t,s,a){const n=new Date(0);n.setUTCFullYear(t,0,4);const r=n.getUTCDay()||7,i=(s-1)*7+a+1-r;return n.setUTCDate(n.getUTCDate()+i),n}const $u=[31,null,31,30,31,30,31,31,30,31,30,31];function zi(t){return t%400===0||t%4===0&&t%100!==0}function Ou(t,s,a){return s>=0&&s<=11&&a>=1&&a<=($u[s]||(zi(t)?29:28))}function Fu(t,s){return s>=1&&s<=(zi(t)?366:365)}function Vu(t,s,a){return s>=1&&s<=53&&a>=0&&a<=6}function zu(t,s,a){return t===24?s===0&&a===0:a>=0&&a<60&&s>=0&&s<60&&t>=0&&t<25}function Wu(t,s){return s>=0&&s<=59}function ra(t,s){const a=le(t),n=a.getFullYear(),r=a.getDate(),i=Fe(t,0);i.setFullYear(n,s,15),i.setHours(0,0,0,0);const o=wu(i);return a.setMonth(s,Math.min(r,o)),a}function Vn(t,s){const a=le(t);return isNaN(+a)?Fe(t,NaN):(a.setFullYear(s),a)}const Bu={lessThanXSeconds:{one:"น้อยกว่า 1 วินาที",other:"น้อยกว่า {{count}} วินาที"},xSeconds:{one:"1 วินาที",other:"{{count}} วินาที"},halfAMinute:"ครึ่งนาที",lessThanXMinutes:{one:"น้อยกว่า 1 นาที",other:"น้อยกว่า {{count}} นาที"},xMinutes:{one:"1 นาที",other:"{{count}} นาที"},aboutXHours:{one:"ประมาณ 1 ชั่วโมง",other:"ประมาณ {{count}} ชั่วโมง"},xHours:{one:"1 ชั่วโมง",other:"{{count}} ชั่วโมง"},xDays:{one:"1 วัน",other:"{{count}} วัน"},aboutXWeeks:{one:"ประมาณ 1 สัปดาห์",other:"ประมาณ {{count}} สัปดาห์"},xWeeks:{one:"1 สัปดาห์",other:"{{count}} สัปดาห์"},aboutXMonths:{one:"ประมาณ 1 เดือน",other:"ประมาณ {{count}} เดือน"},xMonths:{one:"1 เดือน",other:"{{count}} เดือน"},aboutXYears:{one:"ประมาณ 1 ปี",other:"ประมาณ {{count}} ปี"},xYears:{one:"1 ปี",other:"{{count}} ปี"},overXYears:{one:"มากกว่า 1 ปี",other:"มากกว่า {{count}} ปี"},almostXYears:{one:"เกือบ 1 ปี",other:"เกือบ {{count}} ปี"}},Uu=(t,s,a)=>{let n;const r=Bu[t];return typeof r=="string"?n=r:s===1?n=r.one:n=r.other.replace("{{count}}",String(s)),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?t==="halfAMinute"?"ใน"+n:"ใน "+n:n+"ที่ผ่านมา":n},Hu={full:"วันEEEEที่ do MMMM y",long:"do MMMM y",medium:"d MMM y",short:"dd/MM/yyyy"},qu={full:"H:mm:ss น. zzzz",long:"H:mm:ss น. z",medium:"H:mm:ss น.",short:"H:mm น."},Gu={full:"{{date}} 'เวลา' {{time}}",long:"{{date}} 'เวลา' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Yu={date:It({formats:Hu,defaultWidth:"full"}),time:It({formats:qu,defaultWidth:"medium"}),dateTime:It({formats:Gu,defaultWidth:"full"})},Ku={lastWeek:"eeee'ที่แล้วเวลา' p",yesterday:"'เมื่อวานนี้เวลา' p",today:"'วันนี้เวลา' p",tomorrow:"'พรุ่งนี้เวลา' p",nextWeek:"eeee 'เวลา' p",other:"P"},Ju=(t,s,a,n)=>Ku[t],Qu={narrow:["B","คศ"],abbreviated:["BC","ค.ศ."],wide:["ปีก่อนคริสตกาล","คริสต์ศักราช"]},Xu={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["ไตรมาสแรก","ไตรมาสที่สอง","ไตรมาสที่สาม","ไตรมาสที่สี่"]},Zu={narrow:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."],short:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."],abbreviated:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."],wide:["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์"]},eh={narrow:["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],abbreviated:["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],wide:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"]},th={narrow:{am:"ก่อนเที่ยง",pm:"หลังเที่ยง",midnight:"เที่ยงคืน",noon:"เที่ยง",morning:"เช้า",afternoon:"บ่าย",evening:"เย็น",night:"กลางคืน"},abbreviated:{am:"ก่อนเที่ยง",pm:"หลังเที่ยง",midnight:"เที่ยงคืน",noon:"เที่ยง",morning:"เช้า",afternoon:"บ่าย",evening:"เย็น",night:"กลางคืน"},wide:{am:"ก่อนเที่ยง",pm:"หลังเที่ยง",midnight:"เที่ยงคืน",noon:"เที่ยง",morning:"เช้า",afternoon:"บ่าย",evening:"เย็น",night:"กลางคืน"}},sh={narrow:{am:"ก่อนเที่ยง",pm:"หลังเที่ยง",midnight:"เที่ยงคืน",noon:"เที่ยง",morning:"ตอนเช้า",afternoon:"ตอนกลางวัน",evening:"ตอนเย็น",night:"ตอนกลางคืน"},abbreviated:{am:"ก่อนเที่ยง",pm:"หลังเที่ยง",midnight:"เที่ยงคืน",noon:"เที่ยง",morning:"ตอนเช้า",afternoon:"ตอนกลางวัน",evening:"ตอนเย็น",night:"ตอนกลางคืน"},wide:{am:"ก่อนเที่ยง",pm:"หลังเที่ยง",midnight:"เที่ยงคืน",noon:"เที่ยง",morning:"ตอนเช้า",afternoon:"ตอนกลางวัน",evening:"ตอนเย็น",night:"ตอนกลางคืน"}},ah=(t,s)=>String(t),nh={ordinalNumber:ah,era:Je({values:Qu,defaultWidth:"wide"}),quarter:Je({values:Xu,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Je({values:eh,defaultWidth:"wide"}),day:Je({values:Zu,defaultWidth:"wide"}),dayPeriod:Je({values:th,defaultWidth:"wide",formattingValues:sh,defaultFormattingWidth:"wide"})},rh=/^\d+/i,ih=/\d+/i,oh={narrow:/^([bB]|[aA]|คศ)/i,abbreviated:/^([bB]\.?\s?[cC]\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?|ค\.?ศ\.?)/i,wide:/^(ก่อนคริสตกาล|คริสต์ศักราช|คริสตกาล)/i},lh={any:[/^[bB]/i,/^(^[aA]|ค\.?ศ\.?|คริสตกาล|คริสต์ศักราช|)/i]},ch={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^ไตรมาส(ที่)? ?[1234]/i},dh={any:[/(1|แรก|หนึ่ง)/i,/(2|สอง)/i,/(3|สาม)/i,/(4|สี่)/i]},mh={narrow:/^(ม\.?ค\.?|ก\.?พ\.?|มี\.?ค\.?|เม\.?ย\.?|พ\.?ค\.?|มิ\.?ย\.?|ก\.?ค\.?|ส\.?ค\.?|ก\.?ย\.?|ต\.?ค\.?|พ\.?ย\.?|ธ\.?ค\.?)/i,abbreviated:/^(ม\.?ค\.?|ก\.?พ\.?|มี\.?ค\.?|เม\.?ย\.?|พ\.?ค\.?|มิ\.?ย\.?|ก\.?ค\.?|ส\.?ค\.?|ก\.?ย\.?|ต\.?ค\.?|พ\.?ย\.?|ธ\.?ค\.?')/i,wide:/^(มกราคม|กุมภาพันธ์|มีนาคม|เมษายน|พฤษภาคม|มิถุนายน|กรกฎาคม|สิงหาคม|กันยายน|ตุลาคม|พฤศจิกายน|ธันวาคม)/i},uh={wide:[/^มก/i,/^กุม/i,/^มี/i,/^เม/i,/^พฤษ/i,/^มิ/i,/^กรก/i,/^ส/i,/^กัน/i,/^ต/i,/^พฤศ/i,/^ธ/i],any:[/^ม\.?ค\.?/i,/^ก\.?พ\.?/i,/^มี\.?ค\.?/i,/^เม\.?ย\.?/i,/^พ\.?ค\.?/i,/^มิ\.?ย\.?/i,/^ก\.?ค\.?/i,/^ส\.?ค\.?/i,/^ก\.?ย\.?/i,/^ต\.?ค\.?/i,/^พ\.?ย\.?/i,/^ธ\.?ค\.?/i]},hh={narrow:/^(อา\.?|จ\.?|อ\.?|พฤ\.?|พ\.?|ศ\.?|ส\.?)/i,short:/^(อา\.?|จ\.?|อ\.?|พฤ\.?|พ\.?|ศ\.?|ส\.?)/i,abbreviated:/^(อา\.?|จ\.?|อ\.?|พฤ\.?|พ\.?|ศ\.?|ส\.?)/i,wide:/^(อาทิตย์|จันทร์|อังคาร|พุธ|พฤหัสบดี|ศุกร์|เสาร์)/i},ph={wide:[/^อา/i,/^จั/i,/^อั/i,/^พุธ/i,/^พฤ/i,/^ศ/i,/^เส/i],any:[/^อา/i,/^จ/i,/^อ/i,/^พ(?!ฤ)/i,/^พฤ/i,/^ศ/i,/^ส/i]},xh={any:/^(ก่อนเที่ยง|หลังเที่ยง|เที่ยงคืน|เที่ยง|(ตอน.*?)?.*(เที่ยง|เช้า|บ่าย|เย็น|กลางคืน))/i},fh={any:{am:/^ก่อนเที่ยง/i,pm:/^หลังเที่ยง/i,midnight:/^เที่ยงคืน/i,noon:/^เที่ยง/i,morning:/เช้า/i,afternoon:/บ่าย/i,evening:/เย็น/i,night:/กลางคืน/i}},gh={ordinalNumber:Mi({matchPattern:rh,parsePattern:ih,valueCallback:t=>parseInt(t,10)}),era:Qe({matchPatterns:oh,defaultMatchWidth:"wide",parsePatterns:lh,defaultParseWidth:"any"}),quarter:Qe({matchPatterns:ch,defaultMatchWidth:"wide",parsePatterns:dh,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Qe({matchPatterns:mh,defaultMatchWidth:"wide",parsePatterns:uh,defaultParseWidth:"any"}),day:Qe({matchPatterns:hh,defaultMatchWidth:"wide",parsePatterns:ph,defaultParseWidth:"any"}),dayPeriod:Qe({matchPatterns:xh,defaultMatchWidth:"any",parsePatterns:fh,defaultParseWidth:"any"})},ia={code:"th",formatDistance:Uu,formatLong:Yu,formatRelative:Ju,localize:nh,match:gh,options:{weekStartsOn:0,firstWeekContainsDate:1}};var se=function(){return se=Object.assign||function(s){for(var a,n=1,r=arguments.length;n<r;n++){a=arguments[n];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(s[i]=a[i])}return s},se.apply(this,arguments)};function vh(t,s){var a={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&s.indexOf(n)<0&&(a[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(t);r<n.length;r++)s.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(a[n[r]]=t[n[r]]);return a}function Wi(t,s,a){for(var n=0,r=s.length,i;n<r;n++)(i||!(n in s))&&(i||(i=Array.prototype.slice.call(s,0,n)),i[n]=s[n]);return t.concat(i||Array.prototype.slice.call(s))}function as(t){return t.mode==="multiple"}function ns(t){return t.mode==="range"}function Ws(t){return t.mode==="single"}var jh={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function bh(t,s){return Le(t,"LLLL y",s)}function yh(t,s){return Le(t,"d",s)}function Nh(t,s){return Le(t,"LLLL",s)}function wh(t){return"".concat(t)}function _h(t,s){return Le(t,"cccccc",s)}function Sh(t,s){return Le(t,"yyyy",s)}var Dh=Object.freeze({__proto__:null,formatCaption:bh,formatDay:yh,formatMonthCaption:Nh,formatWeekNumber:wh,formatWeekdayName:_h,formatYearCaption:Sh}),Ch=function(t,s,a){return Le(t,"do MMMM (EEEE)",a)},kh=function(){return"Month: "},Eh=function(){return"Go to next month"},Ah=function(){return"Go to previous month"},Th=function(t,s){return Le(t,"cccc",s)},Ih=function(t){return"Week n. ".concat(t)},Ph=function(){return"Year: "},Mh=Object.freeze({__proto__:null,labelDay:Ch,labelMonthDropdown:kh,labelNext:Eh,labelPrevious:Ah,labelWeekNumber:Ih,labelWeekday:Th,labelYearDropdown:Ph});function Rh(){var t="buttons",s=jh,a=Ri,n={},r={},i=1,o={},c=new Date;return{captionLayout:t,classNames:s,formatters:Dh,labels:Mh,locale:a,modifiersClassNames:n,modifiers:r,numberOfMonths:i,styles:o,today:c,mode:"default"}}function Lh(t){var s=t.fromYear,a=t.toYear,n=t.fromMonth,r=t.toMonth,i=t.fromDate,o=t.toDate;return n?i=Ie(n):s&&(i=new Date(s,0,1)),r?o=Xa(r):a&&(o=new Date(a,11,31)),{fromDate:i?$t(i):void 0,toDate:o?$t(o):void 0}}var Bi=h.createContext(void 0);function $h(t){var s,a=t.initialProps,n=Rh(),r=Lh(a),i=r.fromDate,o=r.toDate,c=(s=a.captionLayout)!==null&&s!==void 0?s:n.captionLayout;c!=="buttons"&&(!i||!o)&&(c="buttons");var d;(Ws(a)||as(a)||ns(a))&&(d=a.onSelect);var p=se(se(se({},n),a),{captionLayout:c,classNames:se(se({},n.classNames),a.classNames),components:se({},a.components),formatters:se(se({},n.formatters),a.formatters),fromDate:i,labels:se(se({},n.labels),a.labels),mode:a.mode||n.mode,modifiers:se(se({},n.modifiers),a.modifiers),modifiersClassNames:se(se({},n.modifiersClassNames),a.modifiersClassNames),onSelect:d,styles:se(se({},n.styles),a.styles),toDate:o});return e.jsx(Bi.Provider,{value:p,children:t.children})}function he(){var t=h.useContext(Bi);if(!t)throw new Error("useDayPicker must be used within a DayPickerProvider.");return t}function Ui(t){var s=he(),a=s.locale,n=s.classNames,r=s.styles,i=s.formatters.formatCaption;return e.jsx("div",{className:n.caption_label,style:r.caption_label,"aria-live":"polite",role:"presentation",id:t.id,children:i(t.displayMonth,{locale:a})})}function Oh(t){return e.jsx("svg",se({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},t,{children:e.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Hi(t){var s,a,n=t.onChange,r=t.value,i=t.children,o=t.caption,c=t.className,d=t.style,p=he(),u=(a=(s=p.components)===null||s===void 0?void 0:s.IconDropdown)!==null&&a!==void 0?a:Oh;return e.jsxs("div",{className:c,style:d,children:[e.jsx("span",{className:p.classNames.vhidden,children:t["aria-label"]}),e.jsx("select",{name:t.name,"aria-label":t["aria-label"],className:p.classNames.dropdown,style:p.styles.dropdown,value:r,onChange:n,children:i}),e.jsxs("div",{className:p.classNames.caption_label,style:p.styles.caption_label,"aria-hidden":"true",children:[o,e.jsx(u,{className:p.classNames.dropdown_icon,style:p.styles.dropdown_icon})]})]})}function Fh(t){var s,a=he(),n=a.fromDate,r=a.toDate,i=a.styles,o=a.locale,c=a.formatters.formatMonthCaption,d=a.classNames,p=a.components,u=a.labels.labelMonthDropdown;if(!n)return e.jsx(e.Fragment,{});if(!r)return e.jsx(e.Fragment,{});var j=[];if(Cu(n,r))for(var l=Ie(n),m=n.getMonth();m<=r.getMonth();m++)j.push(ra(l,m));else for(var l=Ie(new Date),m=0;m<=11;m++)j.push(ra(l,m));var x=function(v){var f=Number(v.target.value),N=ra(Ie(t.displayMonth),f);t.onChange(N)},g=(s=p==null?void 0:p.Dropdown)!==null&&s!==void 0?s:Hi;return e.jsx(g,{name:"months","aria-label":u(),className:d.dropdown_month,style:i.dropdown_month,onChange:x,value:t.displayMonth.getMonth(),caption:c(t.displayMonth,{locale:o}),children:j.map(function(v){return e.jsx("option",{value:v.getMonth(),children:c(v,{locale:o})},v.getMonth())})})}function Vh(t){var s,a=t.displayMonth,n=he(),r=n.fromDate,i=n.toDate,o=n.locale,c=n.styles,d=n.classNames,p=n.components,u=n.formatters.formatYearCaption,j=n.labels.labelYearDropdown,l=[];if(!r)return e.jsx(e.Fragment,{});if(!i)return e.jsx(e.Fragment,{});for(var m=r.getFullYear(),x=i.getFullYear(),g=m;g<=x;g++)l.push(Vn(Ii(new Date),g));var v=function(N){var _=Vn(Ie(a),Number(N.target.value));t.onChange(_)},f=(s=p==null?void 0:p.Dropdown)!==null&&s!==void 0?s:Hi;return e.jsx(f,{name:"years","aria-label":j(),className:d.dropdown_year,style:c.dropdown_year,onChange:v,value:a.getFullYear(),caption:u(a,{locale:o}),children:l.map(function(N){return e.jsx("option",{value:N.getFullYear(),children:u(N,{locale:o})},N.getFullYear())})})}function zh(t,s){var a=h.useState(t),n=a[0],r=a[1],i=s===void 0?n:s;return[i,r]}function Wh(t){var s=t.month,a=t.defaultMonth,n=t.today,r=s||a||n||new Date,i=t.toDate,o=t.fromDate,c=t.numberOfMonths,d=c===void 0?1:c;if(i&&es(i,r)<0){var p=-1*(d-1);r=qe(i,p)}return o&&es(r,o)<0&&(r=o),Ie(r)}function Bh(){var t=he(),s=Wh(t),a=zh(s,t.month),n=a[0],r=a[1],i=function(o){var c;if(!t.disableNavigation){var d=Ie(o);r(d),(c=t.onMonthChange)===null||c===void 0||c.call(t,d)}};return[n,i]}function Uh(t,s){for(var a=s.reverseMonths,n=s.numberOfMonths,r=Ie(t),i=Ie(qe(r,n)),o=es(i,r),c=[],d=0;d<o;d++){var p=qe(r,d);c.push(p)}return a&&(c=c.reverse()),c}function Hh(t,s){if(!s.disableNavigation){var a=s.toDate,n=s.pagedNavigation,r=s.numberOfMonths,i=r===void 0?1:r,o=n?i:1,c=Ie(t);if(!a)return qe(c,o);var d=es(a,t);if(!(d<i))return qe(c,o)}}function qh(t,s){if(!s.disableNavigation){var a=s.fromDate,n=s.pagedNavigation,r=s.numberOfMonths,i=r===void 0?1:r,o=n?i:1,c=Ie(t);if(!a)return qe(c,-o);var d=es(c,a);if(!(d<=0))return qe(c,-o)}}var qi=h.createContext(void 0);function Gh(t){var s=he(),a=Bh(),n=a[0],r=a[1],i=Uh(n,s),o=Hh(n,s),c=qh(n,s),d=function(j){return i.some(function(l){return en(j,l)})},p=function(j,l){d(j)||(l&&Vi(j,l)?r(qe(j,1+s.numberOfMonths*-1)):r(j))},u={currentMonth:n,displayMonths:i,goToMonth:r,goToDate:p,previousMonth:c,nextMonth:o,isDateDisplayed:d};return e.jsx(qi.Provider,{value:u,children:t.children})}function rs(){var t=h.useContext(qi);if(!t)throw new Error("useNavigation must be used within a NavigationProvider");return t}function zn(t){var s,a=he(),n=a.classNames,r=a.styles,i=a.components,o=rs().goToMonth,c=function(u){o(qe(u,t.displayIndex?-t.displayIndex:0))},d=(s=i==null?void 0:i.CaptionLabel)!==null&&s!==void 0?s:Ui,p=e.jsx(d,{id:t.id,displayMonth:t.displayMonth});return e.jsxs("div",{className:n.caption_dropdowns,style:r.caption_dropdowns,children:[e.jsx("div",{className:n.vhidden,children:p}),e.jsx(Fh,{onChange:c,displayMonth:t.displayMonth}),e.jsx(Vh,{onChange:c,displayMonth:t.displayMonth})]})}function Yh(t){return e.jsx("svg",se({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:e.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Kh(t){return e.jsx("svg",se({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:e.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var Cs=h.forwardRef(function(t,s){var a=he(),n=a.classNames,r=a.styles,i=[n.button_reset,n.button];t.className&&i.push(t.className);var o=i.join(" "),c=se(se({},r.button_reset),r.button);return t.style&&Object.assign(c,t.style),e.jsx("button",se({},t,{ref:s,type:"button",className:o,style:c}))});function Jh(t){var s,a,n=he(),r=n.dir,i=n.locale,o=n.classNames,c=n.styles,d=n.labels,p=d.labelPrevious,u=d.labelNext,j=n.components;if(!t.nextMonth&&!t.previousMonth)return e.jsx(e.Fragment,{});var l=p(t.previousMonth,{locale:i}),m=[o.nav_button,o.nav_button_previous].join(" "),x=u(t.nextMonth,{locale:i}),g=[o.nav_button,o.nav_button_next].join(" "),v=(s=j==null?void 0:j.IconRight)!==null&&s!==void 0?s:Kh,f=(a=j==null?void 0:j.IconLeft)!==null&&a!==void 0?a:Yh;return e.jsxs("div",{className:o.nav,style:c.nav,children:[!t.hidePrevious&&e.jsx(Cs,{name:"previous-month","aria-label":l,className:m,style:c.nav_button_previous,disabled:!t.previousMonth,onClick:t.onPreviousClick,children:r==="rtl"?e.jsx(v,{className:o.nav_icon,style:c.nav_icon}):e.jsx(f,{className:o.nav_icon,style:c.nav_icon})}),!t.hideNext&&e.jsx(Cs,{name:"next-month","aria-label":x,className:g,style:c.nav_button_next,disabled:!t.nextMonth,onClick:t.onNextClick,children:r==="rtl"?e.jsx(f,{className:o.nav_icon,style:c.nav_icon}):e.jsx(v,{className:o.nav_icon,style:c.nav_icon})})]})}function Wn(t){var s=he().numberOfMonths,a=rs(),n=a.previousMonth,r=a.nextMonth,i=a.goToMonth,o=a.displayMonths,c=o.findIndex(function(x){return en(t.displayMonth,x)}),d=c===0,p=c===o.length-1,u=s>1&&(d||!p),j=s>1&&(p||!d),l=function(){n&&i(n)},m=function(){r&&i(r)};return e.jsx(Jh,{displayMonth:t.displayMonth,hideNext:u,hidePrevious:j,nextMonth:r,previousMonth:n,onPreviousClick:l,onNextClick:m})}function Qh(t){var s,a=he(),n=a.classNames,r=a.disableNavigation,i=a.styles,o=a.captionLayout,c=a.components,d=(s=c==null?void 0:c.CaptionLabel)!==null&&s!==void 0?s:Ui,p;return r?p=e.jsx(d,{id:t.id,displayMonth:t.displayMonth}):o==="dropdown"?p=e.jsx(zn,{displayMonth:t.displayMonth,id:t.id}):o==="dropdown-buttons"?p=e.jsxs(e.Fragment,{children:[e.jsx(zn,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id}),e.jsx(Wn,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id})]}):p=e.jsxs(e.Fragment,{children:[e.jsx(d,{id:t.id,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),e.jsx(Wn,{displayMonth:t.displayMonth,id:t.id})]}),e.jsx("div",{className:n.caption,style:i.caption,children:p})}function Xh(t){var s=he(),a=s.footer,n=s.styles,r=s.classNames.tfoot;return a?e.jsx("tfoot",{className:r,style:n.tfoot,children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:a})})}):e.jsx(e.Fragment,{})}function Zh(t,s,a){for(var n=a?Nt(new Date):st(new Date,{locale:t,weekStartsOn:s}),r=[],i=0;i<7;i++){var o=Ne(n,i);r.push(o)}return r}function ep(){var t=he(),s=t.classNames,a=t.styles,n=t.showWeekNumber,r=t.locale,i=t.weekStartsOn,o=t.ISOWeek,c=t.formatters.formatWeekdayName,d=t.labels.labelWeekday,p=Zh(r,i,o);return e.jsxs("tr",{style:a.head_row,className:s.head_row,children:[n&&e.jsx("td",{style:a.head_cell,className:s.head_cell}),p.map(function(u,j){return e.jsx("th",{scope:"col",className:s.head_cell,style:a.head_cell,"aria-label":d(u,{locale:r}),children:c(u,{locale:r})},j)})]})}function tp(){var t,s=he(),a=s.classNames,n=s.styles,r=s.components,i=(t=r==null?void 0:r.HeadRow)!==null&&t!==void 0?t:ep;return e.jsx("thead",{style:n.head,className:a.head,children:e.jsx(i,{})})}function sp(t){var s=he(),a=s.locale,n=s.formatters.formatDay;return e.jsx(e.Fragment,{children:n(t.date,{locale:a})})}var tn=h.createContext(void 0);function ap(t){if(!as(t.initialProps)){var s={selected:void 0,modifiers:{disabled:[]}};return e.jsx(tn.Provider,{value:s,children:t.children})}return e.jsx(np,{initialProps:t.initialProps,children:t.children})}function np(t){var s=t.initialProps,a=t.children,n=s.selected,r=s.min,i=s.max,o=function(p,u,j){var l,m;(l=s.onDayClick)===null||l===void 0||l.call(s,p,u,j);var x=!!(u.selected&&r&&(n==null?void 0:n.length)===r);if(!x){var g=!!(!u.selected&&i&&(n==null?void 0:n.length)===i);if(!g){var v=n?Wi([],n):[];if(u.selected){var f=v.findIndex(function(N){return Te(p,N)});v.splice(f,1)}else v.push(p);(m=s.onSelect)===null||m===void 0||m.call(s,v,p,u,j)}}},c={disabled:[]};n&&c.disabled.push(function(p){var u=i&&n.length>i-1,j=n.some(function(l){return Te(l,p)});return!!(u&&!j)});var d={selected:n,onDayClick:o,modifiers:c};return e.jsx(tn.Provider,{value:d,children:a})}function sn(){var t=h.useContext(tn);if(!t)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return t}function rp(t,s){var a=s||{},n=a.from,r=a.to;return n&&r?Te(r,t)&&Te(n,t)?void 0:Te(r,t)?{from:r,to:void 0}:Te(n,t)?void 0:ka(n,t)?{from:t,to:r}:{from:n,to:t}:r?ka(t,r)?{from:r,to:t}:{from:t,to:r}:n?Vi(t,n)?{from:t,to:n}:{from:n,to:t}:{from:t,to:void 0}}var an=h.createContext(void 0);function ip(t){if(!ns(t.initialProps)){var s={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return e.jsx(an.Provider,{value:s,children:t.children})}return e.jsx(op,{initialProps:t.initialProps,children:t.children})}function op(t){var s=t.initialProps,a=t.children,n=s.selected,r=n||{},i=r.from,o=r.to,c=s.min,d=s.max,p=function(m,x,g){var v,f;(v=s.onDayClick)===null||v===void 0||v.call(s,m,x,g);var N=rp(m,n);(f=s.onSelect)===null||f===void 0||f.call(s,N,m,x,g)},u={range_start:[],range_end:[],range_middle:[],disabled:[]};if(i?(u.range_start=[i],o?(u.range_end=[o],Te(i,o)||(u.range_middle=[{after:i,before:o}])):u.range_end=[i]):o&&(u.range_start=[o],u.range_end=[o]),c&&(i&&!o&&u.disabled.push({after:sa(i,c-1),before:Ne(i,c-1)}),i&&o&&u.disabled.push({after:i,before:Ne(i,c-1)}),!i&&o&&u.disabled.push({after:sa(o,c-1),before:Ne(o,c-1)})),d){if(i&&!o&&(u.disabled.push({before:Ne(i,-d+1)}),u.disabled.push({after:Ne(i,d-1)})),i&&o){var j=He(o,i)+1,l=d-j;u.disabled.push({before:sa(i,l)}),u.disabled.push({after:Ne(o,l)})}!i&&o&&(u.disabled.push({before:Ne(o,-d+1)}),u.disabled.push({after:Ne(o,d-1)}))}return e.jsx(an.Provider,{value:{selected:n,onDayClick:p,modifiers:u},children:a})}function nn(){var t=h.useContext(an);if(!t)throw new Error("useSelectRange must be used within a SelectRangeProvider");return t}function fs(t){return Array.isArray(t)?Wi([],t):t!==void 0?[t]:[]}function lp(t){var s={};return Object.entries(t).forEach(function(a){var n=a[0],r=a[1];s[n]=fs(r)}),s}var Ge;(function(t){t.Outside="outside",t.Disabled="disabled",t.Selected="selected",t.Hidden="hidden",t.Today="today",t.RangeStart="range_start",t.RangeEnd="range_end",t.RangeMiddle="range_middle"})(Ge||(Ge={}));var cp=Ge.Selected,nt=Ge.Disabled,dp=Ge.Hidden,mp=Ge.Today,oa=Ge.RangeEnd,la=Ge.RangeMiddle,ca=Ge.RangeStart,up=Ge.Outside;function hp(t,s,a){var n,r=(n={},n[cp]=fs(t.selected),n[nt]=fs(t.disabled),n[dp]=fs(t.hidden),n[mp]=[t.today],n[oa]=[],n[la]=[],n[ca]=[],n[up]=[],n);return t.fromDate&&r[nt].push({before:t.fromDate}),t.toDate&&r[nt].push({after:t.toDate}),as(t)?r[nt]=r[nt].concat(s.modifiers[nt]):ns(t)&&(r[nt]=r[nt].concat(a.modifiers[nt]),r[ca]=a.modifiers[ca],r[la]=a.modifiers[la],r[oa]=a.modifiers[oa]),r}var Gi=h.createContext(void 0);function pp(t){var s=he(),a=sn(),n=nn(),r=hp(s,a,n),i=lp(s.modifiers),o=se(se({},r),i);return e.jsx(Gi.Provider,{value:o,children:t.children})}function Yi(){var t=h.useContext(Gi);if(!t)throw new Error("useModifiers must be used within a ModifiersProvider");return t}function xp(t){return!!(t&&typeof t=="object"&&"before"in t&&"after"in t)}function fp(t){return!!(t&&typeof t=="object"&&"from"in t)}function gp(t){return!!(t&&typeof t=="object"&&"after"in t)}function vp(t){return!!(t&&typeof t=="object"&&"before"in t)}function jp(t){return!!(t&&typeof t=="object"&&"dayOfWeek"in t)}function bp(t,s){var a,n=s.from,r=s.to;if(n&&r){var i=He(r,n)<0;i&&(a=[r,n],n=a[0],r=a[1]);var o=He(t,n)>=0&&He(r,t)>=0;return o}return r?Te(r,t):n?Te(n,t):!1}function yp(t){return Qa(t)}function Np(t){return Array.isArray(t)&&t.every(Qa)}function wp(t,s){return s.some(function(a){if(typeof a=="boolean")return a;if(yp(a))return Te(t,a);if(Np(a))return a.includes(t);if(fp(a))return bp(t,a);if(jp(a))return a.dayOfWeek.includes(t.getDay());if(xp(a)){var n=He(a.before,t),r=He(a.after,t),i=n>0,o=r<0,c=ka(a.before,a.after);return c?o&&i:i||o}return gp(a)?He(t,a.after)>0:vp(a)?He(a.before,t)>0:typeof a=="function"?a(t):!1})}function rn(t,s,a){var n=Object.keys(s).reduce(function(i,o){var c=s[o];return wp(t,c)&&i.push(o),i},[]),r={};return n.forEach(function(i){return r[i]=!0}),a&&!en(t,a)&&(r.outside=!0),r}function _p(t,s){for(var a=Ie(t[0]),n=Xa(t[t.length-1]),r,i,o=a;o<=n;){var c=rn(o,s),d=!c.disabled&&!c.hidden;if(!d){o=Ne(o,1);continue}if(c.selected)return o;c.today&&!i&&(i=o),r||(r=o),o=Ne(o,1)}return i||r}var Sp=365;function Ki(t,s){var a=s.moveBy,n=s.direction,r=s.context,i=s.modifiers,o=s.retry,c=o===void 0?{count:0,lastFocused:t}:o,d=r.weekStartsOn,p=r.fromDate,u=r.toDate,j=r.locale,l={day:Ne,week:Ca,month:qe,year:_m,startOfWeek:function(v){return r.ISOWeek?Nt(v):st(v,{locale:j,weekStartsOn:d})},endOfWeek:function(v){return r.ISOWeek?Pi(v):Za(v,{locale:j,weekStartsOn:d})}},m=l[a](t,n==="after"?1:-1);n==="before"&&p?m=Sm([p,m]):n==="after"&&u&&(m=Dm([u,m]));var x=!0;if(i){var g=rn(m,i);x=!g.disabled&&!g.hidden}return x?m:c.count>Sp?c.lastFocused:Ki(m,{moveBy:a,direction:n,context:r,modifiers:i,retry:se(se({},c),{count:c.count+1})})}var Ji=h.createContext(void 0);function Dp(t){var s=rs(),a=Yi(),n=h.useState(),r=n[0],i=n[1],o=h.useState(),c=o[0],d=o[1],p=_p(s.displayMonths,a),u=r??(c&&s.isDateDisplayed(c))?c:p,j=function(){d(r),i(void 0)},l=function(v){i(v)},m=he(),x=function(v,f){if(r){var N=Ki(r,{moveBy:v,direction:f,context:m,modifiers:a});Te(r,N)||(s.goToDate(N,r),l(N))}},g={focusedDay:r,focusTarget:u,blur:j,focus:l,focusDayAfter:function(){return x("day","after")},focusDayBefore:function(){return x("day","before")},focusWeekAfter:function(){return x("week","after")},focusWeekBefore:function(){return x("week","before")},focusMonthBefore:function(){return x("month","before")},focusMonthAfter:function(){return x("month","after")},focusYearBefore:function(){return x("year","before")},focusYearAfter:function(){return x("year","after")},focusStartOfWeek:function(){return x("startOfWeek","before")},focusEndOfWeek:function(){return x("endOfWeek","after")}};return e.jsx(Ji.Provider,{value:g,children:t.children})}function on(){var t=h.useContext(Ji);if(!t)throw new Error("useFocusContext must be used within a FocusProvider");return t}function Cp(t,s){var a=Yi(),n=rn(t,a,s);return n}var ln=h.createContext(void 0);function kp(t){if(!Ws(t.initialProps)){var s={selected:void 0};return e.jsx(ln.Provider,{value:s,children:t.children})}return e.jsx(Ep,{initialProps:t.initialProps,children:t.children})}function Ep(t){var s=t.initialProps,a=t.children,n=function(i,o,c){var d,p,u;if((d=s.onDayClick)===null||d===void 0||d.call(s,i,o,c),o.selected&&!s.required){(p=s.onSelect)===null||p===void 0||p.call(s,void 0,i,o,c);return}(u=s.onSelect)===null||u===void 0||u.call(s,i,i,o,c)},r={selected:s.selected,onDayClick:n};return e.jsx(ln.Provider,{value:r,children:a})}function Qi(){var t=h.useContext(ln);if(!t)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return t}function Ap(t,s){var a=he(),n=Qi(),r=sn(),i=nn(),o=on(),c=o.focusDayAfter,d=o.focusDayBefore,p=o.focusWeekAfter,u=o.focusWeekBefore,j=o.blur,l=o.focus,m=o.focusMonthBefore,x=o.focusMonthAfter,g=o.focusYearBefore,v=o.focusYearAfter,f=o.focusStartOfWeek,N=o.focusEndOfWeek,_=function(C){var y,R,J,q;Ws(a)?(y=n.onDayClick)===null||y===void 0||y.call(n,t,s,C):as(a)?(R=r.onDayClick)===null||R===void 0||R.call(r,t,s,C):ns(a)?(J=i.onDayClick)===null||J===void 0||J.call(i,t,s,C):(q=a.onDayClick)===null||q===void 0||q.call(a,t,s,C)},A=function(C){var y;l(t),(y=a.onDayFocus)===null||y===void 0||y.call(a,t,s,C)},E=function(C){var y;j(),(y=a.onDayBlur)===null||y===void 0||y.call(a,t,s,C)},V=function(C){var y;(y=a.onDayMouseEnter)===null||y===void 0||y.call(a,t,s,C)},Y=function(C){var y;(y=a.onDayMouseLeave)===null||y===void 0||y.call(a,t,s,C)},P=function(C){var y;(y=a.onDayPointerEnter)===null||y===void 0||y.call(a,t,s,C)},T=function(C){var y;(y=a.onDayPointerLeave)===null||y===void 0||y.call(a,t,s,C)},W=function(C){var y;(y=a.onDayTouchCancel)===null||y===void 0||y.call(a,t,s,C)},b=function(C){var y;(y=a.onDayTouchEnd)===null||y===void 0||y.call(a,t,s,C)},w=function(C){var y;(y=a.onDayTouchMove)===null||y===void 0||y.call(a,t,s,C)},M=function(C){var y;(y=a.onDayTouchStart)===null||y===void 0||y.call(a,t,s,C)},I=function(C){var y;(y=a.onDayKeyUp)===null||y===void 0||y.call(a,t,s,C)},F=function(C){var y;switch(C.key){case"ArrowLeft":C.preventDefault(),C.stopPropagation(),a.dir==="rtl"?c():d();break;case"ArrowRight":C.preventDefault(),C.stopPropagation(),a.dir==="rtl"?d():c();break;case"ArrowDown":C.preventDefault(),C.stopPropagation(),p();break;case"ArrowUp":C.preventDefault(),C.stopPropagation(),u();break;case"PageUp":C.preventDefault(),C.stopPropagation(),C.shiftKey?g():m();break;case"PageDown":C.preventDefault(),C.stopPropagation(),C.shiftKey?v():x();break;case"Home":C.preventDefault(),C.stopPropagation(),f();break;case"End":C.preventDefault(),C.stopPropagation(),N();break}(y=a.onDayKeyDown)===null||y===void 0||y.call(a,t,s,C)},z={onClick:_,onFocus:A,onBlur:E,onKeyDown:F,onKeyUp:I,onMouseEnter:V,onMouseLeave:Y,onPointerEnter:P,onPointerLeave:T,onTouchCancel:W,onTouchEnd:b,onTouchMove:w,onTouchStart:M};return z}function Tp(){var t=he(),s=Qi(),a=sn(),n=nn(),r=Ws(t)?s.selected:as(t)?a.selected:ns(t)?n.selected:void 0;return r}function Ip(t){return Object.values(Ge).includes(t)}function Pp(t,s){var a=[t.classNames.day];return Object.keys(s).forEach(function(n){var r=t.modifiersClassNames[n];if(r)a.push(r);else if(Ip(n)){var i=t.classNames["day_".concat(n)];i&&a.push(i)}}),a}function Mp(t,s){var a=se({},t.styles.day);return Object.keys(s).forEach(function(n){var r;a=se(se({},a),(r=t.modifiersStyles)===null||r===void 0?void 0:r[n])}),a}function Rp(t,s,a){var n,r,i,o=he(),c=on(),d=Cp(t,s),p=Ap(t,d),u=Tp(),j=!!(o.onDayClick||o.mode!=="default");h.useEffect(function(){var V;d.outside||c.focusedDay&&j&&Te(c.focusedDay,t)&&((V=a.current)===null||V===void 0||V.focus())},[c.focusedDay,t,a,j,d.outside]);var l=Pp(o,d).join(" "),m=Mp(o,d),x=!!(d.outside&&!o.showOutsideDays||d.hidden),g=(i=(r=o.components)===null||r===void 0?void 0:r.DayContent)!==null&&i!==void 0?i:sp,v=e.jsx(g,{date:t,displayMonth:s,activeModifiers:d}),f={style:m,className:l,children:v,role:"gridcell"},N=c.focusTarget&&Te(c.focusTarget,t)&&!d.outside,_=c.focusedDay&&Te(c.focusedDay,t),A=se(se(se({},f),(n={disabled:d.disabled,role:"gridcell"},n["aria-selected"]=d.selected,n.tabIndex=_||N?0:-1,n)),p),E={isButton:j,isHidden:x,activeModifiers:d,selectedDays:u,buttonProps:A,divProps:f};return E}function Lp(t){var s=h.useRef(null),a=Rp(t.date,t.displayMonth,s);return a.isHidden?e.jsx("div",{role:"gridcell"}):a.isButton?e.jsx(Cs,se({name:"day",ref:s},a.buttonProps)):e.jsx("div",se({},a.divProps))}function $p(t){var s=t.number,a=t.dates,n=he(),r=n.onWeekNumberClick,i=n.styles,o=n.classNames,c=n.locale,d=n.labels.labelWeekNumber,p=n.formatters.formatWeekNumber,u=p(Number(s),{locale:c});if(!r)return e.jsx("span",{className:o.weeknumber,style:i.weeknumber,children:u});var j=d(Number(s),{locale:c}),l=function(m){r(s,a,m)};return e.jsx(Cs,{name:"week-number","aria-label":j,className:o.weeknumber,style:i.weeknumber,onClick:l,children:u})}function Op(t){var s,a,n=he(),r=n.styles,i=n.classNames,o=n.showWeekNumber,c=n.components,d=(s=c==null?void 0:c.Day)!==null&&s!==void 0?s:Lp,p=(a=c==null?void 0:c.WeekNumber)!==null&&a!==void 0?a:$p,u;return o&&(u=e.jsx("td",{className:i.cell,style:r.cell,children:e.jsx(p,{number:t.weekNumber,dates:t.dates})})),e.jsxs("tr",{className:i.row,style:r.row,children:[u,t.dates.map(function(j){return e.jsx("td",{className:i.cell,style:r.cell,role:"presentation",children:e.jsx(d,{displayMonth:t.displayMonth,date:j})},_u(j))})]})}function Bn(t,s,a){for(var n=a!=null&&a.ISOWeek?Pi(s):Za(s,a),r=a!=null&&a.ISOWeek?Nt(t):st(t,a),i=He(n,r),o=[],c=0;c<=i;c++)o.push(Ne(r,c));var d=o.reduce(function(p,u){var j=a!=null&&a.ISOWeek?Li(u):Oi(u,a),l=p.find(function(m){return m.weekNumber===j});return l?(l.dates.push(u),p):(p.push({weekNumber:j,dates:[u]}),p)},[]);return d}function Fp(t,s){var a=Bn(Ie(t),Xa(t),s);if(s!=null&&s.useFixedWeeks){var n=Du(t,s);if(n<6){var r=a[a.length-1],i=r.dates[r.dates.length-1],o=Ca(i,6-n),c=Bn(Ca(i,1),o,s);a.push.apply(a,c)}}return a}function Vp(t){var s,a,n,r=he(),i=r.locale,o=r.classNames,c=r.styles,d=r.hideHead,p=r.fixedWeeks,u=r.components,j=r.weekStartsOn,l=r.firstWeekContainsDate,m=r.ISOWeek,x=Fp(t.displayMonth,{useFixedWeeks:!!p,ISOWeek:m,locale:i,weekStartsOn:j,firstWeekContainsDate:l}),g=(s=u==null?void 0:u.Head)!==null&&s!==void 0?s:tp,v=(a=u==null?void 0:u.Row)!==null&&a!==void 0?a:Op,f=(n=u==null?void 0:u.Footer)!==null&&n!==void 0?n:Xh;return e.jsxs("table",{id:t.id,className:o.table,style:c.table,role:"grid","aria-labelledby":t["aria-labelledby"],children:[!d&&e.jsx(g,{}),e.jsx("tbody",{className:o.tbody,style:c.tbody,children:x.map(function(N){return e.jsx(v,{displayMonth:t.displayMonth,dates:N.dates,weekNumber:N.weekNumber},N.weekNumber)})}),e.jsx(f,{displayMonth:t.displayMonth})]})}function zp(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Wp=zp()?h.useLayoutEffect:h.useEffect,da=!1,Bp=0;function Un(){return"react-day-picker-".concat(++Bp)}function Up(t){var s,a=t??(da?Un():null),n=h.useState(a),r=n[0],i=n[1];return Wp(function(){r===null&&i(Un())},[]),h.useEffect(function(){da===!1&&(da=!0)},[]),(s=t??r)!==null&&s!==void 0?s:void 0}function Hp(t){var s,a,n=he(),r=n.dir,i=n.classNames,o=n.styles,c=n.components,d=rs().displayMonths,p=Up(n.id?"".concat(n.id,"-").concat(t.displayIndex):void 0),u=n.id?"".concat(n.id,"-grid-").concat(t.displayIndex):void 0,j=[i.month],l=o.month,m=t.displayIndex===0,x=t.displayIndex===d.length-1,g=!m&&!x;r==="rtl"&&(s=[m,x],x=s[0],m=s[1]),m&&(j.push(i.caption_start),l=se(se({},l),o.caption_start)),x&&(j.push(i.caption_end),l=se(se({},l),o.caption_end)),g&&(j.push(i.caption_between),l=se(se({},l),o.caption_between));var v=(a=c==null?void 0:c.Caption)!==null&&a!==void 0?a:Qh;return e.jsxs("div",{className:j.join(" "),style:l,children:[e.jsx(v,{id:p,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),e.jsx(Vp,{id:u,"aria-labelledby":p,displayMonth:t.displayMonth})]},t.displayIndex)}function qp(t){var s=he(),a=s.classNames,n=s.styles;return e.jsx("div",{className:a.months,style:n.months,children:t.children})}function Gp(t){var s,a,n=t.initialProps,r=he(),i=on(),o=rs(),c=h.useState(!1),d=c[0],p=c[1];h.useEffect(function(){r.initialFocus&&i.focusTarget&&(d||(i.focus(i.focusTarget),p(!0)))},[r.initialFocus,d,i.focus,i.focusTarget,i]);var u=[r.classNames.root,r.className];r.numberOfMonths>1&&u.push(r.classNames.multiple_months),r.showWeekNumber&&u.push(r.classNames.with_weeknumber);var j=se(se({},r.styles.root),r.style),l=Object.keys(n).filter(function(x){return x.startsWith("data-")}).reduce(function(x,g){var v;return se(se({},x),(v={},v[g]=n[g],v))},{}),m=(a=(s=n.components)===null||s===void 0?void 0:s.Months)!==null&&a!==void 0?a:qp;return e.jsx("div",se({className:u.join(" "),style:j,dir:r.dir,id:r.id,nonce:n.nonce,title:n.title,lang:n.lang},l,{children:e.jsx(m,{children:o.displayMonths.map(function(x,g){return e.jsx(Hp,{displayIndex:g,displayMonth:x},g)})})}))}function Yp(t){var s=t.children,a=vh(t,["children"]);return e.jsx($h,{initialProps:a,children:e.jsx(Gh,{children:e.jsx(kp,{initialProps:a,children:e.jsx(ap,{initialProps:a,children:e.jsx(ip,{initialProps:a,children:e.jsx(pp,{children:e.jsx(Dp,{children:s})})})})})})})}function Kp(t){return e.jsx(Yp,se({},t,{children:e.jsx(Gp,{initialProps:t})}))}function Xi({className:t,classNames:s,showOutsideDays:a=!0,...n}){return e.jsx(Kp,{showOutsideDays:a,className:U("p-3 select-none",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium leading-none",nav:"space-x-1 flex items-center",nav_button:U(ya({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1 table-fixed",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem] flex items-center justify-center",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative overflow-hidden [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:U(ya({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100 flex items-center justify-center text-center leading-none"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground font-medium",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:({...r})=>e.jsx(sl,{className:"h-4 w-4"}),IconRight:({...r})=>e.jsx(tl,{className:"h-4 w-4"})},...n})}Xi.displayName="Calendar";const Jp=()=>{const[t,s]=h.useState([]),[a,n]=h.useState([]),[r,i]=h.useState(null),[o,c]=h.useState(""),[d,p]=h.useState(""),[u,j]=h.useState({}),[l,m]=h.useState(null),[x,g]=h.useState([]),[v,f]=h.useState(!1),{toast:N}=ce();h.useEffect(()=>{_(),A()},[]);const _=async()=>{try{const{data:b,error:w}=await O.from("vaccine_schedules").select("*").eq("active",!0).order("vaccine_name");if(w)throw w;s(b||[])}catch{N({title:"ข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลตารางวัคซีนได้",variant:"destructive"})}},A=async()=>{var b;try{console.log("🔍 เริ่มโหลดข้อมูลการติดตามผู้ป่วย...");const{data:w,error:M}=await O.from("appointments").select("*").order("appointment_date",{ascending:!1});if(M)throw M;console.log("📊 ข้อมูลนัดทั้งหมด:",(w==null?void 0:w.length)||0,"รายการ");const I=(w==null?void 0:w.filter(R=>R.status==="completed"))||[],F=(w==null?void 0:w.filter(R=>["scheduled","pending"].includes(R.status)))||[];console.log("✅ การฉีดที่เสร็จสิ้น:",I.length,"รายการ"),console.log("📅 นัดที่มีอยู่แล้ว:",F.length,"รายการ");const z=new Map;for(const R of I||[]){const J=R.patient_id_number||R.line_user_id,q=`${J}-${R.vaccine_type}`;if(!z.has(q)){const te=I.filter(pe=>(pe.patient_id_number||pe.line_user_id)===J&&pe.vaccine_type===R.vaccine_type&&pe.status==="completed");console.log(`👤 ผู้ป่วย: ${R.patient_name}, วัคซีน: ${R.vaccine_type}, โดสที่ฉีดแล้ว: ${te.length}`);const ne=te.reduce((pe,de)=>new Date(de.appointment_date)>new Date(pe.appointment_date)?de:pe),ve=te.reduce((pe,de)=>new Date(de.appointment_date)<new Date(pe.appointment_date)?de:pe);console.log(`📅 เข็มล่าสุด: ${ne.appointment_date}, เข็มแรก: ${ve.appointment_date}`),z.set(q,{patient_id:J,patient_name:R.patient_name,vaccine_type:R.vaccine_type,doses_received:te.length,latest_date:ne.appointment_date,first_dose_date:ve.appointment_date})}}const{data:C}=await O.from("vaccine_schedules").select("*").eq("active",!0);console.log("💉 โหลดข้อมูลวัคซีน:",(C==null?void 0:C.length)||0,"ประเภท");const y=[];for(const R of z.values())try{const J=C==null?void 0:C.find(ne=>ne.vaccine_type.toLowerCase()===R.vaccine_type.toLowerCase());if(!J){console.log(`❌ ไม่พบข้อมูลวัคซีน: ${R.vaccine_type}`);continue}let q="in_progress",te=null;if(R.doses_received>=J.total_doses)q="completed",console.log(`✅ ผู้ป่วย ${R.patient_name} ได้รับวัคซีน ${R.vaccine_type} ครบแล้ว`);else{const ne=F.find(mt=>(mt.patient_id_number||mt.line_user_id)===R.patient_id&&mt.vaccine_type.toLowerCase()===R.vaccine_type.toLowerCase()&&new Date(mt.appointment_date)>new Date),ve=Array.isArray(J.dose_intervals)?J.dose_intervals:JSON.parse(((b=J.dose_intervals)==null?void 0:b.toString())||"[]");let pe=new Date(R.latest_date);const de=typeof ve[R.doses_received]=="number"?ve[R.doses_received]:30;pe.setDate(pe.getDate()+de),te=pe.toISOString().split("T")[0],ne?(te=ne.appointment_date,console.log(`📅 วัคซีน ${R.vaccine_type}: พบนัดที่มีแล้ว ${te}`)):console.log(`🎯 วัคซีน ${R.vaccine_type}: คำนวณนัดใหม่ ${R.doses_received+1}/${J.total_doses}, วันที่: ${te}, ช่วงห่าง: ${de} วัน`)}y.push({id:`${R.patient_id}-${R.vaccine_type}`,patient_id:R.patient_id,patient_name:R.patient_name,vaccine_schedule_id:J.id,current_dose:R.doses_received,total_doses:J.total_doses,last_dose_date:R.latest_date,next_dose_due:te,completion_status:q,auto_reminder_enabled:!0,reminder_days_before:1,contraindication_checked:!1,contraindication_notes:null,vaccine_schedules:{vaccine_name:J.vaccine_name,vaccine_type:J.vaccine_type,dose_intervals:J.dose_intervals,total_doses:J.total_doses},existing_appointment:!!F.find(ne=>(ne.patient_id_number||ne.line_user_id)===R.patient_id&&ne.vaccine_type.toLowerCase()===R.vaccine_type.toLowerCase()&&new Date(ne.appointment_date)>new Date)})}catch(J){console.error("Error processing patient:",R.patient_id,J)}console.log("✅ ข้อมูลการติดตามที่คำนวณได้:",y.length,"รายการ"),n(y)}catch(w){console.error("Error loading patient tracking:",w),N({title:"ข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลการติดตามผู้ป่วยได้",variant:"destructive"})}},E=async b=>{if(b)try{f(!0);const{data:w,error:M}=await O.rpc("check_contraindications",{_vaccine_schedule_id:b,_patient_conditions:u});if(M)throw M;m(w)}catch{N({title:"ข้อผิดพลาด",description:"ไม่สามารถตรวจสอบข้อห้ามได้",variant:"destructive"})}finally{f(!1)}},V=()=>{if(!r)return;const b=r,w=new Date,M=[];M.push({dose:1,date:w,dueDays:0,status:"due",description:`โดสแรกของวัคซีน ${b.vaccine_name}`});let I=w;for(let F=1;F<b.total_doses;F++){const z=b.dose_intervals[F-1]||30;I=Ne(I,z),M.push({dose:F+1,date:I,dueDays:ta(I,w),status:"scheduled",description:`โดสที่ ${F+1} ของวัคซีน ${b.vaccine_name} (หลังจากโดสก่อนหน้า ${z} วัน)`})}if(b.booster_required&&b.booster_interval){const F=Ne(I,b.booster_interval);M.push({dose:"booster",date:F,dueDays:ta(F,w),status:"booster",description:`โดสเสริม (หลังจากโดสสุดท้าย ${b.booster_interval} วัน)`})}g(M)},Y=async()=>{var b;if(!r||!o||!d){N({title:"ข้อผิดพลาด",description:"กรุณากรอกข้อมูลให้ครบถ้วน",variant:"destructive"});return}if(l!=null&&l.has_contraindications){N({title:"พบข้อห้าม",description:"ไม่สามารถสร้างการติดตามได้เนื่องจากมีข้อห้าม",variant:"destructive"});return}try{f(!0);const w=Ne(new Date,0),{error:M}=await O.from("patient_vaccine_tracking").insert({patient_id:o,patient_name:d,vaccine_schedule_id:r.id,current_dose:1,total_doses:r.total_doses,next_dose_due:Le(w,"yyyy-MM-dd"),completion_status:"in_progress",auto_reminder_enabled:!0,reminder_days_before:1,contraindication_checked:!0,contraindication_notes:((b=l==null?void 0:l.contraindications)==null?void 0:b.length)>0?`ตรวจพบ: ${l.contraindications.join(", ")}`:null});if(M)throw M;await P(o,w),N({title:"สำเร็จ",description:"สร้างการติดตามวัคซีนเรียบร้อยแล้ว",variant:"default"}),c(""),p(""),j({}),m(null),g([]),A()}catch{N({title:"ข้อผิดพลาด",description:"ไม่สามารถสร้างการติดตามได้",variant:"destructive"})}finally{f(!1)}},P=async(b,w)=>{const M=Ne(w,-1);await O.from("notification_schedules").insert({patient_tracking_id:null,notification_type:"reminder",scheduled_date:Le(M,"yyyy-MM-dd"),message_content:`🔔 แจ้งเตือนการฉีดวัคซีน

พรุ่งนี้ (${Le(w,"dd/MM/yyyy")}) คุณมีนัดฉีดวัคซีน ${r==null?void 0:r.vaccine_name}

กรุณามาตรงเวลา`,line_user_id:b,sent:!1})},T=(b,w)=>{j(M=>({...M,[b]:w}))},W=b=>{const w={due:{color:"bg-green-500",text:"ถึงกำหนด"},scheduled:{color:"bg-blue-500",text:"กำหนดการ"},booster:{color:"bg-purple-500",text:"โดสเสริม"},overdue:{color:"bg-red-500",text:"เกินกำหนด"},completed:{color:"bg-gray-500",text:"เสร็จสิ้น"}},M=w[b]||w.scheduled;return e.jsx(H,{className:M.color,children:M.text})};return e.jsx("div",{className:"space-y-4 md:space-y-6",children:e.jsxs(Ue,{defaultValue:"calculator",className:"space-y-4",children:[e.jsxs(ze,{className:"grid w-full grid-cols-1 md:grid-cols-3 gap-1 md:gap-0 h-auto md:h-10",children:[e.jsxs(Z,{value:"calculator",className:"flex items-center gap-2 text-sm md:text-base p-3 md:p-2",children:[e.jsx(al,{className:"h-4 w-4"}),e.jsx("span",{children:"คำนวณตารางวัคซีน"})]}),e.jsxs(Z,{value:"tracking",className:"flex items-center gap-2 text-sm md:text-base p-3 md:p-2",children:[e.jsx(ua,{className:"h-4 w-4"}),e.jsx("span",{children:"ติดตามผู้ป่วย"})]}),e.jsxs(Z,{value:"schedules",className:"flex items-center gap-2 text-sm md:text-base p-3 md:p-2",children:[e.jsx(bs,{className:"h-4 w-4"}),e.jsx("span",{children:"ตารางวัคซีน"})]})]}),e.jsx(ee,{value:"calculator",className:"space-y-4 md:space-y-6",children:e.jsxs(S,{children:[e.jsxs(L,{className:"pb-3 md:pb-4",children:[e.jsxs($,{className:"flex items-center space-x-2 text-lg md:text-xl",children:[e.jsx(Ce,{className:"h-5 w-5 text-primary"}),e.jsx("span",{children:"คำนวณตารางวัคซีนสำหรับผู้ป่วย"})]}),e.jsx(oe,{className:"text-sm md:text-base",children:"เลือกวัคซีนและระบุข้อมูลผู้ป่วยเพื่อคำนวณตารางการฉีดและตรวจสอบข้อห้าม"})]}),e.jsxs(D,{className:"space-y-4 p-4 md:p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"patient-id",className:"text-sm md:text-base font-medium",children:"รหัสผู้ป่วย/LINE User ID"}),e.jsx(ae,{id:"patient-id",value:o,onChange:b=>c(b.target.value),placeholder:"ระบุรหัสผู้ป่วย",className:"text-sm md:text-base"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"patient-name",className:"text-sm md:text-base font-medium",children:"ชื่อผู้ป่วย"}),e.jsx(ae,{id:"patient-name",value:d,onChange:b=>p(b.target.value),placeholder:"ระบุชื่อผู้ป่วย",className:"text-sm md:text-base"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"vaccine-select",className:"text-sm md:text-base font-medium",children:"เลือกวัคซีน"}),e.jsxs(ct,{value:(r==null?void 0:r.id)||"",onValueChange:b=>{const w=t.find(M=>M.id===b);i(w||null),m(null)},children:[e.jsx(et,{className:"text-sm md:text-base",children:e.jsx(dt,{placeholder:"เลือกวัคซีนที่ต้องการ"})}),e.jsx(tt,{children:t.map(b=>e.jsxs(_e,{value:b.id,className:"text-sm md:text-base",children:[b.vaccine_name," (",b.total_doses," โดส)"]},b.id))})]})]}),r&&e.jsxs(S,{className:"border-primary/20 mt-4",children:[e.jsx(L,{className:"pb-3",children:e.jsxs($,{className:"text-base md:text-lg text-primary",children:["ข้อมูลวัคซีน: ",r.vaccine_name]})}),e.jsxs(D,{className:"space-y-3 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 text-sm md:text-base",children:[e.jsxs("div",{className:"bg-background/50 p-3 rounded-lg",children:[e.jsx("span",{className:"font-medium text-muted-foreground block mb-1",children:"จำนวนโดส:"}),e.jsxs("p",{className:"font-semibold",children:[r.total_doses," โดส"]})]}),e.jsxs("div",{className:"bg-background/50 p-3 rounded-lg",children:[e.jsx("span",{className:"font-medium text-muted-foreground block mb-1",children:"ระยะห่าง:"}),e.jsxs("p",{className:"font-semibold",children:[r.dose_intervals.join(", ")," วัน"]})]}),e.jsxs("div",{className:"bg-background/50 p-3 rounded-lg",children:[e.jsx("span",{className:"font-medium text-muted-foreground block mb-1",children:"ระยะเวลาคุ้มกัน:"}),e.jsxs("p",{className:"font-semibold",children:[Math.round(r.efficacy_duration/365)," ปี"]})]}),e.jsxs("div",{className:"bg-background/50 p-3 rounded-lg",children:[e.jsx("span",{className:"font-medium text-muted-foreground block mb-1",children:"โดสเสริม:"}),e.jsx("p",{className:"font-semibold",children:r.booster_required?"ต้องการ":"ไม่ต้องการ"})]})]}),r.age_restrictions&&e.jsxs("div",{className:"bg-background/50 p-3 rounded-lg",children:[e.jsx("span",{className:"font-medium text-muted-foreground block mb-2",children:"ข้อจำกัดอายุ:"}),e.jsxs("p",{className:"text-sm md:text-base",children:[r.age_restrictions.min_age&&`อายุขั้นต่ำ ${r.age_restrictions.min_age} ปี`,r.age_restrictions.min_age&&r.age_restrictions.max_age&&" - ",r.age_restrictions.max_age&&`อายุสูงสุด ${r.age_restrictions.max_age} ปี`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"ข้อบ่งชี้:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:r.indications.map((b,w)=>e.jsx(H,{variant:"secondary",className:"text-xs md:text-sm",children:b},w))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"ข้อห้าม:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:r.contraindications.map((b,w)=>e.jsx(H,{variant:"destructive",className:"text-xs md:text-sm",children:b},w))})]})]})]}),r&&e.jsxs(S,{children:[e.jsx(L,{children:e.jsx($,{className:"text-lg",children:"ตรวจสอบข้อห้ามสำหรับผู้ป่วย"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"age",children:"อายุ (ปี)"}),e.jsx(ae,{id:"age",type:"number",value:u.age||"",onChange:b=>T("age",parseInt(b.target.value)||0),placeholder:"อายุ"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(K,{children:"ประวัติและสภาวะของผู้ป่วย:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{key:"pregnancy",label:"ตั้งครรภ์"},{key:"immunocompromised",label:"ภูมิคุ้มกันบกพร่อง"},{key:"severe_allergic_reaction",label:"แพ้รุนแรง"},{key:"myocarditis_history",label:"ประวัติกล้ามเนื้อหัวใจอักเสบ"},{key:"guillain_barre_syndrome",label:"กิแลง-บาร์เร่ ซินโดรม"},{key:"chronic_disease",label:"โรคเรื้อรัง"}].map(({key:b,label:w})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ka,{id:b,checked:!!u[b],onCheckedChange:M=>T(b,!!M)}),e.jsx(K,{htmlFor:b,className:"text-sm",children:w})]},b))})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(k,{onClick:()=>E(r.id),disabled:v,children:v?"กำลังตรวจสอบ...":"ตรวจสอบข้อห้าม"}),e.jsx(k,{onClick:V,variant:"outline",children:"คำนวณตารางวัคซีน"})]}),l&&e.jsxs(Q,{className:l.has_contraindications?"border-red-200":"border-green-200",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(X,{children:l.has_contraindications?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-600",children:"พบข้อห้าม:"}),e.jsx("ul",{className:"list-disc list-inside mt-1",children:l.contraindications.map((b,w)=>e.jsx("li",{children:b},w))})]}):e.jsx("p",{className:"text-green-600",children:"ไม่พบข้อห้าม สามารถฉีดวัคซีนได้"})})]})]})]}),x.length>0&&e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(Xi,{className:"h-5 w-5"}),e.jsx("span",{children:"ตารางการฉีดวัคซีน"})]})}),e.jsxs(D,{children:[e.jsx("div",{className:"space-y-3",children:x.map((b,w)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-lg font-medium",children:typeof b.dose=="number"?`โดส ${b.dose}`:"โดสเสริม"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Le(b.date,"dd MMMM yyyy",{locale:ia})}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["(",b.dueDays===0?"วันนี้":`อีก ${b.dueDays} วัน`,")"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:W(b.status)})]},w))}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx(k,{onClick:Y,disabled:v||(l==null?void 0:l.has_contraindications),className:"w-full",children:v?"กำลังสร้าง...":"สร้างการติดตามวัคซีน"})})]})]})]})]})}),e.jsx(ee,{value:"tracking",className:"space-y-4",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(ua,{className:"h-5 w-5"}),e.jsx("span",{children:"การติดตามผู้ป่วย"})]}),e.jsx(oe,{children:"รายการผู้ป่วยที่กำลังอยู่ในระหว่างการฉีดวัคซีนตามตาราง"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[a.map(b=>{var w,M,I;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(yt,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:b.patient_name}),e.jsx(H,{variant:"outline",children:b.patient_id})]}),e.jsx(H,{className:b.completion_status==="completed"?"bg-green-500":b.completion_status==="overdue"?"bg-red-500":b.completion_status==="cancelled"?"bg-gray-500":"bg-blue-500",children:b.completion_status==="completed"?"เสร็จสิ้น":b.completion_status==="overdue"?"เกินกำหนด":b.completion_status==="cancelled"?"ยกเลิก":"อยู่ระหว่างดำเนินการ"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"วัคซีน:"}),e.jsx("p",{className:"font-medium",children:(w=b.vaccine_schedules)==null?void 0:w.vaccine_name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ประเภท: ",(M=b.vaccine_schedules)==null?void 0:M.vaccine_type]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"ความคืบหน้า:"}),e.jsx("p",{className:"font-medium",children:b.current_dose>0?`ฉีดแล้ว ${b.current_dose} จาก ${b.total_doses} เข็ม`:"ยังไม่เริ่มฉีด"}),b.current_dose>0&&b.current_dose<b.total_doses&&e.jsxs("p",{className:"text-xs text-green-600",children:["โดสถัดไป: เข็มที่ ",b.current_dose+1]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"เข็มล่าสุด:"}),e.jsx("p",{className:"font-medium",children:b.last_dose_date&&b.current_dose>0?Le(aa(b.last_dose_date),"dd MMM yyyy",{locale:ia}):"ยังไม่ได้ฉีด"}),b.last_dose_date&&b.current_dose>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["เข็มที่ ",b.current_dose]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"นัดครั้งถัดไป:"}),b.next_dose_due?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-600",children:Le(aa(b.next_dose_due),"dd MMM yyyy",{locale:ia})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["เข็มที่ ",b.current_dose+1," •",(()=>{const F=ta(aa(b.next_dose_due),new Date);return F<0?` เลยมา ${Math.abs(F)} วัน`:F===0?" วันนี้":` อีก ${F} วัน`})()]}),b.existing_appointment&&e.jsx("p",{className:"text-xs text-green-600",children:"✓ นัดในระบบแล้ว"}),((I=b.vaccine_schedules)==null?void 0:I.dose_intervals)&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ระยะห่าง: ",b.vaccine_schedules.dose_intervals[b.current_dose]||"N/A"," วัน"]})]}):b.completion_status==="completed"?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-600",children:"เสร็จสิ้น"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ครบตามตาราง"})]}):b.current_dose<b.total_doses?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-orange-600",children:"ต้องกำหนดนัด"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["เข็มที่ ",b.current_dose+1]})]}):e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-500",children:"ไม่มี"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"รอการกำหนด"})]})]})]}),b.contraindication_notes&&e.jsxs("div",{className:"mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"หมายเหตุข้อห้าม:"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:b.contraindication_notes})]}),e.jsx("div",{className:"mt-3 flex items-center space-x-2",children:b.auto_reminder_enabled&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[e.jsx($e,{className:"h-3 w-3"}),e.jsxs("span",{children:["แจ้งเตือนอัตโนมัติ ",b.reminder_days_before," วันก่อน"]})]})})]},b.id)}),a.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(bs,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"ยังไม่มีการติดตามผู้ป่วย"})]})]})})]})}),e.jsx(ee,{value:"schedules",className:"space-y-4",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsx($,{children:"ตารางวัคซีนที่มีในระบบ"}),e.jsx(oe,{children:"ข้อมูลวัคซีนทั้งหมดที่สามารถใช้คำนวณตารางได้"})]}),e.jsx(D,{children:e.jsx("div",{className:"space-y-4",children:t.map(b=>e.jsxs(S,{className:"border-muted",children:[e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{className:"text-lg",children:b.vaccine_name}),e.jsx(H,{className:"bg-primary",children:b.vaccine_type})]})}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"จำนวนโดส:"}),e.jsxs("p",{children:[b.total_doses," โดส"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ระยะห่าง:"}),e.jsx("p",{children:b.dose_intervals.length>0?b.dose_intervals.join(", ")+" วัน":"ไม่มี"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ระยะเวลาคุ้มกัน:"}),e.jsxs("p",{children:[Math.round(b.efficacy_duration/365)," ปี"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"โดสเสริม:"}),e.jsx("p",{children:b.booster_required?`จำเป็น (ทุก ${Math.round((b.booster_interval||0)/365)} ปี)`:"ไม่จำเป็น"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"ข้อบ่งชี้:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:b.indications.map((w,M)=>e.jsx(H,{variant:"secondary",className:"text-xs",children:w},M))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"ข้อห้าม:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:b.contraindications.map((w,M)=>e.jsx(H,{variant:"destructive",className:"text-xs",children:w},M))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"ผลข้างเคียง:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:b.side_effects.map((w,M)=>e.jsx(H,{variant:"outline",className:"text-xs",children:w},M))})]})]})]})]},b.id))})})]})})]})})},Qp=()=>{const[t,s]=h.useState([]),[a,n]=h.useState(""),[r,i]=h.useState(!1),{toast:o}=ce(),c=async()=>{i(!0);try{const{data:l,error:m}=await O.from("patient_registrations").select("*").order("created_at",{ascending:!1});if(m)throw m;s(l||[])}catch(l){console.error("Error loading registrations:",l),o({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลการลงทะเบียนได้",variant:"destructive"})}finally{i(!1)}},d=async(l,m)=>{try{const{error:x}=await O.from("patient_registrations").update({status:m,updated_at:new Date().toISOString()}).eq("id",l);if(x)throw x;o({title:"อัปเดตสำเร็จ",description:"อัปเดตสถานะการลงทะเบียนแล้ว"}),c()}catch(x){console.error("Error updating registration:",x),o({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถอัปเดตสถานะได้",variant:"destructive"})}};h.useEffect(()=>{c()},[]);const p=t.filter(l=>l.full_name.toLowerCase().includes(a.toLowerCase())||l.phone.includes(a)||l.registration_id.toLowerCase().includes(a.toLowerCase())),u=l=>{switch(l){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"confirmed":return"bg-green-100 text-green-800 border-green-200";case"completed":return"bg-blue-100 text-blue-800 border-blue-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},j=l=>{switch(l){case"pending":return"รอดำเนินการ";case"confirmed":return"ยืนยันแล้ว";case"completed":return"เสร็จสิ้น";case"cancelled":return"ยกเลิก";default:return l}};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(Oe,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"รายการลงทะเบียน"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"จัดการข้อมูลผู้ลงทะเบียนรับวัคซีน"})]})]}),e.jsxs(k,{onClick:c,disabled:r,variant:"outline",children:[e.jsx(Se,{className:`h-4 w-4 mr-2 ${r?"animate-spin":""}`}),"รีเฟรช"]})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-5 w-5"}),"ค้นหาผู้ลงทะเบียน"]}),e.jsxs(H,{variant:"secondary",children:["ทั้งหมด ",p.length," คน"]})]})}),e.jsxs(D,{children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(ae,{placeholder:"ค้นหาด้วยชื่อ, เบอร์โทร, หรือ ID",value:a,onChange:l=>n(l.target.value),className:"pl-10"})]}),e.jsx("div",{className:"space-y-4",children:p.map(l=>e.jsx("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:l.full_name}),e.jsx(H,{className:u(l.status),children:j(l.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nl,{className:"h-4 w-4"}),l.phone]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"ID: ",l.registration_id]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),new Date(l.created_at).toLocaleDateString("th-TH")]})]}),l.notes&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground bg-muted/50 p-2 rounded",children:l.notes})]}),e.jsx("div",{className:"flex gap-2 ml-4",children:l.status==="pending"&&e.jsxs(k,{size:"sm",onClick:()=>d(l.id,"confirmed"),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"ยืนยัน"]})})]})},l.id))}),p.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Oe,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:a?"ไม่พบข้อมูลที่ค้นหา":"ยังไม่มีการลงทะเบียน"})]})]})]})]})},Xp=()=>{const[t,s]=h.useState([]),[a,n]=h.useState(""),[r,i]=h.useState(!1),[o,c]=h.useState(null),[d,p]=h.useState(null),{toast:u}=ce(),j=async()=>{i(!0);try{console.log("🔍 เริ่มโหลดข้อมูลนัดครั้งถัดไป...");const{data:f,error:N}=await O.from("appointments").select("*").order("appointment_date",{ascending:!1});if(N)throw N;console.log("📊 ข้อมูลนัดทั้งหมด:",(f==null?void 0:f.length)||0,"รายการ");const _=(f==null?void 0:f.filter(w=>w.status==="completed"))||[],A=(f==null?void 0:f.filter(w=>["scheduled","pending"].includes(w.status)&&new Date(w.appointment_date)>=new Date))||[];console.log("✅ การฉีดที่เสร็จสิ้น:",_.length,"รายการ"),console.log("📅 นัดที่มีอยู่แล้ว:",A.length,"รายการ");const E=new Map;for(const w of _||[]){const M=w.patient_id_number||w.line_user_id,I=`${M}-${w.vaccine_type}`;if(!E.has(I)){const F=_.filter(y=>(y.patient_id_number||y.line_user_id)===M&&y.vaccine_type===w.vaccine_type&&y.status==="completed");console.log(`👤 ผู้ป่วย: ${w.patient_name}, วัคซีน: ${w.vaccine_type}, โดสที่ฉีดแล้ว: ${F.length}`);const z=F.reduce((y,R)=>new Date(R.appointment_date)>new Date(y.appointment_date)?R:y),C=F.reduce((y,R)=>new Date(R.appointment_date)<new Date(y.appointment_date)?R:y);console.log(`📅 เข็มล่าสุด: ${z.appointment_date}, เข็มแรก: ${C.appointment_date}`),E.set(I,{patient_id:M,patient_name:w.patient_name,line_user_id:w.line_user_id,vaccine_type:w.vaccine_type,doses_received:F.length,latest_date:z.appointment_date,first_dose_date:C.appointment_date})}}const{data:V}=await O.from("vaccine_schedules").select("*").eq("active",!0);console.log("💉 โหลดข้อมูลวัคซีน:",(V==null?void 0:V.length)||0,"ประเภท");const Y=[];for(const w of A)if(new Date(w.appointment_date)>new Date&&["scheduled","pending"].includes(w.status)){const M=w.patient_id_number||w.line_user_id,I=_.filter(z=>(z.patient_id_number||z.line_user_id)===M&&z.vaccine_type.toLowerCase()===w.vaccine_type.toLowerCase()),F=V==null?void 0:V.find(z=>z.vaccine_type.toLowerCase()===w.vaccine_type.toLowerCase());F&&(Y.push({id:`scheduled-${w.id}`,patient_id:M,patient_name:w.patient_name,vaccine_name:w.vaccine_name||F.vaccine_name,vaccine_type:w.vaccine_type,current_dose:I.length,total_doses:F.total_doses,next_dose_due:w.appointment_date,last_dose_date:I.length>0?I.reduce((z,C)=>new Date(C.appointment_date)>new Date(z.appointment_date)?C:z).appointment_date:null,first_dose_date:I.length>0?I.reduce((z,C)=>new Date(C.appointment_date)<new Date(z.appointment_date)?C:z).appointment_date:null,completion_status:"scheduled",line_user_id:w.line_user_id,vaccine_schedule_id:F.id,is_existing_appointment:!0}),console.log(`📅 นัดที่มีอยู่: ${w.patient_name} - ${w.vaccine_type} วันที่ ${w.appointment_date}`))}const P=Array.from(E.values()).map(async w=>{var M;try{const I=V==null?void 0:V.find(q=>q.vaccine_type.toLowerCase()===w.vaccine_type.toLowerCase());if(!I)return console.log(`❌ ไม่พบข้อมูลวัคซีน: ${w.vaccine_type}`),null;if(w.doses_received>=I.total_doses)return console.log(`✅ ผู้ป่วย ${w.patient_name} ได้รับวัคซีน ${w.vaccine_type} ครบแล้ว`),null;const F=A.find(q=>(q.patient_id_number||q.line_user_id)===w.patient_id&&q.vaccine_type.toLowerCase()===w.vaccine_type.toLowerCase()&&new Date(q.appointment_date)>new Date&&["scheduled","pending"].includes(q.status));if(F)return console.log(`📅 ผู้ป่วย ${w.patient_name} มีนัด ${w.vaccine_type} แล้วในวันที่ ${F.appointment_date} - ข้าม`),null;const z=Array.isArray(I.dose_intervals)?I.dose_intervals:JSON.parse(((M=I.dose_intervals)==null?void 0:M.toString())||"[]");let C=new Date(w.latest_date);const y=w.doses_received,R=typeof z[y]=="number"?z[y]:typeof z[w.doses_received-1]=="number"?z[w.doses_received-1]:30;C.setDate(C.getDate()+R);const J=w.doses_received+1;return console.log(`🎯 ${w.patient_name}: ต้องการโดสใหม่ ${J}/${I.total_doses}, คำนวณนัด: ${C.toISOString().split("T")[0]}, ช่วงห่าง: ${R} วัน`),{id:`new-${w.patient_id}-${w.vaccine_type}`,patient_id:w.patient_id,patient_name:w.patient_name,vaccine_name:I.vaccine_name,vaccine_type:w.vaccine_type,current_dose:w.doses_received,total_doses:I.total_doses,next_dose_due:C.toISOString().split("T")[0],last_dose_date:w.latest_date,first_dose_date:w.first_dose_date,completion_status:"needs_appointment",line_user_id:w.line_user_id,vaccine_schedule_id:I.id,is_existing_appointment:!1}}catch(I){return console.error("Error processing patient:",w.patient_id,I),null}}),W=(await Promise.all(P)).filter(w=>w!==null),b=[...Y,...W].sort((w,M)=>new Date(w.next_dose_due).getTime()-new Date(M.next_dose_due).getTime());console.log("✅ ผลลัพธ์สุดท้าย:",b.length,"รายการ"),console.log("📅 นัดที่มีอยู่แล้ว:",Y.length,"รายการ"),console.log("🆕 นัดใหม่ที่ต้องสร้าง:",W.length,"รายการ"),b.forEach(w=>{const M=w.is_existing_appointment?"(มีนัดแล้ว)":"(ต้องสร้างนัด)";console.log(`- ${w.patient_name}: โดส ${w.current_dose+1}/${w.total_doses}, นัด: ${w.next_dose_due}, เข็มล่าสุด: ${w.last_dose_date||"ยังไม่มี"} ${M}`)}),s(b)}catch(f){console.error("Error loading next appointments:",f),u({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลนัดครั้งถัดไปได้",variant:"destructive"})}finally{i(!1)}},l=async f=>{try{const{data:N}=await O.from("appointments").select("*").eq("patient_id_number",f.patient_id).eq("vaccine_type",f.vaccine_type).in("status",["scheduled","pending"]).gte("appointment_date",new Date().toISOString().split("T")[0]);if(N&&N.length>0){u({title:"มีนัดอยู่แล้ว",description:`${f.patient_name} มีนัดหมายสำหรับวัคซีนนี้แล้ว`,variant:"destructive"}),s(_=>_.filter(A=>A.id!==f.id));return}}catch(N){console.error("Error checking existing appointments:",N)}c(f.id);try{const N={patient_id_number:f.patient_id,patient_name:f.patient_name,vaccine_type:f.vaccine_type,appointment_date:f.next_dose_due,status:"scheduled",line_user_id:f.line_user_id,notes:`นัดเข็มที่ ${f.current_dose+1} จาก ${f.total_doses} เข็ม`},{error:_}=await O.from("appointments").insert([N]);if(_)throw _;s(A=>A.filter(E=>E.id!==f.id)),u({title:"นัดหมายสำเร็จ",description:`สร้างนัดหมายสำหรับ ${f.patient_name} แล้ว`})}catch(N){console.error("Error scheduling appointment:",N),u({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถสร้างนัดหมายได้",variant:"destructive"})}finally{c(null)}},m=async f=>{if(!f.line_user_id){u({title:"ไม่สามารถส่งได้",description:"ไม่พบ LINE User ID ของผู้ป่วย",variant:"destructive"});return}p(f.id);try{const{error:N}=await O.functions.invoke("send-line-message",{body:{userId:f.line_user_id,message:`🏥 แจ้งเตือนนัดฉีดวัคซีน

คุณ ${f.patient_name}
นัดฉีดเข็มที่ ${f.current_dose+1} 
วัคซีน: ${f.vaccine_name}
วันที่นัด: ${new Date(f.next_dose_due).toLocaleDateString("th-TH")}

กรุณามาตามนัดตรงเวลา

📍 โรงพยาบาลโฮม`}});if(N)throw N;u({title:"ส่งข้อความแล้ว",description:`ส่งข้อความแจ้งเตือนไปยัง ${f.patient_name} แล้ว`})}catch(N){console.error("Error sending reminder:",N),u({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถส่งข้อความแจ้งเตือนได้",variant:"destructive"})}finally{p(null)}};h.useEffect(()=>{j();const f=setInterval(()=>{j()},3e4);return()=>clearInterval(f)},[]);const x=t.filter(f=>f.patient_name.toLowerCase().includes(a.toLowerCase())||f.vaccine_type.toLowerCase().includes(a.toLowerCase())||f.patient_id.toLowerCase().includes(a.toLowerCase())),g=f=>{const N=new Date,A=new Date(f).getTime()-N.getTime();return Math.ceil(A/(1e3*60*60*24))},v=f=>f<0?e.jsxs(H,{className:"bg-red-100 text-red-800 border-red-200",children:["เกินกำหนด ",Math.abs(f)," วัน"]}):f===0?e.jsx(H,{className:"bg-orange-100 text-orange-800 border-orange-200",children:"ครบกำหนดวันนี้"}):f<=7?e.jsxs(H,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:["อีก ",f," วัน"]}):e.jsxs(H,{className:"bg-green-100 text-green-800 border-green-200",children:["อีก ",f," วัน"]});return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(Ys,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"นัดครั้งถัดไป"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["รายการผู้ป่วยที่ต้องฉีดเข็มถัดไป (อัปเดตล่าสุด: ",new Date().toLocaleTimeString("th-TH"),")"]})]})]}),e.jsxs(k,{onClick:j,disabled:r,variant:"outline",children:[e.jsx(Se,{className:`h-4 w-4 mr-2 ${r?"animate-spin":""}`}),"รีเฟรช"]})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-5 w-5"}),"ค้นหานัดครั้งถัดไป"]}),e.jsxs(H,{variant:"secondary",children:["ทั้งหมด ",x.length," คน"]})]})}),e.jsxs(D,{children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(ae,{placeholder:"ค้นหาด้วยชื่อผู้ป่วย, ประเภทวัคซีน, หรือ ID",value:a,onChange:f=>n(f.target.value),className:"pl-10"})]}),e.jsx("div",{className:"space-y-4",children:x.map(f=>{const N=g(f.next_dose_due);return e.jsx("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:f.patient_name}),v(N)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-muted-foreground mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),f.vaccine_name]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"เข็มที่ ",f.current_dose+1," จาก ",f.total_doses]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"ครบกำหนด: ",new Date(f.next_dose_due).toLocaleDateString("th-TH")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"📅"}),"เข็มล่าสุด: ",f.last_dose_date?new Date(f.last_dose_date).toLocaleDateString("th-TH"):"ไม่พบข้อมูล"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground bg-muted/50 p-2 rounded flex justify-between",children:[e.jsxs("span",{children:["ID: ",f.patient_id]}),e.jsx("span",{className:"text-blue-600",children:f.is_existing_appointment?"✓ มีนัดแล้ว":"⚠ ต้องสร้างนัด"})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[f.is_existing_appointment?e.jsx(H,{className:"bg-green-100 text-green-800 border-green-200",children:"มีนัดแล้ว"}):e.jsxs(k,{size:"sm",onClick:()=>l(f),disabled:o===f.id||o!==null,className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o===f.id?e.jsx(Se,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx(Ys,{className:"h-4 w-4 mr-1"}),o===f.id?"กำลังสร้าง...":"สร้างนัด"]}),f.line_user_id&&e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>m(f),disabled:d===f.id,className:"disabled:opacity-50",children:[d===f.id?e.jsx(Se,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx(Ps,{className:"h-4 w-4 mr-1"}),d===f.id?"กำลังส่ง...":"แจ้งเตือน"]})]})]})},f.id)})}),x.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ys,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:a?"ไม่พบข้อมูลที่ค้นหา":"ไม่มีนัดครั้งถัดไปในขณะนี้"})]})]})]})]})},Zp=()=>{const[t,s]=h.useState([]),[a,n]=h.useState(""),[r,i]=h.useState(!1),{toast:o}=ce(),c=async()=>{i(!0);try{const{data:u,error:j}=await O.from("appointments").select("*").eq("status","completed").order("appointment_date",{ascending:!1});if(j)throw j;s(u||[])}catch(u){console.error("Error loading vaccinations:",u),o({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลประวัติการฉีดวัคซีนได้",variant:"destructive"})}finally{i(!1)}};h.useEffect(()=>{c()},[]);const d=t.filter(u=>u.patient_name.toLowerCase().includes(a.toLowerCase())||u.vaccine_type.toLowerCase().includes(a.toLowerCase())||u.patient_phone&&u.patient_phone.includes(a)||u.patient_id_number&&u.patient_id_number.toLowerCase().includes(a.toLowerCase())),p=()=>{const u=[["วันที่","ชื่อผู้ป่วย","เบอร์โทร","ประเภทวัคซีน","หมายเหตุ"].join(","),...d.map(x=>[new Date(x.appointment_date).toLocaleDateString("th-TH"),x.patient_name,x.patient_phone||"",x.vaccine_type,x.notes||""].join(","))].join(`
`),j=new Blob([u],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),m=URL.createObjectURL(j);l.setAttribute("href",m),l.setAttribute("download",`vaccination_history_${new Date().toISOString().split("T")[0]}.csv`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(vn,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"ประวัติการฉีดวัคซีน"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"รายการผู้ที่ได้รับวัคซีนแล้ว"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:p,variant:"outline",size:"sm",children:[e.jsx(bs,{className:"h-4 w-4 mr-2"}),"ส่งออก CSV"]}),e.jsxs(k,{onClick:c,disabled:r,variant:"outline",children:[e.jsx(Se,{className:`h-4 w-4 mr-2 ${r?"animate-spin":""}`}),"รีเฟรช"]})]})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-5 w-5"}),"ค้นหาประวัติการฉีดวัคซีน"]}),e.jsxs(H,{variant:"secondary",children:["ทั้งหมด ",d.length," ครั้ง"]})]})}),e.jsxs(D,{children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(ae,{placeholder:"ค้นหาด้วยชื่อผู้ป่วย, ประเภทวัคซีน, หรือเบอร์โทร",value:a,onChange:u=>n(u.target.value),className:"pl-10"})]}),e.jsx("div",{className:"space-y-4",children:d.map(u=>e.jsx("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:u.patient_name}),e.jsx(H,{className:"bg-green-100 text-green-800 border-green-200",children:"ฉีดแล้ว"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),new Date(u.appointment_date).toLocaleDateString("th-TH"),u.appointment_time&&` เวลา ${u.appointment_time}`]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),u.vaccine_type]}),u.patient_phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"📞"}),u.patient_phone]}),u.patient_id_number&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"🆔"}),u.patient_id_number]})]}),u.notes&&e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground bg-muted/50 p-2 rounded",children:["หมายเหตุ: ",u.notes]})]})})},u.id))}),d.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(vn,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:a?"ไม่พบข้อมูลที่ค้นหา":"ยังไม่มีประวัติการฉีดวัคซีน"})]})]})]})]})},ex=()=>{const[t,s]=h.useState([]),[a,n]=h.useState(!1),[r,i]=h.useState(null),{toast:o}=ce(),c=async()=>{try{const{data:l,error:m}=await O.from("appointment_notifications").select("*").order("created_at",{ascending:!1}).limit(50);if(m)throw m;s(l||[])}catch(l){console.error("Error loading notification history:",l),o({title:"ข้อผิดพลาด",description:"ไม่สามารถโหลดประวัติการแจ้งเตือนได้",variant:"destructive"})}},d=async()=>{var l,m;n(!0);try{const{data:x,error:g}=await O.functions.invoke("manual-notification-trigger",{body:{}});if(g)throw g;i(x.result),o({title:"ระบบแจ้งเตือนทำงานสำเร็จ",description:`ส่งการแจ้งเตือน ${((m=(l=x.result)==null?void 0:l.statistics)==null?void 0:m.notificationsSent)||0} รายการ`}),setTimeout(()=>{c()},2e3)}catch(x){console.error("Error running auto notifications:",x),o({title:"เกิดข้อผิดพลาด",description:x.message||"ไม่สามารถเรียกใช้ระบบแจ้งเตือนได้",variant:"destructive"})}finally{n(!1)}},p=l=>{switch(l){case"sent":return"bg-green-100 text-green-800 border-green-200";case"failed":return"bg-red-100 text-red-800 border-red-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},u=l=>{switch(l){case"reminder":return e.jsx(De,{className:"h-4 w-4"});case"overdue":return e.jsx(je,{className:"h-4 w-4"});default:return e.jsx($e,{className:"h-4 w-4"})}},j=l=>{switch(l){case"reminder":return"แจ้งเตือนล่วงหน้า";case"overdue":return"การนัดเกินกำหนด";default:return l}};return h.useEffect(()=>{c()},[]),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs(S,{children:[e.jsx(L,{className:"pb-3 md:pb-4",children:e.jsxs($,{className:"flex items-center gap-2 text-lg md:text-xl",children:[e.jsx(Zt,{className:"h-5 w-5 text-primary"}),"ระบบแจ้งเตือนอัตโนมัติ"]})}),e.jsxs(D,{className:"space-y-4 p-4 md:p-6",children:[e.jsxs(Q,{children:[e.jsx($e,{className:"h-4 w-4"}),e.jsxs(X,{className:"text-sm md:text-base",children:["ระบบจะตรวจสอบและส่งการแจ้งเตือนล่วงหน้าอัตโนมัติ:",e.jsx("br",{}),"• แจ้งเตือน 1 วันก่อนวันนัด และ 8 ชั่วโมงก่อนวันนัด",e.jsx("br",{}),"• ตรวจสอบการนัดเกินกำหนดและส่งการแจ้งเตือน"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(k,{onClick:d,disabled:a,className:"flex-1 h-11",children:[e.jsx(Ps,{className:"h-4 w-4 mr-2"}),a?"กำลังดำเนินการ...":"เรียกใช้ระบบแจ้งเตือน"]}),e.jsxs(k,{onClick:c,variant:"outline",className:"h-11",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"รีเฟรช"]})]}),(r==null?void 0:r.statistics)&&e.jsxs("div",{className:"mt-4 p-3 md:p-4 bg-muted/50 rounded-lg border",children:[e.jsxs("h3",{className:"font-medium text-sm md:text-base mb-3 flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-600"}),"ผลการทำงานล่าสุด"]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-lg",children:r.statistics.appointmentsChecked}),e.jsx("div",{className:"text-muted-foreground",children:"นัดพรุ่งนี้"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-lg",children:r.statistics.overdueAppointmentsChecked}),e.jsx("div",{className:"text-muted-foreground",children:"นัดเกินกำหนด"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-lg text-green-600",children:r.statistics.notificationsSent}),e.jsx("div",{className:"text-muted-foreground",children:"ส่งสำเร็จ"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-lg text-red-600",children:r.statistics.errors}),e.jsx("div",{className:"text-muted-foreground",children:"ข้อผิดพลาด"})]})]}),r.timestamp&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["เมื่อ: ",new Date(r.timestamp).toLocaleString("th-TH")]})]})]})]}),e.jsxs(S,{children:[e.jsx(L,{className:"pb-3 md:pb-4",children:e.jsxs($,{className:"flex items-center gap-2 text-lg md:text-xl",children:[e.jsx(be,{className:"h-5 w-5 text-primary"}),"ประวัติการแจ้งเตือน (",t.length,")"]})}),e.jsx(D,{className:"p-4 md:p-6",children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Oe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"ยังไม่มีการแจ้งเตือน"})]}):e.jsx("div",{className:"space-y-3",children:t.map(l=>e.jsxs("div",{className:"border rounded-lg p-3 md:p-4 hover:bg-muted/30 transition-colors",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u(l.notification_type),e.jsx("span",{className:"font-medium text-sm md:text-base",children:j(l.notification_type)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:p(l.status)+" text-xs",children:l.status==="sent"?"ส่งแล้ว":l.status==="failed"?"ไม่สำเร็จ":l.status}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(l.created_at).toLocaleString("th-TH")})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["ส่งถึง: ",l.sent_to]}),e.jsx("div",{className:"text-xs md:text-sm bg-background p-2 rounded border border-border/30 max-h-20 overflow-y-auto",children:l.message_content})]},l.id))})})]})]})},tx=()=>{const[t,s]=h.useState(""),[a,n]=h.useState([]),[r,i]=h.useState([]),[o,c]=h.useState(null),[d,p]=h.useState({lastDoseDate:"",nextDoseDate:"",doseNumber:"2",notes:"",customNextDate:!1}),[u,j]=h.useState([]),[l,m]=h.useState(!1),[x,g]=h.useState(!1),{toast:v}=ce(),f=async()=>{m(!0);try{const{data:T,error:W}=await O.from("appointments").select("*").eq("status","completed").order("appointment_date",{ascending:!1});if(W)throw W;n(T||[])}catch(T){console.error("Error loading appointments:",T),v({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลนัดหมายได้",variant:"destructive"})}finally{m(!1)}},N=async()=>{try{const{data:T,error:W}=await O.from("vaccine_schedules").select("*").eq("active",!0);if(W)throw W;i(T||[])}catch(T){console.error("Error loading vaccine schedules:",T)}},_=(T,W,b)=>{var y;const w=r.find(R=>R.vaccine_type===W);if(!w)return"";const M=Array.isArray(w.dose_intervals)?w.dose_intervals:JSON.parse(((y=w.dose_intervals)==null?void 0:y.toString())||"[]"),I=b-2,F=M[I]||30,z=new Date(T),C=new Date(z);return C.setDate(C.getDate()+F),C.toISOString().split("T")[0]},A=async T=>{c(T),p({lastDoseDate:T.appointment_date,nextDoseDate:"",doseNumber:"2",notes:T.notes||"",customNextDate:!1});try{const{data:W,error:b}=await O.from("appointments").select("*").eq("patient_id_number",T.patient_id_number).eq("vaccine_type",T.vaccine_type).in("status",["scheduled","pending"]).gte("appointment_date",new Date().toISOString().split("T")[0]);if(b)throw b;j(W||[])}catch(W){console.error("Error loading future appointments:",W),j([])}},E=T=>{p(W=>({...W,lastDoseDate:T,nextDoseDate:o?_(T,o.vaccine_type,parseInt(W.doseNumber)+1):""}))},V=T=>{p(W=>({...W,doseNumber:T,nextDoseDate:o&&W.lastDoseDate?_(W.lastDoseDate,o.vaccine_type,parseInt(T)+1):""}))},Y=async()=>{if(!o||!d.lastDoseDate){v({title:"ข้อมูลไม่ครบถ้วน",description:"กรุณากรอกวันที่ฉีดเข็มล่าสุด",variant:"destructive"});return}let T=d.nextDoseDate;if(!T&&(T=_(d.lastDoseDate,o.vaccine_type,parseInt(d.doseNumber)+1),!T)){v({title:"ไม่สามารถคำนวณวันนัดได้",description:"ไม่พบข้อมูลวัคซีนหรือช่วงห่างการฉีด",variant:"destructive"});return}g(!0);try{const W=o.patient_id_number,b=parseInt(d.doseNumber)+1,{data:w,error:M}=await O.from("appointments").select("*").eq("patient_id_number",W).eq("vaccine_type",o.vaccine_type).in("status",["scheduled","pending"]).gte("appointment_date",new Date().toISOString().split("T")[0]);if(M)throw M;if(console.log("พบนัดเก่า:",(w==null?void 0:w.length)||0,"รายการ"),w&&w.length>0)for(const C of w){const{error:y}=await O.from("appointments").update({status:"cancelled",notes:`${C.notes||""} (ยกเลิกเนื่องจากแก้ไขข้อมูลเมื่อ ${new Date().toLocaleDateString("th-TH")})`}).eq("id",C.id);if(y)throw y;console.log("ยกเลิกนัดเก่า ID:",C.id)}const{error:I}=await O.from("appointments").update({appointment_date:d.lastDoseDate,notes:`${d.notes} (แก้ไขเมื่อ ${new Date().toLocaleDateString("th-TH")})`}).eq("id",o.id);if(I)throw I;const F=r.find(C=>C.vaccine_type===o.vaccine_type);if(F&&b<=F.total_doses){const{error:C}=await O.from("appointments").insert([{patient_name:o.patient_name,patient_id_number:o.patient_id_number,vaccine_type:o.vaccine_type,appointment_date:T,status:"scheduled",notes:`นัดเข็มที่ ${b} จาก ${F.total_doses} เข็ม (สร้างใหม่จากการแก้ไข ${new Date().toLocaleDateString("th-TH")})`}]);if(C)throw C;console.log("สร้างนัดใหม่สำเร็จ:",T)}const z=(w==null?void 0:w.length)||0;v({title:"บันทึกสำเร็จ",description:`แก้ไขข้อมูลของ ${o.patient_name} แล้ว${z>0?` (ยกเลิกนัดเก่า ${z} รายการ และสร้างนัดใหม่)`:" และสร้างนัดครั้งถัดไป"}`}),c(null),j([]),p({lastDoseDate:"",nextDoseDate:"",doseNumber:"2",notes:"",customNextDate:!1}),f()}catch(W){console.error("Error saving changes:",W),v({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถบันทึกการเปลี่ยนแปลงได้",variant:"destructive"})}finally{g(!1)}};h.useEffect(()=>{f(),N()},[]);const P=a.filter(T=>T.patient_name.toLowerCase().includes(t.toLowerCase())||T.patient_id_number.toLowerCase().includes(t.toLowerCase())||T.vaccine_type.toLowerCase().includes(t.toLowerCase()));return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(Fa,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"แก้ไขข้อมูลนัดหมาย"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"แก้ไขวันที่ฉีดและคำนวณนัดครั้งถัดไป"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-5 w-5"}),"ค้นหานัดหมายที่ต้องแก้ไข"]})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(ae,{placeholder:"ค้นหาด้วยชื่อผู้ป่วย, ID, หรือประเภทวัคซีน",value:t,onChange:T=>s(T.target.value),className:"pl-10"})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:P.map(T=>e.jsxs("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${(o==null?void 0:o.id)===T.id?"border-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>A(T),children:[e.jsx("div",{className:"font-medium",children:T.patient_name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[T.vaccine_type," - ",new Date(T.appointment_date).toLocaleDateString("th-TH")]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",T.patient_id_number]})]},T.id))}),P.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:t?"ไม่พบข้อมูลที่ค้นหา":"ไม่มีข้อมูลนัดหมาย"})]})})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"แก้ไขข้อมูลนัดหมาย"]})}),e.jsx(D,{children:o?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"font-medium",children:o.patient_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:o.vaccine_type}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",o.patient_id_number]})]}),e.jsxs("div",{children:[e.jsxs(K,{htmlFor:"lastDoseDate",children:["วันที่ฉีดเข็มล่าสุด (เข็มที่ ",d.doseNumber,")"]}),e.jsx(ae,{id:"lastDoseDate",type:"date",value:d.lastDoseDate,onChange:T=>E(T.target.value)})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"doseNumber",children:"เข็มที่ฉีดล่าสุด"}),e.jsxs(ct,{value:d.doseNumber,onValueChange:V,children:[e.jsx(et,{children:e.jsx(dt,{})}),e.jsxs(tt,{children:[e.jsx(_e,{value:"1",children:"เข็มที่ 1"}),e.jsx(_e,{value:"2",children:"เข็มที่ 2"}),e.jsx(_e,{value:"3",children:"เข็มที่ 3"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(K,{htmlFor:"nextDoseDate",children:["วันนัดเข็มถัดไป (เข็มที่ ",parseInt(d.doseNumber)+1,")"]}),e.jsx(k,{type:"button",variant:"outline",size:"sm",onClick:()=>p(T=>({...T,customNextDate:!T.customNextDate})),children:d.customNextDate?"ใช้วันที่อัตโนมัติ":"กำหนดวันที่เอง"})]}),d.customNextDate?e.jsx(ae,{id:"nextDoseDate",type:"date",value:d.nextDoseDate,onChange:T=>p(W=>({...W,nextDoseDate:T.target.value}))}):e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("div",{className:"font-medium text-lg text-green-800",children:d.nextDoseDate?new Date(d.nextDoseDate).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",weekday:"long"}):"กรุณาเลือกวันที่ฉีดเข็มล่าสุด"}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["📅 คำนวณอัตโนมัติตามช่วงห่างของวัคซีน",d.nextDoseDate&&d.lastDoseDate&&` (ห่างจากเข็มล่าสุด ${Math.ceil((new Date(d.nextDoseDate).getTime()-new Date(d.lastDoseDate).getTime())/(1e3*60*60*24))} วัน)`]})]})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"notes",children:"หมายเหตุ"}),e.jsx(ae,{id:"notes",value:d.notes,onChange:T=>p(W=>({...W,notes:T.target.value})),placeholder:"หมายเหตุเพิ่มเติม"})]}),e.jsxs("div",{className:"space-y-2",children:[u.length>0&&e.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsxs("div",{className:"font-medium text-yellow-800 mb-2",children:["⚠️ นัดเก่าที่จะถูกยกเลิก (",u.length," รายการ):"]}),u.map((T,W)=>e.jsxs("div",{className:"text-sm text-yellow-700 ml-4",children:["• วันที่ ",new Date(T.appointment_date).toLocaleDateString("th-TH")," (",T.status,")"]},T.id))]}),d.nextDoseDate&&e.jsxs("div",{className:"p-2 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:["✅ ระบบจะสร้างนัดหมายเข็มที่ ",parseInt(d.doseNumber)+1," ในวันที่ ",new Date(d.nextDoseDate).toLocaleDateString("th-TH")," อัตโนมัติ"]}),e.jsxs(k,{onClick:Y,disabled:x||!d.lastDoseDate,className:"w-full",children:[x?e.jsx(Se,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(gr,{className:"h-4 w-4 mr-2"}),x?"กำลังบันทึก...":u.length>0?"ยกเลิกนัดเก่าและสร้างนัดใหม่":"บันทึกและสร้างนัดอัตโนมัติ"]})]})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(be,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"เลือกนัดหมายที่ต้องการแก้ไขจากรายการด้านซ้าย"})]})})]})]})]})},sx=()=>{const[t,s]=h.useState(!1),[a,n]=h.useState([]),{toast:r}=ce(),i=async()=>{s(!0),n([]);const d=[];try{d.push({test:"Database Connection",status:"success",message:"เชื่อมต่อฐานข้อมูลสำเร็จ"});try{const{data:l,error:m}=await O.from("appointment_notifications").select("count").limit(1);if(m)throw m;d.push({test:"Notifications Table",status:"success",message:"ตาราง appointment_notifications พร้อมใช้งาน"})}catch(l){d.push({test:"Notifications Table",status:"error",message:`ตาราง appointment_notifications มีปัญหา: ${l.message}`})}try{const l=new Date;l.setDate(l.getDate()+1);const m=l.toISOString().split("T")[0],{data:x,error:g}=await O.from("appointments").select("*").eq("appointment_date",m).eq("status","scheduled");if(g)throw g;d.push({test:"Tomorrow Appointments",status:x&&x.length>0?"success":"warning",message:`พบนัดหมายพรุ่งนี้ ${(x==null?void 0:x.length)||0} รายการ`,details:x})}catch(l){d.push({test:"Tomorrow Appointments",status:"error",message:`ไม่สามารถตรวจสอบนัดหมายได้: ${l.message}`})}try{const l=new Date().toISOString().split("T")[0],{data:m,error:x}=await O.from("appointments").select("*").lt("appointment_date",l).eq("status","scheduled");if(x)throw x;d.push({test:"Overdue Appointments",status:m&&m.length>0?"warning":"success",message:`พบนัดเกินกำหนด ${(m==null?void 0:m.length)||0} รายการ`,details:m})}catch(l){d.push({test:"Overdue Appointments",status:"error",message:`ไม่สามารถตรวจสอบนัดเกินกำหนดได้: ${l.message}`})}try{const{data:l,error:m}=await O.functions.invoke("manual-notification-trigger",{body:{test:!0}});if(m)throw m;d.push({test:"Notification Function",status:"success",message:"ฟังก์ชันแจ้งเตือนทำงานได้",details:l})}catch(l){d.push({test:"Notification Function",status:"error",message:`ฟังก์ชันแจ้งเตือนมีปัญหา: ${l.message}`})}try{const{data:l,error:m}=await O.from("cron.job").select("*").eq("jobname","process-notifications");m?d.push({test:"CRON Job Status",status:"warning",message:"ไม่สามารถตรวจสอบสถานะ CRON job ได้ (ต้องใช้สิทธิ์ admin)"}):d.push({test:"CRON Job Status",status:l&&l.length>0?"success":"warning",message:l&&l.length>0?`CRON job ทำงานอยู่: ${l[0].schedule}`:"ไม่พบ CRON job process-notifications",details:l})}catch{d.push({test:"CRON Job Status",status:"warning",message:"ไม่สามารถตรวจสอบ CRON job ได้"})}try{const{data:l,error:m}=await O.from("appointment_notifications").select("*").order("created_at",{ascending:!1}).limit(5);if(m)throw m;d.push({test:"Recent Notifications",status:"success",message:`พบการแจ้งเตือนล่าสุด ${(l==null?void 0:l.length)||0} รายการ`,details:l})}catch(l){d.push({test:"Recent Notifications",status:"error",message:`ไม่สามารถตรวจสอบการแจ้งเตือนได้: ${l.message}`})}try{const{data:l,error:m}=await O.from("notification_jobs").select("*").order("created_at",{ascending:!1}).limit(5);if(m)throw m;const x=(l==null?void 0:l.filter(g=>!g.processed_at))||[];d.push({test:"Notification Jobs Queue",status:"success",message:`พบงานแจ้งเตือน ${(l==null?void 0:l.length)||0} รายการ (รอดำเนินการ: ${x.length})`,details:{total:l==null?void 0:l.length,pending:x.length,jobs:l}})}catch(l){d.push({test:"Notification Jobs Queue",status:"warning",message:`ไม่สามารถตรวจสอบ notification_jobs ได้: ${l.message}`})}}catch(l){d.push({test:"General Error",status:"error",message:`เกิดข้อผิดพลาดทั่วไป: ${l.message}`})}n(d),s(!1);const p=d.filter(l=>l.status==="success").length,u=d.filter(l=>l.status==="error").length,j=d.filter(l=>l.status==="warning").length;r({title:"การทดสอบเสร็จสิ้น",description:`สำเร็จ: ${p}, เตือน: ${j}, ข้อผิดพลาด: ${u}`,variant:u>0?"destructive":"default"})},o=d=>{switch(d){case"success":return e.jsx(G,{className:"h-4 w-4 text-green-600"});case"warning":return e.jsx(je,{className:"h-4 w-4 text-yellow-600"});case"error":return e.jsx(je,{className:"h-4 w-4 text-red-600"});default:return e.jsx(De,{className:"h-4 w-4 text-gray-600"})}},c=d=>{switch(d){case"success":return"bg-green-100 text-green-800 border-green-200";case"warning":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"error":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return e.jsx("div",{className:"space-y-6",children:e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(jn,{className:"h-5 w-5 text-primary"}),"ทดสอบระบบแจ้งเตือนอัตโนมัติ"]})}),e.jsxs(D,{children:[e.jsxs(Q,{className:"mb-4",children:[e.jsx(jt,{className:"h-4 w-4"}),e.jsx(X,{children:"เครื่องมือนี้จะทดสอบการทำงานของระบบแจ้งเตือนอัตโนมัติ รวมถึงการเชื่อมต่อฐานข้อมูล, การตรวจสอบนัดหมาย, และการทำงานของฟังก์ชันแจ้งเตือน"})]}),e.jsxs(k,{onClick:i,disabled:t,className:"w-full mb-6",children:[t?e.jsx(Se,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(jn,{className:"h-4 w-4 mr-2"}),t?"กำลังทดสอบ...":"เริ่มทดสอบระบบ"]}),a.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium text-lg mb-3",children:"ผลการทดสอบ:"}),a.map((d,p)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o(d.status),e.jsx("span",{className:"font-medium",children:d.test})]}),e.jsx(H,{className:c(d.status),children:d.status==="success"?"สำเร็จ":d.status==="warning"?"เตือน":"ข้อผิดพลาด"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:d.message}),d.details&&e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-800",children:"ดูรายละเอียด"}),e.jsx("pre",{className:"mt-2 p-2 bg-muted rounded text-xs overflow-auto max-h-32",children:JSON.stringify(d.details,null,2)})]})]},p))]})]})]})})},ax=()=>{const[t,s]=h.useState(null),[a,n]=h.useState(null),[r,i]=h.useState(!1),[o,c]=h.useState(!1),[d,p]=h.useState(!0),u=Ft(),{toast:j}=ce();h.useEffect(()=>{(async()=>{try{const{data:{session:v},error:f}=await O.auth.getSession();if(f)throw f;if(!v){p(!1);return}n(v),s(v.user);const{data:N,error:_}=await O.rpc("is_healthcare_staff",{_user_id:v.user.id});_?(console.error("Error checking staff status:",_),i(!1)):i(N);const{data:A,error:E}=await O.rpc("has_role",{_user_id:v.user.id,_role:"admin"});E?(console.error("Error checking admin status:",E),c(!1)):c(A)}catch(v){console.error("Auth check error:",v),j({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถตรวจสอบสิทธิ์การเข้าถึงได้",variant:"destructive"})}finally{p(!1)}})();const{data:{subscription:g}}=O.auth.onAuthStateChange(async(v,f)=>{(v==="SIGNED_OUT"||!f)&&(s(null),n(null),i(!1),c(!1),u("/auth"))});return()=>g.unsubscribe()},[u,j]);const l=async()=>{try{const{error:x}=await O.auth.signOut();if(x)throw x;j({title:"ออกจากระบบแล้ว",description:"คุณได้ออกจากระบบเรียบร้อยแล้ว"}),u("/auth")}catch(x){console.error("Sign out error:",x),j({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถออกจากระบบได้",variant:"destructive"})}},m=()=>{u("/auth")};return d?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-green-100/30 to-white flex items-center justify-center",children:e.jsx(S,{className:"w-96",children:e.jsxs(D,{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"กำลังตรวจสอบสิทธิ์..."})]})})}):t?r?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-green-100/30 to-white",children:[e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl overflow-hidden shadow-md",children:e.jsx("img",{src:"./images/hospital-logo.png",alt:"โลโก้โรงพยาบาลโฮม",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"ระบบจัดการวัคซีน"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"โรงพยาบาลโฮม"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("p",{className:"text-sm font-medium",children:t.email}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"ผู้ดูแลระบบ":"เจ้าหน้าที่"})]}),e.jsxs(k,{onClick:l,variant:"outline",size:"sm",children:[e.jsx(ws,{className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"ออกจากระบบ"})]})]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs(Ue,{defaultValue:"staff-portal",className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-2 md:grid-cols-7 mb-6",children:[e.jsx(Z,{value:"staff-portal",children:"นัดวันนี้"}),e.jsx(Z,{value:"registrations",children:"รายการลงทะเบียน"}),e.jsx(Z,{value:"next-appointments",children:"นัดครั้งถัดไป"}),e.jsx(Z,{value:"past-vaccinations",children:"ประวัติการฉีด"}),e.jsx(Z,{value:"edit-appointments",children:"แก้ไขนัด"}),e.jsx(Z,{value:"vaccine-calculator",children:"คำนวณวัคซีน"}),o&&e.jsx(Z,{value:"settings",children:"ตั้งค่า"})]}),e.jsx(ee,{value:"staff-portal",children:e.jsx(Ci,{})}),e.jsx(ee,{value:"registrations",children:e.jsx(Qp,{})}),e.jsx(ee,{value:"next-appointments",children:e.jsx(Xp,{})}),e.jsx(ee,{value:"past-vaccinations",children:e.jsx(Zp,{})}),e.jsx(ee,{value:"edit-appointments",children:e.jsx(tx,{})}),e.jsx(ee,{value:"vaccine-calculator",children:e.jsx(Jp,{})}),o&&e.jsx(ee,{value:"settings",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsx($,{children:"ตั้งค่าระบบ"}),e.jsx(oe,{children:"จัดการการตั้งค่าระบบและสิทธิ์การเข้าถึง"})]}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"การจัดการผู้ใช้"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["อีเมล: ",t.email]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["สิทธิ์: ",o?"ผู้ดูแลระบบ":"เจ้าหน้าที่"]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"การตั้งค่าวัคซีน"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"จัดการประเภทวัคซีนและตารางการให้"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"ระบบแจ้งเตือน"}),e.jsxs("div",{className:"mt-2 space-y-4",children:[e.jsx(ex,{}),e.jsx(sx,{})]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"จัดการนัดหมายผู้ป่วย"}),e.jsx("div",{className:"mt-2",children:e.jsx(ki,{})})]})]})})]})})]})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-green-100/30 to-white flex items-center justify-center",children:e.jsxs(S,{className:"w-96",children:[e.jsx(L,{className:"text-center",children:e.jsxs($,{className:"flex items-center justify-center gap-2 text-2xl text-destructive",children:[e.jsx(Pe,{className:"h-6 w-6"}),"ไม่มีสิทธิ์เข้าถึง"]})}),e.jsxs(D,{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-center text-muted-foreground",children:"คุณไม่มีสิทธิ์เข้าถึงระบบจัดการเจ้าหน้าที่ กรุณาติดต่อผู้ดูแลระบบ"}),e.jsxs(k,{onClick:l,variant:"outline",className:"w-full",children:[e.jsx(ws,{className:"h-4 w-4 mr-2"}),"ออกจากระบบ"]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-green-100/30 to-white flex items-center justify-center",children:e.jsxs(S,{className:"w-96",children:[e.jsx(L,{className:"text-center",children:e.jsxs($,{className:"flex items-center justify-center gap-2 text-2xl",children:[e.jsx(Pe,{className:"h-6 w-6 text-primary"}),"ต้องเข้าสู่ระบบ"]})}),e.jsxs(D,{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-center text-muted-foreground",children:"กรุณาเข้าสู่ระบบเพื่อเข้าถึงระบบจัดการเจ้าหน้าที่"}),e.jsx(k,{onClick:m,className:"w-full",children:"เข้าสู่ระบบ"})]})]})})},Hn=()=>e.jsx(ax,{}),nx=({className:t="mx-auto h-32 w-auto object-contain",size:s=128})=>e.jsx("div",{className:t,style:{width:s,height:s},children:e.jsx("img",{src:"./images/hospital-logo.png",alt:"โรงพยาบาลโฮม",className:"w-full h-full object-contain",onError:n=>{var o;console.log("Logo failed, using SVG fallback");const r=n.currentTarget,i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox","0 0 100 100"),i.setAttribute("className","w-full h-full"),i.innerHTML=`
            <rect width="100" height="100" fill="#0ea5e9" rx="10"/>
            <circle cx="50" cy="35" r="15" fill="white"/>
            <rect x="35" y="50" width="30" height="3" fill="white"/>
            <rect x="40" y="55" width="20" height="3" fill="white"/>
            <rect x="45" y="60" width="10" height="3" fill="white"/>
            <text x="50" y="80" text-anchor="middle" fill="white" font-size="8" font-family="Arial">โรงพยาบาล</text>
            <text x="50" y="90" text-anchor="middle" fill="white" font-size="8" font-family="Arial">โฮม</text>
          `,(o=r.parentNode)==null||o.replaceChild(i,r)}})}),ma=768;function rx(){const[t,s]=h.useState(void 0);return h.useEffect(()=>{const a=window.matchMedia(`(max-width: ${ma-1}px)`),n=()=>{s(window.innerWidth<ma)};return a.addEventListener("change",n),s(window.innerWidth<ma),()=>a.removeEventListener("change",n)},[]),!!t}const ix=lr,ox=ir,Zi=h.forwardRef(({className:t,...s},a)=>e.jsx(ks,{className:U("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:a}));Zi.displayName=ks.displayName;const lx=wt("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),eo=h.forwardRef(({side:t="right",className:s,children:a,...n},r)=>e.jsxs(ox,{children:[e.jsx(Zi,{}),e.jsxs(Es,{ref:r,className:U(lx({side:t}),s),...n,children:[a,e.jsxs(or,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Is,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));eo.displayName=Es.displayName;const cx=h.forwardRef(({className:t,...s},a)=>e.jsx(As,{ref:a,className:U("text-lg font-semibold text-foreground",t),...s}));cx.displayName=As.displayName;const dx=h.forwardRef(({className:t,...s},a)=>e.jsx(Ts,{ref:a,className:U("text-sm text-muted-foreground",t),...s}));dx.displayName=Ts.displayName;function qn({className:t,...s}){return e.jsx("div",{className:U("animate-pulse rounded-md bg-muted",t),...s})}const mx="sidebar:state",ux=60*60*24*7,hx="16rem",px="18rem",xx="3rem",fx="b",to=h.createContext(null);function Bs(){const t=h.useContext(to);if(!t)throw new Error("useSidebar must be used within a SidebarProvider.");return t}const so=h.forwardRef(({defaultOpen:t=!0,open:s,onOpenChange:a,className:n,style:r,children:i,...o},c)=>{const d=rx(),[p,u]=h.useState(!1),[j,l]=h.useState(t),m=s??j,x=h.useCallback(N=>{const _=typeof N=="function"?N(m):N;a?a(_):l(_),document.cookie=`${mx}=${_}; path=/; max-age=${ux}`},[a,m]),g=h.useCallback(()=>d?u(N=>!N):x(N=>!N),[d,x,u]);h.useEffect(()=>{const N=_=>{_.key===fx&&(_.metaKey||_.ctrlKey)&&(_.preventDefault(),g())};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[g]);const v=m?"expanded":"collapsed",f=h.useMemo(()=>({state:v,open:m,setOpen:x,isMobile:d,openMobile:p,setOpenMobile:u,toggleSidebar:g}),[v,m,x,d,p,u,g]);return e.jsx(to.Provider,{value:f,children:e.jsx(ai,{delayDuration:0,children:e.jsx("div",{style:{"--sidebar-width":hx,"--sidebar-width-icon":xx,...r},className:U("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",n),ref:c,...o,children:i})})})});so.displayName="SidebarProvider";const ao=h.forwardRef(({side:t="left",variant:s="sidebar",collapsible:a="offcanvas",className:n,children:r,...i},o)=>{const{isMobile:c,state:d,openMobile:p,setOpenMobile:u}=Bs();return a==="none"?e.jsx("div",{className:U("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",n),ref:o,...i,children:r}):c?e.jsx(ix,{open:p,onOpenChange:u,...i,children:e.jsx(eo,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":px},side:t,children:e.jsx("div",{className:"flex h-full w-full flex-col",children:r})})}):e.jsxs("div",{ref:o,className:"group peer hidden md:block text-sidebar-foreground","data-state":d,"data-collapsible":d==="collapsed"?a:"","data-variant":s,"data-side":t,children:[e.jsx("div",{className:U("duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",s==="floating"||s==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),e.jsx("div",{className:U("duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",t==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",s==="floating"||s==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",n),...i,children:e.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:r})})]})});ao.displayName="Sidebar";const no=h.forwardRef(({className:t,onClick:s,...a},n)=>{const{toggleSidebar:r}=Bs();return e.jsxs(k,{ref:n,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:U("h-7 w-7",t),onClick:i=>{s==null||s(i),r()},...a,children:[e.jsx(rl,{}),e.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});no.displayName="SidebarTrigger";const gx=h.forwardRef(({className:t,...s},a)=>{const{toggleSidebar:n}=Bs();return e.jsx("button",{ref:a,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:n,title:"Toggle Sidebar",className:U("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",t),...s})});gx.displayName="SidebarRail";const vx=h.forwardRef(({className:t,...s},a)=>e.jsx("main",{ref:a,className:U("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",t),...s}));vx.displayName="SidebarInset";const jx=h.forwardRef(({className:t,...s},a)=>e.jsx(ae,{ref:a,"data-sidebar":"input",className:U("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",t),...s}));jx.displayName="SidebarInput";const bx=h.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"header",className:U("flex flex-col gap-2 p-2",t),...s}));bx.displayName="SidebarHeader";const yx=h.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"footer",className:U("flex flex-col gap-2 p-2",t),...s}));yx.displayName="SidebarFooter";const Nx=h.forwardRef(({className:t,...s},a)=>e.jsx(ge,{ref:a,"data-sidebar":"separator",className:U("mx-2 w-auto bg-sidebar-border",t),...s}));Nx.displayName="SidebarSeparator";const ro=h.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"content",className:U("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",t),...s}));ro.displayName="SidebarContent";const Ea=h.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"group",className:U("relative flex w-full min-w-0 flex-col p-2",t),...s}));Ea.displayName="SidebarGroup";const Aa=h.forwardRef(({className:t,asChild:s=!1,...a},n)=>{const r=s?Ot:"div";return e.jsx(r,{ref:n,"data-sidebar":"group-label",className:U("duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",t),...a})});Aa.displayName="SidebarGroupLabel";const wx=h.forwardRef(({className:t,asChild:s=!1,...a},n)=>{const r=s?Ot:"button";return e.jsx(r,{ref:n,"data-sidebar":"group-action",className:U("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",t),...a})});wx.displayName="SidebarGroupAction";const Ta=h.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"group-content",className:U("w-full text-sm",t),...s}));Ta.displayName="SidebarGroupContent";const Ia=h.forwardRef(({className:t,...s},a)=>e.jsx("ul",{ref:a,"data-sidebar":"menu",className:U("flex w-full min-w-0 flex-col gap-1",t),...s}));Ia.displayName="SidebarMenu";const Pa=h.forwardRef(({className:t,...s},a)=>e.jsx("li",{ref:a,"data-sidebar":"menu-item",className:U("group/menu-item relative",t),...s}));Pa.displayName="SidebarMenuItem";const _x=wt("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),Ma=h.forwardRef(({asChild:t=!1,isActive:s=!1,variant:a="default",size:n="default",tooltip:r,className:i,...o},c)=>{const d=t?Ot:"button",{isMobile:p,state:u}=Bs(),j=e.jsx(d,{ref:c,"data-sidebar":"menu-button","data-size":n,"data-active":s,className:U(_x({variant:a,size:n}),i),...o});return r?(typeof r=="string"&&(r={children:r}),e.jsxs(ld,{children:[e.jsx(cd,{asChild:!0,children:j}),e.jsx(ni,{side:"right",align:"center",hidden:u!=="collapsed"||p,...r})]})):j});Ma.displayName="SidebarMenuButton";const Sx=h.forwardRef(({className:t,asChild:s=!1,showOnHover:a=!1,...n},r)=>{const i=s?Ot:"button";return e.jsx(i,{ref:r,"data-sidebar":"menu-action",className:U("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",a&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",t),...n})});Sx.displayName="SidebarMenuAction";const Dx=h.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"menu-badge",className:U("absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t),...s}));Dx.displayName="SidebarMenuBadge";const Cx=h.forwardRef(({className:t,showIcon:s=!1,...a},n)=>{const r=h.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return e.jsxs("div",{ref:n,"data-sidebar":"menu-skeleton",className:U("rounded-md h-8 flex gap-2 px-2 items-center",t),...a,children:[s&&e.jsx(qn,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),e.jsx(qn,{className:"h-4 flex-1 max-w-[--skeleton-width]","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":r}})]})});Cx.displayName="SidebarMenuSkeleton";const kx=h.forwardRef(({className:t,...s},a)=>e.jsx("ul",{ref:a,"data-sidebar":"menu-sub",className:U("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",t),...s}));kx.displayName="SidebarMenuSub";const Ex=h.forwardRef(({...t},s)=>e.jsx("li",{ref:s,...t}));Ex.displayName="SidebarMenuSubItem";const Ax=h.forwardRef(({asChild:t=!1,size:s="md",isActive:a,className:n,...r},i)=>{const o=t?Ot:"a";return e.jsx(o,{ref:i,"data-sidebar":"menu-sub-button","data-size":s,"data-active":a,className:U("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",s==="sm"&&"text-xs",s==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",n),...r})});Ax.displayName="SidebarMenuSubButton";const Tx=[{title:"หน้าหลัก",url:"/",icon:vr,roles:["admin"]},{title:"จัดการเจ้าหน้าที่",url:"/staff-portal",icon:Oe,roles:["admin","healthcare_staff"]},{title:"LINE Bot",url:"/LineBot",icon:vs,roles:["admin"]},{title:"ลงทะเบียนผู้ป่วย",url:"/PatientPortal",icon:ot,roles:["admin","healthcare_staff"]}],Ix=[{title:"ระบบผู้ดูแล",url:"/admin",icon:Pe,roles:["admin"]}];function Px(){const s=dr().pathname,a=r=>r==="/"?s==="/":s.startsWith(r),n=r=>a(r)?"nav-link-active":"nav-link";return e.jsx(ao,{className:"glass-sidebar border-r border-border/20",children:e.jsxs(ro,{className:"bg-gradient-sidebar",children:[e.jsx("div",{className:"p-6 border-b border-border/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl overflow-hidden shadow-md",children:e.jsx("img",{src:"./images/hospital-logo.png",alt:"โลโก้โรงพยาบาลโฮม",className:"w-full h-full object-contain object-center"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-lg text-foreground",children:"โรงพยาบาลโฮม"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ระบบจัดการวัคซีน"})]})]})}),e.jsxs(Ea,{children:[e.jsx(Aa,{className:"text-primary font-semibold",children:"เมนูหลัก"}),e.jsx(Ta,{children:e.jsx(Ia,{children:Tx.map(r=>e.jsx(Pa,{children:e.jsx(Ma,{asChild:!0,children:e.jsxs(fn,{to:r.url,className:n(r.url),children:[e.jsx(r.icon,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:r.title})]})})},r.title))})})]}),e.jsxs(Ea,{children:[e.jsx(Aa,{className:"text-medical-error font-semibold",children:"ผู้ดูแลระบบ"}),e.jsx(Ta,{children:e.jsx(Ia,{children:Ix.map(r=>e.jsx(Pa,{children:e.jsx(Ma,{asChild:!0,children:e.jsxs(fn,{to:r.url,className:n(r.url),children:[e.jsx(r.icon,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:r.title})]})})},r.title))})})]}),e.jsx("div",{className:"mt-auto p-6",children:e.jsx("div",{className:"card-glass",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Zt,{className:"h-8 w-8 mx-auto text-primary mb-2"}),e.jsx("h3",{className:"font-semibold text-sm text-foreground mb-1",children:"ระบบทำงานปกติ"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"อัปเดตล่าสุด: วันนี้"})]})})})]})})}function Mx({children:t,user:s,showSidebar:a=!0,title:n}){const{toast:r}=ce(),i=Ft(),o=async()=>{const{error:c}=await O.auth.signOut();c?r({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถออกจากระบบได้",variant:"destructive"}):(i("/auth"),r({title:"ออกจากระบบสำเร็จ",description:"คุณได้ออกจากระบบเรียบร้อยแล้ว"}))};return a?e.jsx(so,{children:e.jsxs("div",{className:"min-h-screen flex w-full bg-gradient-hero",children:[e.jsx(Px,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"h-14 md:h-16 bg-white/80 backdrop-blur-xl border-b border-border/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between h-full px-3 md:px-6",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(no,{className:"text-primary hover:bg-primary/10 transition-colors p-1 md:p-2"}),n&&e.jsx("div",{children:e.jsx("h1",{className:"text-lg md:text-xl font-semibold text-foreground truncate",children:n})})]}),s&&e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-3 px-3 md:px-4 py-1.5 md:py-2 rounded-lg md:rounded-xl bg-accent/50 border border-border/30",children:[e.jsx(yt,{className:"h-4 w-4 text-primary"}),e.jsx("div",{className:"text-sm",children:e.jsx("p",{className:"font-medium text-foreground truncate max-w-[120px] md:max-w-none",children:s.email})})]}),e.jsxs(k,{onClick:o,variant:"outline",size:"sm",className:"h-8 md:h-9 px-2 md:px-3 border-destructive/20 hover:bg-destructive/10 hover:text-destructive",children:[e.jsx(ws,{className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"ออกจากระบบ"})]})]})]})}),e.jsx("main",{className:"flex-1 p-3 md:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:t})})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-hero",children:t})}const Gn=()=>{const[t,s]=h.useState(null),[a,n]=h.useState(null),[r,i]=h.useState(!0),[o,c]=h.useState(!1),[d,p]=h.useState(!1),u=Ft();return ce(),h.useEffect(()=>{i(!1),c(!0);const{data:{subscription:j}}=O.auth.onAuthStateChange(async(l,m)=>{n(m),s((m==null?void 0:m.user)??null),m!=null&&m.user&&setTimeout(async()=>{try{const{data:x,error:g}=await O.rpc("has_role",{_user_id:m.user.id,_role:"admin"}),{data:v,error:f}=await O.rpc("is_healthcare_staff",{_user_id:m.user.id});!g&&!f&&(c(x),p(v))}catch(x){console.error("Role check failed:",x)}},100)});return setTimeout(()=>{O.auth.getSession().then(({data:{session:l}})=>{n(l),s((l==null?void 0:l.user)??null)})},50),()=>j.unsubscribe()},[u]),r?e.jsx("div",{className:"min-h-screen bg-gradient-hero flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"กำลังโหลด..."})]})}):o?e.jsxs(Mx,{user:t,title:"ระบบจัดการหลัก - ผู้ดูแลระบบ",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx(nx,{className:"mx-auto animate-float",size:128})}),e.jsx("h1",{className:"text-4xl font-bold mb-4 bg-gradient-primary bg-clip-text text-transparent",children:"ระบบจัดการวัคซีน"}),e.jsx("h2",{className:"text-2xl text-muted-foreground mb-2",children:"โรงพยาบาลโฮม"}),e.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"ระบบจัดการที่ครบครันสำหรับการดูแลผู้ป่วยและการจัดการวัคซีน"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card-balanced p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"นัดหมายวันนี้"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:"12"})]}),e.jsx(Zt,{className:"h-8 w-8 text-primary"})]})}),e.jsx("div",{className:"card-balanced p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"ผู้ป่วยทั้งหมด"}),e.jsx("p",{className:"text-2xl font-bold text-medical-success",children:"156"})]}),e.jsx(Oe,{className:"h-8 w-8 text-medical-success"})]})}),e.jsx("div",{className:"card-balanced p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"เจ้าหน้าที่"}),e.jsx("p",{className:"text-2xl font-bold text-medical-info",children:"8"})]}),e.jsx(Pe,{className:"h-8 w-8 text-medical-info"})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(S,{className:"card-balanced hover:shadow-lg group transition-all duration-300 hover:-translate-y-1",children:[e.jsx(L,{className:"pb-4",children:e.jsxs($,{className:"flex items-center gap-3 text-lg",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl group-hover:bg-primary/20 transition-colors",children:e.jsx(Oe,{className:"h-6 w-6 text-primary"})}),"จัดการนัดหมาย"]})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-muted-foreground mb-6 leading-relaxed",children:"หน้าสำหรับเจ้าหน้าที่จัดการนัดหมายผู้ป่วยและติดตามการฉีดวัคซีน"}),e.jsx(k,{asChild:!0,className:"w-full btn-primary",children:e.jsx(Gs,{to:"/staff-portal",children:"เข้าสู่ระบบ"})})]})]}),e.jsxs(S,{className:"card-balanced hover:shadow-lg group transition-all duration-300 hover:-translate-y-1",children:[e.jsx(L,{className:"pb-4",children:e.jsxs($,{className:"flex items-center gap-3 text-lg",children:[e.jsx("div",{className:"p-3 bg-medical-info/10 rounded-xl group-hover:bg-medical-info/20 transition-colors",children:e.jsx(vs,{className:"h-6 w-6 text-medical-info"})}),"LINE Bot Management"]})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-muted-foreground mb-6 leading-relaxed",children:"จัดการการตั้งค่า LINE Bot และทดสอบการเชื่อมต่อกับผู้ป่วย"}),e.jsx(k,{asChild:!0,className:"w-full",variant:"outline",children:e.jsx(Gs,{to:"/LineBot",children:"เข้าสู่ระบบ"})})]})]}),e.jsxs(S,{className:"card-balanced hover:shadow-lg group transition-all duration-300 hover:-translate-y-1",children:[e.jsx(L,{className:"pb-4",children:e.jsxs($,{className:"flex items-center gap-3 text-lg",children:[e.jsx("div",{className:"p-3 bg-medical-accent/10 rounded-xl group-hover:bg-medical-accent/20 transition-colors",children:e.jsx(ot,{className:"h-6 w-6 text-medical-accent"})}),"ลงทะเบียนผู้ป่วย"]})}),e.jsxs(D,{children:[e.jsx("p",{className:"text-muted-foreground mb-6 leading-relaxed",children:"หน้าสำหรับผู้ป่วยลงทะเบียนฉีดวัคซีนและจองนัดหมาย"}),e.jsx(k,{asChild:!0,className:"w-full",variant:"outline",children:e.jsx(Gs,{to:"/PatientPortal",children:"เข้าสู่ระบบ"})})]})]})]}),e.jsx(S,{className:"bg-gradient-card border-primary/20 shadow-glow",children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:e.jsx(Pe,{className:"h-6 w-6 text-primary"})}),e.jsx("h3",{className:"text-xl font-semibold",children:"สิทธิ์ผู้ดูแลระบบ"})]}),e.jsx("p",{className:"text-center text-muted-foreground leading-relaxed",children:"คุณมีสิทธิ์เข้าถึงทุกระบบและจัดการข้อมูลทั้งหมด รวมถึงการตั้งค่าระบบและจัดการผู้ใช้งาน"})]})})]}):null},Rx=()=>{const[t,s]=h.useState(null),[a,n]=h.useState(null),[r,i]=h.useState(""),[o,c]=h.useState(""),[d,p]=h.useState(!1),[u,j]=h.useState(!1),[l,m]=h.useState(!1),[x,g]=h.useState(!1),[v,f]=h.useState(""),[N,_]=h.useState(""),A=Ft(),{toast:E}=ce();h.useEffect(()=>{const b=new URLSearchParams(window.location.search),w=window.location.hash;let M=b.get("access_token"),I=b.get("refresh_token"),F=b.get("type");if(!M&&w){const C=new URLSearchParams(w.substring(1));M=C.get("access_token"),I=C.get("refresh_token"),F=C.get("type")}console.log("URL params:",{accessToken:!!M,refreshToken:!!I,type:F}),F==="recovery"&&M&&I&&(console.log("Setting up password recovery..."),g(!0),O.auth.setSession({access_token:M,refresh_token:I}).then(({error:C})=>{C?(console.error("Session error:",C),E({title:"เกิดข้อผิดพลาด",description:"ลิงก์รีเซ็ตรหัสผ่านไม่ถูกต้องหรือหมดอายุแล้ว",variant:"destructive"}),g(!1)):console.log("Session set successfully for password recovery")}));const{data:{subscription:z}}=O.auth.onAuthStateChange((C,y)=>{if(console.log("Auth state change:",C,!!y),n(y),s((y==null?void 0:y.user)??null),C==="PASSWORD_RECOVERY"){console.log("PASSWORD_RECOVERY event received"),g(!0);return}y!=null&&y.user&&!x&&F!=="recovery"&&(A("/staff-portal"),E({title:"เข้าสู่ระบบสำเร็จ",description:"ยินดีต้อนรับเข้าสู่ระบบจัดการนัดหมาย"}))});return O.auth.getSession().then(({data:{session:C}})=>{n(C),s((C==null?void 0:C.user)??null),C!=null&&C.user&&!x&&F!=="recovery"&&A("/staff-portal")}),()=>z.unsubscribe()},[A,E]);const V=async()=>{p(!0);try{const{error:b}=await O.auth.signInWithPassword({email:r,password:o});b&&(b.message.includes("Invalid login credentials")?E({title:"ข้อผิดพลาด",description:"อีเมลหรือรหัสผ่านไม่ถูกต้อง",variant:"destructive"}):b.message.includes("Email not confirmed")?E({title:"ยืนยันอีเมล",description:"กรุณาตรวจสอบอีเมลและคลิกลิงก์ยืนยัน",variant:"destructive"}):E({title:"เกิดข้อผิดพลาด",description:b.message,variant:"destructive"}))}catch{E({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถเข้าสู่ระบบได้ กรุณาลองใหม่",variant:"destructive"})}finally{p(!1)}},Y=async()=>{p(!0);try{const b=`${window.location.origin}/`,{error:w}=await O.auth.signUp({email:r,password:o,options:{emailRedirectTo:b}});w?w.message.includes("User already registered")?E({title:"ข้อผิดพลาด",description:"อีเมลนี้ได้รับการลงทะเบียนแล้ว กรุณาเข้าสู่ระบบ",variant:"destructive"}):w.message.includes("Password should be at least 6 characters")?E({title:"รหัสผ่านไม่ถูกต้อง",description:"รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร",variant:"destructive"}):E({title:"เกิดข้อผิดพลาด",description:w.message,variant:"destructive"}):(E({title:"ลงทะเบียนสำเร็จ",description:"กรุณาตรวจสอบอีเมลเพื่อยืนยันบัญชี"}),j(!1))}catch{E({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถลงทะเบียนได้ กรุณาลองใหม่",variant:"destructive"})}finally{p(!1)}},P=async()=>{if(!r){E({title:"กรุณากรอกอีเมล",description:"กรุณากรอกอีเมลของคุณเพื่อรีเซ็ตรหัสผ่าน",variant:"destructive"});return}p(!0);try{const{error:b}=await O.auth.resetPasswordForEmail(r,{redirectTo:`${window.location.origin}/auth?type=recovery`});b?E({title:"เกิดข้อผิดพลาด",description:b.message,variant:"destructive"}):(E({title:"ส่งอีเมลรีเซ็ตรหัสผ่านแล้ว",description:"กรุณาตรวจสอบอีเมลของคุณและคลิกลิงก์เพื่อรีเซ็ตรหัสผ่าน"}),m(!1))}catch{E({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถส่งอีเมลรีเซ็ตรหัสผ่านได้ กรุณาลองใหม่",variant:"destructive"})}finally{p(!1)}},T=async()=>{if(!v||!N){E({title:"กรุณากรอกรหัสผ่าน",description:"กรุณากรอกรหัสผ่านใหม่และยืนยันรหัสผ่าน",variant:"destructive"});return}if(v!==N){E({title:"รหัสผ่านไม่ตรงกัน",description:"รหัสผ่านใหม่และการยืนยันรหัสผ่านไม่ตรงกัน",variant:"destructive"});return}if(v.length<6){E({title:"รหัสผ่านสั้นเกินไป",description:"รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร",variant:"destructive"});return}p(!0);try{const{error:b}=await O.auth.updateUser({password:v});b?E({title:"เกิดข้อผิดพลาด",description:b.message,variant:"destructive"}):(E({title:"เปลี่ยนรหัสผ่านสำเร็จ",description:"รหัสผ่านของคุณได้รับการอัปเดตแล้ว กำลังนำคุณเข้าสู่ระบบ"}),window.history.replaceState({},document.title,"/auth"),setTimeout(()=>{A("/staff-portal")},2e3))}catch{E({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถเปลี่ยนรหัสผ่านได้ กรุณาลองใหม่",variant:"destructive"})}finally{p(!1)}},W=b=>{b.preventDefault(),x?T():l?P():u?Y():V()};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-green-100/30 to-white flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md space-y-6",children:[e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-32 h-32 bg-gradient-to-br from-primary/20 via-green-400/10 to-emerald-500/20 rounded-full blur-2xl animate-pulse"})}),e.jsxs("div",{className:"relative z-10 space-y-3",children:[e.jsx("h1",{className:"text-5xl font-black bg-gradient-to-r from-primary via-green-600 to-emerald-600 bg-clip-text text-transparent animate-fade-in",children:"โรงพยาบาลโฮม"}),e.jsx("div",{className:"w-24 h-1 bg-gradient-to-r from-primary to-emerald-500 mx-auto rounded-full"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xl font-semibold text-foreground/90",children:"ระบบจัดการการนัดหมายและวัคซีน"}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"เข้าสู่ระบบเพื่อจัดการข้อมูลอย่างปลอดภัย"})]})]}),x?e.jsxs(S,{className:"border-2 border-blue-200 shadow-xl bg-white/95 backdrop-blur-sm animate-scale-in",children:[e.jsx(L,{className:"pb-2",children:e.jsx($,{className:"text-center",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(cs,{className:"h-4 w-4 text-white"})}),e.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent",children:"ตั้งรหัสผ่านใหม่"})]}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"กรุณาสร้างรหัสผ่านใหม่สำหรับบัญชีของคุณ"})]})})}),e.jsx(D,{children:e.jsxs("form",{onSubmit:W,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"new-password",children:"รหัสผ่านใหม่"}),e.jsx(ae,{id:"new-password",type:"password",placeholder:"รหัสผ่านใหม่ (อย่างน้อย 6 ตัวอักษร)",value:v,onChange:b=>f(b.target.value),required:!0,minLength:6,className:"border-2 border-blue-300 focus:border-blue-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"confirm-password",children:"ยืนยันรหัสผ่านใหม่"}),e.jsx(ae,{id:"confirm-password",type:"password",placeholder:"ยืนยันรหัสผ่านใหม่",value:N,onChange:b=>_(b.target.value),required:!0,minLength:6,className:"border-2 border-blue-300 focus:border-blue-500"})]}),e.jsxs(k,{type:"submit",className:"w-full h-12 text-base font-semibold bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-500/90 hover:to-purple-500/90 shadow-lg hover:shadow-xl transition-all duration-300",disabled:d,children:[d?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}):null,"อัปเดตรหัสผ่าน"]}),e.jsx("div",{className:"text-center",children:e.jsx(k,{type:"button",variant:"link",onClick:()=>{g(!1),window.history.replaceState({},document.title,"/auth")},className:"text-sm text-muted-foreground hover:text-foreground font-medium",children:"กลับไปเข้าสู่ระบบ"})})]})})]}):e.jsxs(S,{className:"border-2 border-green-200 shadow-xl bg-white/95 backdrop-blur-sm animate-scale-in",children:[e.jsx(L,{className:"pb-2",children:e.jsx($,{className:"text-center",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-primary to-emerald-500 rounded-lg flex items-center justify-center",children:e.jsx(cs,{className:"h-4 w-4 text-white"})}),e.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-emerald-600 bg-clip-text text-transparent",children:"เข้าสู่ระบบ"})]}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"เลือกระหว่างเข้าสู่ระบบหรือสร้างบัญชีใหม่"})]})})}),e.jsx(D,{children:l?e.jsxs("div",{className:"mt-8 animate-fade-in",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"รีเซ็ตรหัสผ่าน"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"กรอกอีเมลของคุณเพื่อรับลิงก์รีเซ็ตรหัสผ่าน"})]}),e.jsxs("form",{onSubmit:W,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"reset-email",children:"อีเมล"}),e.jsx(ae,{id:"reset-email",type:"email",placeholder:"example@email.com",value:r,onChange:b=>i(b.target.value),required:!0,className:"border-2 border-green-300 focus:border-primary"})]}),e.jsxs(k,{type:"submit",className:"w-full h-12 text-base font-semibold bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-500/90 hover:to-purple-500/90 shadow-lg hover:shadow-xl transition-all duration-300",disabled:d,children:[d?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}):null,"ส่งลิงก์รีเซ็ตรหัสผ่าน"]}),e.jsx("div",{className:"text-center",children:e.jsx(k,{type:"button",variant:"link",onClick:()=>m(!1),className:"text-sm text-muted-foreground hover:text-foreground font-medium",children:"กลับไปเข้าสู่ระบบ"})})]})]}):e.jsxs(Ue,{value:u?"signup":"signin",onValueChange:b=>j(b==="signup"),children:[e.jsxs(ze,{className:"grid w-full grid-cols-2 bg-green-50 p-1 rounded-xl border border-green-200",children:[e.jsxs(Z,{value:"signin",className:"flex items-center gap-2 data-[state=active]:bg-white data-[state=active]:shadow-md data-[state=active]:border data-[state=active]:border-green-200 rounded-lg font-semibold transition-all duration-300",children:[e.jsx(cs,{className:"h-4 w-4"}),"เข้าสู่ระบบ"]}),e.jsxs(Z,{value:"signup",className:"flex items-center gap-2 data-[state=active]:bg-white data-[state=active]:shadow-md data-[state=active]:border data-[state=active]:border-green-200 rounded-lg font-semibold transition-all duration-300",children:[e.jsx(ot,{className:"h-4 w-4"}),"ลงทะเบียน"]})]}),e.jsxs(ee,{value:"signin",className:"mt-8 animate-fade-in",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"ยินดีต้อนรับกลับ"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"กรอกข้อมูลเพื่อเข้าสู่ระบบ"})]}),e.jsxs("form",{onSubmit:W,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"email",children:"อีเมล"}),e.jsx(ae,{id:"email",type:"email",placeholder:"example@email.com",value:r,onChange:b=>i(b.target.value),required:!0,className:"border-2 border-green-300 focus:border-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"password",children:"รหัสผ่าน"}),e.jsx(ae,{id:"password",type:"password",placeholder:"รหัสผ่าน",value:o,onChange:b=>c(b.target.value),required:!0,className:"border-2 border-green-300 focus:border-primary"})]}),e.jsxs(k,{type:"submit",className:"w-full h-12 text-base font-semibold bg-gradient-to-r from-primary to-emerald-500 hover:from-primary/90 hover:to-emerald-500/90 shadow-lg hover:shadow-xl transition-all duration-300",disabled:d,children:[d?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}):e.jsx(cs,{className:"h-5 w-5 mr-3"}),"เข้าสู่ระบบ"]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx(k,{type:"button",variant:"link",onClick:()=>m(!0),className:"text-sm text-primary hover:text-primary/80 font-medium",children:"ลืมรหัสผ่าน?"})})]})]}),e.jsxs(ee,{value:"signup",className:"mt-8 animate-fade-in",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"สร้างบัญชีใหม่"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"เริ่มต้นใช้งานระบบจัดการการนัดหมาย"})]}),e.jsxs("form",{onSubmit:W,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"signup-email",children:"อีเมล"}),e.jsx(ae,{id:"signup-email",type:"email",placeholder:"example@email.com",value:r,onChange:b=>i(b.target.value),required:!0,className:"border-2 border-green-300 focus:border-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"signup-password",children:"รหัสผ่าน"}),e.jsx(ae,{id:"signup-password",type:"password",placeholder:"รหัสผ่าน (อย่างน้อย 6 ตัวอักษร)",value:o,onChange:b=>c(b.target.value),required:!0,minLength:6,className:"border-2 border-green-300 focus:border-primary"})]}),e.jsxs(k,{type:"submit",className:"w-full h-12 text-base font-semibold bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-500/90 hover:to-green-500/90 shadow-lg hover:shadow-xl transition-all duration-300",disabled:d,children:[d?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}):e.jsx(ot,{className:"h-5 w-5 mr-3"}),"ลงทะเบียน"]})]})]})]})})]}),!x&&e.jsx("div",{className:"text-center",children:e.jsxs(k,{variant:"outline",onClick:()=>A("/"),className:"flex items-center gap-2 border-2 border-green-200 hover:bg-green-50 hover:border-primary transition-all duration-300 font-medium",children:[e.jsx(vr,{className:"h-4 w-4"}),"กลับหน้าหลัก"]})})]})})},Lx=()=>{const[t,s]=h.useState(!1),a=Ft(),n=()=>{s(!0),setTimeout(()=>{a("/admin")},500)},r=()=>{s(!0),setTimeout(()=>{a("/staff-portal")},500)},i=()=>{s(!0),setTimeout(()=>{a("/patient-portal")},500)};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',background:"hsl(210, 40%, 98%)"},children:e.jsxs("div",{style:{textAlign:"center",color:"hsl(210, 25%, 15%)",maxWidth:"500px",padding:"40px"},children:[e.jsx("div",{style:{width:"100px",height:"100px",background:"hsl(170, 50%, 45%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 30px",fontSize:"50px",boxShadow:"0 8px 32px rgba(0,0,0,0.1)"},children:"🏥"}),e.jsx("h1",{style:{margin:"0 0 10px 0",fontSize:"32px",fontWeight:"700",color:"hsl(170, 50%, 45%)"},children:"VCHome Hospital"}),e.jsx("h2",{style:{margin:"0 0 40px 0",fontSize:"24px",color:"hsl(210, 25%, 15%)",fontWeight:"600"},children:"ระบบจัดการวัคซีน"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",marginBottom:"30px"},children:[e.jsx("button",{onClick:n,disabled:t,style:{padding:"15px 30px",background:"hsl(170, 50%, 45%)",color:"white",border:"none",borderRadius:"12px",fontSize:"16px",fontWeight:"600",cursor:t?"not-allowed":"pointer",opacity:t?.7:1,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transition:"all 0.2s"},children:t?"กำลังเข้าสู่ระบบ...":"🔧 เข้าสู่ระบบผู้ดูแล"}),e.jsx("button",{onClick:r,disabled:t,style:{padding:"15px 30px",background:"white",color:"hsl(170, 50%, 45%)",border:"2px solid hsl(170, 50%, 45%)",borderRadius:"12px",fontSize:"16px",fontWeight:"600",cursor:t?"not-allowed":"pointer",opacity:t?.7:1,transition:"all 0.2s"},children:t?"กำลังเข้าสู่ระบบ...":"👩‍⚕️ เจ้าหน้าที่"}),e.jsx("button",{onClick:i,disabled:t,style:{padding:"15px 30px",background:"white",color:"hsl(170, 50%, 45%)",border:"2px solid hsl(170, 50%, 45%)",borderRadius:"12px",fontSize:"16px",fontWeight:"600",cursor:t?"not-allowed":"pointer",opacity:t?.7:1,transition:"all 0.2s"},children:t?"กำลังเข้าสู่ระบบ...":"👤 ผู้ป่วย"})]}),e.jsxs("div",{style:{padding:"20px",background:"white",borderRadius:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:"0 0 15px 0",color:"hsl(170, 50%, 45%)",fontSize:"18px"},children:"🚀 เข้าใช้งานด่วน"}),e.jsxs("p",{style:{margin:"0",fontSize:"14px",color:"hsl(210, 25%, 40%)",lineHeight:"1.5"},children:["เลือกประเภทผู้ใช้งานเพื่อเข้าสู่ระบบ",e.jsx("br",{}),"ระบบจะนำคุณไปยังหน้าที่เหมาะสม"]})]}),e.jsx("p",{style:{margin:"0",opacity:"0.5",fontSize:"13px"},children:"VCHome Hospital Management System v1.0.0"})]})})},$x=()=>{const[t,s]=h.useState(0),[a,n]=h.useState("เริ่มต้นระบบ..."),r=Ft();return h.useEffect(()=>{const i=[{progress:20,status:"กำลังโหลดส่วนประกอบ...",delay:300},{progress:40,status:"กำลังเตรียมระบบ...",delay:500},{progress:60,status:"กำลังตรวจสอบการเชื่อมต่อ...",delay:700},{progress:80,status:"เกือบเสร็จแล้ว...",delay:900},{progress:100,status:"เสร็จสิ้น!",delay:1200}];let o=0;const c=setInterval(()=>{if(o<i.length){const d=i[o];s(d.progress),n(d.status),o++}else clearInterval(c),setTimeout(()=>{r("/auth")},500)},400);return()=>clearInterval(c)},[r]),e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',background:"hsl(210, 40%, 98%)"},children:e.jsxs("div",{style:{textAlign:"center",color:"hsl(210, 25%, 15%)",maxWidth:"400px",padding:"40px"},children:[e.jsx("div",{style:{width:"80px",height:"80px",background:"hsl(170, 50%, 45%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 30px",fontSize:"40px",boxShadow:"0 8px 32px rgba(0,0,0,0.1)"},children:"🏥"}),e.jsx("h1",{style:{margin:"0 0 10px 0",fontSize:"28px",fontWeight:"700",color:"hsl(170, 50%, 45%)"},children:"VCHome Hospital"}),e.jsx("h2",{style:{margin:"0 0 30px 0",fontSize:"20px",color:"hsl(210, 25%, 15%)",fontWeight:"600"},children:"ระบบจัดการวัคซีน"}),e.jsx("div",{style:{width:"100%",height:"8px",background:"hsl(170, 50%, 45%, 0.2)",borderRadius:"4px",overflow:"hidden",marginBottom:"20px"},children:e.jsx("div",{style:{width:`${t}%`,height:"100%",background:"hsl(170, 50%, 45%)",borderRadius:"4px",transition:"width 0.3s ease-out"}})}),e.jsx("p",{style:{margin:"0 0 10px 0",opacity:"0.7",fontSize:"16px"},children:a}),e.jsxs("p",{style:{margin:"0",opacity:"0.5",fontSize:"14px"},children:[t,"%"]}),e.jsx("div",{style:{marginTop:"40px",padding:"20px",background:"white",borderRadius:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:e.jsxs("p",{style:{margin:"0",fontSize:"14px",color:"hsl(210, 25%, 40%)",lineHeight:"1.5"},children:["โรงพยาบาลโฮม",e.jsx("br",{}),"ระบบจัดการวัคซีนและนัดหมายการฉีดวัคซีน"]})})]})})},Ox=()=>{const t="your-liff-id",[s,a]=h.useState({fullName:"",phone:""}),[n,r]=h.useState(!1),[i,o]=h.useState(!1),[c,d]=h.useState(!1),[p,u]=h.useState(!1),[j,l]=h.useState(null),[m,x]=h.useState(null),{toast:g}=ce();h.useEffect(()=>{(async()=>{try{if(typeof window<"u"&&window.liff)if(console.log("LIFF SDK found, initializing..."),await window.liff.init({liffId:t}),d(!0),u(window.liff.isInClient()),window.liff.isLoggedIn())try{const V=await window.liff.getProfile();l(V),a(Y=>({...Y,lineUserId:V.userId,lineDisplayName:V.displayName,linePictureUrl:V.pictureUrl,fullName:V.displayName||Y.fullName})),console.log("LIFF Profile loaded:",V),g({title:"เชื่อมต่อ LINE สำเร็จ",description:`ยินดีต้อนรับ ${V.displayName}`})}catch(V){console.error("Error getting LIFF profile:",V),x("ไม่สามารถดึงข้อมูลโปรไฟล์ LINE ได้")}else console.log("User not logged in to LINE"),window.liff.isInClient()&&window.liff.login();else console.log("LIFF SDK not found, loading..."),await v()}catch(V){console.error("LIFF initialization failed:",V),x(`LIFF เริ่มต้นไม่สำเร็จ: ${V}`)}})()},[t,g]);const v=()=>new Promise((E,V)=>{const Y=document.createElement("script");Y.src="https://static.line-scdn.net/liff/edge/2/sdk.js",Y.onload=async()=>{try{if(await window.liff.init({liffId:t}),d(!0),u(window.liff.isInClient()),window.liff.isLoggedIn()){const P=await window.liff.getProfile();l(P),a(T=>({...T,lineUserId:P.userId,lineDisplayName:P.displayName,linePictureUrl:P.pictureUrl,fullName:P.displayName||T.fullName}))}E()}catch(P){V(P)}},Y.onerror=V,document.head.appendChild(Y)}),f=(E,V)=>{a(Y=>({...Y,[E]:V}))},N=async()=>{if(!s.fullName||!s.phone){g({title:"ข้อผิดพลาด",description:"กรุณากรอกข้อมูลให้ครบถ้วน",variant:"destructive"});return}if(!/^[0-9]{9,10}$/.test(s.phone.replace(/[-\s]/g,""))){g({title:"ข้อผิดพลาด",description:"กรุณากรอกหมายเลขโทรศัพท์ให้ถูกต้อง",variant:"destructive"});return}r(!0);try{const V=`HOM-${Date.now().toString().slice(-6)}`,Y=new Date(Date.now()+24*60*60*1e3).toISOString().split("T")[0],{data:P,error:T}=await O.from("appointments").insert({appointment_id:V,patient_name:s.fullName,patient_phone:s.phone,patient_id_number:s.lineUserId,vaccine_type:"general_service",appointment_date:Y,appointment_time:"09:00",status:"scheduled",scheduled_by:"patient_liff",line_user_id:s.lineUserId,notes:`ลงทะเบียนผ่าน LINE LIFF - ${s.lineDisplayName}`}).select().single();if(T)throw T;if(o(!0),g({title:"ลงทะเบียนสำเร็จ",description:`ลงทะเบียนรับบริการสำเร็จแล้ว (ID: ${V})`}),s.lineUserId)try{await O.functions.invoke("send-line-message",{body:{userId:s.lineUserId,message:`✅ ลงทะเบียนรับบริการสำเร็จ

📋 รายละเอียด:
• ชื่อ: ${s.fullName}
• เบอร์โทร: ${s.phone}
• วันที่: ${Y}
• รหัสนัดหมาย: ${V}

🏥 โรงพยาบาลโฮม
เจ้าหน้าที่จะติดต่อกลับเพื่อยืนยันนัดหมาย`,type:"template",templateData:{appointmentId:V,patientName:s.fullName,appointmentDate:Y}}})}catch(W){console.error("Error sending LINE message:",W)}if(p&&window.liff)try{await window.liff.sendMessages([{type:"text",text:`✅ ลงทะเบียนรับบริการสำเร็จ

ชื่อ: ${s.fullName}
เบอร์: ${s.phone}
รหัส: ${V}

โรงพยาบาลโฮม
เจ้าหน้าที่จะติดต่อกลับเพื่อยืนยันนัดหมาย`}])}catch(W){console.error("Error sending LINE chat message:",W)}setTimeout(()=>{p&&window.liff&&window.liff.closeWindow()},8e3)}catch(V){console.error("Registration error:",V),g({title:"ลงทะเบียนไม่สำเร็จ",description:`เกิดข้อผิดพลาด: ${V}`,variant:"destructive"})}finally{r(!1)}},_=()=>{a({fullName:(j==null?void 0:j.displayName)||"",phone:"",lineUserId:j==null?void 0:j.userId,lineDisplayName:j==null?void 0:j.displayName,linePictureUrl:j==null?void 0:j.pictureUrl}),o(!1)},A=()=>{window.liff&&window.liff.isInClient()&&window.liff.closeWindow()};return i?e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx(S,{className:"border-green-200 bg-green-50",children:e.jsxs(D,{className:"p-8 text-center",children:[e.jsx(G,{className:"h-16 w-16 text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-2",children:"ลงทะเบียนสำเร็จ!"}),e.jsxs("p",{className:"text-green-700 mb-6",children:["ขอบคุณที่ลงทะเบียน เจ้าหน้าที่จะติดต่อกลับเพื่อยืนยันนัดหมาย",p&&e.jsx("span",{className:"block mt-2 text-sm font-medium",children:"⏰ หน้าต่างจะปิดอัตโนมัติใน 8 วินาที"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border mb-6 text-left",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"ข้อมูลที่ลงทะเบียน:"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ชื่อ:"})," ",s.fullName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"เบอร์โทร:"})," ",s.phone]}),e.jsxs("p",{children:[e.jsx("strong",{children:"สถานที่:"})," โรงพยาบาลโฮม"]}),s.lineUserId&&e.jsxs("p",{children:[e.jsx("strong",{children:"LINE ID:"})," ",s.lineUserId]})]})]}),e.jsxs("div",{className:"space-y-2",children:[!p&&e.jsx(k,{onClick:_,variant:"outline",className:"w-full",children:"ลงทะเบียนใหม่"}),p&&e.jsx(k,{onClick:A,className:"w-full",children:"ปิดหน้าต่าง"})]})]})})})}):e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"ลงทะเบียนรับบริการ"}),e.jsx("h2",{className:"text-xl text-muted-foreground mt-2 font-semibold",children:"โรงพยาบาลโฮม"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-sm",children:"กรุณากรอกข้อมูลเพื่อลงทะเบียนรับบริการ"})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"h-5 w-5"}),"สถานะ LINE App"]})}),e.jsx(D,{children:m?e.jsxs(Q,{variant:"destructive",children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsx(X,{children:m})]}):e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"LIFF พร้อมใช้:"}),e.jsx("span",{className:c?"text-green-600":"text-red-600",children:c?"✓ พร้อม":"✗ ไม่พร้อม"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ใน LINE App:"}),e.jsx("span",{className:p?"text-green-600":"text-yellow-600",children:p?"✓ ใช่":"✗ เบราว์เซอร์"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"โปรไฟล์:"}),e.jsx("span",{className:j?"text-green-600":"text-yellow-600",children:j?"✓ เชื่อมต่อแล้ว":"✗ ยังไม่เชื่อมต่อ"})]})]})})]}),j&&e.jsx(S,{children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[j.pictureUrl&&e.jsx("img",{src:j.pictureUrl,alt:"LINE Profile",className:"w-12 h-12 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:j.displayName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"เชื่อมต่อจาก LINE"})]})]})})}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"h-5 w-5"}),"ข้อมูลผู้ลงทะเบียน"]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"fullName",children:"ชื่อ-นามสกุล"}),e.jsx(ae,{id:"fullName",placeholder:"นาย/นาง/นางสาว ชื่อ นามสกุล",value:s.fullName,onChange:E=>f("fullName",E.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"phone",children:"หมายเลขโทรศัพท์"}),e.jsx(ae,{id:"phone",placeholder:"08x-xxx-xxxx",value:s.phone,onChange:E=>f("phone",E.target.value),className:"mt-1"})]})]})]}),e.jsx(k,{onClick:N,disabled:n,className:"w-full",size:"lg",children:n?"กำลังลงทะเบียน...":"ลงทะเบียนรับบริการ"}),e.jsx(Q,{children:e.jsxs(X,{children:["หลังจากลงทะเบียน เจ้าหน้าที่จะติดต่อกลับเพื่อยืนยันนัดหมาย และแจ้งข้อมูลบริการที่ต้องการ",p&&" ข้อความยืนยันจะถูกส่งไปที่แชท LINE ของคุณ"]})})]})})},Fx=()=>e.jsx(Ox,{}),Vx=()=>{const[t,s]=h.useState([]),[a,n]=h.useState([]),[r,i]=h.useState(""),[o,c]=h.useState(null),[d,p]=h.useState(!1),[u,j]=h.useState(!0),[l,m]=h.useState(null),{toast:x}=ce();h.useEffect(()=>{g()},[]),h.useEffect(()=>{if(!r.trim())n(t);else{const _=t.filter(A=>A.full_name.toLowerCase().includes(r.toLowerCase())||A.phone.includes(r)||A.registration_id.toLowerCase().includes(r.toLowerCase()));n(_)}},[r,t]);const g=async()=>{try{j(!0);const{data:_,error:A}=await O.from("patient_registrations").select("*").order("full_name",{ascending:!0});if(A)throw A;s(_||[])}catch{x({variant:"destructive",title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดรายชื่อผู้ป่วยได้"})}finally{j(!1)}},v=async _=>{p(!0),c(_);try{const V=await fetch("https://fljyjbrgfzervxofrilo.supabase.co/functions/v1/secure-vaccine-status-lookup",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZsanlqYnJnZnplcnZ4b2ZyaWxvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMDE1MDUsImV4cCI6MjA2OTY3NzUwNX0.2_rGfy-3UA4cPnRsg8Lm8uvj9KBCOoz5IhwCbSWYIq4"},body:JSON.stringify({searchType:"phone",searchValue:_.phone})});if(!V.ok){const P=await V.json();throw new Error(P.error||"เกิดข้อผิดพลาดในการค้นหาข้อมูล")}const Y=await V.json();m({appointments:Y.appointments||[],logs:Y.vaccineLogs||[],registrations:Y.registrations||[]}),x({title:"โหลดข้อมูลสำเร็จ",description:`โหลดข้อมูลของ ${_.full_name} สำเร็จ`})}catch(A){console.error("Error:",A),x({variant:"destructive",title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลวัคซีนได้"})}finally{p(!1)}},f=_=>{const A={completed:{label:"เสร็จสิ้น",variant:"default",icon:G},in_progress:{label:"กำลังดำเนินการ",variant:"secondary",icon:De},scheduled:{label:"นัดหมายแล้ว",variant:"outline",icon:be},cancelled:{label:"ยกเลิก",variant:"destructive",icon:bt}},E=A[_]||A.in_progress,V=E.icon;return e.jsxs(H,{variant:E.variant,className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),E.label]})},N=_=>_?new Date(_).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}):"-";return e.jsx("div",{className:"container mx-auto p-4 max-w-6xl",children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"ตรวจสอบสถานะการฉีดวัคซีน"]}),e.jsx(oe,{children:"เลือกผู้ป่วยเพื่อดูข้อมูลการฉีดวัคซีนและประวัติการรักษา"})]}),e.jsx(D,{className:"space-y-6",children:o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-medium",children:[e.jsx(yt,{className:"h-5 w-5"}),"ข้อมูลผู้ป่วย: ",o.full_name]}),e.jsx(k,{variant:"outline",onClick:()=>{c(null),m(null)},children:"กลับไปยังรายชื่อ"})]}),d?e.jsx("div",{className:"text-center py-8",children:"กำลังโหลดข้อมูลวัคซีน..."}):l&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx(L,{children:e.jsx($,{className:"text-lg",children:"ข้อมูลการลงทะเบียน"})}),e.jsx(D,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"ชื่อ-นามสกุล:"}),e.jsx("span",{className:"ml-2 font-medium",children:o.full_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"เบอร์โทร:"}),e.jsx("span",{className:"ml-2",children:o.phone})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"โรงพยาบาล:"}),e.jsx("span",{className:"ml-2",children:o.hospital})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"รหัสลงทะเบียน:"}),e.jsx("span",{className:"ml-2",children:o.registration_id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"วันที่ลงทะเบียน:"}),e.jsx("span",{className:"ml-2",children:N(o.created_at)})]}),o.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"หมายเหตุ:"}),e.jsx("p",{className:"text-sm mt-1",children:o.notes})]})]})})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsx($,{className:"text-lg",children:"นัดหมายการฉีดวัคซีน"})}),e.jsx(D,{children:l.appointments&&l.appointments.length>0?e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:l.appointments.map(_=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:_.vaccine_type}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(be,{className:"h-3 w-3"}),N(_.appointment_date),_.appointment_time&&e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"h-3 w-3 ml-1"}),_.appointment_time.substring(0,5)]})]})]}),f(_.status)]}),_.notes&&e.jsx("p",{className:"text-sm text-muted-foreground",children:_.notes})]},_.id))}):e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"ไม่มีนัดหมาย"})})]}),e.jsxs(S,{className:"lg:col-span-2",children:[e.jsx(L,{children:e.jsx($,{className:"text-lg",children:"ประวัติการฉีดวัคซีน"})}),e.jsx(D,{children:l.logs&&l.logs.length>0?e.jsx("div",{className:"space-y-3",children:l.logs.map(_=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("h4",{className:"font-medium",children:_.vaccine_type}),e.jsxs(H,{variant:"outline",children:["เข็มที่ ",_.dose_number]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"วันที่ฉีด:"}),e.jsx("p",{className:"font-medium",children:N(_.administered_date)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"ฉีดโดย:"}),e.jsx("p",{className:"font-medium",children:_.administered_by})]}),_.batch_number&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Batch:"}),e.jsx("p",{className:"font-medium",children:_.batch_number})]}),_.side_effects&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"ผลข้างเคียง:"}),e.jsx("p",{className:"font-medium",children:_.side_effects})]})]}),_.notes&&e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"หมายเหตุ:"}),e.jsx("p",{className:"text-sm mt-1",children:_.notes})]})]},_.id))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"ไม่มีประวัติการฉีดวัคซีน"})})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(ae,{placeholder:"ค้นหาด้วยชื่อ เบอร์โทร หรือรหัสลงทะเบียน",value:r,onChange:_=>i(_.target.value),className:"pl-10"})]}),e.jsxs(S,{children:[e.jsx(L,{children:e.jsxs($,{className:"text-lg",children:["รายชื่อผู้ป่วย (",a.length," คน)"]})}),e.jsx(D,{children:u?e.jsx("div",{className:"text-center py-8",children:"กำลังโหลดรายชื่อผู้ป่วย..."}):a.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:t.length===0?"ไม่พบข้อมูลผู้ป่วยในระบบ":"ไม่พบผู้ป่วยที่ตรงกับการค้นหา"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:a.map(_=>e.jsx("div",{className:"border rounded-lg p-3 hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>v(_),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:_.full_name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(yt,{className:"h-3 w-3"}),_.phone]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"h-3 w-3"}),N(_.created_at)]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["รหัส: ",_.registration_id]})]}),e.jsx(H,{variant:_.status==="pending"?"secondary":"default",className:"ml-2",children:_.status==="pending"?"รอการนัดหมาย":_.status})]})},_.id))})})]})]})})]})})},zx=()=>e.jsx(Vx,{}),Wx=new il,Bx=()=>e.jsx(hd,{children:e.jsx(ol,{client:Wx,children:e.jsxs(ai,{children:[e.jsx(pc,{}),e.jsx(Bc,{}),e.jsx(Ho,{basename:"/VaccineHomeBot",children:e.jsxs(qo,{children:[e.jsx(ke,{path:"/",element:e.jsx(Gn,{})}),e.jsx(ke,{path:"/loading",element:e.jsx($x,{})}),e.jsx(ke,{path:"/home",element:e.jsx(Gn,{})}),e.jsx(ke,{path:"/auth",element:e.jsx(Lx,{})}),e.jsx(ke,{path:"/auth-full",element:e.jsx(Rx,{})}),e.jsx(ke,{path:"/admin",element:e.jsx(jm,{})}),e.jsx(ke,{path:"/line-bot",element:e.jsx(Pn,{})}),e.jsx(ke,{path:"/LineBot",element:e.jsx(Pn,{})}),e.jsx(ke,{path:"/patient-portal",element:e.jsx(Mn,{})}),e.jsx(ke,{path:"/PatientPortal",element:e.jsx(Mn,{})}),e.jsx(ke,{path:"/staff-portal",element:e.jsx(Hn,{})}),e.jsx(ke,{path:"/StaffPortal",element:e.jsx(Hn,{})}),e.jsx(ke,{path:"/liff-patient-portal",element:e.jsx(Fx,{})}),e.jsx(ke,{path:"/vaccine-status",element:e.jsx(zx,{})}),e.jsx(ke,{path:"*",element:e.jsx(bm,{})})]})})]})})});jr(document.getElementById("root")).render(e.jsx(h.StrictMode,{children:e.jsx(Bx,{})}));
