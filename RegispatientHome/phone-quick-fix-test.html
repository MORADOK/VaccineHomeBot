<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîß Phone Input Quick Fix Test</title>
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      margin: 20px;
      background: #f8f9fa;
      line-height: 1.6;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .form-group {
      margin: 20px 0;
    }
    .label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 16px;
      color: #333;
    }
    .input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 10px;
      font-size: 16px;
      font-family: 'Sarabun', sans-serif;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    .input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }
    .input.error {
      border-color: #dc3545;
      background-color: #fff5f5;
    }
    .error {
      color: #dc3545;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
    }
    .success {
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîß Phone Input Quick Fix Test</h1>
    <p><strong>‡∏õ‡∏±‡∏ç‡∏´‡∏≤:</strong> ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡∏Ç‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡πÑ‡∏õ</p>
    <p><strong>‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong> ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á formatting ‡∏•‡∏á</p>

    <div class="info">
      <strong>üß™ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</strong><br>
      1. ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á<br>
      2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå<br>
      3. ‡∏•‡∏≠‡∏á focus/blur ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π formatting<br>
      4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö validation
    </div>

    <div class="form-group">
      <label class="label" for="testPhone">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</label>
      <input type="tel" id="testPhone" class="input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" maxlength="12">
      <div class="error" id="phoneError">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</div>
    </div>

    <div id="status" class="info">
      <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...<br>
      <strong>Raw Value:</strong> <span id="rawValue">-</span><br>
      <strong>Display Value:</strong> <span id="displayValue">-</span><br>
      <strong>Validation:</strong> <span id="validationStatus">-</span>
    </div>

    <div class="info">
      <strong>üìã Test Cases:</strong><br>
      ‚Ä¢ <strong>0812345678</strong> - ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏õ‡∏Å‡∏ï‡∏¥<br>
      ‚Ä¢ <strong>812345678</strong> - ‡πÑ‡∏°‡πà‡∏°‡∏µ 0 ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤<br>
      ‚Ä¢ <strong>08123456789</strong> - ‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏Ñ‡∏ß‡∏£‡∏ï‡∏±‡∏î‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 10 ‡∏´‡∏•‡∏±‡∏Å)<br>
      ‚Ä¢ <strong>081234567</strong> - ‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ<br>
      ‚Ä¢ <strong>0712345678</strong> - ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ö‡πâ‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô)
    </div>
  </div>

  <!-- Include validation service -->
  <script src="./config.js"></script>
  <script src="./validation.js"></script>

  <script>
    let validationService;
    
    document.addEventListener('DOMContentLoaded', () => {
      try {
        validationService = new ValidationService();
        console.log('‚úÖ ValidationService initialized');
        setupPhoneInput();
      } catch (error) {
        console.error('‚ùå Failed to initialize ValidationService:', error);
        document.getElementById('status').innerHTML = '<strong style="color: red;">‚ùå ValidationService failed to load</strong>';
      }
    });

    function setupPhoneInput() {
      const elPhone = document.getElementById('testPhone');
      const phoneError = document.getElementById('phoneError');
      const rawValue = document.getElementById('rawValue');
      const displayValue = document.getElementById('displayValue');
      const validationStatus = document.getElementById('validationStatus');

      // Same simplified logic as in main index.html
      elPhone.addEventListener('input', (e) => {
        console.log('Input event:', e.target.value);
        
        // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏Å‡∏±‡∏î 10 ‡∏´‡∏•‡∏±‡∏Å
        const cleaned = e.target.value.replace(/[^\d]/g, '').substring(0, 10);
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà format (‡πÉ‡∏´‡πâ user ‡πÄ‡∏´‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÜ)
        e.target.value = cleaned;
        
        // ‡πÄ‡∏Å‡πá‡∏ö raw value
        e.target.setAttribute('data-raw-value', cleaned);

        // Update display
        rawValue.textContent = cleaned || '-';
        displayValue.textContent = e.target.value || '-';

        // Real-time validation feedback (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ 9+ ‡∏´‡∏•‡∏±‡∏Å)
        if (validationService && cleaned.length >= 9) {
          const validation = validationService.validatePhoneNumber(cleaned);
          validationStatus.textContent = validation.isValid ? '‚úÖ Valid' : '‚ùå ' + validation.errors[0];
          
          if (validation.isValid) {
            e.target.classList.remove('error');
            phoneError.style.display = 'none';
          } else {
            e.target.classList.add('error');
            phoneError.textContent = validation.errors[0] || '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
            phoneError.style.display = 'block';
          }
        } else {
          // ‡∏¢‡∏±‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á error
          e.target.classList.remove('error');
          phoneError.style.display = 'none';
          validationStatus.textContent = cleaned.length > 0 ? `Typing... (${cleaned.length}/10)` : '-';
        }
      });

      elPhone.addEventListener('blur', (e) => {
        console.log('Blur event:', e.target.value);
        
        if (validationService) {
          const rawVal = e.target.getAttribute('data-raw-value') || e.target.value.replace(/[^\d]/g, '');
          const validation = validationService.validatePhoneNumber(rawVal);
          
          if (validation.isValid) {
            // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠ blur
            const formatted = validation.sanitized.replace(/^(\d{3})(\d{3})(\d{4})$/, '$1-$2-$3');
            e.target.value = formatted;
            e.target.setAttribute('data-raw-value', validation.sanitized);
            e.target.classList.remove('error');
            phoneError.style.display = 'none';
            validationStatus.textContent = '‚úÖ Valid: ' + validation.sanitized;
            displayValue.textContent = formatted;
          } else if (rawVal.length > 0) {
            // ‡πÅ‡∏™‡∏î‡∏á error ‡πÄ‡∏°‡∏∑‡πà‡∏≠ blur ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            e.target.classList.add('error');
            phoneError.textContent = validation.errors[0] || '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
            phoneError.style.display = 'block';
            validationStatus.textContent = '‚ùå Invalid: ' + validation.errors[0];
          }
        }
      });

      elPhone.addEventListener('focus', (e) => {
        console.log('Focus event:', e.target.value);
        
        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ focus ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        const rawVal = e.target.getAttribute('data-raw-value') || e.target.value.replace(/[^\d]/g, '');
        e.target.value = rawVal;
        displayValue.textContent = rawVal || '-';
        validationStatus.textContent = rawVal.length > 0 ? `Editing... (${rawVal.length}/10)` : 'Ready for input';
      });
    }
  </script>
</body>
</html>