<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß™ Complete System Test - VCHome Registration</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f8f9fa;
      line-height: 1.6;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .test-section {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .test-section h3 {
      margin-top: 0;
      color: #007bff;
      border-bottom: 2px solid #e9ecef;
      padding-bottom: 10px;
    }
    .form-group {
      margin: 20px 0;
    }
    .label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 16px;
      color: #333;
    }
    .input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 10px;
      font-size: 16px;
      font-family: 'Sarabun', sans-serif;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    .input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }
    .input.error {
      border-color: #dc3545;
      background-color: #fff5f5;
    }
    .error {
      color: #dc3545;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    .test-result {
      margin: 10px 0;
      padding: 15px;
      border-radius: 8px;
      font-weight: 500;
    }
    .pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
      font-family: 'Sarabun', sans-serif;
      font-weight: 500;
      transition: background 0.3s;
    }
    button:hover { background: #0056b3; }
    button.success { background: #28a745; }
    button.danger { background: #dc3545; }
    button.warning { background: #ffc107; color: #212529; }
    .console-output {
      background: #2d3748;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin: 15px 0;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .stat-number {
      font-size: 2em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .stat-label {
      color: #6c757d;
      font-size: 0.9em;
    }
    .test-scenario {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
      border-left: 4px solid #007bff;
    }
    .scenario-title {
      font-weight: 600;
      color: #007bff;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üß™ Complete System Test</h1>
      <h2>VCHome Registration System</h2>
      <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô</p>
    </div>

    <!-- Test Statistics -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-number" id="totalTests">0</div>
        <div class="stat-label">Total Tests</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="passedTests" style="color: #28a745;">0</div>
        <div class="stat-label">Passed</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="failedTests" style="color: #dc3545;">0</div>
        <div class="stat-label">Failed</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="successRate">0%</div>
        <div class="stat-label">Success Rate</div>
      </div>
    </div>

    <div class="test-grid">
      <!-- Service Tests -->
      <div class="test-section">
        <h3>üîß Service Initialization Tests</h3>
        
        <div id="configTest" class="test-result info">Testing config loading...</div>
        <div id="supabaseTest" class="test-result info">Testing Supabase client...</div>
        <div id="validationTest" class="test-result info">Testing validation service...</div>
        <div id="uiTest" class="test-result info">Testing UI components...</div>
        
        <button onclick="runServiceTests()">üöÄ Run Service Tests</button>
      </div>

      <!-- Phone Input Tests -->
      <div class="test-section">
        <h3>üì± Phone Input Tests</h3>
        
        <div class="form-group">
          <label class="label" for="testPhone">Live Phone Input Test:</label>
          <input type="tel" id="testPhone" class="input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">
          <div class="error" id="phoneError">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</div>
        </div>
        
        <div id="phoneStatus" class="test-result info">
          <strong>Status:</strong> Ready for input<br>
          <strong>Raw Value:</strong> <span id="rawValue">-</span><br>
          <strong>Display Value:</strong> <span id="displayValue">-</span><br>
          <strong>Validation:</strong> <span id="validationStatus">-</span>
        </div>
        
        <button onclick="runPhoneTests()">üì± Run Phone Tests</button>
        <button onclick="clearPhoneInput()">üßπ Clear Input</button>
      </div>

      <!-- Validation Tests -->
      <div class="test-section">
        <h3>‚úÖ Validation Tests</h3>
        
        <div id="validationResults"></div>
        
        <button onclick="runValidationTests()">‚úÖ Run Validation Tests</button>
        <button onclick="runNameValidationTests()">üë§ Test Name Validation</button>
      </div>

      <!-- Integration Tests -->
      <div class="test-section">
        <h3>üîó Integration Tests</h3>
        
        <div id="integrationResults"></div>
        
        <button onclick="runIntegrationTests()">üîó Run Integration Tests</button>
        <button onclick="testFormSubmission()">üìù Test Form Submission</button>
      </div>
    </div>

    <!-- Test Scenarios -->
    <div class="test-section">
      <h3>üìã Test Scenarios</h3>
      
      <div class="test-scenario">
        <div class="scenario-title">Scenario 1: Normal Registration</div>
        <p>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" ‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå "0812345678" ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</p>
        <button onclick="runScenario1()">‚ñ∂Ô∏è Run Scenario 1</button>
      </div>
      
      <div class="test-scenario">
        <div class="scenario-title">Scenario 2: Phone Format Variations</div>
        <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ: +66, 66, 9 ‡∏´‡∏•‡∏±‡∏Å, ‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢</p>
        <button onclick="runScenario2()">‚ñ∂Ô∏è Run Scenario 2</button>
      </div>
      
      <div class="test-scenario">
        <div class="scenario-title">Scenario 3: Error Handling</div>
        <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ú‡∏¥‡∏î, ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏¥‡∏î, ‡πÑ‡∏°‡πà‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°</p>
        <button onclick="runScenario3()">‚ñ∂Ô∏è Run Scenario 3</button>
      </div>
      
      <div id="scenarioResults"></div>
    </div>

    <!-- Control Panel -->
    <div class="test-section">
      <h3>üéõÔ∏è Control Panel</h3>
      <button class="success" onclick="runAllTests()">üöÄ Run All Tests</button>
      <button class="warning" onclick="runCriticalTests()">‚ö° Run Critical Tests</button>
      <button onclick="clearAllResults()">üßπ Clear All Results</button>
      <button class="danger" onclick="resetSystem()">üîÑ Reset System</button>
    </div>

    <!-- Console Output -->
    <div class="test-section">
      <h3>üìã Console Output</h3>
      <div id="console" class="console-output">System initialized. Ready for testing...</div>
      <button onclick="clearConsole()">Clear Console</button>
      <button onclick="exportResults()">üìÑ Export Results</button>
    </div>
  </div>

  <!-- Include all services -->
  <script src="./config.js"></script>
  <script src="./supabase-client.js"></script>
  <script src="./validation.js"></script>
  <script src="./ui-components.js"></script>

  <script>
    // Test Statistics
    let testStats = {
      total: 0,
      passed: 0,
      failed: 0
    };

    // Services
    let supabaseClient, validationService, uiComponents;

    // Console capture
    const consoleDiv = document.getElementById('console');
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;
    
    function logToConsole(type, ...args) {
      const timestamp = new Date().toLocaleTimeString();
      const message = args.map(arg => 
        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
      ).join(' ');
      consoleDiv.textContent += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }
    
    console.log = (...args) => {
      originalLog(...args);
      logToConsole('log', ...args);
    };
    
    console.error = (...args) => {
      originalError(...args);
      logToConsole('error', ...args);
    };
    
    console.warn = (...args) => {
      originalWarn(...args);
      logToConsole('warn', ...args);
    };

    // Test helper functions
    function updateTestResult(elementId, success, message) {
      const element = document.getElementById(elementId);
      if (element) {
        element.className = `test-result ${success ? 'pass' : 'fail'}`;
        element.textContent = `${success ? '‚úÖ' : '‚ùå'} ${message}`;
      }
      
      testStats.total++;
      if (success) {
        testStats.passed++;
      } else {
        testStats.failed++;
      }
      updateStats();
    }

    function updateStats() {
      document.getElementById('totalTests').textContent = testStats.total;
      document.getElementById('passedTests').textContent = testStats.passed;
      document.getElementById('failedTests').textContent = testStats.failed;
      const successRate = testStats.total > 0 ? Math.round((testStats.passed / testStats.total) * 100) : 0;
      document.getElementById('successRate').textContent = successRate + '%';
    }

    // Initialize system
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('üß™ Complete System Test initialized');
      
      try {
        // Initialize services
        supabaseClient = new SupabaseClient();
        validationService = new ValidationService();
        uiComponents = new UIComponents();
        
        console.log('‚úÖ All services initialized successfully');
        setupPhoneInput();
        
        // Auto-run service tests
        setTimeout(runServiceTests, 1000);
        
      } catch (error) {
        console.error('‚ùå Failed to initialize system:', error);
      }
    });

    // Service Tests
    async function runServiceTests() {
      console.log('üîß Running service tests...');
      
      // Test 1: Config
      try {
        if (window.CONFIG || window.VCHomeConfig) {
          updateTestResult('configTest', true, 'Configuration loaded successfully');
        } else {
          updateTestResult('configTest', false, 'Configuration not found');
        }
      } catch (error) {
        updateTestResult('configTest', false, `Config error: ${error.message}`);
      }
      
      // Test 2: Supabase
      try {
        const health = await supabaseClient.healthCheck();
        updateTestResult('supabaseTest', health.status === 'healthy', 
          `SupabaseClient: ${health.status}`);
      } catch (error) {
        updateTestResult('supabaseTest', false, `SupabaseClient error: ${error.message}`);
      }
      
      // Test 3: Validation
      try {
        const testResult = validationService.validatePhoneNumber('0812345678');
        updateTestResult('validationTest', testResult.isValid, 
          'ValidationService working correctly');
      } catch (error) {
        updateTestResult('validationTest', false, `ValidationService error: ${error.message}`);
      }
      
      // Test 4: UI Components
      try {
        uiComponents.showToast('Test message', 'info', 2000);
        updateTestResult('uiTest', true, 'UIComponents working correctly');
      } catch (error) {
        updateTestResult('uiTest', false, `UIComponents error: ${error.message}`);
      }
    }

    // Phone Input Setup
    function setupPhoneInput() {
      const elPhone = document.getElementById('testPhone');
      const phoneError = document.getElementById('phoneError');
      const rawValue = document.getElementById('rawValue');
      const displayValue = document.getElementById('displayValue');
      const validationStatus = document.getElementById('validationStatus');

      // Same logic as main system
      elPhone.addEventListener('input', (e) => {
        const cleaned = e.target.value.replace(/[^\d]/g, '').substring(0, 10);
        e.target.value = cleaned;
        e.target.setAttribute('data-raw-value', cleaned);

        // Update display
        rawValue.textContent = cleaned || '-';
        displayValue.textContent = e.target.value || '-';

        // Validation
        if (validationService && cleaned.length >= 9) {
          const validation = validationService.validatePhoneNumber(cleaned);
          validationStatus.textContent = validation.isValid ? '‚úÖ Valid' : '‚ùå ' + validation.errors[0];
          
          if (validation.isValid) {
            e.target.classList.remove('error');
            phoneError.style.display = 'none';
          } else {
            e.target.classList.add('error');
            phoneError.textContent = validation.errors[0];
            phoneError.style.display = 'block';
          }
        } else {
          e.target.classList.remove('error');
          phoneError.style.display = 'none';
          validationStatus.textContent = cleaned.length > 0 ? `Typing... (${cleaned.length}/10)` : '-';
        }
      });

      elPhone.addEventListener('blur', (e) => {
        if (validationService) {
          const rawVal = e.target.getAttribute('data-raw-value') || '';
          const validation = validationService.validatePhoneNumber(rawVal);
          
          if (validation.isValid) {
            const formatted = validation.sanitized.replace(/^(\d{3})(\d{3})(\d{4})$/, '$1-$2-$3');
            e.target.value = formatted;
            displayValue.textContent = formatted;
            validationStatus.textContent = '‚úÖ Valid: ' + validation.sanitized;
          }
        }
      });

      elPhone.addEventListener('focus', (e) => {
        const rawVal = e.target.getAttribute('data-raw-value') || '';
        e.target.value = rawVal;
        displayValue.textContent = rawVal || '-';
      });
    }

    // Phone Tests
    function runPhoneTests() {
      console.log('üì± Running phone input tests...');
      
      const testCases = [
        { input: '0812345678', expected: true, description: 'Normal mobile number' },
        { input: '812345678', expected: true, description: '9 digits (auto-add 0)' },
        { input: '0912345678', expected: true, description: '09 mobile number' },
        { input: '0612345678', expected: true, description: '06 mobile number' },
        { input: '0712345678', expected: false, description: 'Landline number' },
        { input: '081234567', expected: false, description: 'Too short' },
        { input: '08123456789', expected: false, description: 'Too long (should be truncated)' }
      ];

      let results = '<h4>Phone Validation Test Results:</h4>';
      testCases.forEach(test => {
        const result = validationService.validatePhoneNumber(test.input);
        const passed = result.isValid === test.expected;
        results += `<div class="test-result ${passed ? 'pass' : 'fail'}">
          ${passed ? '‚úÖ' : '‚ùå'} ${test.description}: "${test.input}" ‚Üí ${result.isValid ? 'Valid' : 'Invalid'}
        </div>`;
        
        testStats.total++;
        if (passed) testStats.passed++;
        else testStats.failed++;
      });
      
      document.getElementById('phoneStatus').innerHTML = results;
      updateStats();
    }

    // Validation Tests
    function runValidationTests() {
      console.log('‚úÖ Running validation tests...');
      
      const phoneTests = [
        { input: '0812345678', expected: true },
        { input: '+66812345678', expected: true },
        { input: '66812345678', expected: true },
        { input: '0712345678', expected: false },
        { input: '081234567', expected: false }
      ];

      let results = '<h4>Validation Test Results:</h4>';
      phoneTests.forEach((test, index) => {
        const result = validationService.validatePhoneNumber(test.input);
        const passed = result.isValid === test.expected;
        results += `<div class="test-result ${passed ? 'pass' : 'fail'}">
          Test ${index + 1}: "${test.input}" ‚Üí ${passed ? 'PASS' : 'FAIL'}
        </div>`;
        
        testStats.total++;
        if (passed) testStats.passed++;
        else testStats.failed++;
      });
      
      document.getElementById('validationResults').innerHTML = results;
      updateStats();
    }

    function runNameValidationTests() {
      const nameTests = [
        { input: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ', expected: true },
        { input: 'John Doe', expected: true },
        { input: '‡∏Å', expected: false },
        { input: '', expected: false }
      ];

      let results = '<h4>Name Validation Results:</h4>';
      nameTests.forEach((test, index) => {
        const result = validationService.validatePatientName(test.input);
        const passed = result.isValid === test.expected;
        results += `<div class="test-result ${passed ? 'pass' : 'fail'}">
          Name Test ${index + 1}: "${test.input}" ‚Üí ${passed ? 'PASS' : 'FAIL'}
        </div>`;
        
        testStats.total++;
        if (passed) testStats.passed++;
        else testStats.failed++;
      });
      
      document.getElementById('validationResults').innerHTML += results;
      updateStats();
    }

    // Integration Tests
    function runIntegrationTests() {
      console.log('üîó Running integration tests...');
      
      let results = '<h4>Integration Test Results:</h4>';
      
      // Test 1: Full validation flow
      try {
        const testData = {
          patientName: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö',
          phoneNumber: '0812345678',
          lineUserId: 'test-user-123'
        };
        
        const validation = validationService.validateRegistrationData(testData);
        const passed = validation.isValid;
        
        results += `<div class="test-result ${passed ? 'pass' : 'fail'}">
          Full Validation Flow: ${passed ? 'PASS' : 'FAIL'}
        </div>`;
        
        testStats.total++;
        if (passed) testStats.passed++;
        else testStats.failed++;
        
      } catch (error) {
        results += `<div class="test-result fail">
          Integration Test Error: ${error.message}
        </div>`;
        testStats.total++;
        testStats.failed++;
      }
      
      document.getElementById('integrationResults').innerHTML = results;
      updateStats();
    }

    // Scenario Tests
    function runScenario1() {
      console.log('‚ñ∂Ô∏è Running Scenario 1: Normal Registration');
      
      const testData = {
        patientName: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ',
        phoneNumber: '0812345678',
        lineUserId: 'test-user-scenario1'
      };
      
      const validation = validationService.validateRegistrationData(testData);
      const result = `<div class="test-result ${validation.isValid ? 'pass' : 'fail'}">
        Scenario 1: ${validation.isValid ? 'PASS' : 'FAIL'} - Normal registration flow
      </div>`;
      
      document.getElementById('scenarioResults').innerHTML = result;
      
      testStats.total++;
      if (validation.isValid) testStats.passed++;
      else testStats.failed++;
      updateStats();
    }

    function runScenario2() {
      console.log('‚ñ∂Ô∏è Running Scenario 2: Phone Format Variations');
      
      const phoneFormats = ['+66812345678', '66812345678', '812345678', '08-1234-5678'];
      let results = '<h4>Scenario 2 Results:</h4>';
      
      phoneFormats.forEach(phone => {
        const validation = validationService.validatePhoneNumber(phone);
        results += `<div class="test-result ${validation.isValid ? 'pass' : 'fail'}">
          "${phone}" ‚Üí ${validation.isValid ? 'VALID' : 'INVALID'}
        </div>`;
        
        testStats.total++;
        if (validation.isValid) testStats.passed++;
        else testStats.failed++;
      });
      
      document.getElementById('scenarioResults').innerHTML = results;
      updateStats();
    }

    function runScenario3() {
      console.log('‚ñ∂Ô∏è Running Scenario 3: Error Handling');
      
      const errorCases = [
        { name: '', phone: '0812345678', description: 'Empty name' },
        { name: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ', phone: '0712345678', description: 'Invalid phone' },
        { name: '‡∏Å', phone: '0812345678', description: 'Name too short' }
      ];
      
      let results = '<h4>Scenario 3 Results:</h4>';
      
      errorCases.forEach(testCase => {
        const validation = validationService.validateRegistrationData({
          patientName: testCase.name,
          phoneNumber: testCase.phone,
          lineUserId: 'test'
        });
        
        const shouldFail = true; // These should all fail
        const passed = !validation.isValid === shouldFail;
        
        results += `<div class="test-result ${passed ? 'pass' : 'fail'}">
          ${testCase.description}: ${passed ? 'CORRECTLY FAILED' : 'UNEXPECTEDLY PASSED'}
        </div>`;
        
        testStats.total++;
        if (passed) testStats.passed++;
        else testStats.failed++;
      });
      
      document.getElementById('scenarioResults').innerHTML = results;
      updateStats();
    }

    // Control functions
    async function runAllTests() {
      console.log('üöÄ Running all tests...');
      clearAllResults();
      
      await runServiceTests();
      runPhoneTests();
      runValidationTests();
      runNameValidationTests();
      runIntegrationTests();
      runScenario1();
      runScenario2();
      runScenario3();
      
      console.log(`‚úÖ All tests completed! ${testStats.passed}/${testStats.total} passed`);
      
      const successRate = Math.round((testStats.passed / testStats.total) * 100);
      uiComponents.showToast(
        `Tests completed! ${testStats.passed}/${testStats.total} passed (${successRate}%)`,
        successRate >= 90 ? 'success' : successRate >= 70 ? 'warning' : 'error'
      );
    }

    async function runCriticalTests() {
      console.log('‚ö° Running critical tests...');
      clearAllResults();
      
      await runServiceTests();
      runPhoneTests();
      runScenario1();
      
      console.log('‚ö° Critical tests completed');
    }

    function clearAllResults() {
      testStats = { total: 0, passed: 0, failed: 0 };
      updateStats();
      
      const results = document.querySelectorAll('.test-result');
      results.forEach(result => {
        result.className = 'test-result info';
        result.textContent = 'Ready for testing...';
      });
      
      document.getElementById('validationResults').innerHTML = '';
      document.getElementById('integrationResults').innerHTML = '';
      document.getElementById('scenarioResults').innerHTML = '';
    }

    function clearPhoneInput() {
      document.getElementById('testPhone').value = '';
      document.getElementById('rawValue').textContent = '-';
      document.getElementById('displayValue').textContent = '-';
      document.getElementById('validationStatus').textContent = '-';
    }

    function clearConsole() {
      consoleDiv.textContent = 'Console cleared...\n';
    }

    function resetSystem() {
      if (confirm('Are you sure you want to reset the entire test system?')) {
        location.reload();
      }
    }

    function exportResults() {
      const results = {
        timestamp: new Date().toISOString(),
        stats: testStats,
        successRate: testStats.total > 0 ? Math.round((testStats.passed / testStats.total) * 100) : 0,
        console: consoleDiv.textContent
      };
      
      const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `vchome-test-results-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      console.log('üìÑ Test results exported');
    }
  </script>
</body>
</html>