<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß™ Quick Test - VCHome Registration</title>
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      margin: 20px;
      background: #f8f9fa;
    }
    .test-container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .test-result {
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      font-weight: 500;
    }
    .pass { background: #d4edda; color: #155724; }
    .fail { background: #f8d7da; color: #721c24; }
    .pending { background: #fff3cd; color: #856404; }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üß™ Quick Test - VCHome Registration System</h1>
    
    <h3>Service Loading Tests:</h3>
    <div id="configTest" class="test-result pending">Testing config loading...</div>
    <div id="supabaseTest" class="test-result pending">Testing Supabase client...</div>
    <div id="validationTest" class="test-result pending">Testing validation service...</div>
    <div id="uiTest" class="test-result pending">Testing UI components...</div>
    
    <h3>Validation Tests:</h3>
    <button onclick="testPhoneValidation()">Test Phone Validation</button>
    <button onclick="testNameValidation()">Test Name Validation</button>
    <div id="validationResults"></div>
    
    <h3>Manual Tests:</h3>
    <p>1. <a href="./index.html" target="_blank">Open Registration Form</a></p>
    <p>2. <a href="./test.html" target="_blank">Open Full Test Suite</a></p>
    
    <h3>Console Output:</h3>
    <div id="console" style="background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
  </div>

  <!-- Include all services -->
  <script src="./config.js"></script>
  <script src="./supabase-client.js"></script>
  <script src="./validation.js"></script>
  <script src="./ui-components.js"></script>

  <script>
    // Capture console output
    const consoleDiv = document.getElementById('console');
    const originalLog = console.log;
    const originalError = console.error;
    
    function logToDiv(type, ...args) {
      const timestamp = new Date().toLocaleTimeString();
      const message = args.map(arg => 
        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
      ).join(' ');
      consoleDiv.innerHTML += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }
    
    console.log = (...args) => {
      originalLog(...args);
      logToDiv('log', ...args);
    };
    
    console.error = (...args) => {
      originalError(...args);
      logToDiv('error', ...args);
    };

    // Test functions
    function updateResult(elementId, success, message) {
      const element = document.getElementById(elementId);
      element.className = `test-result ${success ? 'pass' : 'fail'}`;
      element.textContent = `${success ? '‚úÖ' : '‚ùå'} ${message}`;
    }

    // Run tests on load
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('üß™ Starting quick tests...');
      
      // Test 1: Config loading
      try {
        if (window.CONFIG || window.VCHomeConfig) {
          updateResult('configTest', true, 'Configuration loaded successfully');
        } else {
          updateResult('configTest', false, 'Configuration not found');
        }
      } catch (error) {
        updateResult('configTest', false, `Config error: ${error.message}`);
      }
      
      // Test 2: Supabase client
      try {
        const client = new SupabaseClient();
        updateResult('supabaseTest', true, 'SupabaseClient created successfully');
      } catch (error) {
        updateResult('supabaseTest', false, `SupabaseClient error: ${error.message}`);
      }
      
      // Test 3: Validation service
      try {
        const validator = new ValidationService();
        const testResult = validator.validatePhoneNumber('0812345678');
        updateResult('validationTest', testResult.isValid, 'ValidationService working correctly');
      } catch (error) {
        updateResult('validationTest', false, `ValidationService error: ${error.message}`);
      }
      
      // Test 4: UI components
      try {
        const ui = new UIComponents();
        updateResult('uiTest', true, 'UIComponents created successfully');
      } catch (error) {
        updateResult('uiTest', false, `UIComponents error: ${error.message}`);
      }
      
      console.log('‚úÖ Quick tests completed');
    });

    function testPhoneValidation() {
      const validator = new ValidationService();
      const results = document.getElementById('validationResults');
      
      const testCases = [
        { input: '0812345678', expected: true },
        { input: '0912345678', expected: true },
        { input: '0612345678', expected: true },
        { input: '1234567890', expected: false },
        { input: '081234567', expected: false },
        { input: 'abc', expected: false }
      ];
      
      let html = '<h4>Phone Validation Results:</h4>';
      testCases.forEach(test => {
        const result = validator.validatePhoneNumber(test.input);
        const passed = result.isValid === test.expected;
        html += `<div class="test-result ${passed ? 'pass' : 'fail'}">
          ${passed ? '‚úÖ' : '‚ùå'} "${test.input}" ‚Üí ${result.isValid ? 'Valid' : 'Invalid'} 
          ${result.isValid ? `(${result.sanitized})` : `(${result.errors[0]})`}
        </div>`;
      });
      
      results.innerHTML = html;
    }

    function testNameValidation() {
      const validator = new ValidationService();
      const results = document.getElementById('validationResults');
      
      const testCases = [
        { input: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ', expected: true },
        { input: 'John Doe', expected: true },
        { input: '‡∏Å', expected: false },
        { input: '', expected: false },
        { input: 'Test@123', expected: false }
      ];
      
      let html = '<h4>Name Validation Results:</h4>';
      testCases.forEach(test => {
        const result = validator.validatePatientName(test.input);
        const passed = result.isValid === test.expected;
        html += `<div class="test-result ${passed ? 'pass' : 'fail'}">
          ${passed ? '‚úÖ' : '‚ùå'} "${test.input}" ‚Üí ${result.isValid ? 'Valid' : 'Invalid'}
          ${result.isValid ? `(${result.sanitized})` : `(${result.errors[0]})`}
        </div>`;
      });
      
      results.innerHTML = html;
    }
  </script>
</body>
</html>